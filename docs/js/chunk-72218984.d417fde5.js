(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72218984"],{"0e25":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var s=i("c649");class r{constructor(){this.items=[]}addObject(t,e){this.items.push({type:0,objectStateId:e,object:t})}addRenderGeometry(t,e,i){this.items.push({type:1,objectStateId:e,renderGeometry:t,owner:i})}addExternal(t,e){this.items.push({type:2,objectStateId:e,remove:t})}remove(t){for(let e=this.items.length-1;e>=0;--e){const i=this.items[e];i.objectStateId===t&&(this._removeObjectStateItem(i),this.items.splice(e,1))}}removeObject(t){for(let e=this.items.length-1;e>=0;--e){const i=this.items[e];0===i.type&&i.object===t&&(this._removeObjectStateItem(i),this.items.splice(e,1))}}removeRenderGeometry(t){for(let e=this.items.length-1;e>=0;--e){const i=this.items[e];1===i.type&&i.renderGeometry===t&&(this._removeObjectStateItem(i),this.items.splice(e,1))}}removeAll(){this.items.forEach(t=>{this._removeObjectStateItem(t)}),this.items=[]}_removeObjectStateItem(t){switch(t.type){case 0:0===t.objectStateId.channel?t.object.removeHighlight(t.objectStateId):1===t.objectStateId.channel&&t.object.removeOcclude(t.objectStateId);break;case 1:t.owner.removeRenderGeometryObjectState(t.renderGeometry,t.objectStateId);break;case 2:t.remove(t.objectStateId)}}}class a{constructor(t,e){this.stateType=t,this.objectIdField=e,this.objectStateSet=new r,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}class n{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach(t=>t.objectStateSet.removeAll()),this._stateSets=null}acquireSet(t,e){const i=new a(t,e);this._stateSets.push(i);const r=Object(s["c"])(()=>this.releaseSet(i));return{set:i,handle:r}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const i=this._graphicsCore.graphics3DGraphics.get(e);i&&this._addObjectStateSet(i,t)}setUids(t,e){e.forEach(e=>this.setUid(t,e))}setObjectIds(t,e){e.forEach(e=>t.ids.add(e)),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach(e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)})}removeGraphic(t){this._stateSets.forEach(e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(t=>t.objectStateSet.removeAll())}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach(e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)}):t.ids.forEach(i=>{const s=e.get(i);s&&this._addObjectStateSet(s,t)})}get test(){return{states:this._stateSets}}}},"0efb":function(t,e,i){"use strict";i.d(e,"a",(function(){return E}));var s=i("a4ee"),r=i("8d60"),a=i("fc29"),n=i("2c4f"),h=i("af40"),c=i("b2b2"),o=i("f4cc"),l=i("3795"),d=i("59b2"),p=(i("b50f"),i("c120"),i("cea0"),i("d386")),u=i("0f1c"),g=i("a6a3"),b=i("d3cf"),y=i("69dd"),m=i("ed70"),f=i("4c84"),O=i("8202"),j=i("0e25"),v=i("3422"),S=i("ba58"),w=i("d347");let I=class extends a["a"]{constructor(t){super(t),this.graphicsCore=null,this.elevationAlignment=new O["a"],this.watchUpdatingTracking=new w["a"],this.handles=new h["a"],this.suspendResumeExtent=null}normalizeCtorArgs(t){let e=null;t.scaleVisibilityEnabled&&(delete(t={...t}).scaleVisibilityEnabled,e=new v["a"]);const i=new f["a"]({owner:t.owner,layer:t.layer,preferredUpdatePolicy:1,graphicSymbolSupported:!0});return{...t,graphicsCore:i,scaleVisibility:e}}initialize(){const t=this.scaleVisibility;Object(c["l"])(t)&&"minScale"in this.layer&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>t.layerMinMaxScaleChangeHandler()),"elevationInfo"in this.layer&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(t,e)=>{Object(u["a"])(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})}async setup(){const t=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.elevationAlignment.setup(this.owner,t,this.graphicsCore,this.view.elevationProvider),Object(c["l"])(this.scaleVisibility)&&"minScale"in this.layer){const e=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this.owner,this.layer,t,this.graphicsCore,e)}this._set("objectStates",new j["a"](this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(e){if(Object(o["m"])(e))return;throw e}this.destroyed||(this.handles.add(this.view.watch("clippingArea",()=>this.updateClippingExtent(),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles=Object(c["e"])(this.handles),this.watchUpdatingTracking.destroy(),this._set("elevationAlignment",Object(c["e"])(this.elevationAlignment)),this._set("scaleVisibility",Object(c["e"])(this.scaleVisibility)),this._set("objectStates",Object(c["e"])(this.objectStates)),this._set("graphicsCore",Object(c["e"])(this.graphicsCore))}get suspended(){return!(!Object(c["l"])(this.scaleVisibility)||!this.scaleVisibility.suspended)}get updating(){var t,e;return!!(null!=(t=this.graphicsCore)&&t.updating||Object(c["l"])(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(e=this.watchUpdatingTracking)&&e.updating)}getGraphicFromGraphicUid(t){if(this.owner.loadedGraphics){const e=this.owner.loadedGraphics.find(e=>e.uid===t);if(e){const t=this.layer instanceof g["a"]?this.layer:null;return Object(b["c"])(e,t)}}}whenGraphicBounds(t,e){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(t,e):Promise.reject()}computeAttachmentOrigin(t,e){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(t,e):null}getSymbolLayerSize(t,e){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(t,e):null}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t){if(t instanceof y["a"])return x;if("number"==typeof t)return this.highlight([t]);if(t instanceof r["a"])return this.highlight([t]);if(t instanceof n["a"]&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof r["a"]){const e=t.map(t=>t.uid),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,e),s}if("number"==typeof t[0]){const e=t,{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setObjectIds(i,e),s}}return x}updateClippingExtent(){const t=this.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}updateSuspendResumeExtent(){Object(c["k"])(this.scaleVisibility)||(this.suspendResumeExtent=Object(S["e"])(this.graphicsCore.computedExtent,this.suspendResumeExtent,m["a"],this.graphicsCore.extentPadding),this.scaleVisibility.setExtent(this.suspendResumeExtent))}setupSuspendResumeExtent(){Object(c["k"])(this.scaleVisibility)||(Object(l["a"])(this.graphicsCore,"computedExtent",t=>this.updateSuspendResumeExtent(),!0),this.graphicsCore.watch("extentPadding",t=>this.updateSuspendResumeExtent()))}};Object(s["a"])([Object(d["b"])({constructOnly:!0})],I.prototype,"owner",void 0),Object(s["a"])([Object(d["b"])({constructOnly:!0})],I.prototype,"layer",void 0),Object(s["a"])([Object(d["b"])({readOnly:!0,aliasOf:"owner.view"})],I.prototype,"view",void 0),Object(s["a"])([Object(d["b"])({constructOnly:!0})],I.prototype,"graphicsCore",void 0),Object(s["a"])([Object(d["b"])({constructOnly:!0})],I.prototype,"scaleVisibility",void 0),Object(s["a"])([Object(d["b"])({readOnly:!0})],I.prototype,"elevationAlignment",void 0),Object(s["a"])([Object(d["b"])({readOnly:!0})],I.prototype,"objectStates",void 0),Object(s["a"])([Object(d["b"])({readOnly:!0})],I.prototype,"watchUpdatingTracking",void 0),Object(s["a"])([Object(d["b"])({readOnly:!0})],I.prototype,"suspended",null),Object(s["a"])([Object(d["b"])({readOnly:!0})],I.prototype,"updating",null),I=Object(s["a"])([Object(p["a"])("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],I);const x={remove(){},pause(){},resume(){}},E=I},4637:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var s,r,a,n={exports:{}};s=n,r=function(){function t(t,i,r,a,n){e(t,i,r||0,a||t.length-1,n||s)}function e(t,s,r,a,n){for(;a>r;){if(a-r>600){var h=a-r+1,c=s-r+1,o=Math.log(h),l=.5*Math.exp(2*o/3),d=.5*Math.sqrt(o*l*(h-l)/h)*(c-h/2<0?-1:1);e(t,s,Math.max(r,Math.floor(s-c*l/h+d)),Math.min(a,Math.floor(s+(h-c)*l/h+d)),n)}var p=t[s],u=r,g=a;for(i(t,r,s),n(t[a],p)>0&&i(t,r,a);u<g;){for(i(t,u,g),u++,g--;n(t[u],p)<0;)u++;for(;n(t[g],p)>0;)g--}0===n(t[r],p)?i(t,r,g):i(t,++g,a),g<=s&&(r=g+1),s<=g&&(a=g-1)}}function i(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function s(t,e){return t<e?-1:t>e?1:0}return t},void 0!==(a=r())&&(s.exports=a);const h=n.exports},8202:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var s=i("a4ee"),r=i("fc29"),a=i("ce6d"),n=i("af40"),h=i("b2b2"),c=i("59b2"),o=(i("b50f"),i("c120"),i("cea0"),i("d386")),l=i("8a44"),d=i("9180"),p=i("9305");const u=.05;class g{constructor(){this._extents=new l["a"]({allocator:t=>t||Object(d["m"])()}),this._tmpExtent=Object(d["m"])(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this.contains(t)||(this.removeContained(t),Object(d["l"])(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=p["d"]){const e=this._extents,i=new Set;let s=0;for(;s!==e.length;){e.sort((t,e)=>t[0]-e[0]),s=e.length,i.clear();for(let s=0;s<e.length;++s){if(t.done)return;const r=e.getItemAt(s);for(let t=s+1;t<e.length;++t){const s=e.getItemAt(t);if(s[0]>=r[2])break;i.add(s)}i.forEach(s=>{if(r===s)return;if(s[2]<=r[0])return void i.delete(s);const a=Object(d["d"])(r),n=Object(d["d"])(s),h=this._tmpExtent;Object(d["q"])(r,s,h);const c=a+n;(Object(d["d"])(h)-c)/c<u&&(Object(d["l"])(r,h),i.delete(s),e.remove(s),t.madeProgress())}),i.add(r)}}this._dirty=!1}contains(t){return this._extents.some(e=>Object(d["g"])(e,t))}removeContained(t){this._extents.filterInPlace(e=>!Object(d["g"])(t,e))}get test(){const t=this;return{containsPoint:e=>t._extents.some(t=>Object(d["h"])(t,e))}}}let b=class extends r["a"]{constructor(){super(...arguments),this.dirtyExtents=new g,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new n["a"],this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new a["a"]}setup(t,e,i,s){this.layerView=t,this.queryGraphicUIDsInExtent=e,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on("elevation-change",t=>this._elevationChanged(t)),this.layerView.watch("suspended",()=>this.suspendedChange()),r.registerTask(p["b"].ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(t){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,t.madeProgress()),t.run(()=>this.dirtyExtents.merge(t));this.running&&!t.done;)this._updateDirtyGraphics(t),this._updateDirtyExtents(t);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(t){const e=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this.dirtyGraphicsSet.keys()){const r=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),Object(h["l"])(r)&&(r.alignWithElevation(this.elevationProvider,e,i),t.madeProgress()),t.done)return}}_updateDirtyExtents(t){for(;!this.dirtyExtents.empty&&!t.done;){const e=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:e,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(e,i,t=>{const e=this.graphicsCore.getGraphics3DGraphicById(t);Object(h["l"])(e)&&e.needsElevationUpdates()&&this.dirtyGraphicsSet.add(t)}),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,t.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((t,e)=>this.dirtyGraphicsSet.add(e))}_elevationChanged(t){if("scene"===t.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:e,spatialReference:i}=t;if(this.layerView.suspended){if(!this.updateElevation){const t=this.graphicsCore.computedExtent;t&&e[2]>t.xmin&&e[0]<t.xmax&&e[3]>t.ymin&&e[1]<t.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:e,spatialReference:i})}else e[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(e),this.notifyChange("updating")}};Object(s["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"updating",null),Object(s["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"updatingRemaining",null),b=Object(s["a"])([Object(o["a"])("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],b);const y=b},bb49:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return y}));var s=i("a4ee"),r=i("b2b2"),a=i("3795"),n=i("59b2"),h=(i("b50f"),i("c120"),i("cea0"),i("d386")),c=i("66af"),o=i("ebae"),l=i("0efb"),d=i("ba58"),p=i("eec2"),u=i("365a");const g=1.2;let b=class extends(Object(c["a"])(u["a"])){constructor(){super(...arguments),this.type="graphics-3d",this.frustumVisibility=new o["a"],this.slicePlaneEnabled=!1,this.drapeSourceType=1,this.suspendResumeExtent=null,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set("graphics3d",new l["a"]({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",()=>this.graphics3d.graphicsCore.opacityChange()),this.handles.add(this.layer.on("graphic-update",t=>this.graphics3d.graphicsCore.graphicUpdateHandler(t))),this.addResolvingPromise(Object(p["a"])(this).then(t=>this.fullExtentInLocalViewSpatialReference=t)),this.layer.internal?this.notifyChange("updating"):this.handles.add(Object(a["m"])(this.view,"basemapTerrain.ready",()=>this.notifyChange("updating")))}destroy(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))}get legendEnabled(){return this.canResume()&&!this.frustumVisibility.suspended}get suspendInfo(){var t;const e={};return Object(r["l"])(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(e.outsideScaleRange=!0),e.outsideOfView=!(null==(t=this.frustumVisibility)||!t.suspended),e}async fetchPopupFeatures(t,e){return Object(r["l"])(e)?e.clientGraphics:null}notifyGraphicGeometryChanged(t){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(t)}notifyGraphicVisibilityChanged(t){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(t)}get graphics3DGraphics(){return this.graphics3d.graphicsCore.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}get symbolUpdateType(){return this.graphics3d.graphicsCore.symbolUpdateType}getGraphicFromGraphicUid(t){return this.graphics3d.getGraphicFromGraphicUid(t)}whenGraphicBounds(t,e){return this.graphics3d.whenGraphicBounds(t,e)}computeAttachmentOrigin(t,e){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(t,e):null}getSymbolLayerSize(t,e){return this.graphics3d.getSymbolLayerSize(t,e)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(t){return this.graphics3d.maskOccludee(t)}highlight(t){return this.graphics3d.highlight(t)}get updatePolicy(){var t;return(null==(t=this.graphics3d)?void 0:t.graphicsCore.effectiveUpdatePolicy)||1}canResume(){var t;return super.canResume()&&!(null!=(t=this.graphics3d)&&t.suspended)}isUpdating(){var t,e;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(t=this.view)&&null!=(e=t.basemapTerrain)&&e.ready))}setupSuspendResumeExtent(){const t=()=>{this.suspendResumeExtent=Object(d["e"])(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,g,this.graphics3d.graphicsCore.extentPadding),this.frustumVisibility.setExtent(this.suspendResumeExtent)};Object(a["a"])(this.graphics3d.graphicsCore,"computedExtent",()=>t(),!0),Object(a["e"])(this.graphics3d.graphicsCore,"extentPadding",()=>t(),!0)}get performanceInfo(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}};Object(s["a"])([Object(n["b"])({aliasOf:"layer.graphics"})],b.prototype,"loadedGraphics",void 0),Object(s["a"])([Object(n["b"])({readOnly:!0})],b.prototype,"suspended",void 0),Object(s["a"])([Object(n["b"])({readOnly:!0})],b.prototype,"legendEnabled",null),Object(s["a"])([Object(n["b"])({readOnly:!0})],b.prototype,"updating",void 0),Object(s["a"])([Object(n["b"])()],b.prototype,"layer",void 0),Object(s["a"])([Object(n["b"])({readOnly:!0})],b.prototype,"frustumVisibility",void 0),Object(s["a"])([Object(n["b"])({readOnly:!0})],b.prototype,"graphics3d",void 0),Object(s["a"])([Object(n["b"])({type:Boolean})],b.prototype,"slicePlaneEnabled",void 0),Object(s["a"])([Object(n["b"])({readOnly:!0})],b.prototype,"suspendInfo",null),b=Object(s["a"])([Object(h["a"])("esri.views.3d.layers.GraphicsLayerView3D")],b);const y=b},d97e:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var s=i("b2b2");function r(t,e){return t?e?4:3:e?3:2}function a(t,e,i,a,c){if(Object(s["k"])(e)||!e.lengths.length)return null;const o="upperLeft"===(null==c?void 0:c.originPosition)?-1:1;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const l=t.coords,d=[],p=i?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:g}=e,b=r(i,a);let y=0;for(const s of u){const t=n(p,g,y,s,i,a,o);t&&d.push(t),y+=s*b}if(d.sort((t,e)=>{let s=o*t[2]-o*e[2];return 0===s&&i&&(s=t[4]-e[4]),s}),d.length){let t=6*d[0][2];l[0]=d[0][0]/t,l[1]=d[0][1]/t,i&&(t=6*d[0][4],l[2]=0!==t?d[0][3]/t:0),(l[0]<p[0]||l[0]>p[1]||l[1]<p[2]||l[1]>p[3]||i&&(l[2]<p[4]||l[2]>p[5]))&&(l.length=0)}if(!l.length){const t=e.lengths[0]?h(g,0,u[0],i,a):null;if(!t)return null;l[0]=t[0],l[1]=t[1],i&&t.length>2&&(l[2]=t[2])}return t}function n(t,e,i,s,a,n,h=1){const c=r(a,n);let o=i,l=i+c,d=0,p=0,u=0,g=0,b=0;for(let r=0,m=s-1;r<m;r++,o+=c,l+=c){const i=e[o],s=e[o+1],r=e[o+2],n=e[l],h=e[l+1],c=e[l+2];let y=i*h-n*s;g+=y,d+=(i+n)*y,p+=(s+h)*y,a&&(y=i*c-n*r,u+=(r+c)*y,b+=y),i<t[0]&&(t[0]=i),i>t[1]&&(t[1]=i),s<t[2]&&(t[2]=s),s>t[3]&&(t[3]=s),a&&(r<t[4]&&(t[4]=r),r>t[5]&&(t[5]=r))}if(g*h>0&&(g*=-1),b*h>0&&(b*=-1),!g)return null;const y=[d,p,.5*g];return a&&(y[3]=u,y[4]=.5*b),y}function h(t,e,i,s,a){const n=r(s,a);let h=e,p=e+n,u=0,g=0,b=0,y=0;for(let r=0,m=i-1;r<m;r++,h+=n,p+=n){const e=t[h],i=t[h+1],r=t[h+2],a=t[p],n=t[p+1],m=t[p+2],f=s?o(e,i,r,a,n,m):c(e,i,a,n);if(f)if(u+=f,s){const t=d(e,i,r,a,n,m);g+=f*t[0],b+=f*t[1],y+=f*t[2]}else{const t=l(e,i,a,n);g+=f*t[0],b+=f*t[1]}}return u>0?s?[g/u,b/u,y/u]:[g/u,b/u]:i>0?s?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function c(t,e,i,s){const r=i-t,a=s-e;return Math.sqrt(r*r+a*a)}function o(t,e,i,s,r,a){const n=s-t,h=r-e,c=a-i;return Math.sqrt(n*n+h*h+c*c)}function l(t,e,i,s){return[t+.5*(i-t),e+.5*(s-e)]}function d(t,e,i,s,r,a){return[t+.5*(s-t),e+.5*(r-e),i+.5*(a-i)]}},ebae:function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var s=i("a4ee"),r=i("fc29"),a=i("af40"),n=i("3795"),h=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),o=i("f694"),l=i("6b38"),d=i("9305");const p=1.2;let u=class extends r["a"]{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new a["a"],this.layerView=null,this.updating=!0}setup(t){this.layerView=t,this.extentIntersection=new l["a"]({renderCoordsHelper:t.view.renderCoordsHelper});const e=t.view,i=e.basemapTerrain,s=e.resourceController.scheduler;this.handles.add([e.on("resize",()=>this.viewChange()),e.state.watch("camera",()=>this.viewChange(),!0),s.registerTask(d["b"].FRUSTUM_VISIBILITY,this),i.on("elevation-bounds-change",()=>this.elevationBoundsChange())]),"local"===e.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(n["a"])(i,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),Object(n["a"])(e,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(t){this.extent=t,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(t){this._isVisibleBelowSurface=t,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const t=this.layerView.view,e=t.basemapTerrain,i="local"===t.viewingMode,s=t.map.ground&&t.map.ground.navigationConstraint&&"none"===t.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!e.opaque||s}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const t=this.layerView.view;let e;if(this._isVisibleBelowSurface)e=-.3*Object(o["e"])(t.spatialReference).radius;else{const{min:i,max:s}=t.basemapTerrain.elevationBounds;e=i-Math.max(1,(s-i)*(p-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this.updateExtentIntersection();const t=this.layerView.view.frustum,e=Object(o["e"])(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(t,e))}};Object(s["a"])([Object(h["b"])({readOnly:!0})],u.prototype,"suspended",void 0),Object(s["a"])([Object(h["b"])({readOnly:!0})],u.prototype,"updating",void 0),u=Object(s["a"])([Object(c["a"])("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],u);const g=u},eec2:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var s=i("b2b2"),r=i("9786"),a=i("e2e8");function n(t){const e=t.view.spatialReference,i=t.layer.fullExtent,n=Object(s["l"])(i)&&i.spatialReference;if(Object(s["k"])(i)||!n)return Promise.resolve(null);if(n.equals(e))return Promise.resolve(i.clone());const h=Object(r["d"])(i,e);return Object(s["l"])(h)?Promise.resolve(h):t.view.state.isLocal?Object(a["projectGeometry"])(i,e,t.layer.portalItem).then(e=>!t.destroyed&&e?e:void 0).catch(()=>null):Promise.resolve(null)}}}]);
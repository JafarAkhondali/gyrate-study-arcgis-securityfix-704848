(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c7a01e0"],{"82de":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c}));var n=i("0b2d"),r=i("f694"),s=i("8188"),o=i("afe1");function a(e,t,i,n){const r=c(e,t,i),a=Object(o["b"])();return Object(s["d"])(i,r,a,n),a}const l=1,d=5-l;function c(e,t,i){const s=Object(n["e"])(),o=e[3],a=2**(Math.ceil(Math.log(o)*Math.LOG2E/d)*d+l);if(i.isGeographic){const t=a/Object(r["e"])(i).radius*180/Math.PI,n=Math.round(e[1]/t),o=Math.max(-90,Math.min(90,n*t)),l=t/Math.cos((Math.abs(o)-t/2)/180*Math.PI),d=Math.round(e[0]/l)*l;s[0]=d,s[1]=o}else{const t=Math.round(e[0]/a),i=Math.round(e[1]/a);s[0]=t*a,s[1]=i*a}const c=e[2]+t,u=Math.round(c/a);return s[2]=u*a,s}},9056:function(e,t,i){"use strict";i.r(t);var n=i("a4ee"),r=(i("c120"),i("a21b")),s=i("b2b2"),o=i("e92d"),a=(i("cea0"),i("59b2")),l=i("d386"),d=(i("e041"),i("8eed"),i("f402"),i("f4cc")),c=i("2c4f"),u=i("e5ec"),h=i("4106"),p=(i("5970"),i("c1da")),f=i("a915"),b=i("792b"),g=i("e431"),_=i("8048"),m=i("9180"),y=i("8188"),O=i("8076"),j=i("306f"),x=i("9305"),S=i("4261"),v=i("5e70"),w=i("1a54"),P=i("47f8"),z=i("d0ac"),M=i("4b49"),N=i("66af"),C=i("9ee2"),R=i("365a"),A=i("cee3"),I=i("ee9c"),k=i("78ba");class F extends k["a"]{constructor(e){super("PointCloudWorker","transform",e)}getTransferList(e){const t=[e.geometryBuffer];if(Object(s["k"])(e.primaryAttributeData)&&e.primaryAttributeData.buffer&&t.push(e.primaryAttributeData.buffer),Object(s["k"])(e.modulationAttributeData)&&e.modulationAttributeData.buffer&&t.push(e.modulationAttributeData.buffer),Object(s["k"])(e.filterAttributesData))for(const i of e.filterAttributesData)Object(s["k"])(i)&&i.buffer&&t.push(i.buffer);for(const i of e.userAttributesData)i.buffer&&t.push(i.buffer);return t}}function V(e,t,i){for(let r=0;r<t.length;r++)L[r]=!1,U[r]=null;for(let r=0;r<e.length;r++)q[r]=!1,E[r]=null;for(let r=0;r<t.length;r++){const n=D(t[r],e,i);n>=0&&(L[r]=!0,null!=E[n]?E[n].push(t[r]):E[n]=[t[r]])}for(let r=0;r<e.length;r++){const n=D(e[r],t,i);n>=0&&(q[r]=!0,null!=U[n]?U[n].push(e[r]):U[n]=[e[r]])}const n=[];for(let r=0;r<e.length;r++)null!=E[r]||q[r]||n.push({load:[],remove:[e[r]]});for(let r=0;r<t.length;r++)null!=U[r]||L[r]||n.push({load:[t[r]],remove:[]});for(let r=0;r<t.length;r++)null!=U[r]&&(U[r].length>1||U[r][0]!==t[r])&&n.push({load:[t[r]],remove:U[r]});for(let r=0;r<e.length;r++)null!=E[r]&&(E[r].length>1||E[r][0]!==e[r])&&n.push({load:E[r],remove:[e[r]]});return n}const q=[!1],E=[null],L=[!1],U=[null];function D(e,t,i){let n=e;for(;n>0;){const e=t.indexOf(n);if(e>=0)return e;n=i.getParentId(n)}return t.indexOf(n)}function W(e,t,i){return e.sort((e,n)=>{if(0===e.load.length&&0===n.load.length)return 0;if(0===e.load.length)return-1;if(0===n.load.length)return 1;if(0===e.remove.length&&0===n.remove.length){const r=i.getRenderCenter(e.load[0]),s=i.getRenderCenter(n.load[0]);return Object(g["i"])(r,t)-Object(g["i"])(s,t)}if(0===e.remove.length)return-1;if(0===n.remove.length)return 1;if(1===e.load.length&&1===n.load.length){const r=i.getRenderCenter(e.load[0]),s=i.getRenderCenter(n.load[0]);return Object(g["i"])(r,t)-Object(g["i"])(s,t)}if(1===e.load.length)return-1;if(1===n.load.length)return 1;{const r=i.getRenderCenter(e.remove[0]),s=i.getRenderCenter(n.remove[0]);return Object(g["i"])(r,t)-Object(g["i"])(s,t)}})}function H(e,t,i){for(let n=0;n<e.length;++n){const r=e[n];r.load.length>t&&1===r.remove.length&&T(e,r,i)}}function T(e,t,i){const n=[t.remove[0]],r=[];for(;1===n.length;){const e=n.pop();r.length=0;for(let s=0;s<t.load.length;s++){let o=t.load[s],a=i.getParentId(o);for(;a!==e;)o=a,a=i.getParentId(o);let l=n.indexOf(o);l<0&&(l=n.length,n.push(o),r.push([])),r[l].push(t.load[s])}}t.load=n;for(let s=0;s<n.length;s++)r[s].length>1?e.push({remove:[n[s]],load:r[s]}):n[s]=r[s][0]}class Q{constructor(e,t,i){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=i}addPage(e,t,i=0){for(;this._pages.length<e;)this._pages.push(null);const n=B(t,this._nodeSR,this._renderSR,i);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},$(this._pages,this.pageSize)}hasPage(e){return!!this._pages[e]}getNode(e){const t=this.pageSize;return this._pages[J(e,t)].nodes[K(e,t)]}getRenderObb(e){const t=this.pageSize;return this._pages[J(e,t)].renderObbs[K(e,t)]}getRenderCenter(e){return this.getRenderObb(e).center}setRenderObb(e,t){const i=this.pageSize;Object(A["l"])(t,this._pages[J(e,i)].renderObbs[K(e,i)])}getParentId(e){const t=this.pageSize;return this._pages[J(e,t)].parents[K(e,t)]}hasNodes(e,t){const i=J(e,this.pageSize),n=J(e+t-1,this.pageSize);for(let r=i;r<=n;r++)if(null==this._pages[r])return!1;return!0}forEachNodeId(e){for(let t=0;t<this._pages.length;t++){const i=this._pages[t];if(i)for(let n=0;n<i.nodes.length;n++)e(t*this.pageSize+n)}}createVisibilityTraverse(){const e={index:this,queue:[],masks:[],tempAabb:Object(S["h"])()};return(t,i)=>G(e,t,i)}}function G(e,t,i){const n=e.index;if(!n.hasNodes(0,1))return;const r=e.queue;r.length=0,r.push(0);const s=e.masks;for(s.length=0,s.push(0);r.length>0;){const o=r.pop();let a=s.pop();const l=n.getNode(o),d=n.getRenderObb(o);let c=!0;if(null!=t.clippingBox){const i=1<<t.frustum.length;if(0==(a&i)){const n=Object(A["m"])(d,e.tempAabb);Object(S["f"])(t.clippingBox,n)?a|=i:Object(S["w"])(t.clippingBox,n)||(c=!1)}}for(let e=0;e<t.frustum.length&&c;e++){const i=1<<e;if(0==(a&i)){const n=Object(A["g"])(d,t.frustum[e]);n>0?c=!1:n<0&&(a|=i)}}if(i.predicate(o,l,c)){const e=l.firstChild,t=l.childCount;let d=!1;const c=J(e,n.pageSize),u=J(e+t-1,n.pageSize);for(let r=c;r<=u;r++)if(!n.hasPage(r)){i.pageMiss(o,r),d=!0;break}if(!d)for(let i=0;i<t;i++)r.push(e+i),s.push(a)}}}function B(e,t,i,n){const r=new A["a"](e.length);for(let s=0;s<e.length;s++)Object(I["y"])(e[s].obb,t,r.obbs[s],i,n);return r.obbs}function $(e,t){const i=[0];for(;i.length;){const n=i.pop(),r=e[J(n,t)].nodes[K(n,t)];for(let s=0;s<r.childCount;s++){const o=r.firstChild+s;null!=e[J(o,t)]&&(e[J(o,t)].parents[K(o,t)]=n,i.push(o))}}}function J(e,t){return e/t|0}function K(e,t){return e%t}var Y=Q;function Z(e){const t=e.renderer,i=t&&t.type,n=t&&e.renderer.toJSON()||null;let r=null,s=!1;"point-cloud-unique-value"===i||"point-cloud-stretch"===i||"point-cloud-class-breaks"===i?r=re(e.attributeStorageInfo,t.field):"point-cloud-rgb"===i?(r=ne(e.attributeStorageInfo,t.field),s=null!=r):(r=ne(e.attributeStorageInfo,"RGB"),s=null!=r);let o=null;return t&&t.colorModulation&&(o=re(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:s,primaryAttribute:r,modulationAttribute:o}}function X(e){const t=e.filters;return t?t.map(t=>({filterJSON:t.toJSON(),attributeInfo:re(e.attributeStorageInfo,t.field)})):[]}function ee(e){const t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null}function te(e){const t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null}function ie(e){const t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}function ne(e,t){for(const i of e)if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{name:t,storageInfo:i,useElevation:!1};return null}function re(e,t){for(const i of e)if(i.name===t){const e="embedded-elevation"===i.encoding;return{name:t,storageInfo:e?null:i,useElevation:e}}return"elevation"===t.toLowerCase()?{name:t,storageInfo:null,useElevation:!0}:null}var se,oe=i("05ff"),ae=i("8d60");let le=se=class extends ae["a"]{constructor(e){super(e)}clone(){return new se(this.cloneProperties())}cloneProperties(){const{pointCloudMetadata:e}=this;return{...super.cloneProperties(),pointCloudMetadata:e}}};Object(n["a"])([Object(a["b"])({constructOnly:!0})],le.prototype,"pointCloudMetadata",void 0),le=se=Object(n["a"])([Object(l["a"])("esri.views.3d.layers.i3s.PointGraphic")],le);var de=i("8a44"),ce=i("0b2d"),ue=i("d791"),he=i("afe1"),pe=i("7577"),fe=i("fa1e"),be=i("970c"),ge=i("7ce4"),_e=i("0fa6"),me=i("a978"),ye=i("d272"),Oe=i("6a07"),je=i("c649"),xe=i("bea9");class Se{constructor(e){this.context=e,this.highlights=new Set}get hasHighlights(){return this.highlights.size>0}destroy(){this.highlights=null}add(e){const t=new ve(e);return this.highlights.add(t),this.enableSet(t),Object(je["c"])(()=>this.removeSet(t))}removeSet(e){this.disableSet(e),this.highlights.delete(e)}enableSet(e){e.enabled||(e.enabled=!0,this.context.forEachNode(t=>this.enableSetForNode(e,t)))}enableSetForNode(e,t){if(!e.enabled)return;const i=e.ids.get(t.id);i&&i.forEach(i=>this.context.addHighlight(t,i,e.id))}disableSet(e){e.enabled&&(e.enabled=!1,this.context.forEachNode(t=>this.disableSetForNode(e,t)))}disableSetForNode(e,t){e.enabled||this.context.removeHighlight(t,e.id)}nodeAdded(e){this.highlights.forEach(t=>this.enableSetForNode(t,e))}nodeRemoved(e){this.highlights.forEach(t=>this.disableSetForNode(t,e))}removeAll(){this.highlights.forEach(e=>this.disableSet(e))}}class ve{constructor(e){this.id=new xe["a"](0),this.ids=new Map,this.enabled=!1;for(const t of e)Object(s["k"])(t)&&this.add(t.nodeId,t.pointId)}add(e,t){const i=this.ids.get(e);i?i.add(t):this.ids.set(e,new Set([t]))}}var we=i("c3a4"),Pe=i("ca98"),ze=i("da35"),Me=i("8e37"),Ne=i("189c"),Ce=i("87b7"),Re=i("bc58");class Ae extends Pe["a"]{constructor(e,t){super(e,t)}initializeProgram(e){const t=Ae.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:i.drawScreenSize});return new Me["a"](e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),fe["a"])}initializePipeline(){return Object(Ne["e"])({depthTest:{func:513},depthWrite:Ne["d"],colorWrite:Ne["c"],stencilWrite:this.configuration.sceneHasOcludees?Ce["j"]:null,stencilTest:this.configuration.sceneHasOcludees?Ce["e"]:null})}}Ae.shader=new we["a"](Re["a"],()=>i.e("chunk-2d207ae6").then(i.bind(null,"a221")));class Ie extends ze["a"]{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.drawScreenSize=!1,this.sceneHasOcludees=!1}}Object(n["a"])([Object(ze["b"])({count:8})],Ie.prototype,"output",void 0),Object(n["a"])([Object(ze["b"])()],Ie.prototype,"slicePlaneEnabled",void 0),Object(n["a"])([Object(ze["b"])()],Ie.prototype,"drawScreenSize",void 0),Object(n["a"])([Object(ze["b"])()],Ie.prototype,"sceneHasOcludees",void 0);const ke={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};class Fe{constructor(e){this._params=e,this.type="Point",this.isGround=!1,this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null},this._highlights=new Se({forEachNode:e=>this.forEachNode(e),addHighlight:(e,t,i)=>this.addHighlight(e,t,i),removeHighlight:(e,t)=>this.removeHighlight(e,t)}),this.canRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=Object(S["h"])(S["b"]),this._techniqueConfig=new Ie,this.tempMatrix4=Object(be["a"])(),this.tempVec3=Object(P["c"])(),this.nodes=new de["a"]}get needsHighlight(){return this._highlights.hasHighlights}initializeRenderContext(e){this._context=e,this._techniqueRep=this._context.shaderTechniqueRep,e.requestRender()}uninitializeRenderContext(){}intersect(e,t,i,n){const r=Object(ce["e"])(),s=Object(ce["e"])(),o=Object(ce["e"])(),a=Object(ce["e"])(),l=z["f"].create(),d=e.camera.perScreenPixelRatio/2,c=e.camera.near,u=this._getSizeParams();Object(g["k"])(s,n,i);const h=1/Object(g["q"])(s);Object(g["f"])(s,s,h),Object(g["u"])(o,s),Object(pe["l"])(l,s[0],s[1],s[2],-Object(g["i"])(s,i));class p{constructor(){this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=""}}const f=new p,b=new p,_=[],m=Object(S["h"])(),y=Object(S["h"])(this._clipBox);Object(S["A"])(y,-i[0],-i[1],-i[2],y),this.nodes.forAll(O=>{const j=O.splatSize*this._scaleFactor;let x=Object(A["j"])(O.obb,l),v=Object(A["i"])(O.obb,l);x-=Ee(j,x+c,u,d,O.isLeaf),v-=Ee(j,v+c,u,d,O.isLeaf);const w=v<0,P=null!=f.dist&&null!=b.dist&&f.dist<x*h&&b.dist>v*h;if(w||P)return;const z=qe(j,v+c,u,d,O.isLeaf);if(!Object(A["f"])(O.obb,i,s,z))return;const M=z*z;Object(A["m"])(O.obb,m),Object(S["A"])(m,-i[0],-i[1],-i[2],m);const N=!Object(S["f"])(y,m);Object(g["k"])(a,O.origin,i);const C=O.coordinates.length/3;for(let l=0;l<C;l++){if(r[0]=a[0]+O.coordinates[3*l],r[1]=a[1]+O.coordinates[3*l+1],r[2]=a[2]+O.coordinates[3*l+2],N&&!Object(S["g"])(y,r))continue;const m=Object(g["i"])(r,s),x=Object(g["t"])(r)-m*m;if(x>M)continue;let v=m+c;const w=Ee(j,v,u,d,O.isLeaf);if(m-w<0)continue;v-=w;const P=qe(j,v,u,d,O.isLeaf);if(x>P*P)continue;const z=(m-w)*h,C=e=>{e.point=Le(O,l,e.point),e.dist=z,e.normal=o,e.node=O,e.pointId=l,e.layerUid=this.layerUid};if((null==f.dist||z<f.dist)&&(null==t||t(i,n,z))&&C(f),0!==e.options.store&&(null==b.dist||z>b.dist)&&(null==t||t(i,n,z))&&C(b),2===e.options.store&&(null==t||t(i,n,z))){const e=new p;C(e),_.push(e)}}});const O=e=>{const{layerUid:t,node:i,pointId:n}=e;return{type:"external",point:e.point,metadata:{layerUid:t,createGraphic:()=>this._params.createGraphic(i,n,e.point)}}},j=(e,t)=>{const i=O(t),n=`${t.layerUid}/${t.node.id}/${t.pointId}`;e.set(i,n,t.dist,t.normal,he["a"],void 0),e.intersector="PointRenderer"};if(null!=f.dist){const t=e.results.min;(null==t.dist||f.dist<t.dist)&&j(t,f)}if(null!=b.dist&&0!==e.options.store){const t=e.results.max;(null==t.dist||b.dist>t.dist)&&j(t,b)}if(2===e.options.store){const t=z["g"].fromPoints(i,n);for(const i of _){const n=new me["b"](t);j(n,i),e.results.all.push(n)}}}render(e){if(0!==e.pass&&2!==e.pass&&5!==e.pass)return!1;const t=2===e.pass,i=e.rctx;this.nodes.forAll(t=>{null==t.vao&&this._initNode(e,t)});const n=this._getSizeParams(),r=this.selectTechnique(e,n),s=r.program;if(null==s||0===this.nodes.length)return!0;const o=this._clipBox,a=!Object(S["l"])(o,S["b"],(e,t)=>e===t);a||(Object(g["x"])(this.tempVec3,-1/0,-1/0,-1/0),s.setUniform3fv("uClipMin",this.tempVec3),Object(g["x"])(this.tempVec3,1/0,1/0,1/0),s.setUniform3fv("uClipMax",this.tempVec3)),i.bindProgram(s),r.bindPipelineState(i),s.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),t&&s.setUniform2f("nearFar",e.camera.near,e.camera.far),e.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/e.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/e.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=e.highlightDepthTexture,Oe["a"].bindOutputHighlight(i,s,this._bindParameters));const l=e.camera.pixelRatio;n.drawFixedSize&&s.setUniform2f("uPointScale",n.fixedSize*l,e.camera.fullHeight);const d=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null;return this.nodes.forAll(t=>{if(0===t.coordinates.length||e.isHighlightPass&&!t.highlights)return;if(s.setUniform2f("uScreenMinMaxSize",n.screenMinSize*l,Ve(t.isLeaf)*l),!n.drawFixedSize){const i=t.splatSize*this._scaleFactor;s.setUniform2f("uPointScale",i*l,e.camera.fullHeight/l)}const c=t.origin;a&&(Object(g["x"])(this.tempVec3,o[0]-c[0],o[1]-c[1],o[2]-c[2]),s.setUniform3fv("uClipMin",this.tempVec3),Object(g["x"])(this.tempVec3,o[3]-c[0],o[4]-c[1],o[5]-c[2]),s.setUniform3fv("uClipMax",this.tempVec3)),Object(ue["i"])(this.tempMatrix4),Object(ue["t"])(this.tempMatrix4,this.tempMatrix4,c),Object(ue["m"])(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),s.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),ye["a"].bindUniforms(s,r.configuration,d,c),i.bindVAO(t.vao),e.isHighlightPass?this._renderHighlightFragments(i,t):i.drawArrays(0,0,t.coordinates.length/3)}),!0}_renderHighlightFragments(e,t){const i=t.highlights;if(Object(s["j"])(i))return;let n=Object(s["t"])(i[0].component),r=n+1;for(let a=1;a<i.length;a++){const t=Object(s["t"])(i[a].component);if(t!==r){const i=r-n;i>0&&e.drawArrays(0,n,i),n=t}r=t+1}const o=r-n;o>0&&e.drawArrays(0,n,o)}set useFixedSizes(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())}get useFixedSizes(){return this._useFixedSizes}set scaleFactor(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())}get scaleFactor(){return this._scaleFactor}set minSizePx(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())}get minSizePx(){return this._minSizePx}set useRealWorldSymbolSizes(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())}get useRealWorldSymbolSizes(){return this._useRealWorldSymbolSizes}set size(e){this._size!==e&&(this._size=e,this._requestRender())}get size(){return this._size}set sizePx(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())}get sizePx(){return this._sizePx}set clippingBox(e){Object(S["C"])(this._clipBox,e||S["b"])}get slicePlane(){return this._slicePlaneEnabled}set slicePlane(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender())}get intersectionHandlerId(){return this.layerUid}addNode(e){this.nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()}removeNode(e){let t=null;return this.nodes.filterInPlace(i=>i.id!==e||(t=i,i.vao=Object(s["f"])(i.vao),this._highlights.nodeRemoved(i),!1)),this._requestRender(),t}forEachNode(e){this.nodes.forAll(e)}removeAll(){this.nodes.forAll(e=>e.vao=Object(s["f"])(e.vao)),this._highlights.removeAll(),this.nodes.clear(),this._requestRender()}highlight(e){return this._highlights.add(e)}addHighlight(e,t,i){e.highlights=De(e.highlights,t,i),this._requestRender()}removeHighlight(e,t){e.highlights=We(e.highlights,t),this._requestRender()}_initNode(e,t){const i=e.rctx;t.vao=new _e["a"](i,fe["a"],ke,{positions:ge["a"].createVertex(i,35044,t.coordinates),colors:ge["a"].createVertex(i,35044,t.rgb)})}_requestRender(){this._context&&this._context.requestRender()}_getSizeParams(){const e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,i=t?this._sizePx:this._size;let n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:i,screenMinSize:n}}selectTechnique(e,t){return this._techniqueConfig.drawScreenSize=t.drawScreenSpace,this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled,this._techniqueConfig.sceneHasOcludees=e.hasOccludees,this._techniqueConfig.output=2===e.pass?1:5===e.pass?4:0,this._techniqueRep.acquireAndReleaseExisting(Ae,this._techniqueConfig,this._technique)}}function Ve(e){return e?256:64}function qe(e,t,i,n,r){if(i.drawScreenSpace)return i.fixedSize*t*n;const s=Ve(r)*t*n;return i.drawFixedSize?Math.min(i.fixedSize/2,s):i.screenMinSize>0?Math.min(Math.max(i.screenMinSize*t*n,e/2),s):Math.min(e/2,s)}function Ee(e,t,i,n,r){return i.drawScreenSpace?0:qe(e,t,i,n,r)}function Le(e,t,i){return null==i&&(i=Object(ce["e"])()),i[0]=e.origin[0]+e.coordinates[3*t],i[1]=e.origin[1]+e.coordinates[3*t+1],i[2]=e.origin[2]+e.coordinates[3*t+2],i}function Ue(e){return Object(s["k"])(e.component)?e.component:-1}function De(e,t,i){Object(s["j"])(e)&&(e=[]);const n={component:t,id:i};e.push(n);const r=Ue(n);let o=e.length-1;for(;o>0&&r<Ue(e[o-1]);)[e[o-1],e[o]]=[e[o],e[o-1]],--o;return e}function We(e,t){if(Object(s["j"])(e))return e;const i=e.filter(e=>e.id!==t);return 0===i.length?null:i}!function(e){function t(e){return e.hasOwnProperty("splatSize")}e.isInstanceOfNode=t}(Fe||(Fe={}));var He=i("f7f0");const Te=o["a"].getLogger("esri.views.3d.layers.PointCloudLayerView3D"),Qe=8,Ge=z["f"].create();let Be=class extends(Object(He["a"])(Object(N["a"])(R["a"]))){constructor(){super(...arguments),this.maximumPointCount=4e6,this.slicePlaneEnabled=!1,this._renderer=null,this._rendererAdded=!1,this._renderedNodes=new Set,this._nodeScales=new Map,this._updateViewNeeded=!0,this._lodFactor=1,this._maxLoggedBoxWarnings=5,this._pageMultiplier=1,this._nodeLoadEpoch=0,this._indexQueue=[],this._workQueue=new Array,this._idleQueue=new j["a"],this._indexPagesLoading=new Map,this._loadingNodes=new Map,this._recalcWork=!0,this._layerIsVisible=!1,this._codedDomainPopulationPromise=null,this._codedDomainPopulationAbortController=null,this._totalWork=0,this._index=null,this._loadingInitNodePage=!1,this._nodeIdArray=[]}get pointScale(){const e=ee(this.layer&&this.layer.renderer),t=1;return e&&null!=e.scaleFactor?e.scaleFactor:t}get useRealWorldSymbolSizes(){const e=te(this.layer&&this.layer.renderer),t=!1;return e&&null!=e.useRealWorldSymbolSizes?e.useRealWorldSymbolSizes:t}get pointSize(){const e=te(this.layer&&this.layer.renderer),t=0;return e&&null!=e.size?e.size:t}get inverseDensity(){const e=96;return this.layer&&this.layer.renderer?1*e/this.layer.renderer.pointsPerInch:5}get availableFields(){const e=Z(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);const i=X(this.layer);if(i)for(const n of i)t.add(n.attributeInfo.name);if(this.layer.outFields)for(const n of Object(p["v"])(this.layer.fields,this.layer.outFields))t.add(n);return Array.from(t)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const e=Object(S["h"])(),t=this.view.renderSpatialReference;return Object(M["a"])(this.view.clippingArea,e,t)?e:null}get _elevationOffset(){const e=this.layer&&this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){const t=Object(_["f"])(this.layer.spatialReference),i=Object(O["a"])(e.unit);return Object(s["u"])(e.offset,0)*i/t}return 0}initialize(){const e=this.view.resourceController,t=e.scheduler;this._worker=new F(t),this.addResolvingPromise(this._worker.promise),this._tmpPoint=Object(w["k"])(0,0,0,this.layer.spatialReference),Object(I["c"])(this.layer),Object(I["b"])(this.layer,this.view),this._indexRequester=e.createStreamDataRequester(2),this._dataRequester=e.createStreamDataRequester(3),this._initRenderer();const i=this._initNodePages(),n=this.view.resourceController.memoryController;this._memCache=n.getMemCache(this.layer.uid),this.updatingHandles.add(this,"_clippingBox",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this,"_elevationOffset",()=>this._elevationOffsetChanged(),2),this.updatingHandles.add(this.layer,"renderer",()=>this._rendererChanged(),2),this.updatingHandles.add(this.layer,"filters",()=>this._reload(),2),this.updatingHandles.add(this.layer,"outFields",()=>this._reload(),2),this.updatingHandles.add(this.layer,"scaleRangeId",()=>this._setUpdateViewNeeded()),this.updatingHandles.add(this,"clippingArea",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this.view.state,"contentCamera",()=>this._setUpdateViewNeeded()),this.handles.add([this.view.basemapTerrain.on("scale-change",e=>this._scaleUpdateHandler(e)),n.events.on("quality-changed",()=>this._setUpdateViewNeeded())]),this.addResolvingPromise(i),this.when(()=>{this.handles.add([t.registerTask(x["b"].POINT_CLOUD_LAYER,e=>this._process(e),()=>this._needsUpdate()),t.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(this,"suspended",e=>{e?this._clearNodeState():this._setUpdateViewNeeded()},2)])},()=>{this.updatingHandles.removeAll(),this.handles.removeAll()})}_setUpdateViewNeeded(){this._updateViewNeeded=!0,this._updateLoading()}destroy(){this.cancelLoading(),this._worker&&(this._worker.destroy(),this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new Fe({createGraphic:(e,t,i)=>this._createGraphic(e,t,i)}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add(this,"_clippingBox",e=>this._renderer.clippingBox=e,2),this.updatingHandles.add(this,"suspended",e=>this._setPointsVisible(!e),2),this.updatingHandles.add(this,"pointScale",e=>this._renderer.scaleFactor=e,2),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add(this,"useRealWorldSymbolSizes",e=>this._renderer.useRealWorldSymbolSizes=e,2),this.updatingHandles.add(this,"pointSize",e=>{const t=Object(f["h"])(e);this._renderer.size=e,this._renderer.sizePx=t},2),this.updatingHandles.add(this,"slicePlaneEnabled",e=>this._renderer.slicePlane=e,2),this.updatingHandles.add(this,"inverseDensity",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this,"maximumPointCount",()=>this._setUpdateViewNeeded(),2),this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",e=>{this._lodFactor=e,this._setUpdateViewNeeded()},2)}_destroyRenderer(){this._renderer.removeAll(),this._setPointsVisible(!1)}_createGraphic(e,t,i){const n=Object(s["k"])(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,r=this.view.computeMapPointFromVec3d(i),o=this._createGraphicAttributes(e,n);return new le({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:n,epoch:this._nodeLoadEpoch},geometry:r,attributes:o,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(e,t){const i={};for(const n of e.attributes)this._encodeGraphicAttribute(n.attributeInfo,n.values,t,i);return i}_encodeGraphicAttribute(e,t,i,n){const r=e.storageInfo&&e.storageInfo.attributeValues,s=r?r.valuesPerElement:1;if(1===s)n[e.name]=t[i];else if("UInt8"===r.valueType&&s<=4){let r=0;const o=i*s;for(let e=o;e<o+s;e++)r=(r<<8)+t[e];n[e.name]=r}else n[e.name]=void 0}_setPointsVisible(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=ie(this.layer.renderer),this._reload()}_reload(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()}_scaleUpdateHandler(e){this.layer.minScale||this.layer.maxScale?Object(y["o"])(e.extent,e.spatialReference,Je,this.layer.spatialReference)&&(this._nodeScales.forEach((t,i)=>{if(!this._renderedNodes.has(i))return void this._nodeScales.delete(i);const n=this._index.getNode(i);Object(m["h"])(Je,n.obb.center)&&this._nodeScales.set(i,e.scale)}),this._setUpdateViewNeeded()):this._nodeScales.clear()}displayNodes(e){this._workQueue=V([...this._renderedNodes],e,this._index),W(this._workQueue,this.view.state.contentCamera.viewForward,this._index),H(this._workQueue,Qe,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading(),this._cancelIndexLoading()}_cancelNodeLoading(){const e=new Array;this._loadingNodes.forEach(({abortController:t})=>e.push(t)),this._loadingNodes.clear();for(const t of e)t.abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()}_updateQueues(){const e=new Set;this._workQueue.forEach(t=>t.load.forEach(t=>e.add(t)));const t=new Array,i=new Map;this._loadingNodes.forEach((n,r)=>{e.has(r)?i.set(r,n):t.push(n)}),this._loadingNodes=i;for(const{abortController:n}of t)n.abort();this._workQueue=this._workQueue.filter(e=>{for(const t of e.load)if(this._loadingNodes.has(t))return this._recalcWork=!0,!1;return!0}),this._totalWork=this._computeWork(),this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[],this._indexPagesLoading.forEach(({abortController:e})=>e.abort()),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++,this._renderedNodes.forEach(e=>this._removeFromRenderer(e)),this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}_needsUpdate(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.length>0}_process(e){if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;const e=this._isRootNodeVisible();e!==this._layerIsVisible&&(this._layerIsVisible=e,this.notifyChange("suspended")),this._updateLoading()}}else{for(e.run(()=>this._updateWorkQueues());this._indexQueue.length>0&&e.run(()=>this._processIndexQueue()););for(this._processWorkQueue(e);this._idleQueue.length>0&&e.run(()=>this._idleQueue.process()););}}_processIndexQueue(){const e=this._indexQueue.shift(),t=this._loadNodePage(e);return this._indexPagesLoading.set(e,t),t.promise.then(t=>{this._index.addPage(e,t,this._elevationOffset),this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(e)},()=>{this._indexPagesLoading.delete(e)}),!0}_processWorkQueue(e){for(;!e.done;){const t=this._scheduleWorkEntry();if(Object(s["j"])(t))return;this._processWorkEntry(t),e.madeProgress()}}_scheduleWorkEntry(){let e=this._workQueue.length;for(;e--;){const e=this._workQueue.shift();if(!e.remove.find(e=>!this._renderedNodes.has(e)))return e;this._workQueue.push(e)}return null}_processWorkEntry(e){if(0!==e.load.length)Promise.all(e.load.map(e=>{const t=Object(d["e"])(),i=this._memCache.pop(e.toString());return Object(s["k"])(i)?this._loadingNodes.set(e,{abortController:t,promise:Promise.resolve(i)}):this._loadingNodes.has(e)||this._loadingNodes.set(e,{abortController:t,promise:this.loadNode(e,t.signal)}),this._loadingNodes.get(e).promise})).then(t=>{for(let i=0;i<e.load.length;i++)if(t[i]){const n=this._setupRendererData(e.load[i],t[i]);this._addToRenderer(n)}for(const i of e.remove)this._removeFromRenderer(i)}).catch(()=>{}).then(()=>{for(const t of e.load)this._loadingNodes.delete(t);this._updateLoading(),this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading();else for(const t of e.remove)this._removeFromRenderer(t)}async populateClassCodeCodedDomain(e,t){const i="CLASS_CODE",n=this.layer.fieldsIndex.get(i);if(!n||n.domain)return;if(-1===e.indexOf(n.name))return;const r=await Object(b["d"])(this.layer.queryCachedStatistics(i,{signal:t}));if(!1===r.ok)return;const s=r.value,o=s&&s.labels&&s.labels.labels;o&&Array.isArray(o)&&(n.domain=new h["a"]({name:"CLASS_CODE",codedValues:o.map(e=>new u["a"]({code:e.value,name:e.label}))}))}async prepareFetchPopupFeatures(e){return this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=Object(d["e"])(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(e,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null})),this._codedDomainPopulationPromise}async whenGraphicAttributes(e,t){const i=this._splitGraphicsPerNode(e),n=this.layer.attributeStorageInfo,r=t.map(e=>re(n,e)),s=async(e,t)=>{const i=this._index.getNode(t);await Object(b["b"])(r,async t=>{const n=t.useElevation?await this._loadElevationAttributeFromGeometry(i.resourceId):await this._loadAndParseAttribute(i,t);if(n)for(const i of e)if(this._isValidPointGraphic(i)){const e=i.pointCloudMetadata.attributePointIndexInNode;this._encodeGraphicAttribute(t,n,e,i.attributes)}})},o=[];return i.forEach((e,t)=>{o.push(s(e,t))}),await Object(d["k"])(o),e}_isValidPointGraphic(e){return e instanceof le&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(e){const t=new Map;for(const i of e){if(!this._isValidPointGraphic(i))continue;const e=i.pointCloudMetadata,n=t.get(e.nodeId);n?n.push(i):t.set(e.nodeId,[i])}return t}async _loadAndParseAttribute(e,t){const i=await this._loadAttribute(e.resourceId,t,null);return Object(s["k"])(i)?Object(oe["d"])({attributeInfo:t,buffer:i},null,e.vertexCount):null}async _loadElevationAttributeFromGeometry(e){const t=this.layer.store.defaultGeometrySchema,i=Object(oe["e"])(t,await this._loadGeometry(e,null));return Object(oe["a"])(i,i.length/3)}highlight(e){if(!e)return{remove(){}};const t=c["a"].isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(t.map(e=>this._graphicToPointDefinition(e)))}_graphicToPointDefinition(e){if(!this._isValidPointGraphic(e))return null;const{nodeId:t,pointIndexInNode:i}=e.pointCloudMetadata;return null!=t&&null!=i?{nodeId:t,pointId:i}:null}_computeWork(){let e=0;for(const t of this._workQueue)e+=t.load.length+t.remove.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,e+=this._loadingInitNodePage?100:0,e+=this._updateViewNeeded?100:0,e}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const e=this._computeWork();return 1-Math.min(this._totalWork,e)/this._totalWork}_updateLoading(){this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:this._computeWork()>0}_initNodePages(){const e=this.layer.store.index,t=e.nodesPerPage||e.nodePerIndexBlock;return this._index=new Y(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,t),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=e.nodesPerPage?1:e.nodePerIndexBlock,this._loadNodePage(0).promise.then(e=>{this._index.addPage(0,e,this._elevationOffset),this._loadingInitNodePage=!1,this._setUpdateViewNeeded()})}_loadNodePage(e){const t=Object(d["e"])(),i=`${this.baseUrl}/nodepages/${e*this._pageMultiplier}`;return{promise:this._requestNodePage(i,t.signal).then(t=>t.nodes.map((t,i)=>({resourceId:null!=t.resourceId?t.resourceId:e*this._index.pageSize+i,obb:t.obb,firstChild:t.firstChild,childCount:t.childCount,vertexCount:null!=t.vertexCount?t.vertexCount:t.pointCount,lodThreshold:null!=t.lodThreshold?t.lodThreshold:t.effectiveArea}))),abortController:t}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;let e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let i=this._computeNodesForMinimumDensity(e),n=this._computePointCount(i),r=Math.sqrt(n/(.75*t));for(;n>t;)e*=r,i=this._computeNodesForMinimumDensity(e),n=this._computePointCount(i),r=Math.sqrt(2);return this.displayNodes(i),this._updateViewNeeded=!1,this._updateLoading(),!0}_computePointCount(e){let t=0;for(let i=0;i<e.length;i++){const n=this._index.getNode(e[i]);n&&(t+=n.vertexCount)}return t}_getLodMemoryFactor(){return this.view.resourceController.memoryController.memoryFactor}_isRootNodeVisible(){let e=!1;return this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(t,i,n)=>(e=n,!1),pageMiss:()=>{}}),e}_computeNodesForMinimumDensity(e){const t=this.view.state.contentCamera,i=t.frustum,n=this._clippingBox,r=t.viewForward,s=Object(g["i"])(r,t.eye),o=z["f"].fromNormalAndOffset(r,-s,Ge),a=t.perScreenPixelRatio/2,l=e*e,d=this._nodeIdArray;d.length=0;const{minScale:c,maxScale:u}=Object(v["a"])(this.layer),h=0===c&&0===u?e=>d.push(e):e=>{const t=this._getScale(e);Object(v["d"])(t,c,u)&&d.push(e)};return this._traverseVisible({frustum:i,clippingBox:n},{predicate:(e,t,i)=>{if(!i)return!1;if(0===t.childCount)return h(e),!1;const n=this._index.getRenderObb(e);return!(this._computeAveragePixelArea(n,t.lodThreshold,t.vertexCount,o,a)<=l)||(h(e),!1)},pageMiss:(e,t)=>{h(e),this._indexQueue.indexOf(t)<0&&this._indexQueue.push(t)}}),d}_getScale(e){let t=this._nodeScales.get(e);if(null==t){const i=this._index.getNode(e).obb.center;this._tmpPoint.x=i[0],this._tmpPoint.y=i[1],this._tmpPoint.z=i[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t}_computeAveragePixelArea(e,t,i,n,r){const s=1e-7,o=Math.max(s,Object(A["j"])(e,n));return t/(o*o)/(4*r*r)/i}loadNode(e,t){try{return this.loadNodeAsync(e,t)}catch(i){throw Object(d["n"])(i)||Te.error(i),i}}async loadAdditionalUserAttributes(e,t,i){const n=this.layer.outFields;if(!n)return[];const r=Object(p["v"])(this.layer.fields,n),o=new Set(e.map(e=>Object(s["k"])(e)?e.name:null)),a=this.layer.attributeStorageInfo,l=[];for(const s of r){if(o.has(s))continue;const e=re(a,s);e&&l.push(t(e))}const c=await Object(d["l"])(l);return Object(d["w"])(i),Object(s["o"])(c,e=>e)}async loadNodeAsync(e,t){const i=this._index.getNode(e),n=Z(this.layer),r=X(this.layer),o=i.resourceId,a=async e=>{if(Object(s["j"])(e))return null;if(e.useElevation)return{attributeInfo:e,buffer:null};const i=await this._loadAttribute(o,e,t);return Object(s["k"])(i)?{attributeInfo:e,buffer:i}:null};return this._idleQueue.push(async()=>{const i=this._loadGeometry(o,t),{primaryAttribute:s,modulationAttribute:l}=n,c=a(s),u=a(l),h=r.map(e=>e.attributeInfo),p=h.map(e=>a(e)),f=this.loadAdditionalUserAttributes([s,l,...h],a,t),[b,g,_,m,y]=await Promise.all([i,c,u,Promise.all(p),f]);Object(d["w"])(t);const O={geometryBuffer:b,primaryAttributeData:g,modulationAttributeData:_,filterAttributesData:m,userAttributesData:y,schema:this.layer.store.defaultGeometrySchema,rendererInfo:n,filterInfo:r,obb:this._index.getRenderObb(e),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(O,t)},t)}async _loadGeometry(e,t){return this._requestData(`${this.baseUrl}/nodes/${e}/geometries/0`,t)}async _loadAttribute(e,t,i){if(Object(s["j"])(t)||!t.storageInfo)return null;const n=t.storageInfo.key;return this._requestData(`${this.baseUrl}/nodes/${e}/attributes/${n}`,i)}_requestNodePage(e,t){return this._indexRequester.request(e,"json",{query:{f:"json"},signal:t})}_requestData(e,t){return this._dataRequester.request(e,"binary",{signal:t})}_removeFromRenderer(e){if(this._renderedNodes.has(e)){const t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,$e(t))}}_addToRenderer(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))}_setupRendererData(e,t){const i=this._index.getNode(e),n=Math.sqrt(i.lodThreshold/i.vertexCount),r=this._index.getRenderObb(e);if(Fe.isInstanceOfNode(t))return t.splatSize=n,t.obb=r,t.origin=Object(P["a"])(t.obb.center),t;const s=1.001;if(t.obb.halfSize[0]>r.halfSize[0]*s||t.obb.halfSize[1]>r.halfSize[1]*s||t.obb.halfSize[2]>r.halfSize[2]*s){if(this._maxLoggedBoxWarnings>0){const i=e=>`[${e.halfSize[0]}, ${e.halfSize[1]}, ${e.halfSize[2]}]`;Te.warn(`Node ${e} reported bounding box too small. got ${i(r)} but points cover ${i(t.obb)}`),0==--this._maxLoggedBoxWarnings&&Te.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:Object(P["a"])(r.center),rgb:t.rgb,attributes:t.attributes,pointIdFilterMap:t.pointIdFilterMap,highlights:null,splatSize:n,obb:r,isLeaf:0===i.childCount}}getUsedMemory(){let e=0;return this._renderer.forEachNode(t=>{e+=Ke,e+=Object(r["a"])(t.coordinates);for(const i of t.attributes){const t=i.values;Object(r["c"])(t.buffer)&&(e+=Object(r["a"])(t))}}),e}getUnloadedMemory(){const e=this._renderedNodes.size;if(e<4)return 0;const t=[...this._renderedNodes].reduce((e,t)=>e+this._index.getNode(t).vertexCount);let i=this._loadingNodes.size;for(let n=0;n<this._workQueue.length;n++)i+=this._workQueue[n].load.length,i-=this._workQueue[n].remove.length;return i<0?0:i*t/e*((this.getUsedMemory()-e*Ke)/t)+i*Ke}ignoresMemoryFactor(){return!1}get performanceInfo(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((e,t)=>e+this._index.getNode(t).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};function $e(e){return 5*e.coordinates.length+128}Object(n["a"])([Object(a["b"])()],Be.prototype,"layer",void 0),Object(n["a"])([Object(a["b"])({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],Be.prototype,"baseUrl",void 0),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"pointScale",null),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"useRealWorldSymbolSizes",null),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"pointSize",null),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"inverseDensity",null),Object(n["a"])([Object(a["b"])()],Be.prototype,"maximumPointCount",void 0),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"availableFields",null),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"_clippingBox",null),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"_elevationOffset",null),Object(n["a"])([Object(a["b"])({type:Boolean})],Be.prototype,"slicePlaneEnabled",void 0),Object(n["a"])([Object(a["b"])()],Be.prototype,"updating",void 0),Object(n["a"])([Object(a["b"])(C["a"])],Be.prototype,"updatingProgress",void 0),Object(n["a"])([Object(a["b"])({readOnly:!0})],Be.prototype,"updatingProgressValue",null),Be=Object(n["a"])([Object(l["a"])("esri.views.3d.layers.PointCloudLayerView3D")],Be);const Je=Object(m["l"])(),Ke=160;var Ye=Be;t["default"]=Ye},ad73:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var n=i("b2b2"),r=i("c1da");async function s(e,t=e.popupTemplate){if(!Object(n["k"])(t))return[];const i=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:s}=t,{objectIdField:o,typeIdField:a,globalIdField:l,relationships:d}=e;if(i.includes("*"))return["*"];const c=s?await Object(r["m"])(e):[],u=Object(r["i"])(e.fields,[...i,...c]);return a&&u.push(a),u&&o&&Object(r["p"])(e.fields,o)&&-1===u.indexOf(o)&&u.push(o),u&&l&&Object(r["p"])(e.fields,l)&&-1===u.indexOf(l)&&u.push(l),d&&d.forEach(t=>{const{keyField:i}=t;u&&i&&Object(r["p"])(e.fields,i)&&-1===u.indexOf(i)&&u.push(i)}),u}function o(e,t){return e.popupTemplate?e.popupTemplate:Object(n["k"])(t)&&t.defaultPopupTemplateEnabled&&Object(n["k"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},bc58:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return l}));var n=i("3886"),r=i("690a"),s=i("d272"),o=i("501b"),a=i("6a07");function l(e){const t=new r["a"],i=0===e.output,l=1===e.output,d=4===e.output;return t.extensions.add("GL_OES_standard_derivatives"),t.include(s["a"],e),t.attributes.add("position","vec3"),t.attributes.add("color","vec3"),t.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3"),l?(t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float")):4!==e.output&&t.varyings.add("vColor","vec3"),t.vertex.code.add(n["a"]`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${e.drawScreenSize?n["a"]`
      float clampedScreenSize = pointSize;`:n["a"]`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${l?n["a"]`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${i?n["a"]`vColor = color;`:""}
    }
  `),t.fragment.include(o["a"],e),d&&t.include(a["a"]),t.fragment.code.add(n["a"]`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${l?n["a"]`gl_FragColor = float2rgba(depth);`:""}
      ${d?n["a"]`outputHighlight();`:""}
      ${i?n["a"]`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `),t}var d=Object.freeze({__proto__:null,build:l})},ee9c:function(e,t,i){"use strict";i.d(t,"a",(function(){return fe})),i.d(t,"b",(function(){return ae})),i.d(t,"c",(function(){return oe})),i.d(t,"d",(function(){return re})),i.d(t,"e",(function(){return ne})),i.d(t,"f",(function(){return ee})),i.d(t,"g",(function(){return te})),i.d(t,"h",(function(){return me})),i.d(t,"i",(function(){return I})),i.d(t,"j",(function(){return A})),i.d(t,"k",(function(){return F})),i.d(t,"l",(function(){return W})),i.d(t,"m",(function(){return k})),i.d(t,"n",(function(){return X})),i.d(t,"o",(function(){return K})),i.d(t,"p",(function(){return E})),i.d(t,"q",(function(){return Y})),i.d(t,"r",(function(){return C})),i.d(t,"s",(function(){return pe})),i.d(t,"t",(function(){return Z})),i.d(t,"u",(function(){return D})),i.d(t,"v",(function(){return V})),i.d(t,"w",(function(){return ce})),i.d(t,"x",(function(){return R})),i.d(t,"y",(function(){return be})),i.d(t,"z",(function(){return ue})),i.d(t,"A",(function(){return H}));var n=i("c120"),r=i("a21b"),s=i("b2b2"),o=i("ce50"),a=i("b50f"),l=i("f4cc"),d=i("5996"),c=i("9786"),u=i("2eab"),h=i("e431"),p=i("f694"),f=i("d791"),b=i("9180"),g=i("8188"),_=i("c64f"),m=i("afe1"),y=i("0fc4"),O=i("04f0"),j=i("4261"),x=i("ec13"),S=i("1e2c"),v=i("caf1"),w=i("e764"),P=i("cee3"),z=i("ad64"),M=i("82de");function N(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function C(e){const t=e._stage.renderView.has(1),i=e._stage.renderView.has(0),r=Object(n["a"])("disable-feature:i3s-basis")?0:1;return 12|(t?2|r:0)|(i?r:0)}function R(e,t){return e.find(e=>0!=(e.encoding&t))}function A(e){switch(e){case 1:return S["a"].BASIS_ENCODING;case 2:return S["a"].DDS_ENCODING;case 4:return"image/png";case 8:return"image/jpeg";case 16:return"image/ktx";default:return""}}function I(e){if(Object(n["a"])("disable-feature:i3s-draco")||!e)return!1;for(const t of e)for(const e of t.geometryBuffers)if("draco"===e.compressedAttributes.encoding)return!0;return!1}function k(e,t,i,n,r,s){r.traverse(i,i=>{let r=i.mbs;t!==n&&(r=L,Object(g["p"])(i.mbs,n,r,t));const o=U(e,r);return 0!==o&&(s(i,o),!0)})}function F(e,t,i){let n=0,r=0;for(let s=0;s<t.length&&n<e.length;s++)e[n]===t[s]&&(i(s)&&(e[r]=e[n],r++),n++);e.length=r}function V(e,t,i){let n=0,r=0;for(;n<i.length;)Object(a["b"])(e,i[n])>=0===t&&(i[r]=i[n],r++),n++;i.length=r}const q=Object(j["h"])();function E(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return q[0]=(e[0]-t.position[0])/t.rotationScale[0],q[1]=(e[1]-t.position[1])/t.rotationScale[4],q[2]=(e[2]-t.position[2])/t.rotationScale[8],q[3]=(e[3]-t.position[0])/t.rotationScale[0],q[4]=(e[4]-t.position[1])/t.rotationScale[4],q[5]=(e[5]-t.position[2])/t.rotationScale[8],q}const L=Object(y["c"])();function U(e,t){const i=t[0],n=t[1],r=t[3],s=e[0]-i,o=i-e[2],a=e[1]-n,l=n-e[3],d=Math.max(s,o,0),c=Math.max(a,l,0),u=d*d+c*c;return u>r*r?0:u>0?1:-Math.max(s,o,a,l)>r?3:2}function D(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=e[0]-i,a=i-e[3],l=e[1]-n,d=n-e[4],c=e[2]-r,u=r-e[5],h=Math.max(o,a,0),p=Math.max(l,d,0),f=Math.max(c,u,0),b=h*h+p*p+f*f;return b>s*s?0:b>0?1:-Math.max(o,a,l,d,c,u)>s?3:2}function W(e,t,i){const n=[],r=i&&i.missingFields,s=i&&i.originalFields;for(const o of e){const e=o.toLowerCase();let i=!1;for(const r of t)if(e===r.name.toLowerCase()){n.push(r.name),i=!0,s&&s.push(o);break}!i&&r&&r.push(o)}return n}async function H(e,t,i,n,r){if(0===t.length)return[];const l=e.attributeStorageInfo;if(Object(s["k"])(e.associatedLayer))try{return await Q(e.associatedLayer,t,i,n)}catch(d){if(e.associatedLayer.loaded)throw d}if(l){const d=T(t,i,r);if(Object(s["j"])(d))throw new o["a"]("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const c=e.parsedUrl.path,u=await Promise.all(d.map(e=>B(c,l,e.node,e.indices,n).then(t=>{for(let i=0;i<e.graphics.length;i++){const n=e.graphics[i],r=t[i];if(n.attributes)for(const e in n.attributes)e in r||(r[e]=n.attributes[e]);n.attributes=r}return e.graphics})));return Object(a["f"])(u)}throw new o["a"]("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function T(e,t,i){const n=new Map,r=[],s=i();for(const o of e){const e=o.attributes[t];for(let t=0;t<s.length;t++){const i=s[t],a=i.featureIds.indexOf(e);if(a>=0){let e=n.get(i.node);e||(e={node:i.node,indices:[],graphics:[]},r.push(e),n.set(i.node,e)),e.indices.push(a),e.graphics.push(o);for(let i=t;i>0;i--)s[i]=s[i-1];s[0]=i;break}}}return r}async function Q(e,t,i,n){t.sort((e,t)=>e.attributes[i]-t.attributes[i]);const r=t.map(e=>e.attributes[i]),s=[],o=W(n,e.fields,{originalFields:s}),a=await G(e,r,o);for(let l=0;l<t.length;l++){const e=t[l],i=a[l],n={};if(e.attributes)for(const t in e.attributes)n[t]=e.attributes[t];for(let t=0;t<s.length;t++)n[s[t]]=i[o[t]];e.attributes=n}return t}function G(e,t,i){const n=e.capabilities.query.maxRecordCount;if(null!=n&&t.length>n){const r=Object(a["o"])(t,n);return Promise.all(r.map(t=>G(e,t,i))).then(a["f"])}const r=new _["a"]({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(r).then(e=>{if(e&&e.features&&e.features.length===t.length)return e.features.map(e=>e.attributes);throw new o["a"]("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function B(e,t,i,n,r){const s=[];for(const o of t)if(o&&-1!==r.indexOf(o.name)){const t=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;s.push({url:t,storageInfo:o})}return Object(l["k"])(s.map(e=>Object(u["default"])(e.url,{responseType:"array-buffer"}).then(t=>Object(z["d"])(e.storageInfo,t.data)))).then(e=>{const t=[];for(const i of n){const n={};for(let t=0;t<e.length;t++)null!=e[t].value&&(n[s[t].storageInfo.name]=K(e[t].value,i));t.push(n)}return t})}const $=-32768,J=-(2**31);function K(e,t){if(!e)return null;const i=e[t];return Object(r["f"])(e)?i===$?null:i:Object(r["g"])(e)?i===J?null:i:i!=i?null:i}function Y(e){const t=e.store.indexCRS||e.store.geographicCRS,i=void 0===t?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new o["a"]("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new o["a"]("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=t?new d["a"](N(t)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function Z(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=void 0===t?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new o["a"]("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new o["a"]("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=t?new d["a"](N(t)):e.spatialReference;return n.equals(e.spatialReference)?e.spatialReference:n}function X(e,t){return Object(s["j"])(t)?"@null":t===Object(p["g"])(t)?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null}function ee(e,t,i){if(!Object(c["a"])(e,t))throw new o["a"]("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===i&&e.isGeographic)throw new o["a"]("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function te(e,t,i){const n=Y(e),r=Z(e);ee(n,t,i),ee(r,t,i)}function ie(e){return(null==e.geometryType||"triangles"===e.geometryType)&&(null==e.topology||"PerAttributeArray"===e.topology)&&null!=e.vertexAttributes&&null!=e.vertexAttributes.position}function ne(e){if(null==e.store||null==e.store.defaultGeometrySchema||!ie(e.store.defaultGeometrySchema))throw new o["a"]("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function re(e,t){te(e,t.spatialReference,t.viewingMode)}function se(e){return null!=e.geometryType&&"points"===e.geometryType&&(null==e.topology||"PerAttributeArray"===e.topology)&&(null==e.encoding||""===e.encoding||"lepcc-xyz"===e.encoding)&&null!=e.vertexAttributes&&null!=e.vertexAttributes.position}function oe(e){if(null==e.store||null==e.store.defaultGeometrySchema||!se(e.store.defaultGeometrySchema))throw new o["a"]("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function ae(e,t){ee(e.spatialReference,t.spatialReference,t.viewingMode)}function le(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}function de(e){return"mesh-3d"===e.type}function ce(e){if(null==e||!le(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.getSymbols();if(0===t.length)return!0;for(const i of t){if(!de(i)||0===i.symbolLayers.length)return!0;for(const e of i.symbolLayers.items)if("fill"!==e.type||Object(s["j"])(e.material)||Object(s["j"])(e.material.color)||"replace"!==e.material.colorMixMode)return!0}return!1}const ue=Object(x["c"])({color:[0,0,0,0],opacity:0});class he{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function pe(e){const t=new he;let i=!1,n=!1;for(const r of e.symbolLayers.items)if("fill"===r.type&&r.enabled){const e=r.material,o=r.edges;if(Object(s["k"])(e)&&!i){const n=e.color,o=Object(v["b"])(e.colorMixMode);Object(s["k"])(n)?t.material={color:[n.r/255,n.g/255,n.b/255],alpha:n.a,colorMixMode:o}:t.material={color:[1,1,1],alpha:1,colorMixMode:1},t.castShadows=r.castShadows,i=!0}Object(s["k"])(o)&&!n&&(t.edgeMaterial=Object(x["b"])(o,{}),n=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:1}),t}function fe(e,t){return(0|e)+(0|t)|0}function be(e,t,i,n,r=0){n===Object(p["g"])(n)?t.isGeographic?_e(e,i,t,r):ge(e,i,t,r):e===i?(i.center[2]+=r,Object(g["q"])(i.center,t,0,i.center,n,0,1)):(Object(h["x"])(i.center,e.center[0],e.center[1],e.center[2]+r),Object(g["q"])(i.center,t,0,i.center,n,0,1),Object(O["a"])(i.quaternion,e.quaternion),Object(h["l"])(i.halfSize,e.halfSize))}function ge(e,t,i,n){Object(P["d"])(e,je),Object(h["x"])(t.center,e.center[0],e.center[1],e.center[2]+n),Object(g["d"])(i,t.center,ye,Object(p["g"])(i)),Object(h["x"])(t.center,ye[12],ye[13],ye[14]);const r=2*Math.sqrt(1+ye[0]+ye[5]+ye[10]);Oe[0]=(ye[6]-ye[9])/r,Oe[1]=(ye[8]-ye[2])/r,Oe[2]=(ye[1]-ye[4])/r,Oe[3]=.25*r,Object(O["e"])(t.quaternion,Oe,e.quaternion),Object(O["b"])(Oe,t.quaternion);let s=0,o=0,a=0;for(const l of je)l[2]+=n,Object(g["q"])(l,i,0,l,Object(p["g"])(i),0,1),Object(h["w"])(we,l,t.center),Object(h["v"])(we,we,Oe),s=Math.max(s,Math.abs(we[0])),o=Math.max(o,Math.abs(we[1])),a=Math.max(a,Math.abs(we[2]));Object(h["x"])(t.halfSize,s,o,a)}function _e(e,t,i,n){const r=Object(p["e"])(i),s=1+Math.max(0,n)/(r.radius+e.center[2]);Object(h["x"])(t.center,e.center[0],e.center[1],e.center[2]+n),Object(g["q"])(t.center,i,0,t.center,Object(p["g"])(i),0,1),Object(O["a"])(t.quaternion,e.quaternion),Object(O["b"])(Oe,e.quaternion),Object(h["x"])(we,0,0,1),Object(h["v"])(we,we,Oe),Object(h["x"])(we,e.halfSize[0]*Math.abs(we[0]),e.halfSize[1]*Math.abs(we[1]),e.halfSize[2]*Math.abs(we[2])),Object(h["f"])(we,we,r.inverseFlattening),Object(h["g"])(t.halfSize,e.halfSize,we),Object(h["f"])(t.halfSize,t.halfSize,s)}function me(e,t,i,n,r,o){if(!o||0===o.length||Object(s["j"])(t))return null;const a=Object(M["a"])(e.mbs,r,i,t);let l;Object(f["a"])(ze,a);const d=()=>{if(!l)if(l=je,Object(b["n"])(Se),Object(s["k"])(e.serviceObb)){be(e.serviceObb,i,ve,t,r),Object(P["d"])(ve,l);for(const e of l)Object(h["n"])(e,e,ze),Object(b["q"])(Se,e)}else{const n=e.mbs,s=n[3];Object(g["y"])(n,i,we,t),Object(h["n"])(we,we,ze),we[2]+=r;for(let e=0;e<8;++e){const t=1&e?s:-s,i=2&e?s:-s,n=4&e?s:-s,r=l[e];Object(h["l"])(r,[we[0]+t,we[1]+i,we[2]+n]),Object(b["q"])(Se,r)}}};let c=1/0,u=-1/0;const p=e=>{if("replace"!==e.type)return;const i=e.geometry;if(!i.hasZ)return;Object(b["n"])(xe);const r=i.spatialReference||n,s=i.rings.reduce((e,i)=>i.reduce((e,i)=>(Object(g["y"])(i,r,we,t),Object(h["n"])(we,we,ze),Object(b["q"])(xe,we),Math.min(we[2],e)),e),1/0);d(),Object(b["w"])(Se,xe)&&(c=Math.min(c,s),u=Math.max(u,s))};if(o.forEach(e=>p(e)),c===1/0)return null;const _=(e,t,i)=>{Object(h["n"])(we,i,a),e[t+0]=we[0],e[t+1]=we[1],e[t+2]=we[2],t+=24,i[2]=c,Object(h["n"])(we,i,a),e[t+0]=we[0],e[t+1]=we[1],e[t+2]=we[2],t+=24,i[2]=u,Object(h["n"])(we,i,a),e[t+0]=we[0],e[t+1]=we[1],e[t+2]=we[2]};for(let s=0;s<8;++s)_(Pe.data,3*s,l[s]);return Object(P["c"])(Pe)}const ye=Object(m["b"])(),Oe=Object(w["b"])(),je=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],xe=Object(b["l"])(),Se=Object(b["l"])(),ve=Object(P["e"])(),we=[0,0,0],Pe={data:new Array(72),size:3},ze=Object(m["b"])()},f7f0:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("a4ee"),r=(i("c120"),i("b2b2")),s=(i("e92d"),i("cea0"),i("59b2"),i("d386")),o=i("ce50"),a=(i("e041"),i("8eed"),i("f402"),i("c1da")),l=i("ad73");const d=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:i}=t;return i?Object(l["a"])(t,e)?void 0:new o["a"]("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new o["a"]("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,t){const i=this._validateFetchPopupFeatures(t);if(i)return Promise.reject(i);const n=Object(r["k"])(t)?t.clientGraphics:null;if(!n||0===n.length)return Promise.resolve([]);const s=[],o=[],d="scene"===this.layer.type&&Object(r["k"])(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,c=Object(a["v"])(this.layer.fields,await Object(l["b"])(d,Object(l["a"])(this.layer,t)));await this.prepareFetchPopupFeatures(c);const u=new Set;for(const r of n)Object(a["t"])(c,r,u)?o.push(r):s.push(r);return 0===o.length?Promise.resolve(s):this.whenGraphicAttributes(o,[...u]).catch(()=>o).then(e=>s.concat(e))}};return t=Object(n["a"])([Object(s["a"])("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b92058b4","chunk-9aadce66","chunk-72218984","chunk-0658e062"],{"008c":function(e,t,r){"use strict";r.d(t,"a",(function(){return P})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return T})),r.d(t,"e",(function(){return E})),r.d(t,"f",(function(){return A})),r.d(t,"g",(function(){return R}));var i=r("b2b2"),n=r("a9ab");const a=(e,t,r)=>[t,r],s=(e,t,r)=>[t,r,e[2]],o=(e,t,r)=>[t,r,e[2],e[3]];function c(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:Object(i["l"])(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function u({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function d(e,t,r){const i=[];let n,a,s,o;for(let c=0;c<r.length;c++){const d=r[c];c>0?(s=l(e,d[0]),o=u(e,d[1]),s===n&&o===a||(i.push(t(d,s-n,o-a)),n=s,a=o)):(n=l(e,d[0]),a=u(e,d[1]),i.push(t(d,n,a)))}return i.length>0?i:null}function h(e,t,r,i){return d(e,r?i?o:s:i?s:a,t)}function p(e,t,r,i){const n=[],c=r?i?o:s:i?s:a;for(let a=0;a<t.length;a++){const r=d(e,c,t[a]);r&&r.length>=3&&n.push(r)}return n.length?n:null}function f(e,t,r,i){const n=[],c=r?i?o:s:i?s:a;for(let a=0;a<t.length;a++){const r=d(e,c,t[a]);r&&r.length>=2&&n.push(r)}return n.length?n:null}function b({scale:e,translate:t},r){return r*e[0]+t[0]}function m({scale:e,translate:t},r){return t[1]-r*e[1]}function g(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,a]=e.scale;let s=b(e,r[0][0]),o=m(e,r[0][1]);i[0]=t(r[0],s,o);for(let c=1;c<r.length;c++){const e=r[c];s+=e[0]*n,o-=e[1]*a,i[c]=t(e,s,o)}return i}function v(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=g(e,t,r[n]);return i}function y(e,t,r,i){return g(e,r?i?o:s:i?s:a,t)}function O(e,t,r,i){return v(e,r?i?o:s:i?s:a,t)}function x(e,t,r,i){return v(e,r?i?o:s:i?s:a,t)}function j(e,t,r,i,n){return t.xmin=l(e,r.xmin),t.ymin=u(e,r.ymin),t.xmax=l(e,r.xmax),t.ymax=u(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function _(e,t,r,i,n){return t.points=h(e,r.points,i,n),t}function S(e,t,r,i,n){return t.x=l(e,r.x),t.y=u(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function w(e,t,r,i,n){const a=p(e,r.rings,i,n);return a?(t.rings=a,t):null}function C(e,t,r,i,n){const a=f(e,r.paths,i,n);return a?(t.paths=a,t):null}function P(e,t){return e&&t?Object(n["f"])(t)?S(e,{},t,!1,!1):Object(n["h"])(t)?C(e,{},t,!1,!1):Object(n["g"])(t)?w(e,{},t,!1,!1):Object(n["e"])(t)?_(e,{},t,!1,!1):Object(n["d"])(t)?j(e,{},t,!1,!1):null:null}function T(e,t,r,n,a){return Object(i["l"])(r)&&(t.points=y(e,r.points,n,a)),t}function E(e,t,r,n,a){return Object(i["k"])(r)||(t.x=b(e,r.x),t.y=m(e,r.y),t!==r&&(n&&(t.z=r.z),a&&(t.m=r.m))),t}function A(e,t,r,n,a){return Object(i["l"])(r)&&(t.rings=x(e,r.rings,n,a)),t}function R(e,t,r,n,a){return Object(i["l"])(r)&&(t.paths=O(e,r.paths,n,a)),t}},"0310":function(e,t,r){"use strict";r.d(t,"a",(function(){return M})),r.d(t,"b",(function(){return R}));var i=r("bd75"),n=r("17ca"),a=r("d272"),s=r("4db9"),o=r("d539"),c=r("c332"),l=r("b09a"),u=r("6cb2"),d=r("dfaf"),h=r("6d5b"),p=r("7d11"),f=r("17b0"),b=r("7e21"),m=r("d047"),g=r("0d7a"),v=r("7088"),y=r("ea4b"),O=r("c6d7"),x=r("aab5"),j=r("5d5f"),_=r("a7d7"),S=r("d017"),w=r("be24"),C=r("ebd5"),P=r("d56e"),T=r("3626"),E=r("3886"),A=r("690a");function R(e){const t=new A["a"],r=t.vertex.code,R=t.fragment.code;return t.include(P["a"],{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(l["a"]),t.varyings.add("vpos","vec3"),t.include(w["a"],e),t.include(o["a"],e),t.include(f["a"],e),0!==e.output&&7!==e.output||(t.include(c["a"],e),t.include(s["a"],{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(n["a"]),t.include(g["a"],e),t.include(p["a"],e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(d["a"],e),t.include(i["a"],e),t.include(u["a"],e),t.include(h["a"],e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r.add(E["a"]`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${E["a"].float(C["c"])}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===e.normalType?E["a"]`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),7===e.output&&(t.include(a["a"],e),t.include(C["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(m["a"]),t.include(O["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(T["a"]),R.add(E["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?E["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:E["a"]`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?E["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `)),0===e.output&&(t.include(a["a"],e),t.include(y["a"],e),t.include(v["a"],e),t.include(C["a"],e),e.receiveShadows&&t.include(S["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(m["a"]),t.include(O["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(_["b"],e),t.include(j["a"],e),t.fragment.include(T["a"]),t.include(x["a"],e),R.add(E["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?E["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:E["a"]`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===e.normalType?E["a"]`
        vec3 normal = screenDerivativeNormal(localvpos);`:E["a"]`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===e.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?E["a"]`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E["a"]`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${e.hasNormalTexture?E["a"]`
              mat3 tangentSpace = ${e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal = normal;"}
        ${1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?E["a"]`vec3 normalGround = normalize(vpos + localOrigin);`:E["a"]`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:E["a"]``}
        ${1===e.pbrMode||2===e.pbrMode?E["a"]`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(b["a"],e),t}const M=Object.freeze({__proto__:null,build:R})},"040b":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){1===t.viewingMode?e.vertex.code.add(i["a"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(i["a"]`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),1===t.viewingMode?e.vertex.code.add(i["a"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(i["a"]`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},"0494":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return c}));var i=r("b2b2");class n{constructor(e,t,r=2048){this.text=e,this._parameters=t,this.maxSize=r,this._lineWidths=new Array,this._renderPixelRatio=null,this._displayWidth=null,this.key=`${this._parameters.key}--${e}`,this._lines=e.split(/\r?\n/),this._lineHeight=this.computeLineHeight()}get displayWidth(){return this._ensureTextWidth()}get displayHeight(){return this._lineHeight*this._lines.length}get renderedWidth(){return Math.round(this.displayWidth*this.renderPixelRatio)}get renderedHeight(){return Math.round(this.displayHeight*this.renderPixelRatio)}get renderedLineHeight(){return Math.round(this._lineHeight*this.renderPixelRatio)}get renderedFontSize(){return this._parameters.definition.size*this.renderPixelRatio}get renderedHaloSize(){return this._parameters.haloSize*this.renderPixelRatio}get renderPixelRatio(){if(Object(i["k"])(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio}getLineXOffset(e){return Math.round((this.renderedWidth-this._lineWidths[e]*this.renderPixelRatio)/2)}render(e,t=0,r=0){const i=this.renderedLineHeight,n=this.renderedHaloSize,o=a(e.textAlign,this.renderedWidth)+n,c=n+s;e.save(),n>0&&this.renderHalo(e,o,c,t,r),this.setFontProperties(e,this.renderedFontSize),r+=c,t+=o;for(let a=0;a<this._lines.length;++a){e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)";const n=this._lines[a],s=this.getLineXOffset(a);e.fillText(n,t+s,r),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.fillStyle,e.fillText(n,t+this.getLineXOffset(a),r),r+=i}e.restore()}renderHalo(e,t,r,i,n){const a=this.renderedWidth,s=this.renderedHeight,o=c(l,Math.max(a,u),Math.max(s,u)),d=o.getContext("2d");d.clearRect(0,0,a,s),this.setFontProperties(d,this.renderedFontSize),d.fillStyle=this._parameters.haloStyle,d.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;d.lineJoin=h?"miter":"round",h?this.renderHaloEmulated(d,t,r):this.renderHaloNative(d,t,r),e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(o,0,0,a,s,i,n,a,s),e.globalAlpha=1}renderHaloEmulated(e,t,r){const i=this.renderedLineHeight,n=this.renderedHaloSize;for(let a=0;a<this._lines.length;++a){const s=this._lines[a],c=this.getLineXOffset(a);for(const[i,a]of o)e.fillText(s,t+c+n*i,r+n*a);r+=i}}renderHaloNative(e,t,r){const i=this.renderedLineHeight,n=this.renderedHaloSize;for(let a=0;a<this._lines.length;++a){const s=2*n,o=this._lines[a],c=this.getLineXOffset(a),l=5,u=.1;for(let i=0;i<l;i++){const n=1-(l-1)*u+i*u;e.lineWidth=n*s,e.strokeText(o,t+c,r)}r+=i}}setFontProperties(e,t){const r=this._parameters.definition.font,i=`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`;e.font=i,e.textAlign="left",e.textBaseline="top"}_ensureTextWidth(){if(Object(i["l"])(this._displayWidth))return this._displayWidth;const e=c(l,u,u).getContext("2d");this.setFontProperties(e,this._parameters.definition.size);let t=0,r=2*this._parameters.haloSize;this._lineWidths.length=0;const n=this._parameters.definition.font;("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(r+=.3*e.measureText("A").width);for(const i of this._lines){const n=Math.round(e.measureText(i).width+r);this._lineWidths.push(n),t=Math.max(t,n)}return this._displayWidth=t,this._displayWidth}computeLineHeight(){const e=1.275*this._parameters.definition.size;return Math.ceil(e+2*this._parameters.haloSize)+s}}function a(e,t){return"center"===e?.5*t:"right"===e?t:0}const s=1,o=[];{const e=16;for(let t=0;t<360;t+=360/e)o.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}function c(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}const l={canvas:null},u=512},"0613":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i=2.1},"087c":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var i=r("a21b"),n=r("1038");function a(e,t=n["d"]){return"number"==typeof e?t(e):Object(i["i"])(e)||Object(i["k"])(e)?new Uint32Array(e):e}function s(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;t+=1)t%2==0?(i[e++]=t,i[e++]=t+1,i[e++]=t+2):(i[e++]=t+1,i[e++]=t,i[e++]=t+2)}else{let t=0;for(let n=0;n<r;n+=1)if(n%2==0){const r=e[n],a=e[n+1],s=e[n+2];i[t++]=r,i[t++]=a,i[t++]=s}else{const r=e[n+1],a=e[n],s=e[n+2];i[t++]=r,i[t++]=a,i[t++]=s}}return i}function o(e){const t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if("number"==typeof e){let e=0;for(let t=0;t<r;++t)i[e++]=0,i[e++]=t+1,i[e++]=t+2;return i}{const t=e[0];let n=e[1],a=0;for(let s=0;s<r;++s){const r=e[s+2];i[a++]=t,i[a++]=n,i[a++]=r,n=r}return i}}},"0bde":function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r("b2b2"),n=r("ecd7"),a=r("8a44"),s=r("e431"),o=r("0b2d"),c=r("d359"),l=r("d18f"),u=r("f895"),d=r("1153");class h{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),w[0]=null,R.prune(),F.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const r=p.acquire();for(let i=0;i<t;i++){const t=e[i];this._isDegenerate(t)?this._degenerateObjects.add(t):(r.init(this._root),this._add(t,r))}p.release(r)}remove(e,t=null){this._objectCount-=e.length;const r=p.acquire();for(const n of e){const e=Object(i["l"])(t)?t:Object(u["b"])(this._objectToBoundingSphere(n),M);x(e[3])?(r.init(this._root),this._remove(n,e,r)):this._degenerateObjects.delete(n)}p.release(r),this._shrink()}update(e,t){if(!x(t[3])&&this._isDegenerate(e))return;const r=C(e);this.remove(r,t),this.add(r)}forEachAlongRay(e,t,r){const i=Object(l["h"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNode(i,e))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObject(i,e)&&r(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObject(i,e)&&r(e)}),!0})}forEachAlongRayWithVerticalOffset(e,t,r,i){const n=Object(l["h"])(e,t);this._forEachNode(this._root,e=>{if(!this._intersectsNodeWithOffset(n,e,i))return!1;const t=e.node;return t.terminals.forAll(e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)}),null!==t.residents&&t.residents.forAll(e=>{this._intersectsObjectWithOffset(n,e,i)&&r(e)}),!0})}forEach(e){this._forEachNode(this._root,t=>{const r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,r,i=(()=>!0),n=1/0){let a=1/0,o=1/0,l=null;const d=y(e,t),h=s=>{if(--n,!i(s))return;const d=this._objectToBoundingSphere(s);if(!Object(c["k"])(r,d))return;const h=O(e,t,Object(u["g"])(d)),p=h-d[3],f=h+d[3];p<a&&(a=p,o=f,l=s)};return this._forEachNodeDepthOrdered(this._root,i=>{if(n<=0||!Object(c["k"])(r,i.bounds))return!1;if(Object(s["h"])(T,d,i.halfSize),Object(s["i"])(T,T,i.bounds),O(e,t,T)>o)return!1;const a=i.node;return a.terminals.forAll(e=>h(e)),null!==a.residents&&a.residents.forAll(e=>h(e)),!0},e,t),l}forEachInDepthRange(e,t,r,i,n,a,o){let l=-1/0,d=1/0;const h={setRange:e=>{1===r?(l=Math.max(l,e.near),d=Math.min(d,e.far)):(l=Math.max(l,-e.far),d=Math.min(d,-e.near))}};h.setRange(i);const p=O(t,r,e),f=y(t,r),b=y(t,-r),m=e=>{if(!o(e))return;const i=this._objectToBoundingSphere(e),s=Object(u["g"])(i),f=O(t,r,s)-p,b=f-i[3],m=f+i[3];b>d||m<l||!Object(c["k"])(a,i)||n(e,h)};this._forEachNodeDepthOrdered(this._root,e=>{if(!Object(c["k"])(a,e.bounds))return!1;if(Object(s["h"])(T,f,e.halfSize),Object(s["i"])(T,T,e.bounds),O(t,r,T)-p>d)return!1;if(Object(s["h"])(T,b,e.halfSize),Object(s["i"])(T,T,e.bounds),O(t,r,T)-p<l)return!1;const i=e.node;return i.terminals.forAll(e=>m(e)),null!==i.residents&&i.residents.forAll(e=>m(e)),!0},t,r)}forEachNode(e){this._forEachNode(this._root,t=>e(t.node,t.bounds,t.halfSize))}_intersectsNode(e,t){return m(t.bounds,2*-t.halfSize,E),m(t.bounds,2*t.halfSize,A),Object(d["j"])(e.origin,e.direction,E,A)}_intersectsNodeWithOffset(e,t,r){return m(t.bounds,2*-t.halfSize,E),m(t.bounds,2*t.halfSize,A),r.applyToMinMax(E,A),Object(d["j"])(e.origin,e.direction,E,A)}_intersectsObject(e,t){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(u["i"])(r,e)}_intersectsObjectWithOffset(e,t,r){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(u["i"])(r.applyToBoundingSphere(i),e)}_forEachNode(e,t){let r=p.acquire().init(e);const i=[r];for(;0!==i.length;){if(r=i.pop(),t(r)&&!r.isLeaf())for(let e=0;e<r.node.children.length;e++)r.node.children[e]&&i.push(p.acquire().init(r).advance(e));p.release(r)}}_forEachNodeDepthOrdered(e,t,r,i=1){let n=p.acquire().init(e);const a=[n];for(v(r,i,V);0!==a.length;){if(n=a.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=V[e];n.node.children[t]&&a.push(p.acquire().init(n).advance(t))}p.release(n)}}_remove(e,t,r){R.clear();const i=r.advanceTo(t,(e,t)=>{R.push(e.node),R.push(t)})?r.node.terminals:r.node.residents;if(i.removeUnordered(e),0===i.length)for(let n=R.length-2;n>=0;n-=2){const e=R.data[n],t=R.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new a["a"]({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let r=0;r<t.length;r++){const i=p.acquire().init(e);this._add(t.getItemAt(r),i),p.release(i)}}_grow(e,t){if(0!==t&&(g(e,t,e=>this._objectToBoundingSphere(e),D),x(D[3])&&!this._fitsInsideTree(D)))if(this._nodeIsEmpty(this._root.node))Object(u["b"])(D,this._root.bounds),this._root.halfSize=1.25*D[3];else{const e=this._rootBoundsForRootAsSubNode(D);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(D,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){Object(s["n"])(z,t.bounds),z[3]=t.halfSize,g([e,z],2,e=>e,I);const r=p.acquire().init(this._root);this._root.initFrom(null,I,1.25*I[3]),this._forEachNode(r,e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0)),p.release(r)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,e=>(r=Math.max(r,e.depth),r+t<=this._maximumDepth)),r+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],r=e;let i=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let s=0;s<3;s++){const e=n[s]-a-(r[s]-t),o=r[s]+t-(n[s]+a),c=Math.max(0,Math.ceil(e/(2*a))),l=Math.max(0,Math.ceil(o/(2*a)))+1,u=2**Math.ceil(Math.log(c+l)*Math.LOG2E);i=Math.max(i,u),L[s].min=c,L[s].max=l}for(let s=0;s<3;s++){let e=L[s].min,t=L[s].max;const r=(i-(e+t))/2;e+=Math.ceil(r),t+=Math.floor(r);const o=n[s]-a-e*a*2;P[s]=o+(t+e)*a}return P[3]=i*a*S,p.acquire().initFrom(null,P,i*a,0)}_growRootAsSubNode(e){const t=this._root.node;Object(s["n"])(D,this._root.bounds),D[3]=this._root.halfSize,this._root.init(e),e.advanceTo(D,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let r=0,i=0;for(;i<t.length&&null==e;)r=i++,e=t[r];for(;i<t.length;)if(t[i++])return-1;return r}_isDegenerate(e){return!x(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}}class p{constructor(){this.bounds=Object(u["c"])(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,r,n=this.depth){return this.node=Object(i["l"])(e)?e:p.createEmptyNode(),Object(i["l"])(t)&&Object(u["b"])(t,this.bounds),this.halfSize=r,this.depth=n,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const r=j[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*S,this}advanceTo(e,t,r=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}const i=this._childIndex(e);t&&t(this,i),this.advance(i)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a["a"]({shrink:!0}),residents:new a["a"]({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function f(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function b(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function m(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function g(e,t,r,i){if(1===t){const t=r(e[0]);Object(u["b"])(t,i)}else{E[0]=1/0,E[1]=1/0,E[2]=1/0,A[0]=-1/0,A[1]=-1/0,A[2]=-1/0;for(let i=0;i<t;i++){const t=r(e[i]);x(t[3])&&(f(E,t),b(A,t))}Object(s["l"])(i,E,A,.5),i[3]=Math.max(A[0]-E[0],A[1]-E[1],A[2]-E[2])/2}}function v(e,t,r){if(!F.length)for(let i=0;i<8;++i)F.push({index:0,distance:0});for(let i=0;i<8;++i){const r=j[i];F.data[i].index=i,F.data[i].distance=O(e,t,r)}F.sort((e,t)=>e.distance-t.distance);for(let i=0;i<8;++i)r[i]=F.data[i].index}function y(e,t){let r=1/0,i=null;for(let n=0;n<8;++n){const a=O(e,t,_[n]);a<r&&(r=a,i=_[n])}return i}function O(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function x(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new n["a"](p);const j=[Object(o["h"])(-1,-1,-1),Object(o["h"])(1,-1,-1),Object(o["h"])(-1,1,-1),Object(o["h"])(1,1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(1,-1,1),Object(o["h"])(-1,1,1),Object(o["h"])(1,1,1)],_=[Object(o["h"])(-1,-1,-1),Object(o["h"])(-1,-1,1),Object(o["h"])(-1,1,-1),Object(o["h"])(-1,1,1),Object(o["h"])(1,-1,-1),Object(o["h"])(1,-1,1),Object(o["h"])(1,1,-1),Object(o["h"])(1,1,1)],S=Math.sqrt(3),w=[null];function C(e){return w[0]=e,w}const P=Object(u["c"])(),T=Object(o["f"])(),E=Object(o["f"])(),A=Object(o["f"])(),R=new a["a"],M=Object(u["c"])(),D=Object(u["c"])(),z=Object(u["c"])(),I=Object(u["c"])(),L=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=new a["a"],V=[0,0,0,0,0,0,0,0]},"0cb9":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return s}));var i=r("b2b2"),n=r("84f4");class a{constructor(e,t=null,r=0){this.array=e,this.spatialReference=t,this.offset=r}}function s(e){return"array"in e}function o(e,t,r="ground"){if(Object(n["a"])(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(s(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(i["v"])(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},"0d7a":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("7cb4"),n=r("3886");function a(e,t){const r=e.fragment;t.vertexTangents?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?r.code.add(n["a"]`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(n["a"]`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(n["a"]`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),0!==t.attributeTextureCoordinates&&(e.include(i["a"],t),r.uniforms.add("normalTexture","sampler2D"),r.uniforms.add("normalTextureSize","vec2"),r.code.add(n["a"]`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))}},"0d96":function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return O}));var i=r("3349"),n=r("02f1"),a=r("0fc4"),s=r("d272"),o=r("7c1d"),c=r("d0cb"),l=r("7079"),u=r("6a07"),d=r("be24"),h=r("ebd5"),p=r("4377"),f=r("501b"),b=r("2f98"),m=r("3886"),g=r("690a");function v(e){const t=new g["a"],r=e.signedDistanceFieldEnabled;if(t.include(o["a"]),t.include(c["a"],e),t.include(s["a"],e),6===e.output)return t.include(l["a"],e),t;t.include(b["a"]),t.fragment.include(f["a"]),t.fragment.include(p["a"]),t.include(d["a"],e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(m["a"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?m["a"]`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:m["a"]`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const i=m["a"]`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,n=e.pixelSnappingEnabled?r?m["a"]`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:m["a"]`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:m["a"]`posProj += quadOffset;`;t.vertex.code.add(m["a"]`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${i}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${m["a"].float(h["c"])};
      ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${m["a"].float(h["c"])};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${n}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?m["a"]`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const a=e.debugDrawBorder?m["a"]`(isBorder > 0.0 ? 0.0 : ${m["a"].float(h["b"])})`:m["a"].float(h["b"]),v=m["a"]`
    ${e.debugDrawBorder?m["a"]`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?m["a"]`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${m["a"].float(h["c"])}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:m["a"]`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?m["a"]`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(m["a"]`
      void main() {
        ${v}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(m["a"]`
    void main() {
      ${v}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(u["a"]),t.fragment.code.add(m["a"]`
    void main() {
      ${v}
      ${e.binaryHighlightOcclusionEnabled?m["a"]`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function y(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a["b"]),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",O(t))}function O(e,t=j){return e.textureIsSignedDistanceField?x(e.anchorPos,e.distanceFieldBoundingBox,t):Object(i["c"])(t,e.anchorPos),t}function x(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}const j=Object(n["b"])(),_=Object.freeze({__proto__:null,build:v,bindHUDMaterialUniforms:y,calculateAnchorPosForRendering:O})},"0d9f":function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return ie})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return I})),r.d(t,"g",(function(){return x})),r.d(t,"h",(function(){return D})),r.d(t,"i",(function(){return w})),r.d(t,"j",(function(){return C})),r.d(t,"k",(function(){return B})),r.d(t,"l",(function(){return N})),r.d(t,"m",(function(){return G})),r.d(t,"n",(function(){return j}));r("c120");var i=r("e92d"),n=r("38a4"),a=r("2119"),s=r("d791"),o=r("afe1"),c=r("e431"),l=r("0b2d"),u=r("bd7e"),d=r("7289"),h=r("d18f"),p=r("a1b1"),f=r("7361");const b=i["a"].getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class m{constructor(){this.plane=Object(d["d"])(),this.origin=Object(l["f"])(),this.basis1=Object(l["f"])(),this.basis2=Object(l["f"])()}}function g(e=Y){return{plane:Object(d["d"])(e.plane),origin:Object(l["d"])(e.origin),basis1:Object(l["d"])(e.basis1),basis2:Object(l["d"])(e.basis2)}}function v(e,t,r){const i=K.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=Object(d["w"])(0,0,0,0),j(i),i}function y(e,t=g()){return x(e.origin,e.basis1,e.basis2,t)}function O(e,t){Object(c["n"])(t.origin,e.origin),Object(c["n"])(t.basis1,e.basis1),Object(c["n"])(t.basis2,e.basis2),Object(d["c"])(e.plane,t.plane)}function x(e,t,r,i=g()){return Object(c["n"])(i.origin,e),Object(c["n"])(i.basis1,t),Object(c["n"])(i.basis2,r),j(i),$(i,"fromValues()"),i}function j(e){Object(d["j"])(e.basis2,e.basis1,e.origin,e.plane)}function _(e,t,r){e!==r&&y(e,r);const i=Object(c["h"])(f["d"].get(),B(e),t);return Object(c["i"])(r.origin,r.origin,i),r.plane[3]-=t,r}function S(e,t,r){return w(t,r),_(r,F(e,e.origin),r),r}function w(e,t=g()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return Object(c["z"])(t.origin,e[0]+r,e[1]+i,0),Object(c["z"])(t.basis1,r,0,0),Object(c["z"])(t.basis2,0,i,0),Object(d["i"])(0,0,1,0,t.plane),t}function C(e,t,r){return!!Object(d["n"])(e.plane,t,r)&&H(e,r)}function P(e,t,r){if(C(e,t,r))return r;const i=T(e,t,f["d"].get());return Object(c["i"])(r,t.origin,Object(c["h"])(f["d"].get(),t.direction,Object(c["p"])(t.origin,i)/Object(c["s"])(t.direction))),r}function T(e,t,r){const i=J.get();Z(e,t,i,J.get());let a=Number.POSITIVE_INFINITY;for(const s of ee){const o=W(e,s,X.get()),l=f["d"].get();if(Object(d["l"])(i,o,l)){const e=Object(c["y"])(f["d"].get(),t.origin,l),i=Math.abs(Object(n["b"])(Object(c["k"])(t.direction,e)));i<a&&(a=i,Object(c["n"])(r,l))}}return a===Number.POSITIVE_INFINITY?E(e,t,r):r}function E(e,t,r){if(C(e,t,r))return r;const i=J.get(),n=J.get();Z(e,t,i,n);let a=Number.POSITIVE_INFINITY;for(const s of ee){const o=W(e,s,X.get()),l=f["d"].get();if(Object(d["m"])(i,o,l)){const e=Object(h["d"])(t,l);if(!Object(d["p"])(n,l))continue;e<a&&(a=e,Object(c["n"])(r,l))}}return M(e,t.origin)<a&&A(e,t.origin,r),r}function A(e,t,r){const i=Object(d["s"])(e.plane,t,f["d"].get()),n=Object(u["i"])(q(e,e.basis1),i,-1,1,f["d"].get()),a=Object(u["i"])(q(e,e.basis2),i,-1,1,f["d"].get());return Object(c["m"])(r,Object(c["i"])(f["d"].get(),n,a),e.origin),r}function R(e,t,r){const{origin:i,basis1:n,basis2:a}=e,s=Object(c["m"])(f["d"].get(),t,i),o=Object(p["d"])(n,s),l=Object(p["d"])(a,s),u=Object(p["d"])(B(e),s);return Object(c["z"])(r,o,l,u)}function M(e,t){const r=R(e,t,f["d"].get()),{basis1:i,basis2:n}=e,a=Object(c["s"])(i),s=Object(c["s"])(n),o=Math.max(Math.abs(r[0])-a,0),l=Math.max(Math.abs(r[1])-s,0),u=r[2];return o*o+l*l+u*u}function D(e,t){return Math.sqrt(M(e,t))}function z(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of ee){const n=W(e,i,X.get()),a=Object(u["e"])(n,t);a>r&&(r=a)}return Math.sqrt(r)}function I(e,t){return Object(d["p"])(e.plane,t)&&H(e,t)}function L(e,t,r,i){return k(e,r,i)}function F(e,t){const r=-e.plane[3];return Object(p["d"])(B(e),t)-r}function V(e,t,r,i){const n=F(e,t),a=Object(c["h"])(Q,B(e),r-n);return Object(c["i"])(i,t,a),i}function U(e,t){return Object(c["r"])(e.basis1,t.basis1)&&Object(c["r"])(e.basis2,t.basis2)&&Object(c["r"])(e.origin,t.origin)}function G(e,t,r){return e!==r&&y(e,r),Object(s["c"])(te,t),Object(s["u"])(te,te),Object(c["t"])(r.basis1,e.basis1,te),Object(c["t"])(r.basis2,e.basis2,te),Object(c["t"])(Object(d["r"])(r.plane),Object(d["r"])(e.plane),te),Object(c["t"])(r.origin,e.origin,t),Object(d["u"])(r.plane,r.origin,r.plane),r}function N(e,t,r,i){return e!==i&&y(e,i),Object(s["f"])(re,Object(s["j"])(re),t,r),Object(c["t"])(i.basis1,e.basis1,re),Object(c["t"])(i.basis2,e.basis2,re),j(i),i}function B(e){return Object(d["r"])(e.plane)}function k(e,t,r){switch(t){case 0:Object(c["n"])(r,e.basis1),Object(c["u"])(r,r);break;case 1:Object(c["n"])(r,e.basis2),Object(c["u"])(r,r);break;case 2:Object(c["n"])(r,B(e))}return r}function H(e,t){const r=Object(c["m"])(f["d"].get(),t,e.origin),i=Object(c["w"])(e.basis1),n=Object(c["w"])(e.basis2),a=Object(c["k"])(e.basis1,r),s=Object(c["k"])(e.basis2,r);return-a-i<0&&a-i<0&&-s-n<0&&s-n<0}function q(e,t){const r=X.get();return Object(c["n"])(r.origin,e.origin),Object(c["n"])(r.vector,t),r}function W(e,t,r){const{basis1:i,basis2:n,origin:a}=e,s=Object(c["h"])(f["d"].get(),i,t.origin[0]),o=Object(c["h"])(f["d"].get(),n,t.origin[1]);Object(c["i"])(r.origin,s,o),Object(c["i"])(r.origin,r.origin,a);const l=Object(c["h"])(f["d"].get(),i,t.direction[0]),u=Object(c["h"])(f["d"].get(),n,t.direction[1]);return Object(c["h"])(r.vector,Object(c["i"])(l,l,u),2),r}function $(e,t){Math.abs(Object(c["k"])(e.basis1,e.basis2)/(Object(c["s"])(e.basis1)*Object(c["s"])(e.basis2)))>1e-6&&b.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c["k"])(e.basis1,B(e)))>1e-6&&b.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c["k"])(B(e),e.origin)-e.plane[3])>1e-6&&b.warn(t,"Plane offset is not consistent with plane origin")}function Z(e,t,r,i){const n=B(e);Object(d["j"])(n,t.direction,t.origin,r),Object(d["j"])(Object(d["r"])(r),n,t.origin,i)}const Y={plane:Object(d["d"])(),origin:Object(l["h"])(0,0,0),basis1:Object(l["h"])(1,0,0),basis2:Object(l["h"])(0,1,0)},J=new a["a"](d["d"]),X=new a["a"](u["d"]),Q=Object(l["f"])(),K=new a["a"](()=>({origin:null,basis1:null,basis2:null,plane:null})),ee=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],te=Object(o["d"])(),re=Object(o["d"])(),ie=Object.freeze({__proto__:null,BoundedPlaneClass:m,create:g,wrap:v,copy:y,copyWithoutVerify:O,fromValues:x,updateUnboundedPlane:j,elevate:_,setExtent:S,fromAABoundingRect:w,intersectRay:C,intersectRayClosestSilhouette:P,closestPointOnSilhouette:T,closestPoint:E,projectPoint:A,projectPointLocal:R,distance2:M,distance:D,distanceToSilhouette:z,extrusionContainsPoint:I,axisAt:L,altitudeAt:F,setAltitudeAt:V,equals:U,transform:G,rotate:N,normal:B,UP:Y})},"0e25":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("c649");class n{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,r){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:r})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const r=this.items[t];r.objectStateId===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const r=this.items[t];0===r.type&&r.object===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const r=this.items[t];1===r.type&&r.renderGeometry===e&&(this._removeObjectStateItem(r),this.items.splice(t,1))}}removeAll(){this.items.forEach(e=>{this._removeObjectStateItem(e)}),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}class a{constructor(e,t){this.stateType=e,this.objectIdField=t,this.objectStateSet=new n,this.ids=new Set,this.paused=!1}hasGraphic(e){if(this.objectIdField){const t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}class s{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach(e=>e.objectStateSet.removeAll()),this._stateSets=null}acquireSet(e,t){const r=new a(e,t);this._stateSets.push(r);const n=Object(i["c"])(()=>this.releaseSet(r));return{set:r,handle:n}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}_addObjectStateSet(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}_removeObjectStateSet(e,t){e.removeObjectState(t.objectStateSet)}setUid(e,t){e.ids.add(t);const r=this._graphicsCore.graphics3DGraphics.get(t);r&&this._addObjectStateSet(r,e)}setUids(e,t){t.forEach(t=>this.setUid(e,t))}setObjectIds(e,t){t.forEach(t=>e.ids.add(t)),this.initializeSet(e)}addGraphic(e){this._stateSets.forEach(t=>{!t.paused&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})}removeGraphic(e){this._stateSets.forEach(t=>{t.hasGraphic(e)&&this._removeObjectStateSet(e,t)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(e=>e.objectStateSet.removeAll())}initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(t=>{t&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}):e.ids.forEach(r=>{const i=t.get(r);i&&this._addObjectStateSet(i,e)})}get test(){return{states:this._stateSets}}}},"0e88":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("b2b2"),n=r("f9d0");class a{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class s{constructor(e){this._context=e,this._perConstructorInstances=new n["a"],this._frameCounter=0,this._keepAliveFrameCount=o}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(e=>e.forEach(e=>e.technique.dispose())),this._perConstructorInstances.clear()}acquire(e,t){const r=t.key;let n=this._perConstructorInstances.get(e,r);if(Object(i["k"])(n)){const i=new e(this._context,t,()=>this.release(i));n=new a(i),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,t,r){if(Object(i["l"])(r)){if(t.key===r.key)return r;r.release()}return this.acquire(e,t)}release(e){if(Object(i["k"])(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);Object(i["k"])(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==o&&this._perConstructorInstances.forEach((e,t)=>{e.forEach((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.dispose(),this._perConstructorInstances.delete(t,r))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((t,r)=>{const i=async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach(e=>{e.technique.reload(this._context)}))};e.push(i(t,r))}),await Promise.all(e)}}const o=-1},"0eb9":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("b2b2"),n=r("8076"),a=r("e9d6");class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n["a"])(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=Object(a["e"])(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n["c"])(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(i["v"])(e.offset,0)}updateFeatureExpressionInfoContext(e,t,r){if(Object(i["k"])(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(i["l"])(t)&&Object(i["l"])(r)?(this._featureExpressionInfoContext=Object(a["a"])(e),Object(a["g"])(this._featureExpressionInfoContext,Object(a["d"])(n.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return Object(i["l"])(e)&&t.setFromElevationInfo(e),t}}},"0efb":function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));var i=r("a4ee"),n=r("8d60"),a=r("fc29"),s=r("2c4f"),o=r("af40"),c=r("b2b2"),l=r("f4cc"),u=r("3795"),d=r("59b2"),h=(r("b50f"),r("c120"),r("cea0"),r("d386")),p=r("0f1c"),f=r("a6a3"),b=r("d3cf"),m=r("69dd"),g=r("ed70"),v=r("4c84"),y=r("8202"),O=r("0e25"),x=r("3422"),j=r("ba58"),_=r("d347");let S=class extends a["a"]{constructor(e){super(e),this.graphicsCore=null,this.elevationAlignment=new y["a"],this.watchUpdatingTracking=new _["a"],this.handles=new o["a"],this.suspendResumeExtent=null}normalizeCtorArgs(e){let t=null;e.scaleVisibilityEnabled&&(delete(e={...e}).scaleVisibilityEnabled,t=new x["a"]);const r=new v["a"]({owner:e.owner,layer:e.layer,preferredUpdatePolicy:1,graphicSymbolSupported:!0});return{...e,graphicsCore:r,scaleVisibility:t}}initialize(){const e=this.scaleVisibility;Object(c["l"])(e)&&"minScale"in this.layer&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>e.layerMinMaxScaleChangeHandler()),"elevationInfo"in this.layer&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(e,t)=>{Object(p["a"])(e,t)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})}async setup(){const e=(e,t,r)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r);if(this.elevationAlignment.setup(this.owner,e,this.graphicsCore,this.view.elevationProvider),Object(c["l"])(this.scaleVisibility)&&"minScale"in this.layer){const t=this.owner.view.basemapTerrain;this.scaleVisibility.setup(this.owner,this.layer,e,this.graphicsCore,t)}this._set("objectStates",new O["a"](this.graphicsCore));try{await this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(t){if(Object(l["m"])(t))return;throw t}this.destroyed||(this.handles.add(this.view.watch("clippingArea",()=>this.updateClippingExtent(),!0)),this.updateClippingExtent(),this.setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this.handles=Object(c["e"])(this.handles),this.watchUpdatingTracking.destroy(),this._set("elevationAlignment",Object(c["e"])(this.elevationAlignment)),this._set("scaleVisibility",Object(c["e"])(this.scaleVisibility)),this._set("objectStates",Object(c["e"])(this.objectStates)),this._set("graphicsCore",Object(c["e"])(this.graphicsCore))}get suspended(){return!(!Object(c["l"])(this.scaleVisibility)||!this.scaleVisibility.suspended)}get updating(){var e,t;return!!(null!=(e=this.graphicsCore)&&e.updating||Object(c["l"])(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(t=this.watchUpdatingTracking)&&t.updating)}getGraphicFromGraphicUid(e){if(this.owner.loadedGraphics){const t=this.owner.loadedGraphics.find(t=>t.uid===e);if(t){const e=this.layer instanceof f["a"]?this.layer:null;return Object(b["c"])(t,e)}}}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){const{set:t,handle:r}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(t,e.uid),r}highlight(e){if(e instanceof m["a"])return w;if("number"==typeof e)return this.highlight([e]);if(e instanceof n["a"])return this.highlight([e]);if(e instanceof s["a"]&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof n["a"]){const t=e.map(e=>e.uid),{set:r,handle:i}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(r,t),i}if("number"==typeof e[0]){const t=e,{set:r,handle:i}=this.objectStates.acquireSet(0,null);return this.objectStates.setObjectIds(r,t),i}}return w}updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}updateSuspendResumeExtent(){Object(c["k"])(this.scaleVisibility)||(this.suspendResumeExtent=Object(j["e"])(this.graphicsCore.computedExtent,this.suspendResumeExtent,g["a"],this.graphicsCore.extentPadding),this.scaleVisibility.setExtent(this.suspendResumeExtent))}setupSuspendResumeExtent(){Object(c["k"])(this.scaleVisibility)||(Object(u["a"])(this.graphicsCore,"computedExtent",e=>this.updateSuspendResumeExtent(),!0),this.graphicsCore.watch("extentPadding",e=>this.updateSuspendResumeExtent()))}};Object(i["a"])([Object(d["b"])({constructOnly:!0})],S.prototype,"owner",void 0),Object(i["a"])([Object(d["b"])({constructOnly:!0})],S.prototype,"layer",void 0),Object(i["a"])([Object(d["b"])({readOnly:!0,aliasOf:"owner.view"})],S.prototype,"view",void 0),Object(i["a"])([Object(d["b"])({constructOnly:!0})],S.prototype,"graphicsCore",void 0),Object(i["a"])([Object(d["b"])({constructOnly:!0})],S.prototype,"scaleVisibility",void 0),Object(i["a"])([Object(d["b"])({readOnly:!0})],S.prototype,"elevationAlignment",void 0),Object(i["a"])([Object(d["b"])({readOnly:!0})],S.prototype,"objectStates",void 0),Object(i["a"])([Object(d["b"])({readOnly:!0})],S.prototype,"watchUpdatingTracking",void 0),Object(i["a"])([Object(d["b"])({readOnly:!0})],S.prototype,"suspended",null),Object(i["a"])([Object(d["b"])({readOnly:!0})],S.prototype,"updating",null),S=Object(i["a"])([Object(h["a"])("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],S);const w={remove(){},pause(){},resume(){}},C=S},1666:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s}));var i=r("9812"),n=r("32ed"),a=r("8c4b");function s(e){const t=c(e.rings,e.hasZ,1),r=[];let n=0,s=0;for(const a of t.polygons){const e=a.count,o=a.index,c=new Float64Array(t.position.buffer,3*o*t.position.BYTES_PER_ELEMENT,3*e),l=a.holeIndices.map(e=>e-o),u=new Uint32Array(Object(i["a"])(c,l,3));r.push({position:c,faces:u}),n+=c.length,s+=u.length}const l=o(r,n,s),u=Object(a["a"])(l.position.buffer,6,{originalIndices:l.faces});return l.position=new Float64Array(u.buffer),l.faces=u.indices,l}function o(e,t,r){if(1===e.length)return e[0];const i=new Float64Array(t),n=new Uint32Array(r);let a=0,s=0,o=0;for(const c of e){for(let e=0;e<c.position.length;e++)i[a++]=c.position[e];for(let e=0;e<c.faces.length;e++)n[s++]=c.faces[e]+o;o=a/3}return{position:i,faces:n}}function c(e,t,r){const i=e.length,n=new Array(i),a=new Array(i),s=new Array(i);let o=0,c=0,d=0,h=0;for(let l=0;l<i;++l)h+=e[l].length;const p=new Float64Array(3*h);let f=0;for(let b=i-1;b>=0;b--){const h=e[b],m=1===r&&u(h);if(m&&1!==i)n[o++]=h;else{let e=h.length;for(let t=0;t<o;++t)e+=n[t].length;const r={index:f,pathLengths:new Array(o+1),count:e,holeIndices:new Array(o)};r.pathLengths[0]=h.length,h.length>0&&(s[d++]={index:f,count:h.length}),f=m?l(h,h.length-1,-1,p,f,h.length,t):l(h,0,1,p,f,h.length,t);for(let i=0;i<o;++i){const e=n[i];r.holeIndices[i]=f,r.pathLengths[i+1]=e.length,e.length>0&&(s[d++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}o=0,r.count>0&&(a[c++]=r)}}for(let u=0;u<o;++u){const e=n[u];e.length>0&&(s[d++]={index:f,count:e.length}),f=l(e,0,1,p,f,e.length,t)}return c<i&&(a.length=c),d<i&&(s.length=d),{position:p,polygons:a,outlines:s}}function l(e,t,r,i,n,a,s){n*=3;for(let o=0;o<a;++o){const a=e[t];i[n++]=a[0],i[n++]=a[1],i[n++]=s?a[2]:0,t+=r}return n/3}function u(e){return!Object(n["g"])(e,!1,!1)}},"171c":function(e,t,r){"use strict";r.d(t,"a",(function(){return O}));var i=r("e92d"),n=r("38a4"),a=r("b2b2"),s=r("a915"),o=r("d791"),c=r("afe1"),l=r("3349"),u=r("02f1"),d=r("e431"),h=r("0b2d"),p=r("7577"),f=r("0fc4"),b=r("d359"),m=r("d18f"),g=r("a1b1"),v=r("1153");const y=i["a"].getLogger("esri.views.3d.webgl-engine.lib.Camera");class O{constructor(e=null,t=null,r=null){this._viewUp=Object(h["f"])(),this._viewForward=Object(h["f"])(),this._viewRight=Object(h["f"])(),this._ray=Object(m["c"])(),this._viewport=Object(f["g"])(0,0,1,1),this._padding=Object(f["g"])(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(u["f"])(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c["d"])(),this._projectionDirty=!0,this._projectionMatrix=Object(c["d"])(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c["d"])(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c["d"])(),this._frustumDirty=!0,this._frustum=Object(b["c"])(),this._fullViewport=Object(f["e"])(),this.pixelRatio=1,this.relativeElevation=0,Object(a["l"])(e)&&Object(d["n"])(this._ray.origin,e),this._center=Object(a["l"])(t)?Object(h["d"])(t):Object(h["f"])(),this._up=Object(a["l"])(r)?Object(h["d"])(r):Object(h["h"])(0,0,1)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(d["m"])(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o["d"])(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(p["c"])(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o["n"])(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;Object(o["i"])(this._projectionMatrix,-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(o["d"])(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(v["b"])(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(v["d"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(v["c"])(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(v["e"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(d["p"])(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o["c"])(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o["u"])(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(d["n"])(this._ray.origin,e.eye),Object(d["n"])(this._center,e.center),Object(d["n"])(this._up,e.up),Object(p["c"])(this._viewport,e.viewport),Object(p["c"])(this._padding,e.padding),Object(l["c"])(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o["d"])(this._viewMatrix,e.viewMatrix),Object(d["n"])(this._viewRight,e.viewRight),Object(d["n"])(this._viewUp,e.viewUp),Object(d["n"])(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o["d"])(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(b["b"])(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o["d"])(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p["c"])(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new O).copyFrom(this)}equals(e){return Object(d["r"])(this.eye,e.eye)&&Object(d["r"])(this._center,e.center)&&Object(d["r"])(this._up,e.up)&&Object(p["g"])(this._viewport,e.viewport)&&Object(p["g"])(this._padding,e.padding)&&Object(l["e"])(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4,r=1-1e-10;Object(d["C"])(_,e.eye,e.center),Object(d["C"])(S,this.eye,this._center);const i=Object(d["k"])(_,S),n=Object(d["D"])(_),a=Object(d["D"])(S);return i*i>=r*n*a&&Object(d["E"])(e.eye,this.eye)<Math.max(n,a)*t*t&&Object(p["i"])(e.padding,this._padding)<.5&&Object(p["i"])(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(g["d"])(this.viewForward,Object(d["m"])(_,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(s["g"])()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t,r=!1){e!==x&&Object(d["n"])(x,e),x[3]=1,r&&(t[2]=-x[2]),Object(p["m"])(x,x,this.projectionMatrix),Object(d["h"])(x,x,1/Math.abs(x[3]));const i=this.fullViewport;return t[0]=Object(n["l"])(0,i[0]+i[2],.5+.5*x[0]),t[1]=Object(n["l"])(0,i[1]+i[3],.5+.5*x[1]),r||(t[2]=.5*(x[2]+1)),t}projectToScreen(e,t){this.projectToRenderScreen(e,w),this.renderToScreen(w,t)}projectToRenderScreen(e,t){if(x[0]=e[0],x[1]=e[1],x[2]=e[2],x[3]=1,Object(p["m"])(x,x,this.viewProjectionMatrix),0===x[3])return null;Object(d["h"])(x,x,1/Math.abs(x[3]));const r=this.fullViewport;return"x"in t?(t.x=Object(n["l"])(0,r[0]+r[2],.5+.5*x[0]),t.y=Object(n["l"])(0,r[1]+r[3],.5+.5*x[1])):(t[0]=Object(n["l"])(0,r[0]+r[2],.5+.5*x[0]),t[1]=Object(n["l"])(0,r[1]+r[3],.5+.5*x[1]),t.length>2&&(t[2]=.5*(x[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,w),t)}unprojectFromRenderScreen(e,t){if(Object(o["n"])(j,this.projectionMatrix,this.viewMatrix),!Object(o["c"])(j,j))return null;const r=this.fullViewport;return x[0]=2*(e[0]-r[0])/r[2]-1,x[1]=2*(e[1]-r[1])/r[3]-1,x[2]=2*e[2]-1,x[3]=1,Object(p["m"])(x,x,j),0===x[3]?null:(t[0]=x[0]/x[3],t[1]=x[1]/x[3],t[2]=x[2]/x[3],t)}constrainWindowSize(e,t,r,i=r){const n=e*this.pixelRatio,a=t*this.pixelRatio,s=Math.max(n-r/2,0),o=Math.max(this.fullHeight-a-i/2,0),c=-Math.min(n-r/2,0),l=-Math.min(this.fullHeight-a-i/2,0);return[s,o,r-c- -Math.min(this.fullWidth-n-r/2,0),i-l- -Math.min(a-i/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}computeUpGlobal(){Object(d["m"])(_,this.center,this.eye);const e=Object(d["s"])(this.center);e<1?(Object(d["z"])(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(d["k"])(_,this.center))>.9999*Object(d["s"])(_)*e||(Object(d["j"])(this._up,_,this.center),Object(d["j"])(this._up,this._up,_),Object(d["u"])(this._up,this._up),this._markViewDirty())}computeUpLocal(){Object(d["y"])(_,this.eye,this.center),Math.abs(_[2])<=.9999&&(Object(d["h"])(_,_,_[2]),Object(d["z"])(this._up,-_[0],-_[1],1-_[2]),Object(d["u"])(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(d["r"])(e,t)||(Object(d["n"])(t,e),this._markViewDirty()):y.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(b["e"])(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o["m"])(this._viewMatrix,this.eye,this._center,this._up),Object(d["z"])(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(d["z"])(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(d["z"])(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const x=Object(f["e"])(),j=Object(c["d"])(),_=Object(h["f"])(),S=Object(h["f"])(),w=Object(s["e"])()},1797:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));r("e06a");var i=r("b50f"),n=r("b2b2"),a=r("f4cc"),s=r("9305"),o=r("57dc");class c{constructor(e,t){this.spatialReference=e,this.view=t}getElevation(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}async queryElevation(e,t,r,i,n){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)}}class l{constructor(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(s["b"].ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,t,r,n=0){return new Promise((s,o)=>{const c={x:e,y:t,minDemResolution:n,result:{resolve:s,reject:o},signal:r};this._queries.push(c),Object(a["r"])(r,()=>{Object(i["j"])(this._queries,c),o(Object(a["e"])())})})}get running(){return this._queries.length>0}runTask(){const e=this._queries;this._queries=[];const t=this._getElevationQueryProvider();if(!t)return void e.forEach(e=>e.result.reject());const r=e.map(e=>[e.x,e.y]),i=e.reduce((e,t)=>Math.min(e,t.minDemResolution),1/0),s=new o["a"]({points:r,spatialReference:this.spatialReference}),c=e.length>1&&e.some(e=>!!e.signal)?new AbortController:null,l=Object(n["l"])(c)?c.signal:e[0].signal;if(Object(n["l"])(c)){let t=0;e.forEach(r=>Object(a["r"])(r.signal,()=>{t++,r.result.reject(Object(a["e"])()),t===e.length&&c.abort()}))}const u={...this._queryOptions,minDemResolution:i,signal:l};t.queryElevation(s,u).then(t=>{e.forEach((e,r)=>{Object(n["l"])(e.signal)&&e.signal.aborted?e.result.reject(Object(a["e"])()):e.result.resolve(t.geometry.points[r][2])})}).catch(t=>{e.forEach(e=>e.result.reject(t))})}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask()}}}},"17ca":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.vertex.code.add(i["a"]`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},"191a":function(e,t,r){"use strict";r.d(t,"a",(function(){return M}));var i=r("28eb"),n=r("b2b2"),a=r("8a44"),s=r("d791"),o=r("afe1"),c=r("2ebb"),l=r("b061"),u=r("1153"),d=r("1f93");class h{constructor(e){this.first=e.from,this.count=e.to-e.from}}class p{constructor(e=0,t=0){this.from=e,this.to=t}}class f extends p{constructor(e,t,r,i,n,a){super(t,r),this.id=e,this.isVisible=i,this.hasHighlights=n,this.hasOccludees=a}}function b(e){return Array.from(e.values()).sort(m)}function m(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function g(e,t){if(0===e.length)return void e.push(new h(t));const r=e[e.length-1];if(v(r,t)){const e=t.from-r.first+t.to-t.from;r.count=e}else e.push(new h(t))}function v(e,t){return e.first+e.count>=t.from}class y{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(x(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let r;const i=j(this._buffer.length,this._size,e);if(this._buffer.length!==i){const e=this._pool.newBuffer(i);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,i))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),r=this._buffer,this._buffer=e}const n=this._size;return this._size=e,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(e,t,i)=>this._buffer.array.set(r.array.subarray(t,i),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,r)=>{e!==t&&this._buffer.array.copyWithin(e,t,r)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}const O=65536;function x(e){return Math.ceil(e/O)*O}function j(e,t,r){return t<=r?e>=r?e:x(Math.max(2*e,r)):e<=2*r?e:x(r)}var _=r("aefa"),S=r("f2e0"),w=r("7ce4"),C=(r("d267"),r("c120"),r("1956"),r("d17d"),r("9f8b"),r("a1ff"),r("0fa6"));class P{constructor(e,t,r,i){this.vao=new C["a"](e,t,{geometry:r},{geometry:w["a"].createVertex(e,35044)}),this.array=new Float32Array(i),this.vao.vertexBuffers.geometry.setData(this.array)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const T=_["a"]+1;class E{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=e.newCache("MergedRenderer pool "+Object(S["b"])(),A)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),r=this._cache.pop(t);if(Object(n["l"])(r)){const e=r.pop();return r.length>0&&this._cache.put(t,r,e.array.byteLength*r.length,T),e}return new P(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,r=e.array.length.toString(),i=this._cache.pop(r);return Object(n["l"])(i)?(i.push(e),this._cache.put(r,i,t*i.length,-1)):this._cache.put(r,[e],t,-1),null}}function A(e,t){if(0===t)return void e.forEach(e=>e.dispose());const r=e.pop(),i=e.length*r.array.byteLength;return r.dispose(),i}var R=r("b623");class M{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new a["a"],this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new l["a"](this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new E(e,r.vertexAttributeLocations,Object(c["a"])(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof d["a"]}get rendersOccluded(){return!this.isEmpty&&1!==this._material.renderOccluded}modify(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}addAndRemoveGeometries(e,t){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,a=z(e,t);a.forEach((e,t)=>{a.delete(t);const s=e.toAdd.reduce((e,t)=>e+r.elementCount(t.data),0);let o=n.get(t);if(null==o)Object(u["a"])(0===e.toRemove.length),o=new U(e.origin,new y(this._bufferPool,s*i)),n.set(t,o);else if(0===e.toAdd.length&&o.instances.size===e.toRemove.length)return o.buffer.dispose(),void n.delete(t);let c=0;o.instances.forEach(e=>c+=e.to-e.from);const l=e.toRemove.reduce((e,t)=>e+r.elementCount(t.data),0),d=o.buffer.size,h=(c+s-l)*i,p=N;if(h<d/2?this.removeAndRebuild(o,e.toRemove,i,h,p):e.toRemove.length>0&&this.remove(o,e.toRemove,i,p),e.toAdd.length>0){const t=B;Object(u["l"])(t,-e.origin[0],-e.origin[1],-e.origin[2]),this.add(o,e.toAdd,i,t,p)}const f=o.buffer.vao.vertexBuffers.geometry;V(p),p.forAll(({from:e,to:t})=>{if(e<t){const r=o.buffer.array,i=4,n=e*i,a=t*i;f.setSubData(r,n,n,a)}}),p.clear(),o.drawCommandsDirty=!0})}updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.origin.id),a=n&&n.instances.get(e.id);if(!a)return;const s=i.updateType;if(1&s&&(a.isVisible=e.instanceParameters.visible),9&s){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t}if(16&s&&(a.hasOccludees=!!e.instanceParameters.occludees),6&s){const{array:i,vao:s}=n.buffer;Object(R["b"])(e,k,H),t.write({transformation:k,invTranspTransformation:H},e.data,t.vertexBufferLayout.createView(i.buffer),a.from),Object(u["a"])(a.from+t.elementCount(e.data)===a.to,"material VBO layout has changed"),s.vertexBuffers.geometry.setSubData(i,a.from*r*4,a.from*r*4,a.to*r*4)}n.drawCommandsDirty=!0}}updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(i["c"])(e.instances,t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))});const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!L(e)){const t=this._bufferWriter.vertexBufferLayout.stride,r=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:r}])}const t=b(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?g(e.drawCommandsOccludees,r):g(e.drawCommandsDefault,r),r.hasHighlights?g(e.drawCommandsHighlight,r):g(e.drawCommandsShadowHighlightRest,r))};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)})}updateLogic(e){return this._material.update(e)}render(e,t,r){if(null!=e&&!this._material.requiresSlot(e,t))return!1;const i=5===t||7===t;if(i&&!this._hasHighlights)return!1;const a=6===t,s=!(i||a);if(this._dataByOrigin.forEach(e=>{if(i&&!e.hasHighlights)return;const t=(i?e.drawCommandsHighlight:a&&L(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,r=s&&e.drawCommandsOccludees||null;(Object(n["l"])(t)||Object(n["l"])(r))&&this._renderCommandData.push(new G(e.origin,e.buffer,t,r))}),0===this._renderCommandData.length)return!1;const o=this._rctx,c=this._glMaterials.load(o,t);if(Object(n["k"])(c))return this._renderCommandData.clear(),!1;const l=c.beginSlot(r);return l.bindPipelineState(o,e,!1),o.useProgram(l.program),c.bind(r,l),this._renderCommandData.forAll(({origin:t,buffer:i,renderCommands:a,occludeeCommands:s})=>{r.origin=t,l.bindDraw(r),l.ensureAttributeLocations(i.vao),o.bindVAO(i.vao);const c=l.primitiveType;Object(n["l"])(a)&&this.renderCommands(o,c,a),Object(n["l"])(s)&&(l.bindPipelineState(o,e,!0),this.renderCommands(o,c,s),l.bindPipelineState(o,e,!1))}),this._renderCommandData.clear(),!0}renderCommands(e,t,r){for(let i=0;i<r.length;i++)e.drawArrays(t,r[i].first,r[i].count)}removeAndRebuild(e,t,r,i,n){for(const l of t)e.instances.delete(l.id);const a=b(e.instances);e.instances.clear();const s=e.buffer.size,o=e.buffer.alloc(i);let c=0;for(const l of a){const t=l.from*r,i=l.to*r;o.copy(c,t,i),l.from=c/r,c+=i-t,l.to=c/r,e.instances.set(l.id,l)}n.push(new p(0,o.hasNewBuffer?e.buffer.array.length:s)),o.dispose(),e.buffer.erase(c,n.back().to),e.holes.clear()}remove(e,t,r,i){for(const n of t){const t=n.id,a=e.instances.get(t),s=a.from*r,o=a.to*r;e.buffer.erase(s,o),e.holes.push(new p(a.from,a.to)),e.instances.delete(t),i.push(new p(s,o))}V(e.holes)}add(e,t,r,i,a){const o=this._bufferWriter;let c=o.vertexBufferLayout.createView(e.buffer.array.buffer);for(const l of t){const t=Object(n["l"])(l.transformation)?Object(s["n"])(k,i,l.transformation):i;Object(s["c"])(H,t);const d=Object(s["u"])(H,H),h=o.elementCount(l.data),b=h*r;let m=F(e.holes,h);Object(n["k"])(m)&&(m=e.buffer.size/r,e.buffer.grow(b),c=o.vertexBufferLayout.createView(e.buffer.array.buffer)),o.write({transformation:t,invTranspTransformation:d},l.data,c,m);const g=l.instanceParameters.visible,v=!!l.instanceParameters.highlights&&g,y=!!l.instanceParameters.occludees,O=new f(l.id,m,m+h,g,v,y);Object(u["a"])(null==e.instances.get(l.id)),e.instances.set(l.id,O),a.push(new p(O.from*r,O.to*r))}}get test(){return{material:this._material,glMaterials:this._glMaterials}}}class D{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function z(e,t){const r=new Map;for(const i of e)I(r,i,!0);for(const i of t)I(r,i,!1);return r}function I(e,t,r){const i=t.origin;if(Object(n["k"])(i))return;let a=e.get(i.id);null==a&&(a=new D(i.vec3),e.set(i.id,a)),r?a.toAdd.push(t):a.toRemove.push(t)}function L(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function F(e,t){let r;if(!e.some(e=>!(e.to-e.from<t)&&(r=e,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}function V(e){const t=new Map;e.forAll(e=>t.set(e.from,e));let r=!0;for(;r;)r=!1,e.forEach(i=>{const n=t.get(i.to);n&&(i.to=n.to,t.delete(n.from),e.removeUnordered(n),r=!0)})}class U{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new a["a"]({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class G{constructor(e,t,r,i){this.origin=e,this.buffer=t,this.renderCommands=r,this.occludeeCommands=i}}const N=new a["a"]({deallocator:null}),B=Object(o["d"])(),k=Object(o["d"])(),H=Object(o["d"])()},1962:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return f}));var i=r("d272"),n=r("4db9"),a=r("6d5b"),s=r("c2d1"),o=r("6a07"),c=r("d047"),l=r("c6d7"),u=r("ebd5"),d=r("4377"),h=r("3886"),p=r("690a");function f(e){const t=new p["a"],r=1===e.output;return t.include(n["a"],{linearDepth:r}),t.include(a["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r&&(t.include(s["a"],e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(h["a"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${r?h["a"]`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:h["a"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(i["a"],e),t.fragment.include(d["a"]),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(l["b"],e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(o["a"]),t.fragment.code.add(h["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${h["a"].float(u["c"])}) {
      discard;
    }

    ${7===e.output?h["a"]`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?h["a"]`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?h["a"]`outputHighlight();`:""};
    ${1===e.output?h["a"]`outputDepth(linearDepth);`:""};
  }
  `),t}const b=Object.freeze({__proto__:null,build:f})},"1a54":function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return S})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return m})),r.d(t,"g",(function(){return C})),r.d(t,"h",(function(){return f})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return y})),r.d(t,"k",(function(){return j}));var i=r("f0b9"),n=(r("c120"),r("b2b2")),a=r("a21b"),s=r("f2e0"),o=r("5996"),c=r("4261"),l=r("9180"),u=r("008c"),d=r("74e2"),h=r("a1f3");r("3563");class p{constructor(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function f(e){return Object(n["l"])(e.geometry)}class b{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function m(e){const t=d["a"].fromJSON(e.geometryType),r=o["a"].fromJSON(e.spatialReference),i=e.transform,a=e.features.map(a=>{const s=g(a,t,r,e.objectIdFieldName),o=s.geometry;if(Object(n["l"])(o)&&i)switch(o.type){case"point":s.geometry=Object(u["e"])(i,o,o,o.hasZ,o.hasM);break;case"multipoint":s.geometry=Object(u["d"])(i,o,o,o.hasZ,o.hasM);break;case"polygon":s.geometry=Object(u["f"])(i,o,o,o.hasZ,o.hasM);break;case"polyline":s.geometry=Object(u["g"])(i,o,o,o.hasZ,o.hasM);break;case"extent":case"mesh":s.geometry=o}return s});return{geometryType:t,features:a,spatialReference:r,fields:e.fields?e.fields.map(e=>h["a"].fromJSON(e)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function g(e,t,r,i){return{uid:Object(s["b"])(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:v(e.geometry,t,r),visible:!0}}function v(e,t,r){if(Object(n["k"])(e))return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:r}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:r}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:r}}}}function y(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}}function O(e){if(Object(n["k"])(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),n="polyline"===e.type?e.paths:e.rings;for(const e of n)r+=e.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(n.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=Object(a["a"])(e.vertexAttributes.position),t+=Object(a["a"])(e.vertexAttributes.normal),t+=Object(a["a"])(e.vertexAttributes.uv),t+=Object(a["a"])(e.vertexAttributes.tangent)}return t}function x(e){let t=32;return t+=Object(i["a"])(e.attributes),t+=3,t+=8+O(e.geometry),t}function j(e){if(Object(n["k"])(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function _(e){if(Object(n["k"])(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function S(e,t){switch(Object(c["k"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)Object(c["o"])(t,e.paths[r],e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)Object(c["o"])(t,e.rings[r],e.hasZ);break;case"multipoint":Object(c["o"])(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function w(e,t){switch(Object(l["o"])(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)Object(l["s"])(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)Object(l["s"])(t,e.rings[r]);break;case"multipoint":Object(l["s"])(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function C(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(c["h"])(),Object(l["m"])()},"1a64":function(e,t,r){"use strict";r.d(t,"a",(function(){return J}));var i=r("e92d"),n=r("38bf"),a=r("9ef0"),s=r("b2b2"),o=r("a915"),c=r("74df"),l=r("2e0f"),u=r("0eb9"),d=r("7b96"),h=r("7f60"),p=r("ba58"),f=r("5241"),b=r("a803"),m=r("0278"),g=r("35b3"),v=r("738e"),y=r("fc00"),O=r("d7f7"),x=r("5957"),j=r("a4ee"),_=r("d272"),S=r("17b0"),w=r("d0cb"),C=r("9617"),P=r("8e97"),T=r("c3a4"),E=r("ca98"),A=r("da35"),R=r("fa1e"),M=r("c829"),D=r("7c51"),z=r("a5b5"),I=r("189c");class L extends E["a"]{initializeProgram(e){const t=L.shader.get(),r=this.configuration,i=t.build({occlusionTestEnabled:r.occlusionTestEnabled,verticalOffsetEnabled:r.verticalOffset,screenSizePerspectiveEnabled:r.screenSizePerspective,depthHudEnabled:r.depthHudEnabled,depthHudAlignStartEnabled:r.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:e.viewingMode,isDraped:!1,multipassGeometryEnabled:r.multipassGeometryEnabled});return new M["a"](e.rctx,i,R["a"])}bindPass(e,t){Object(P["c"])(this.program,t.camera.projectionMatrix),z["a"].bindUniforms(this.program,e,t.camera.pixelRatio||1),Object(S["b"])(this.program,e,t),Object(w["b"])(this.program,t),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(C["a"])(this.program,t),this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture"),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(P["f"])(this.program,t),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform2f("pixelToNDC",2/t.camera.fullViewport[2],2/t.camera.fullViewport[3]);const r=t.camera.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(e.size)*r),Object(D["a"])(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")}bindDraw(e){Object(P["d"])(this.program,e),Object(P["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(_["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=e?519:513;return this.configuration.depthHudEnabled?Object(I["g"])({depthTest:{func:t},depthWrite:I["e"]}):Object(I["g"])({blending:Object(I["h"])(1,770,771,771),depthTest:{func:t},colorWrite:I["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.multipassGeometryEnabled)}}L.shader=new T["a"](z["b"],()=>r.e("chunk-2d0efcae").then(r.bind(null,"9a2b")));class F extends A["a"]{constructor(){super(...arguments),this.occlusionTestEnabled=!0,this.verticalOffset=!1,this.screenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.screenCenterOffsetUnitsEnabled=0,this.slicePlaneEnabled=!1,this.multipassGeometryEnabled=!1}}Object(j["a"])([Object(A["b"])()],F.prototype,"occlusionTestEnabled",void 0),Object(j["a"])([Object(A["b"])()],F.prototype,"verticalOffset",void 0),Object(j["a"])([Object(A["b"])()],F.prototype,"screenSizePerspective",void 0),Object(j["a"])([Object(A["b"])()],F.prototype,"depthHudEnabled",void 0),Object(j["a"])([Object(A["b"])()],F.prototype,"depthHudAlignStartEnabled",void 0),Object(j["a"])([Object(A["b"])({count:2})],F.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(j["a"])([Object(A["b"])()],F.prototype,"slicePlaneEnabled",void 0),Object(j["a"])([Object(A["b"])()],F.prototype,"multipassGeometryEnabled",void 0);class V extends g["a"]{constructor(e){super(e,G),this.techniqueConfig=new F,this._uniqueMaterialIdentifier=V.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getTechniqueConfig(e,t){const r=18!==(null==t?void 0:t.slot);return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?1:0,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig}intersect(){}requiresSlot(e){switch(e){case 18:case 19:return!0}return!1}createGLMaterial(e){return 0===e.output?new U(e):null}createBufferWriter(){return new k}validateParameters(e){const t=V.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}}class U extends O["a"]{updateParameters(e){return this.ensureTechnique(L,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const G={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...g["b"]},N=Object(y["a"])().vec3f("position").vec3f("normal").vec2f("uv0").vec4f("auxpos1"),B=[Object(v["b"])(0,0),Object(v["b"])(1,0),Object(v["b"])(0,1),Object(v["b"])(1,0),Object(v["b"])(1,1),Object(v["b"])(0,1)];class k{constructor(){this.vertexBufferLayout=N}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,r,i){Object(x["e"])(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(x["d"])(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6),Object(x["a"])(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6);for(let n=0;n<B.length;++n)r.uv0.setVec(i+n,B[n])}}class H extends h["a"]{constructor(e,t){super(e,null,t,Z),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new V(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}perInstanceMaterialParameters(e){const t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t}get materialParameters(){const e=this.symbol,t=e.callout,r=Object(s["l"])(t.color)?a["a"].toUnitRGBA(t.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const i=Object(o["h"])(t.size||0);let n=null;if(e.verticalOffset){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e.verticalOffset;n={screenLength:Object(o["h"])(t),minWorldLength:r||0,maxWorldLength:null!=i?i:1/0}}const c=Object(s["l"])(t.border)&&Object(s["l"])(t.border.color)?a["a"].toUnitRGBA(t.border.color):null,l="object"===e.symbolLayers.getItemAt(0).type,u=!l,d=l?0:void 0,h="label-3d"===e.type;return{color:r,size:i,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:u,shaderPolygonOffset:d,depthHUDAlignStart:h,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:g["b"].renderOccluded}}_defaultElevationInfoNoZ(){return $}createGraphics3DGraphic(e){const t=e.renderingInfo,r=e.graphic,i=this.setGraphicElevationContext(r,new u["a"],t.elevationOffset||0),n=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some(e=>"object"===e.type||"text"===e.type));if("label-3d"!==n.type&&a)return null;const o=Object(p["a"])(r.geometry);return Object(s["k"])(o)?null:this._createAs3DShape(o,i,t,r.uid)}layerOpacityChanged(){return Object(s["k"])(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(l["e"])(H.elevationModeChangeTypes,r,i);return n!==l["b"].UPDATE||e.forEach(e=>{const r=t(e);Object(s["l"])(r)&&this.updateGraphicElevationContext(e.graphic,r)}),n}slicePlaneEnabledChanged(){return Object(s["k"])(this._material)||this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(e,t,r=0){const i=super.setGraphicElevationContext(e,t);return i.addOffsetRenderUnits(r),i}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(l["h"])(t.elevationContext.mode)}updateGeometry(e,t){return!1}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:b["e"].memory}}createVertexData(e){const{translation:t,centerOffset:r}=e;return[["position",t?{size:3,data:[t[0],t[1],t[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["auxpos1",r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}_getOrCreateMaterial(e){const t=this.perInstanceMaterialParameters(e),r=V.uniqueMaterialIdentifier(t);if(Object(s["l"])(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection){let i=e.materialCollection.get(r);return Object(s["k"])(i)&&(i=new V(t),e.materialCollection.add(r,i)),{material:i,isUnique:!1}}return{material:new V(t),isUnique:!0}}_createAs3DShape(e,t,r,i){const n=[new m["a"](this.createVertexData(r),W,1)],a=this._getOrCreateMaterial(r),s=Object(f["a"])(this._context,e,n,[a.material],t,this._context.layer.uid,i);if(null===s)return null;const o=new d["a"](this,s.object,n,a.isUnique?[a.material]:null,null,c["b"],t);return o.metadata={elevationOffset:r.elevationOffset||0},o.alignedSampledElevation=s.sampledElevation,o.needsElevationUpdates=Object(l["h"])(t.mode),Object(f["b"])(o,e,this._context.elevationProvider),o}}H.elevationModeChangeTypes={definedChanged:l["b"].UPDATE,staysOnTheGround:l["b"].UPDATE,onTheGroundChanged:l["b"].RECREATE};const q=new Uint16Array([0]),W=[["position",q],["normal",q],["auxpos1",q]],$={mode:"relative-to-ground",offset:0},Z={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Y=i["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function J(e,t){if(!Object(n["d"])(e))return Y.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=X[e.callout.type];return r?new r(e,t):(Y.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)}const X={line:H}},"1c20":function(e,t,r){"use strict";function i(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=r?r.count:t.count;let c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*s;for(let u=0;u<o;++u)i[c]=a[l],i[c+1]=a[l+1],i[c+2]=a[l+2],i[c+3]=a[l+3],c+=n,l+=s}function n(e,t,r,i,n,a){var s,o;const c=e.typedBuffer,l=e.typedBufferStride,u=null!=(s=null==a?void 0:a.count)?s:e.count;let d=(null!=(o=null==a?void 0:a.dstIndex)?o:0)*l;for(let h=0;h<u;++h)c[d]=t,c[d+1]=r,c[d+2]=i,c[d+3]=n,d+=l}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:i,fill:n})},"1f93":function(e,t,r){"use strict";r.d(t,"a",(function(){return R}));var i=r("b2b2"),n=r("b0ea");class a{constructor(){this.enabled=!0,this._time=0}get time(){return Object(n["a"])(this._time)}advance(e){return Object(i["l"])(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}var s=r("b061"),o=r("35b3"),c=r("7438"),l=r("d7f7"),u=r("a4ee"),d=r("d272"),h=r("6a07"),p=r("c6d7"),f=r("d017"),b=r("df77"),m=r("33e2"),g=r("8e97"),v=r("c3a4"),y=r("ca98"),O=r("da35"),x=r("fa1e"),j=r("c829"),_=r("ea44"),S=r("189c");class w extends y["a"]{constructor(e,t,r){super(e,t,r),this._textureRepository=e.waterTextureRepository}initializeProgram(e){const t=w.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,highStepCount:!0,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new j["a"](e.rctx,i,x["a"])}bindPass(e,t){Object(g["c"])(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(p["a"])(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(b["b"])(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(m["b"])(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(h["b"])(this.program,t)}bindDraw(e){Object(g["d"])(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(g["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(f["b"])(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(d["c"])(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e;return Object(S["g"])({blending:2!==t.output&&4!==t.output&&t.transparent?r?c["g"]:Object(c["a"])(e):null,depthTest:{func:Object(c["b"])(e)},depthWrite:r?t.writeDepth&&S["e"]:Object(c["c"])(e),colorWrite:S["d"],polygonOffset:r||i?null:Object(c["h"])(t.enableOffset)})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}w.shader=new v["a"](_["a"],()=>r.e("chunk-2d0a5169").then(r.bind(null,"08e0")));class C extends O["a"]{constructor(){super(...arguments),this.output=0,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(u["a"])([Object(O["b"])({count:8})],C.prototype,"output",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"receiveShadows",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"slicePlaneEnabled",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"transparent",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"enableOffset",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"writeDepth",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"useSSR",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"isDraped",void 0),Object(u["a"])([Object(O["b"])({count:4})],C.prototype,"transparencyPassType",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"multipassTerrainEnabled",void 0),Object(u["a"])([Object(O["b"])()],C.prototype,"cullAboveGround",void 0);class P extends l["a"]{updateParameters(e){return this.ensureTechnique(w,e)}setElapsedTimeUniform(e){const t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.parameters.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:e.ssrEnabled})}ensureResources(e){const t=this._techniqueRep.constructionContext.waterTextureRepository;return t.ready||t.updating||t.loadTextures(e),t.ready?2:1}beginSlot(e){return 0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(t.program)}}var T=r("8675"),E=r("7c51"),A=r("b855");class R extends o["a"]{constructor(e){super(e,A["a"]),this._techniqueConfig=new C,this.animation=new a}getTechniqueConfig(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<c["e"],this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<M;const r=this.animation.advance(e);return this.animation.enabled&&r}intersect(e,t,r,i,n,a,s){Object(E["i"])(e,t,i,n,a,void 0,s)}requiresSlot(e,t){switch(Object(s["b"])(t)){case 2:return 21===e;case 0:if(this.parameters.isDraped)return 20===e;break;case 4:return 2===e||20===e}let r=2;return this.parameters.transparent&&(r=this.parameters.writeDepth?4:7),e===r}createGLMaterial(e){if(0===e.output&&this.parameters.isDraped)return e.output=5,new P(e);switch(e.output){case 0:case 2:case 4:case 7:return new P(e)}return null}createBufferWriter(){return new T["a"](T["d"])}}const M=35e3},2245:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var i=r("e431"),n=r("0b2d"),a=r("2bc9"),s=r("38a4");function o(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function c(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function l(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function u(e){return(e+1)*(e+1)}function d(e){return Object(s["f"])(Math.floor(Math.sqrt(e)-1),0,2)}function h(e,t,r){const i=e[0],n=e[1],a=e[2],s=r||[];return s.length=u(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*i*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*i*a,s[8]=.54627421529*(i*i-n*n)),s}function p(e,t){const r=u(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function f(e,t){const r=d(t.r.length);for(const n of e)Object(i["v"])(j,n.direction),h(j,r,O),o(O,_),c(O,n.intensity[0],x),l(t.r,x),c(O,n.intensity[1],x),l(t.g,x),c(O,n.intensity[2],x),l(t.b,x);return t}function b(e,t){h(j,0,O);for(const r of e)t.r[0]+=O[0]*_[0]*r.intensity[0]*4*Math.PI,t.g[0]+=O[0]*_[0]*r.intensity[1]*4*Math.PI,t.b[0]+=O[0]*_[0]*r.intensity[2]*4*Math.PI;return t}function m(e,t,r,n){p(t,n),Object(i["z"])(r.intensity,0,0,0);let s=!1;const o=g,c=v,u=y;o.length=0,c.length=0,u.length=0;for(const l of e)l instanceof a["c"]&&!s?(Object(i["n"])(r.direction,l.direction),r.intensity[0]=l.intensity[0],r.intensity[1]=l.intensity[1],r.intensity[2]=l.intensity[2],r.castShadows=l.castShadows,s=!0):l instanceof a["c"]||l instanceof a["b"]?o.push(l):l instanceof a["a"]?c.push(l):l instanceof a["d"]&&u.push(l);f(o,n),b(c,n);for(const i of u)l(n.r,i.r),l(n.g,i.g),l(n.b,i.b)}const g=[],v=[],y=[],O=[0],x=[0],j=Object(n["f"])(),_=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class S{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(n["f"])(),ambient:{color:Object(n["f"])(),intensity:1},diffuse:{color:Object(n["f"])(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new a["d"],this._mainLight={intensity:Object(n["f"])(),direction:Object(n["h"])(1,0,0),castShadows:!1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(e,t=!1){const r=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",r),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);const i=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}set(e){m(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(i["n"])(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(i["h"])(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(i["n"])(w,this._oldSunlight.diffuse.color),Object(i["h"])(w,w,this._ambientBoost*this.globalFactor),Object(i["i"])(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,w)}get old(){return this._oldSunlight}}const w=Object(n["f"])()},"22f5":function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return j}));var i=r("2eab"),n=r("792b"),a=r("ce50"),s=r("e92d"),o=r("b2b2"),c=r("f4cc"),l=r("549a"),u=r("0b2d"),d=r("4261"),h=r("2db0"),p=r("0278"),f=r("1e2c"),b=r("dbad");const m=s["a"].getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function g(e,t){const r=await v(e,t);return{resource:r,textures:await S(r.textureDefinitions,t)}}async function v(e,t){const r=Object(o["l"])(t)&&t.streamDataRequester;if(r)return y(e,r,t);const a=await Object(n["d"])(Object(i["default"])(e,Object(o["u"])(t)));if(!0===a.ok)return a.value.data;Object(c["v"])(a.error),O(a.error)}async function y(e,t,r){const i=await Object(n["d"])(t.request(e,"json",r));if(!0===i.ok)return i.value;Object(c["v"])(i.error),O(i.error.details.url)}function O(e){throw new a["a"]("","Request for object resource failed: "+e)}function x(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(m.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const e=t.faces;if(e){if(t.vertexAttributes)for(const r in t.vertexAttributes){const t=e[r];t&&t.values?(null!=t.valueType&&"UInt32"!==t.valueType&&(m.warn(`Unsupported indexed geometry indices type '${t.valueType}', only UInt32 is currently supported`),i=!1),null!=t.valuesPerElement&&1!==t.valuesPerElement&&(m.warn(`Unsupported indexed geometry values per element '${t.valuesPerElement}', only 1 is currently supported`),i=!1)):(m.warn(`Indexed geometry does not specify face indices for '${r}' attribute`),i=!1)}}else m.warn("Indexed geometries must specify faces"),i=!1;break}default:m.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(m.warn("Geometry requires material"),i=!1);const n=e.params.vertexAttributes;for(const a in n)n[a].values||(m.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function j(e,t){const r=[],i=[],n=[],a=[],s=e.resource,c=l["a"].parse(s.version||"1.0","wosr");P.validate(c);const d=s.model.name,h=s.model.geometries,m=s.materialDefinitions,g=e.textures;let v=0;const y=new Map;for(let l=0;l<h.length;l++){const e=h[l];if(!x(e))continue;const s=C(e),c=e.params.vertexAttributes,d=[];for(const t in c){const e=c[t],r=e.values;d.push([t,{data:r,size:e.valuesPerElement,exclusive:!0}])}const O=[];if("PerAttributeArray"!==e.params.topology){const t=e.params.faces;for(const e in t)O.push([e,new Uint32Array(t[e].values)])}const j=g&&g[s.texture];if(j&&!y.has(s.texture)){const{image:e,params:t}=j,r=new f["a"](e,t);a.push(r),y.set(s.texture,r)}const _=y.get(s.texture),S=_?_.id:void 0;let P=n[s.material]?n[s.material][s.texture]:null;if(!P){const e=m[s.material.substring(s.material.lastIndexOf("/")+1)].params;1===e.transparency&&(e.transparency=0);const r=j&&j.alphaChannelUsage,i=e.transparency>0||"transparency"===r||"maskAndTransparency"===r,a=j?w(j.alphaChannelUsage):void 0,c={ambient:Object(u["g"])(e.diffuse),diffuse:Object(u["g"])(e.diffuse),opacity:1-(e.transparency||0),transparent:i,textureAlphaMode:a,textureAlphaCutoff:.33,textureId:S,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:e.externalColorMixMode||"tint",textureAlphaPremultiplied:!!j&&!!j.params.preMultiplyAlpha};Object(o["l"])(t)&&t.materialParamsMixin&&Object.assign(c,t.materialParamsMixin),P=new b["a"](c),n[s.material]||(n[s.material]={}),n[s.material][s.texture]=P}i.push(P);const T=new p["a"](d,O);v+=O.position?O.position.length:0,r.push(T)}return{name:d,stageResources:{textures:a,materials:i,geometries:r},pivotOffset:s.model.pivotOffset,boundingBox:_(r),numberOfVertices:v,lodThreshold:null}}function _(e){const t=Object(d["k"])();return e.forEach(e=>{const r=e.boundingInfo;Object(o["l"])(r)&&(Object(d["r"])(t,r.getBBMin()),Object(d["r"])(t,r.getBBMax()))}),t}async function S(e,t){const r=[];for(const a in e){const i=e[a],n=i.images[0].data;if(!n){m.warn("Externally referenced texture data is not yet supported");continue}const s=i.encoding+";base64,"+n,c="/textureDefinitions/"+a,l="rgba"===i.channels?i.alphaChannelUsage||"transparency":"none",u={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:1!==w(l)},d=Object(o["l"])(t)&&t.disableTextures?Promise.resolve(null):Object(h["a"])(s,t);r.push(d.then(e=>({refId:c,image:e,params:u,alphaChannelUsage:l})))}const i=await Promise.all(r),n={};for(const a of i)n[a.refId]=a;return n}function w(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;default:return 0}}function C(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const P=new l["a"](1,2,"wosr")},2906:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){const r=e.fragment,n=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===n?(r.uniforms.add("lightingAmbientSH0","vec3"),r.code.add(i["a"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===n?(r.uniforms.add("lightingAmbientSH_R","vec4"),r.uniforms.add("lightingAmbientSH_G","vec4"),r.uniforms.add("lightingAmbientSH_B","vec4"),r.code.add(i["a"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===n&&(r.uniforms.add("lightingAmbientSH0","vec3"),r.uniforms.add("lightingAmbientSH_R1","vec4"),r.uniforms.add("lightingAmbientSH_G1","vec4"),r.uniforms.add("lightingAmbientSH_B1","vec4"),r.uniforms.add("lightingAmbientSH_R2","vec4"),r.uniforms.add("lightingAmbientSH_G2","vec4"),r.uniforms.add("lightingAmbientSH_B2","vec4"),r.code.add(i["a"]`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),1!==t.pbrMode&&2!==t.pbrMode||r.code.add(i["a"]`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}},"2aad":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(i["a"]`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},"2b60":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("2eab"),n=r("792b"),a=r("ce50"),s=r("b2b2"),o=r("f4cc"),c=r("e041");class l{constructor(e){this.streamDataRequester=e}async loadJSON(e,t){return this.load("json",e,t)}async loadBinary(e,t){return Object(c["u"])(e)?(Object(o["w"])(t),Object(c["j"])(e)):this.load("binary",e,t)}async loadImage(e,t){return this.load("image",e,t)}async load(e,t,r){if(Object(s["k"])(this.streamDataRequester))return(await Object(i["default"])(t,{responseType:u[e]})).data;const c=await Object(n["d"])(this.streamDataRequester.request(t,e,r));if(!0===c.ok)return c.value;throw Object(o["v"])(c.error),new a["a"]("","Request for resource failed: "+c.error)}}const u={image:"image",binary:"array-buffer",json:"json"}},"2bc9":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return o}));var i=r("0b2d");class n{constructor(e=Object(i["f"])()){this.intensity=e}}class a{constructor(e=Object(i["f"])(),t=Object(i["h"])(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class s{constructor(e=Object(i["f"])(),t=Object(i["h"])(.57735,.57735,.57735),r=!0){this.intensity=e,this.direction=t,this.castShadows=r}}class o{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},"2df1":function(e,t,r){"use strict";r.d(t,"a",(function(){return J}));var i=r("38a4"),n=r("b2b2"),a=r("a915"),s=r("1c92"),o=r("dae5"),c=r("d791"),l=r("afe1"),u=r("3349"),d=r("02f1"),h=r("e431"),p=r("0b2d");function f(e){return e instanceof Float32Array&&e.length>=16}function b(e){return Array.isArray(e)&&e.length>=16}function m(e){return f(e)||b(e)}var g=r("9180"),v=r("fc00"),y=r("1038"),O=r("b061"),x=r("68af"),j=r("35b3"),_=r("da1c"),S=r("1153"),w=r("5957"),C=r("7c51"),P=r("b623"),T=r("0d96"),E=r("a4ee"),A=r("d272"),R=r("17b0"),M=r("d0cb"),D=r("6a07"),z=r("9617"),I=r("c6d7"),L=r("be24"),F=r("2f98"),V=r("8e97"),U=r("c3a4"),G=r("ca98"),N=r("da35"),B=r("fa1e"),k=r("7438"),H=r("c829"),q=r("189c");class W extends G["a"]{initializeProgram(e){const t=W.shader.get(),r=this.configuration,i=t.build({output:r.output,FrontFacePass:2===r.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:r.debugDrawBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,pixelSnappingEnabled:r.pixelSnappingEnabled,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1,isDraped:r.isDraped,multipassGeometryEnabled:r.multipassGeometryEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new H["a"](e.rctx,i,B["a"])}bindPass(e,t){Object(V["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(R["b"])(this.program,e,t),Object(F["b"])(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(V["f"])(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(z["a"])(this.program,t),Object(I["a"])(this.program,t)):(Object(M["b"])(this.program,t),Object(T["c"])(this.program,e,t.camera.pixelRatio||1),Object(L["b"])(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(D["b"])(this.program,t)}bindDraw(e){Object(V["d"])(this.program,e),Object(V["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(A["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e,n=515,a=this.configuration.polygonOffsetEnabled&&$,s=(r||i)&&4!==t.output?(t.depthEnabled||6===t.output)&&q["e"]:null;return Object(q["g"])({blending:0===t.output||7===t.output||4===t.output?r?Z:Object(k["a"])(e):null,depthTest:{func:n},depthWrite:s,colorWrite:q["d"],polygonOffset:a})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}W.shader=new U["a"](T["a"],()=>r.e("chunk-2d0db7d8").then(r.bind(null,"6fa3")));const $={factor:0,units:-4},Z=Object(q["i"])(1,771);class Y extends N["a"]{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!1,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(E["a"])([Object(N["b"])({count:8})],Y.prototype,"output",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"occlusionTestEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"sdf",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"vvSize",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"vvColor",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"verticalOffset",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"screenSizePerspective",void 0),Object(E["a"])([Object(N["b"])({count:2})],Y.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"debugDrawBorder",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"binaryHighlightOcclusion",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"slicePlaneEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"polygonOffsetEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"depthEnabled",void 0),Object(E["a"])([Object(N["b"])({count:4})],Y.prototype,"transparencyPassType",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"pixelSnappingEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"isDraped",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"multipassGeometryEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"multipassTerrainEnabled",void 0),Object(E["a"])([Object(N["b"])()],Y.prototype,"cullAboveGround",void 0);class J extends j["a"]{constructor(e){super(e,ye),this.techniqueConfig=new Y}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.parameters.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,a,s,o,c,l){Object(n["l"])(l)?this.intersectDrapedHudGeometry(e,s,o,c,l):this.intersectHudGeometry(e,t,r,i,o,c)}intersectDrapedHudGeometry(e,t,r,i,a){const s=e.vertexAttributes.get("position"),o=e.vertexAttributes.get("size"),c=this.parameters,l=Object(T["d"])(c);let u=1,d=1;if(Object(n["l"])(i)){const e=i(fe);u=e[0],d=e[5]}u*=e.screenToWorldRatio,d*=e.screenToWorldRatio;const h=me*e.screenToWorldRatio;for(let n=0;n<s.data.length/s.size;n++){const i=n*s.size,p=s.data[i],f=s.data[i+1],b=n*o.size;let m;ge[0]=o.data[b]*u,ge[1]=o.data[b+1]*d,c.textureIsSignedDistanceField&&(m=c.outlineSize*e.screenToWorldRatio/2),te(t,p,f,ge,h,m,c,l)&&r(a.dist,a.normal,-1,!0)}}intersectHudGeometry(e,t,r,i,a,o){if(!i.options.selectionMode||!i.options.hud||Object(P["d"])(t))return;const l=this.parameters;let u=1,d=1;if(Object(s["f"])(le,r),Object(n["l"])(o)){const e=o(fe);u=e[0],d=e[5],ee(le)}const f=e.vertexAttributes.get("position"),b=e.vertexAttributes.get("size"),m=e.vertexAttributes.get("normal"),g=e.vertexAttributes.get("auxpos1");Object(S["a"])(f.size>=3);const v=i.point,y=i.camera,O=Object(T["d"])(l);u*=y.pixelRatio,d*=y.pixelRatio;const x="screen"===this.parameters.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(h["z"])(ne,f.data[e],f.data[e+1],f.data[e+2]),Object(h["t"])(ne,ne,r);const t=n*b.size;ge[0]=b.data[t]*u,ge[1]=b.data[t+1]*d,Object(h["t"])(ne,ne,y.viewMatrix);const s=n*g.size;if(Object(h["z"])(he,g.data[s+0],g.data[s+1],g.data[s+2]),!x&&(ne[0]+=he[0],ne[1]+=he[1],0!==he[2])){const e=he[2];Object(h["u"])(he,ne),Object(h["m"])(ne,ne,Object(h["h"])(he,he,e))}const o=n*m.size;if(Object(h["z"])(ae,m.data[o],m.data[o+1],m.data[o+2]),this.normalAndViewAngle(ae,le,y,pe),this.applyVerticalOffsetTransformationView(ne,pe,y,re),y.applyProjection(ne,se),se[0]>-1){let e=Math.floor(se[0])+this.parameters.screenOffset[0],t=Math.floor(se[1])+this.parameters.screenOffset[1];x&&(e+=he[0],0!==he[1]&&(t+=Object(_["b"])(he[1],re.factorAlignment))),Object(_["a"])(ge,re.factor,ge);const r=be*y.pixelRatio;let n;if(l.textureIsSignedDistanceField&&(n=l.outlineSize*y.pixelRatio/2),te(v,e,t,ge,r,n,l,O)){const e=i.ray;if(Object(h["t"])(ce,ne,Object(c["c"])(de,y.viewMatrix)),se[0]=v[0],se[1]=v[1],y.unprojectFromRenderScreen(se,ne)){const t=Object(p["f"])();Object(h["n"])(t,e.direction);const r=1/Object(h["s"])(t);Object(h["h"])(t,t,r),a(Object(h["p"])(e.origin,ne)*r,t,-1,!0,1,ce)}}}}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const i=r.get("position"),n=e.indices.get("position");return Object(y["b"])(i,n,t)}createBufferWriter(){return new xe(this)}normalAndViewAngle(e,t,r,i){return m(t)&&(t=Object(s["f"])(ue,t)),Object(h["A"])(i.normal,e,t),Object(h["t"])(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=Object(h["k"])(oe,ve),i}updateScaleInfo(e,t,r){const i=this.parameters;i.screenSizePerspective?Object(_["e"])(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?Object(_["e"])(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,r,i,n,a,s){const o=this.normalAndViewAngle(t,r,n,pe);return this.applyVerticalGroundOffsetView(e,o,n,s),this.applyVerticalOffsetTransformationView(s,o,n,a),this.applyPolygonOffsetView(s,o,i[3],n,s),this.applyCenterOffsetView(s,i,s),s}applyShaderOffsetsNDC(e,t,r,i,a){return this.applyCenterOffsetNDC(e,t,r,i),Object(n["l"])(a)&&Object(h["n"])(a,i),this.applyPolygonOffsetNDC(i,t,r,i),i}applyPolygonOffsetView(e,t,r,n,a){const s=n.aboveGround?1:-1;let o=Math.sign(r);0===o&&(o=s);const c=s*o;if(this.parameters.shaderPolygonOffset<=0)return Object(h["n"])(a,e);const l=Object(i["f"])(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-l*l)/l/n.viewport[2];return Object(h["h"])(a,e,c>0?u:1/u),a}applyVerticalGroundOffsetView(e,t,r,i){const n=Object(h["s"])(e),a=r.aboveGround?1:-1,s=.5*r.computeRenderPixelSizeAtDist(n),o=Object(h["h"])(ne,t.normal,a*s);return Object(h["i"])(i,e,o),i}applyVerticalOffsetTransformationView(e,t,r,i){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const r=Object(h["s"])(e);this.updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const a=Object(h["s"])(e),s=n.screenSizePerspectiveAlignment||n.screenSizePerspective,o=Object(C["l"])(r,a,n.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(i,a,t.cosAngle),Object(h["h"])(t.normal,t.normal,o),Object(h["i"])(e,e,t.normal)}applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&Object(h["n"])(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(Object(h["u"])(ae,r),Object(h["i"])(r,r,Object(h["h"])(ae,ae,t[2])))),r}applyCenterOffsetNDC(e,t,r,i){const n="screen"!==this.parameters.centerOffsetUnits;return i!==e&&Object(h["n"])(i,e),n||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}applyPolygonOffsetNDC(e,t,r,i){const n=this.parameters.shaderPolygonOffset;if(e!==i&&Object(h["n"])(i,e),n){const e=r.aboveGround?1:-1,a=e*Math.sign(t[3]);i[2]-=(a||e)*n}return i}requiresSlot(e,t){const r=Object(O["b"])(t);if(0===r||7===r){if(20===e)return!0;const t=this.parameters.drawInSecondSlot?17:16;return this.parameters.occlusionTest&&11===e||e===t}return e===(this.parameters.drawInSecondSlot?17:16)||20===e}createGLMaterial(e){return 0===e.output||7===e.output?new Q(e):4===e.output?new X(e):null}calculateRelativeScreenBounds(e,t,r=Object(g["m"])()){return K(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class X extends x["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(e)}selectProgram(e){return this.ensureTechnique(W,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}class Q extends X{isOcclusionSlot(e){return 11===e.slot&&this._material.parameters.occlusionTest&&(0===this._output||7===this._output)}selectProgram(e){return this.ensureTechnique(W,e,this.isOcclusionSlot(e)?6:this._output)}bind(e,t){this.isOcclusionSlot(e)||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.parameters,e)}}function K(e,t,r,i=ie){return Object(u["c"])(i,e.anchorPos),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function ee(e){const t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(n*n+a*a+s*s),h=1/Math.sqrt(o*o+c*c+l*l);return e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*d,e[4]=a*d,e[5]=s*d,e[6]=o*h,e[7]=c*h,e[8]=l*h,e}function te(e,t,r,i,n,a,s,o){let c=t-n-(o[0]>0?i[0]*o[0]:0),l=c+i[0]+2*n,u=r-n-(o[1]>0?i[1]*o[1]:0),d=u+i[1]+2*n;if(s.textureIsSignedDistanceField){const e=s.distanceFieldBoundingBox;c+=i[0]*e[0],u+=i[1]*e[1],l-=i[0]*(1-e[2]),d-=i[1]*(1-e[3]),c-=a,l+=a,u-=a,d+=a}return e[0]>c&&e[0]<l&&e[1]>u&&e[1]<d}const re={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ie=Object(d["b"])(),ne=Object(p["f"])(),ae=Object(p["f"])(),se=Object(a["e"])(),oe=Object(p["f"])(),ce=Object(p["f"])(),le=Object(o["b"])(),ue=Object(o["b"])(),de=Object(l["d"])(),he=Object(p["f"])(),pe={normal:oe,cosAngle:0},fe=Object(l["d"])(),be=1,me=2,ge=[0,0],ve=Object(p["h"])(0,0,1),ye={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(d["f"])(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...j["b"]},Oe=Object(v["a"])().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class xe{constructor(e){this.material=e,this.vertexBufferLayout=Oe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,r,i){Object(w["e"])(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,r.position,i,6),Object(w["d"])(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,r.normal,i,6);{const e=t.vertexAttributes.get("uv0").data;let n,a,s,o;if(null==e||e.length<4){const e=this.material.parameters;n=0,a=0,s=e.texCoordScale[0],o=e.texCoordScale[1]}else n=e[0],a=e[1],s=e[2],o=e[3];s=Math.min(1.99999,s+1),o=Math.min(1.99999,o+1);const c=t.indices.get("position").length,l=r.uv0;let u=i;for(let t=0;t<c;++t)l.set(u,0,n),l.set(u,1,a),u+=1,l.set(u,0,s),l.set(u,1,a),u+=1,l.set(u,0,s),l.set(u,1,o),u+=1,l.set(u,0,s),l.set(u,1,o),u+=1,l.set(u,0,n),l.set(u,1,o),u+=1,l.set(u,0,n),l.set(u,1,a),u+=1}Object(w["b"])(t.indices.get("color"),t.vertexAttributes.get("color").data,4,r.color,i,6);{const e=t.indices.get("size"),n=t.vertexAttributes.get("size").data,a=e.length,s=r.size;let o=i;for(let t=0;t<a;++t){const r=n[2*e[t]],i=n[2*e[t]+1];for(let e=0;e<6;++e)s.set(o,0,r),s.set(o,1,i),o+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(w["a"])(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,r.auxpos1,i,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(w["a"])(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,r.auxpos2,i,6)}}},"2e0f":function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return m})),r.d(t,"f",(function(){return b})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return g})),r.d(t,"i",(function(){return v}));var i,n=r("6c97"),a=r("b2b2"),s=r("d791"),o=r("afe1"),c=r("0b2d"),l=r("8188"),u=r("84f4"),d=r("ba58"),h=r("0cb9");function p(e,t,r,i,n,a,s,o,c,u,d){const h=C[d.mode];let p,f,b=0;if(Object(l["p"])(e,t,r,i,c.spatialReference,n,o))return h.requiresAlignment(d)?(b=h.applyElevationAlignmentBuffer(i,n,a,s,o,c,u,d),p=a,f=s):(p=i,f=n),Object(l["p"])(p,c.spatialReference,f,a,u.spatialReference,s,o)?b:void 0}function f(e,t,r,i,s){const o=(Object(u["a"])(e)?e.z:Object(h["c"])(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=Object(a["v"])(Object(h["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=r,void(s.z=r)}case"relative-to-ground":{const n=Object(a["v"])(Object(h["b"])(t,e,"ground"),0),c=r.geometryZWithOffset(o,i);return s.verticalDistanceToGround=c,s.sampledElevation=n,void(s.z=c+n)}case"relative-to-scene":{const n=Object(a["v"])(Object(h["b"])(t,e,"scene"),0),c=r.geometryZWithOffset(o,i);return s.verticalDistanceToGround=c,s.sampledElevation=n,void(s.z=c+n)}case"absolute-height":{const n=r.geometryZWithOffset(o,i),c=Object(a["v"])(Object(h["b"])(t,e,"ground"),0);return s.verticalDistanceToGround=n-c,s.sampledElevation=c,void(s.z=n)}default:return Object(n["a"])(r.mode),void(s.z=0)}}function b(e,t,r,i){return f(e,t,r,i,T),T.z}function m(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?i.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function y(e,t,r,i,n){f(t,r,n,i,T),Object(d["j"])(e,T.verticalDistanceToGround);const a=T.sampledElevation,o=Object(s["d"])(P,e.transformation);return E[0]=t.x,E[1]=t.y,E[2]=T.z,Object(l["d"])(t.spatialReference,E,o,i.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),a}function O(e,t,r,i,n,s){let o=0;const c=s.spatialReference;t*=3,i*=3;for(let l=0;l<n;++l){const n=e[t+0],l=e[t+1],u=e[t+2],d=Object(a["v"])(s.getElevation(n,l,u,c,"ground"),0);o+=d,r[i+0]=n,r[i+1]=l,r[i+2]=d,t+=3,i+=3}return o/n}function x(e,t,r,i,n,s,o,c){let l=0;const u=c.calculateOffsetRenderUnits(o),d=c.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(a["v"])(s.getElevation(n,o,c,h,"ground"),0);l+=p,r[i+0]=n,r[i+1]=o,r[i+2]=null==d?c+p+u:p+u,t+=3,i+=3}return l/n}function j(e,t,r,i,n,s,o,c){let l=0;const u=c.calculateOffsetRenderUnits(o),d=c.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(a["v"])(s.getElevation(n,o,c,h,"scene"),0);l+=p,r[i+0]=n,r[i+1]=o,r[i+2]=null==d?c+p+u:p+u,t+=3,i+=3}return l/n}function _(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}function S(e,t,r,i,n,a,s,o){const c=o.calculateOffsetRenderUnits(s),l=o.featureExpressionInfoContext;t*=3,i*=3;for(let u=0;u<n;++u){const n=e[t+0],a=e[t+1],s=e[t+2];r[i+0]=n,r[i+1]=a,r[i+2]=null==l?s+c:c,t+=3,i+=3}return 0}class w{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(i||(i={}));const C={"absolute-height":{applyElevationAlignmentBuffer:S,requiresAlignment:_},"on-the-ground":{applyElevationAlignmentBuffer:O,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:x,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:j,requiresAlignment:()=>!0}},P=Object(o["d"])(),T=new w,E=Object(c["f"])()},"2ebb":function(e,t,r){"use strict";function i(e,t=0){const r=e.stride;return e.fieldNames.filter(t=>{const r=e.fields.get(t).optional;return!(r&&r.glPadding)}).map(i=>{const a=e.fields.get(i),s=a.constructor.ElementCount,o=n(a.constructor.ElementType),c=a.offset,l=!(!a.optional||!a.optional.glNormalized);return{name:i,stride:r,count:s,type:o,offset:c,normalized:l,divisor:t}})}function n(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}r.d(t,"a",(function(){return i}));const a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},"33e2":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r("d981"),n=r("3886");function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(i["b"]),e.fragment.code.add(n["a"]`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function s(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},3544:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var i=r("b2b2");const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},a={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null},s=8;function o(e,t=2){return Object(i["k"])(e)?e:{pattern:e.slice(),pixelRatio:t}}function c(e,t=2){return{pattern:[e,e],pixelRatio:t}}function l(e){return Object(i["l"])(e)&&"style"===e.type?o(a[e.style],s):null}},3563:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return s}));r("c120");var i=r("b2b2");function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const i=e[r],n=t[r];if(i.length!==n.length)return!1;for(let e=0;e<i.length;e++)if(i[e]!==n[e])return!1}return!0}function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function s(e,t){return!!d(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function o(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&a(e.paths,t.paths)}function c(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&a(e.rings,t.rings)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}function u(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!d(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function d(e,t){return e===t||e&&t&&e.equals(t)}function h(e,t){if(e===t)return!0;if(Object(i["k"])(e)||Object(i["k"])(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return s(e,t);case"extent":return u(e,t);case"polyline":return o(e,t);case"polygon":return c(e,t);case"multipoint":return l(e,t);case"mesh":return!1;default:return}}function p(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const n of r)if(e[n]!==t[n])return!1;return!0}function f(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!h(e.geometry,t.geometry)&&!!p(e.attributes,t.attributes)}},3626:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("4377"),n=r("3886");function a(e){e.include(i["a"]),e.code.add(n["a"]`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${n["a"].int(1)}) {
        return allMixed;
      }
      else if (mode == ${n["a"].int(2)}) {
        return internalMixed;
      }
      else if (mode == ${n["a"].int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${n["a"].int(2)}) {
        return internalMixed;
      }
      else if (mode == ${n["a"].int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)}},"365a":function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r("a4ee"),n=r("fc29"),a=r("ce6d"),s=r("9096"),o=r("a5d8"),c=r("e92d"),l=r("b2b2"),u=r("fab3"),d=r("59b2"),h=(r("b50f"),r("c120"),r("cea0"),r("d386"));let p=class extends(Object(s["b"])(Object(o["a"])(Object(u["b"])(a["a"].EventedMixin(n["a"]))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",r=this.layer&&this.layer.title||"no title";throw c["a"].getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${r}', id: '${t}')`,e),e}})}get fullOpacity(){return Object(l["v"])(this.get("layer.opacity"),1)*Object(l["v"])(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i["a"])([Object(d["b"])()],p.prototype,"fullOpacity",null),Object(i["a"])([Object(d["b"])()],p.prototype,"layer",void 0),Object(i["a"])([Object(d["b"])()],p.prototype,"parent",void 0),Object(i["a"])([Object(d["b"])({readOnly:!0})],p.prototype,"suspended",null),Object(i["a"])([Object(d["b"])({readOnly:!0})],p.prototype,"suspendInfo",null),Object(i["a"])([Object(d["b"])({readOnly:!0})],p.prototype,"legendEnabled",null),Object(i["a"])([Object(d["b"])({type:Boolean,readOnly:!0})],p.prototype,"updating",null),Object(i["a"])([Object(d["b"])({readOnly:!0})],p.prototype,"updatingProgress",null),Object(i["a"])([Object(d["b"])()],p.prototype,"visible",null),p=Object(i["a"])([Object(h["a"])("esri.views.layers.LayerView")],p);const f=p},3748:function(e,t,r){"use strict";r.d(t,"a",(function(){return I}));var i=r("e92d"),n=r("b2b2"),a=r("a915"),s=r("3349"),o=r("e431"),c=r("0b2d"),l=r("bd7e"),u=r("7289"),d=r("8190"),h=r("1038"),p=r("d7f7"),f=r("35b3"),b=r("1153"),m=r("5957"),g=r("8675"),v=r("7c51"),y=r("b623"),O=r("a4ee"),x=r("d272"),j=r("6a07"),_=r("8e97"),S=r("c3a4"),w=r("ca98"),C=r("da35"),P=r("fa1e"),T=r("c829"),E=r("87b7"),A=r("713b"),R=r("189c");class M extends w["a"]{constructor(e,t,r){super(e,t,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&4!==this.configuration.output}initializeProgram(e){const t=M.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:r.stipplePreferContinuous});return new T["a"](e.rctx,i,P["a"])}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(_["c"])(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:r,pixels:i}=Object(n["l"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",r),this.program.setUniform1f("stipplePatternTextureSize",i),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(n["u"])(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}4===this.configuration.output&&Object(j["b"])(this.program,t)}bindDraw(e){Object(_["d"])(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(_["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(x["c"])(this.program,this.configuration,e),this.program.rebindTextures()}initializePipeline(){const e=this.configuration,t=Object(R["h"])(770,1,771,771),r=(t,r=null,i=null)=>Object(R["g"])({blending:r,depthTest:E["b"],depthWrite:i,colorWrite:R["d"],stencilWrite:e.sceneHasOcludees?E["j"]:null,stencilTest:e.sceneHasOcludees?t?E["f"]:E["e"]:null});return 0===e.output?(this._occludeePipelineState=r(!0,e.transparent||this.stippleEnabled?t:null,R["e"]),r(!1,e.transparent||this.stippleEnabled?t:null,R["e"])):r(!1)}get primitiveType(){return 1}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}M.shader=new S["a"](A["a"],()=>r.e("chunk-2d20f1b1").then(r.bind(null,"b1e1")));class D extends C["a"]{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.sceneHasOcludees=!1}}Object(O["a"])([Object(C["b"])({count:8})],D.prototype,"output",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"slicePlaneEnabled",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"vertexColors",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"transparent",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"draped",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"stippleEnabled",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"stippleOffColorEnabled",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"stipplePreferContinuous",void 0),Object(O["a"])([Object(C["b"])()],D.prototype,"sceneHasOcludees",void 0);const z=i["a"].getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class I extends f["a"]{constructor(e){super(e,V),this._techniqueConfig=new D}getTechniqueConfig(e,t){this._techniqueConfig.output=e,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=20===t.slot;const r=Object(n["l"])(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&Object(n["l"])(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,r,i,a,s,o,c,l){Object(n["l"])(l)?Object(v["h"])(e,i,l,s,1,o):this.intersectLineGeometry(e,t,r,i,o)}intersectLineGeometry(e,t,r,i,n){if(!i.options.selectionMode||Object(y["d"])(t))return;if(!Object(b["g"])(r))return void z.error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get("position").data,c=i.camera,d=Y;Object(s["c"])(d,i.point);const h=2;Object(o["z"])(J[0],d[0]-h,d[1]+h,0),Object(o["z"])(J[1],d[0]+h,d[1]+h,0),Object(o["z"])(J[2],d[0]+h,d[1]-h,0),Object(o["z"])(J[3],d[0]-h,d[1]-h,0);for(let s=0;s<4;s++)if(!c.unprojectFromRenderScreen(J[s],X[s]))return;Object(u["g"])(c.eye,X[0],X[1],Q),Object(u["g"])(c.eye,X[1],X[2],K),Object(u["g"])(c.eye,X[2],X[3],ee),Object(u["g"])(c.eye,X[3],X[0],te);let p=Number.MAX_VALUE,f=0;for(let s=0;s<a.length-5;s+=3){if(U[0]=a[s]+r[12],U[1]=a[s+1]+r[13],U[2]=a[s+2]+r[14],G[0]=a[s+3]+r[12],G[1]=a[s+4]+r[13],G[2]=a[s+5]+r[14],Object(u["v"])(Q,U)<0&&Object(u["v"])(Q,G)<0||Object(u["v"])(K,U)<0&&Object(u["v"])(K,G)<0||Object(u["v"])(ee,U)<0&&Object(u["v"])(ee,G)<0||Object(u["v"])(te,U)<0&&Object(u["v"])(te,G)<0)continue;if(c.projectToRenderScreen(U,k),c.projectToRenderScreen(G,H),k[2]<0&&H[2]>0){Object(o["m"])(N,U,G);const e=c.frustum,t=-Object(u["v"])(e[4],U)/Object(o["k"])(N,Object(u["r"])(e[4]));Object(o["h"])(N,N,t),Object(o["i"])(U,U,N),c.projectToRenderScreen(U,k)}else if(k[2]>0&&H[2]<0){Object(o["m"])(N,G,U);const e=c.frustum,t=-Object(u["v"])(e[4],G)/Object(o["k"])(N,Object(u["r"])(e[4]));Object(o["h"])(N,N,t),Object(o["i"])(G,G,N),c.projectToRenderScreen(G,H)}else if(k[2]<0&&H[2]<0)continue;k[2]=0,H[2]=0;const e=Object(l["e"])(Object(l["f"])(k,H,$),d);e<p&&(p=e,Object(o["n"])(q,U),Object(o["n"])(W,G),f=s/3)}const m=i.rayBegin,g=i.rayEnd;if(p<h*h){let e=Number.MAX_VALUE;if(Object(l["a"])(Object(l["f"])(q,W,$),Object(l["f"])(m,g,Z),B)){Object(o["m"])(B,B,m);const t=Object(o["s"])(B);Object(o["h"])(B,B,1/t),e=t/Object(o["p"])(m,g)}n(e,B,f,!1)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return!1;const i=r.get("position");return Object(h["a"])(i,null,!1,t)}requiresSlot(e){return 2===e||20===e}createGLMaterial(e){return 0===e.output||4===e.output?new L(e):null}createBufferWriter(){const e=this.parameters.vertexColors?g["b"]:g["c"];return Object(n["k"])(this.parameters.stipplePattern)?new g["a"](e):new F(e.clone().vec3f("auxpos1").vec2f("uv0"))}}class L extends p["a"]{updateParameters(e){return this.ensureTechnique(M,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0===this._output&&this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}class F{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(m["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i),this.writeAuxpos1(e,t,r,i),this.writeUV0(e,t,r,i)}writeAuxpos1(e,t,r,i){const n=r.getField("auxpos1",d["u"]),a=t.indices.get("position"),s=t.vertexAttributes.get("position").data,o=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;i*=c;for(let u=0;u<a.length-1;u+=2)for(const e of[1,0]){const t=3*a[u+e],r=s[t],n=s[t+1],d=s[t+2],h=o[0]*r+o[4]*n+o[8]*d+o[12],p=o[1]*r+o[5]*n+o[9]*d+o[13],f=o[2]*r+o[6]*n+o[10]*d+o[14];l[i]=h,l[i+1]=p,l[i+2]=f,i+=c}}writeUV0(e,t,r,i){var n;const a=r.getField("uv0",d["m"]),s=t.indices.get("position"),c=t.vertexAttributes.get("position").data,l=null==(n=t.vertexAttributes.get("distanceToStart"))?void 0:n.data,u=e.transformation,h=a.typedBufferStride,p=a.typedBuffer;let f=0;p[i*=h]=0,p[i+1]=f,i+=h;const b=3*s[0],m=Object(o["z"])(U,c[b],c[b+1],c[b+2]);u&&Object(o["t"])(m,m,u);const g=G,v=s.length-1;let y=1;const O=l?(e,t,r)=>f=l[r]:(e,t,r)=>f+=Object(o["p"])(e,t);for(let d=1;d<v;d+=2){const e=3*s[d];Object(o["z"])(g,c[e],c[e+1],c[e+2]),u&&Object(o["t"])(g,g,u),O(m,g,y++);for(let t=0;t<2;++t)p[i]=1-t,p[i+1]=f,i+=h;Object(o["n"])(m,g)}const x=3*s[v];Object(o["z"])(g,c[x],c[x+1],c[x+2]),u&&Object(o["t"])(g,g,u),O(m,g,y),p[i]=1,p[i+1]=f}}const V={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1,...f["b"]},U=Object(c["f"])(),G=Object(c["f"])(),N=Object(c["f"])(),B=Object(c["f"])(),k=Object(a["e"])(),H=Object(a["e"])(),q=Object(c["f"])(),W=Object(c["f"])(),$=Object(l["d"])(),Z=Object(l["d"])(),Y=Object(c["f"])(),J=[Object(a["e"])(),Object(a["e"])(),Object(a["e"])(),Object(a["e"])()],X=[Object(c["f"])(),Object(c["f"])(),Object(c["f"])(),Object(c["f"])()],Q=Object(u["d"])(),K=Object(u["d"])(),ee=Object(u["d"])(),te=Object(u["d"])()},"3c3b":function(e,t,r){"use strict";r.d(t,"a",(function(){return N}));var i=r("b2b2"),n=r("afe1"),a=r("ce50"),s=r("e92d");const o=s["a"].getLogger("esri.views.3d.glTF");class c{error(e){throw new a["a"]("gltf-loader-error",e)}errorUnsupported(e){throw new a["a"]("gltf-loader-unsupported-feature",e)}errorUnsupportedIf(e,t){e&&this.errorUnsupported(t)}assert(e,t){e||this.error(t)}warn(e){o.warn(e)}warnUnsupported(e){this.warn("[Unsupported Feature] "+e)}warnUnsupportedIf(e,t){e&&this.warnUnsupported(t)}}function l(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function u(e,t={}){return{data:e,parameters:{wrap:{s:10497,t:10497,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}var d=r("6c97"),h=r("28eb"),p=r("e041"),f=r("549a"),b=r("d791"),m=r("04f0"),g=r("b139"),v=r("8190"),y=r("7cfb");class O{constructor(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const e=this.offset4;return this.offset4+=1,this.dataUint32[e]}readUint8Array(e){const t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}remainingBytes(){return this.data.byteLength-4*this.offset4}}const x={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},j={pbrMetallicRoughness:x,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},_={ESRI_externalColorMixMode:"tint"},S=(e={})=>{const t={...x,...e.pbrMetallicRoughness},r=w({..._,...e.extras});return{...j,...e,pbrMetallicRoughness:t,extras:r}};function w(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:Object(d["a"])(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}const C={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},P=e=>({...C,...e});function T(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,(e,i,n)=>(t=i||"",r=n||"","")),{dirPart:t,filePart:r}}const E={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class A{constructor(e,t,r,i,n){this.context=e,this.errorContext=t,this.uri=r,this.json=i,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=T(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==i.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==i.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==i.nodes,"Nodes must be defined."),this.computeNodeParents()}static async load(e,t,r,i){if(Object(p["u"])(r)){const i=Object(p["i"])(r);if("model/gltf-binary"!==i.mediaType)try{const n=JSON.parse(i.isBase64?atob(i.data):i.data);return new A(e,t,r,n)}catch{}const n=Object(p["j"])(r);if(A.isGLBData(n))return this.fromGLBData(e,t,r,n)}if(r.endsWith(".gltf")){const n=await e.loadJSON(r,i);return new A(e,t,r,n)}const n=await e.loadBinary(r,i);if(A.isGLBData(n))return this.fromGLBData(e,t,r,n);const a=await e.loadJSON(r,i);return new A(e,t,r,a)}static isGLBData(e){const t=new O(e);return t.remainingBytes()>=4&&t.readUint32()===E.MAGIC}static async fromGLBData(e,t,r,i){const n=await A.parseGLBData(t,i);return new A(e,t,r,n.json,n.binaryData)}static async parseGLBData(e,t){const r=new O(t);e.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),a=r.readUint32();e.assert(i===E.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=a,"GLB binary data is smaller than header specifies."),e.errorUnsupportedIf(2!==n,"An unsupported GLB container version was detected. Only version 2 is supported.");let s,o,c=0;for(;r.remainingBytes()>=8;){const t=r.readUint32(),i=r.readUint32();0===c?(e.assert(i===E.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),e.assert(t>=0,"No JSON data found."),s=await F(r.readUint8Array(t))):1===c?(e.errorUnsupportedIf(i!==E.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),o=r.readUint8Array(t)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return s||e.error("No GLB JSON chunk detected."),{json:s,binaryData:o}}async getBuffer(e,t){const r=this.json.buffers[e],i=this.errorContext;if(null==r.uri)return i.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;const n=await this.getBufferLoader(e,t);return i.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async getBufferLoader(e,t){const r=this.bufferLoaders.get(e);if(r)return r;const i=this.json.buffers[e],n=this.context.loadBinary(this.resolveUri(i.uri),t).then(e=>new Uint8Array(e));return this.bufferLoaders.set(e,n),n}async getAccessor(e,t){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const i=this.json.accessors[e];r.errorUnsupportedIf(null==(null==i?void 0:i.bufferView),"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(i.type in["MAT2","MAT3","MAT4"],`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],a=await this.getBuffer(n.buffer,t),s=z[i.type],o=I[i.componentType],c=s*o,l=n.byteStride||c;return{raw:a.buffer,byteStride:l,byteOffset:a.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:l===c,componentCount:s,componentByteSize:o,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,t){if(null==e.indices)return null;const r=await this.getAccessor(e.indices,t);if(r.isDenselyPacked)switch(r.componentType){case 5121:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case 5123:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case 5125:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case 5121:return Object(y["a"])(this.wrapAccessor(v["l"],r));case 5123:return Object(y["a"])(this.wrapAccessor(v["j"],r));case 5125:return Object(y["a"])(this.wrapAccessor(v["k"],r))}}async getPositionData(e,t){const r=this.errorContext;r.errorUnsupportedIf(null==e.attributes.POSITION,"No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,t);return r.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+U[i.componentType]),r.errorUnsupportedIf(3!==i.componentCount,"POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed()),this.wrapAccessor(v["u"],i)}async getNormalData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.NORMAL,"No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,t);return r.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+U[i.componentType]),r.errorUnsupportedIf(3!==i.componentCount,"NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed()),this.wrapAccessor(v["u"],i)}async getTangentData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TANGENT,"No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,t);return r.errorUnsupportedIf(5126!==i.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+U[i.componentType]),r.errorUnsupportedIf(4!==i.componentCount,"TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed()),new v["C"](i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,t);return r.errorUnsupportedIf(2!==i.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed()),5126===i.componentType?this.wrapAccessor(v["m"],i):(r.errorUnsupportedIf(!i.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),L(i))}async getVertexColors(e,t){const r=this.errorContext;r.assert(null!=e.attributes.COLOR_0,"No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,t);if(r.errorUnsupportedIf(4!==i.componentCount&&3!==i.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed()),4===i.componentCount){if(5126===i.componentType)return this.wrapAccessor(v["C"],i);if(5121===i.componentType)return this.wrapAccessor(v["J"],i);if(5123===i.componentType)return this.wrapAccessor(v["H"],i)}else if(3===i.componentCount){if(5126===i.componentType)return this.wrapAccessor(v["u"],i);if(5121===i.componentType)return this.wrapAccessor(v["B"],i);if(5123===i.componentType)return this.wrapAccessor(v["z"],i)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+U[i.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,r){let i=this.materialCache.get(e.material);if(!i){const n=null!=e.material?S(this.json.materials[e.material]):S(),a=n.pbrMetallicRoughness,s=this.hasVertexColors(e),o=this.getTexture(a.baseColorTexture,t),c=this.getTexture(n.normalTexture,t),l=r?this.getTexture(n.occlusionTexture,t):null,u=r?this.getTexture(n.emissiveTexture,t):null,d=r?this.getTexture(a.metallicRoughnessTexture,t):null,h=null!=e.material?e.material:-1;i={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:a.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await o,normalTexture:await c,name:n.name,id:h,occlusionTexture:await l,emissiveTexture:await u,emissiveFactor:n.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:await d,vertexColors:s,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return i}async getTexture(e,t){if(!e)return null;this.errorContext.errorUnsupportedIf(0!==(e.texCoord||0),"Only TEXCOORD with index 0 is supported.");const r=e.index,i=this.errorContext,n=this.json.textures[r],a=P(null!=n.sampler?this.json.samplers[n.sampler]:{});i.errorUnsupportedIf(null==n.source,"Source is expected to be defined for a texture.");const s=this.json.images[n.source],o=await this.loadTextureImageData(r,n,t);return Object(h["b"])(this.textureCache,r,()=>{const e=e=>33071===e||33648===e||10497===e,t=e=>(i.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`),10497);return{data:o,wrapS:e(a.wrapS)?a.wrapS:t(a.wrapS),wrapT:e(a.wrapT)?a.wrapT:t(a.wrapT),minFilter:a.minFilter,name:s.name,id:r}})}getNodeTransform(e){if(void 0===e)return M;let t=this.nodeTransformCache.get(e);if(!t){const r=this.getNodeTransform(this.getNodeParent(e)),i=this.json.nodes[e];i.matrix?t=Object(b["n"])(Object(n["d"])(),r,i.matrix):i.translation||i.rotation||i.scale?(t=Object(n["c"])(r),i.translation&&Object(b["b"])(t,t,i.translation),i.rotation&&(D[3]=Object(m["c"])(D,i.rotation),Object(b["f"])(t,t,D[3],D)),i.scale&&Object(b["g"])(t,t,i.scale)):t=r,this.nodeTransformCache.set(e,t)}return t}wrapAccessor(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}resolveUri(e){return Object(p["A"])(e,this.baseUri)}getNodeParent(e){return this.nodeParentMap.get(e)}checkVersionSupported(){const e=f["a"].parse(this.json.asset.version,"glTF");R.validate(e)}checkRequiredExtensionsSupported(){const e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}computeNodeParents(){this.json.nodes.forEach((e,t)=>{e.children&&e.children.forEach(e=>{this.nodeParentMap.set(e,t)})})}async loadTextureImageData(e,t,r){const i=this.textureLoaders.get(e);if(i)return i;const n=this.createTextureLoader(t,r);return this.textureLoaders.set(e,n),n}async createTextureLoader(e,t){const r=this.json.images[e.source];if(r.uri)return this.context.loadImage(this.resolveUri(r.uri),t);const i=this.errorContext;i.errorUnsupportedIf(null==r.bufferView,"Image bufferView must be defined."),i.errorUnsupportedIf(null==r.mimeType,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],a=await this.getBuffer(n.buffer,t);return i.errorUnsupportedIf(null!=n.byteStride,"byteStride not supported for image buffer"),V(new Uint8Array(a.buffer,a.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const R=new f["a"](2,0,"glTF"),M=Object(b["v"])(Object(n["d"])(),Math.PI/2),D=Object(g["b"])(),z={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},I={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};function L(e){switch(e.componentType){case 5120:return new v["q"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new v["t"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new v["o"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new v["r"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new v["s"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new v["m"](e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void Object(d["a"])(e.componentType)}}async function F(e){return new Promise((t,r)=>{const i=new Blob([e]),n=new FileReader;n.onload=()=>{const e=n.result;t(JSON.parse(e))},n.onerror=e=>{r(e)},n.readAsText(i)})}async function V(e,t){return new Promise((r,i)=>{const n=new Blob([e],{type:t}),a=URL.createObjectURL(n),s=new Image;s.addEventListener("load",()=>{URL.revokeObjectURL(a),"decode"in s?s.decode().then(()=>r(s),()=>r(s)):r(s)}),s.addEventListener("error",e=>{URL.revokeObjectURL(a),i(e)}),s.src=a})}const U={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let G=0;async function N(e,t,r={},a=!0){const s=await A.load(e,W,t,r),o="gltf_"+G++,c={lods:[],materials:new Map,textures:new Map,meta:B(s)},l=!(!s.json.asset.extras||"symbolResource"!==s.json.asset.extras.ESRI_type),u=new Map;await k(s,async(e,t,l,d)=>{var h;const p=null!=(h=u.get(l))?h:0;u.set(l,p+1);const f=void 0!==e.mode?e.mode:4,b=4===f||5===f||6===f?f:null;if(Object(i["k"])(b))return void W.warnUnsupported("Unsupported primitive mode ("+Z[f]+"). Skipping primitive.");if(!s.hasPositions(e))return void W.warn("Skipping primitive without POSITION vertex attribute.");const m=s.getPositionData(e,r),g=s.getMaterial(e,r,a),v=s.hasNormals(e)?s.getNormalData(e,r):null,y=s.hasTangents(e)?s.getTangentData(e,r):null,O=s.hasTextureCoordinates(e)?s.getTextureCoordinates(e,r):null,x=s.hasVertexColors(e)?s.getVertexColors(e,r):null,j=s.getIndexData(e,r),_={transform:Object(n["c"])(t),attributes:{position:await m,normal:v?await v:null,texCoord0:O?await O:null,color:x?await x:null,tangent:y?await y:null},indices:await j,primitiveType:b,material:q(c,await g,o)};let S=null;Object(i["l"])(c.meta)&&Object(i["l"])(c.meta.ESRI_lod)&&"screenSpaceRadius"===c.meta.ESRI_lod.metric&&(S=c.meta.ESRI_lod.thresholds[l]),c.lods[l]=c.lods[l]||{parts:[],name:d,lodThreshold:S},c.lods[l].parts[p]=_});for(const i of c.lods)i.parts=i.parts.filter(e=>!!e);return{model:c,meta:{isEsriSymbolResource:l,uri:s.uri},customMeta:{}}}function B(e){const t=e.json;let r=null;return t.nodes.forEach(e=>{const t=e.extras;Object(i["l"])(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(r=t)}),r}async function k(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,a=[];for(const o of i){const e=r.nodes[o];a.push(s(o,0)),H(e)&&!n&&e.extensions.MSFT_lod.ids.forEach((e,t)=>s(e,t+1))}async function s(i,n){const o=r.nodes[i],c=e.getNodeTransform(i);if(W.warnUnsupportedIf(null!=o.weights,"Morph targets are not supported."),null!=o.mesh){const e=r.meshes[o.mesh];for(const r of e.primitives)a.push(t(r,c,n,e.name))}for(const e of o.children||[])a.push(s(e,n))}await Promise.all(a)}function H(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function q(e,t,r){const i=t=>{const i=`${r}_tex_${t&&t.id}${t&&t.name?"_"+t.name:""}`;if(t&&!e.textures.has(i)){const r=u(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:$.some(e=>e===t.minFilter),noUnpackFlip:!0});e.textures.set(i,r)}return i},n=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(n)){const r=l({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(n,r)}return n}const W=new c,$=[9987,9985],Z=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]},"3e44":function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s}));var i=r("2aad"),n=r("3886"),a=r("690a");function s(){const e=new a["a"];return e.include(i["a"]),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(n["a"]`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`),e}const o=Object.freeze({__proto__:null,build:s})},4294:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var i=r("38a4"),n=r("9180"),a=r("7abc");class s{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=Object(n["m"])(),this.resolution=0,this.renderLocalOrigin=Object(a["a"])(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries={extents:[Object(n["m"])(),Object(n["m"])(),Object(n["m"])()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}getNormalTexture(e){const t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield(),i=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)1===n.type&&!1===i?this.validTargets[n.type]=!1:this.validTargets[n.type]=e.drawTarget(this,n,t);return r^this.computeRenderTargetValidityBitfield()?0:1}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(n["A"])(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(n["A"])(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(n["l"])(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}function o(e,t,r){return Math.min(Object(i["n"])(Math.max(e,t)+256),r)}},4395:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("e92d"),n=r("b2b2"),a=r("f9d0"),s=r("1153");const o=i["a"].getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class c{constructor(e){this._glMaterial=e,this.refCnt=0,this._glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(s["a"])(this.refCnt>=0)}getRefCnt(){return this.refCnt}get glMaterial(){return this._glMaterial}}class l{constructor(e,t,r,i){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new a["a"]}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let r=this._id2glMaterialRef.get(t,e.id);if(Object(n["k"])(r)){const i=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});r=new c(i),this._id2glMaterialRef.set(t,e.id,r)}return r.incRefCnt(),r.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);Object(n["l"])(r)&&(r.decRefCnt(),0===r.getRefCnt()&&(Object(n["f"])(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){Object(n["l"])(e.repository)&&e.repository!==this&&o.error("Material is already owned by a different material repository"),e.repository=this}}},4554:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return j})),r.d(t,"h",(function(){return x})),r.d(t,"i",(function(){return _}));var i=r("e92d"),n=r("b2b2"),a=r("1c92"),s=r("dae5"),o=r("afe1"),c=r("e431"),l=r("0b2d"),u=r("8188"),d=r("f694"),h=r("7f83"),p=r("9786"),f=r("8190"),b=r("668b");const m=i["a"].getLogger("esri.geometry.support.meshUtils.normalProjection");function g(e,t,r,i,n){return P(i)?(C(0,f["u"].fromTypedArray(e),f["v"].fromTypedArray(t),f["v"].fromTypedArray(r),i,f["u"].fromTypedArray(n)),n):(m.error("Cannot convert spatial reference to PCPF"),n)}function v(e,t,r,i,n){return P(i)?(C(1,f["u"].fromTypedArray(e),f["v"].fromTypedArray(t),f["v"].fromTypedArray(r),i,f["u"].fromTypedArray(n)),n):(m.error("Cannot convert to spatial reference from PCPF"),n)}function y(e,t,r){return Object(u["p"])(e,t,0,r,Object(d["g"])(t),0,e.length/3),r}function O(e,t,r){return Object(u["p"])(e,Object(d["g"])(r),0,t,r,0,e.length/3),t}function x(e,t,r){if(Object(n["k"])(e))return t;const i=f["v"].fromTypedArray(e),a=f["v"].fromTypedArray(t);return Object(b["e"])(a,i,r),t}function j(e,t,r){if(Object(n["k"])(e))return t;Object(a["a"])(D,r);const i=f["u"].fromTypedArray(e),s=f["u"].fromTypedArray(t);return Object(b["a"])(s,i,D),Object(a["i"])(D)||Object(b["c"])(s,s),t}function _(e,t,r){if(Object(n["k"])(e))return t;Object(a["a"])(D,r);const i=f["u"].fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=f["u"].fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Object(b["a"])(s,i,D),Object(a["i"])(D)||Object(b["c"])(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function S(e,t,r,i,n){if(!P(i))return m.error("Cannot convert spatial reference to PCPF"),n;C(0,f["u"].fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),f["v"].fromTypedArray(t),f["v"].fromTypedArray(r),i,f["u"].fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let a=3;a<e.length;a+=4)n[a]=e[a];return n}function w(e,t,r,i,n){if(!P(i))return m.error("Cannot convert to spatial reference from PCPF"),n;C(1,f["u"].fromTypedArray(e,16),f["v"].fromTypedArray(t),f["v"].fromTypedArray(r),i,f["u"].fromTypedArray(n,16));for(let a=3;a<e.length;a+=4)n[a]=e[a];return n}function C(e,t,r,i,n,s){if(!t)return;const o=r.count,l=Object(d["g"])(n);if(T(n))for(let d=0;d<o;d++)i.getVec(d,A),t.getVec(d,R),Object(u["d"])(l,A,M,l),Object(a["f"])(D,M),1===e&&Object(a["o"])(D,D),Object(c["A"])(R,R,D),s.setVec(d,R);else for(let d=0;d<o;d++){i.getVec(d,A),t.getVec(d,R),Object(u["d"])(l,A,M,l),Object(a["f"])(D,M);const n=Object(p["h"])(r.get(d,1));let o=Math.cos(n);0===e&&(o=1/o),D[0]*=o,D[1]*=o,D[2]*=o,D[3]*=o,D[4]*=o,D[5]*=o,1===e&&Object(a["o"])(D,D),Object(c["A"])(R,R,D),Object(c["u"])(R,R),s.setVec(d,R)}return s}function P(e){return T(e)||E(e)}function T(e){return e.isWGS84||Object(h["f"])(e)||Object(h["i"])(e)||Object(h["j"])(e)}function E(e){return e.isWebMercator}const A=Object(l["f"])(),R=Object(l["f"])(),M=Object(o["d"])(),D=Object(s["b"])()},4637:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n,a,s={exports:{}};i=s,n=function(){function e(e,r,n,a,s){t(e,r,n||0,a||e.length-1,s||i)}function t(e,i,n,a,s){for(;a>n;){if(a-n>600){var o=a-n+1,c=i-n+1,l=Math.log(o),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(o-u)/o)*(c-o/2<0?-1:1);t(e,i,Math.max(n,Math.floor(i-c*u/o+d)),Math.min(a,Math.floor(i+(o-c)*u/o+d)),s)}var h=e[i],p=n,f=a;for(r(e,n,i),s(e[a],h)>0&&r(e,n,a);p<f;){for(r(e,p,f),p++,f--;s(e[p],h)<0;)p++;for(;s(e[f],h)>0;)f--}0===s(e[n],h)?r(e,n,f):r(e,++f,a),f<=i&&(n=f+1),i<=f&&(a=f-1)}}function r(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function i(e,t){return e<t?-1:e>t?1:0}return e},void 0!==(a=n())&&(i.exports=a);const o=s.exports},"49b8":function(e,t,r){"use strict";function i(e){return e=e||globalThis.location.hostname,l.some(t=>{var r;return null!=(null==(r=e)?void 0:r.match(t))})}function n(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(o)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(s)||null!=t.match(c)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const a=/^devext.arcgis.com$/,s=/^qaext.arcgis.com$/,o=/^[\w-]*\.mapsdevext.arcgis.com$/,c=/^[\w-]*\.mapsqa.arcgis.com$/,l=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,s,/^jsapps.esri.com$/,o,c]},"4b49":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var i=r("b2b2"),n=r("0b2d"),a=r("8188");function s(e,t,r){if(Object(i["k"])(e)||Object(i["k"])(r))return!1;let n=!0;return c[0]=null!=e.xmin?e.xmin:0,c[1]=null!=e.ymin?e.ymin:0,c[2]=null!=e.zmin?e.zmin:0,n=n&&Object(a["p"])(c,e.spatialReference,0,t,r,0,1),c[0]=null!=e.xmax?e.xmax:0,c[1]=null!=e.ymax?e.ymax:0,c[2]=null!=e.zmax?e.zmax:0,n=n&&Object(a["p"])(c,e.spatialReference,0,t,r,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n}function o(e,t,r){if(Object(i["k"])(e)||Object(i["k"])(r))return!1;let n=!0;return c[0]=null!=e.xmin?e.xmin:0,c[1]=null!=e.ymin?e.ymin:0,c[2]=null!=e.zmin?e.zmin:0,n=n&&Object(a["p"])(c,e.spatialReference,0,c,r,0,1),t[0]=c[0],t[1]=c[1],c[0]=null!=e.xmax?e.xmax:0,c[1]=null!=e.ymax?e.ymax:0,c[2]=null!=e.zmax?e.zmax:0,n=n&&Object(a["p"])(c,e.spatialReference,0,c,r,0,1),t[2]=c[0],t[3]=c[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),n}const c=Object(n["f"])()},"4c96":function(e,t,r){"use strict";function i(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=r?r.count:t.count;let c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*s;for(let u=0;u<o;++u)i[c]=a[l],i[c+1]=a[l+1],i[c+2]=a[l+2],c+=n,l+=s}function n(e,t,r,i,n){var a,s;const o=e.typedBuffer,c=e.typedBufferStride,l=null!=(a=null==n?void 0:n.count)?a:e.count;let u=(null!=(s=null==n?void 0:n.dstIndex)?s:0)*c;for(let d=0;d<l;++d)o[u]=t,o[u+1]=r,o[u+2]=i,u+=c}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}));Object.freeze({__proto__:null,copy:i,fill:n})},"4f8b":function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return l}));var i=r("2119"),n=r("e431"),a=r("d18f");r("7361");function s(e){return e?{ray:Object(a["c"])(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a["c"])(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=s()){return Object(a["b"])(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,r=s()){const i=Object(n["s"])(e.vector);return Object(a["g"])(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function l(e,t){return d(e,e.c0,t)}function u(e,t){return d(e,e.c1,t)}function d(e,t,r){return Object(n["i"])(r,e.ray.origin,Object(n["h"])(r,e.ray.direction,t))}new i["a"](()=>({c0:0,c1:0,ray:null}))},5211:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i["a"]`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}},5241:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return m}));var i=r("b2b2"),n=r("afe1"),a=r("0b2d"),s=r("8188"),o=r("4261"),c=r("32ed"),l=r("1a54"),u=r("2e0f"),d=r("ba58"),h=r("5a22");const p=Object(a["f"])();function f(e,t,r,a,c,l,d,f){const b=r?r.length:0,m=e.clippingExtent;if(Object(s["t"])(t,p,e.elevationProvider.spatialReference),Object(i["l"])(m)&&!Object(o["g"])(m,p))return null;const g=e.renderCoordsHelper.spatialReference;Object(s["t"])(t,p,g);const v=e.localOriginFactory.getOrigin(p),y=new h["a"]({castShadow:!1,metadata:{layerUid:l,graphicUid:d,usesVerticalDistanceToGround:!0}});for(let i=0;i<b;i++){const e=n["a"];y.addGeometry(r[i],a[i],e,v,f)}return{object:y,sampledElevation:Object(u["c"])(y,t,e.elevationProvider,e.renderCoordsHelper,c)}}function b(e,t,r){const i=e.elevationContext,n=r.spatialReference;Object(s["t"])(t,p,n),i.centerPointInElevationSR=Object(l["j"])(p[0],p[1],t.hasZ?p[2]:0,n)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(d["a"])(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const r=Object(c["f"])(t,Object(c["e"])(t)/2);return Object(l["j"])(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function g(e,t,r,i,n){const a=new Float64Array(3*e.length),s=new Float64Array(a.length);e.forEach((e,t)=>{a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0});const o=Object(u["d"])(a,t,0,s,0,a,0,a.length/3,r,i,n),c=null!=o;return{numVertices:e.length,position:a,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},"549a":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("ce50");class n{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}since(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const t=this._context&&this._context+":",r=this._context&&this._context+" ";throw new i["a"](t+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new n(this.major,this.minor,this._context)}static parse(e,t=""){const[r,a]=e.split("."),s=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(s))throw new i["a"]((t&&t+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!a||!a.match||!a.match(s))throw new i["a"]((t&&t+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),c=parseInt(a,10);return new n(o,c,t)}}},5876:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.vertex.code.add(i["a"]`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${i["a"].int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${i["a"].int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${i["a"].int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${i["a"].int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},"5a22":function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var i=r("b2b2"),n=r("d791"),a=r("afe1"),s=r("e431"),o=r("0b2d"),c=r("f895"),l=r("680b"),u=r("003f"),d=r("697e"),h=r("bea9"),p=r("1153"),f=r("b623");class b extends u["a"]{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(a["d"])(),this._bvObjectSpace=new g,this._bvWorldSpace=new g,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new m),this.transformation=Object(a["d"])();const{geometries:t,materials:r,transformations:i,origins:n}=e;if(Array.isArray(t)){Object(p["a"])(r.length===t.length,"Object3D: materials don't match geometries"),Object(p["a"])(i.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=d["a"].pool.acquire(t[e],r[e],Object(a["c"])(i[e]),{highlights:null,occludees:null,visible:this._visible},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n["d"])(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(p["a"])(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,r,n,s){r=r||a["a"],this._geometries.push(e);const o=d["a"].pool.acquire(e,t,r,{highlights:null,occludees:null,visible:this._visible},n,s);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(i["l"])(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(i["l"])(t.shaderTransformation)?this._geometryRecords.some(e=>Object(i["l"])(e.shaderTransformation)):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new h["a"](1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(f["a"])(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(f["e"])(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new h["a"](0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(f["a"])(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(f["e"])(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n["n"])(Object(i["v"])(t,Object(a["d"])()),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return t=t||Object(a["d"])(),Object(n["n"])(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],r=e.boundingInfo;Object(i["l"])(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Object(s["l"])(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(s["l"])(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o["f"])(),t=Object(o["f"])(),r=Object(l["i"])(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const a=this._geometries[n].boundingInfo;if(Object(i["k"])(a))continue;const o=this._geometryRecords[n].getShaderTransformation(),c=Object(l["i"])(o);Object(s["t"])(e,a.getCenter(),o);const u=Object(s["p"])(e,this._bvObjectSpace.bounds),d=a.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],u+d),Object(s["t"])(t,e,this.transformation);const h=Object(s["p"])(t,this._bvWorldSpace.bounds),p=d*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,r){const i=e.getBBMin(),n=e.getBBMax(),a=Object(o["d"])(i),c=Object(o["d"])(n);Object(s["t"])(a,a,r),Object(s["t"])(c,c,r);for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],c[s]),t.max[s]=Math.max(t.max[s],a[s],c[s]);for(let o=0;o<3;++o){Object(s["n"])(a,i),Object(s["n"])(c,n),a[o]=n[o],c[o]=i[o],Object(s["t"])(a,a,r),Object(s["t"])(c,c,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],a[e],c[e]),t.max[e]=Math.max(t.max[e],a[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(i["l"])(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(i["l"])(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class m{constructor(){this.min=Object(o["h"])(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o["h"])(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class g extends m{constructor(){super(...arguments),this.bounds=Object(c["c"])()}init(){Object(s["z"])(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(s["z"])(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c["a"])(this.bounds)}}},"5e82":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("b2b2"),n=r("f4cc");class a{constructor(e){this.schedule=e,this._loadStatus=0,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return 1===this._loadStatus?(e&&e(),Object(i["u"])(this._loader)):2===this._loadStatus?(t&&t(this._loadError),Object(i["u"])(this._loader)):(Object(i["k"])(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=2,!Object(n["m"])(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){Object(i["l"])(this._abortController)?this._abortController=Object(i["a"])(this._abortController):0===this._loadStatus&&(this._loadStatus=2),this._loader=null}}},6061:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r("b2b2"),n=r("f2e0"),a=r("d791"),s=r("afe1"),o=r("e431"),c=r("0fc4"),l=r("680b"),u=r("1038"),d=r("bea9"),h=r("b623");class p{constructor(e,t,r=null,i=null,a=Object(n["b"])(),o=null,l=null,u=!1){this.data=e,this.material=t,this.layerUid=r,this.graphicUid=i,this.id=a,this.boundingInfo=o,this.calculateShaderTransformation=l,this.castShadow=u,this.boundingSphere=Object(c["e"])(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(s["d"])(),this._shaderTransformationDirty=!0}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,r=Object(l["i"])(e)){Object(i["k"])(this.boundingInfo)||(Object(o["t"])(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return Object(i["l"])(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(i["k"])(this.calculateShaderTransformation)?Object(i["v"])(this.transformation,s["a"]):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(s["d"])()),Object(a["d"])(this._shaderTransformation,this.calculateShaderTransformation(Object(i["v"])(this.transformation,s["a"]))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(i["l"])(this._transformation)&&Object(o["t"])(e,e,this._transformation),!0);const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return!!Object(u["c"])(r,t,e)&&(Object(i["l"])(this._transformation)&&Object(o["t"])(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new d["a"](0),t=this.instanceParameters;return t.highlights=Object(h["a"])(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(h["e"])(t.highlights,e)}}},6339:function(e,t,r){"use strict";r.d(t,"a",(function(){return Ls}));var i=r("792b"),n=r("b2b2"),a=r("f4cc"),s=r("f0b9"),o=r("ecd7"),c=r("3349"),l=r("02f1"),u=r("e431"),d=r("0b2d"),h=r("1219"),p=r("8188"),f=r("4261"),b=r("9180"),m=r("1a54"),g=r("6655"),v=r("e9d6");const y=new o["a"](Array,e=>Object(f["C"])(e,f["c"]),null,10,5),O=Object(b["m"])();class x{constructor(e,t,r,i,a){this.graphic=e,this.graphics3DSymbol=t,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=j(2,4),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++t.referenced,this._featureExpressionFeature=a?Object(v["d"])(a,e,i):null;for(const s of r)Object(n["l"])(s)&&(this.isElevationSource=this.isElevationSource||s.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(e,t,r){this._layer=t,this._stage=e,this.forEachSymbolLayerGraphic(i=>{i.initialize(e,t,r),i.setVisibility(this.isVisible())})}destroy(){this.forEachSymbolLayerGraphic(e=>e.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.graphics}clearLabelGraphics(){this.forEachLabelGraphic(e=>e.destroy()),this._labelGraphics.length=0}addLabelGraphic(e,t,r){this._labelGraphics.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(1))}addAuxiliaryGraphic(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._stage,this._layer),e.setVisibility(this.isVisible()))}get isDraped(){let e=!1;return this.forEachSymbolLayerGraphic(t=>{"draped"===t.type&&(e=!0)}),e}isVisible(e=0,t){for(let r=0;r<=e;r++){const e=this._visibilityFlags[r];for(let r=0;r<e.length;++r)if(!1===e[r]&&r!==t)return!1}return!0}hasVisibilityFlag(e,t){return null!=this._visibilityFlags[t][e]}setVisibilityFlag(e,t,r){const i=this.isVisible(r);this._visibilityFlags[r][e]=t;const n=this.isVisible(r);if(i===n)return!1;if(1===r)this.forEachLabelGraphic(e=>e.setVisibility(n));else{this.forEachSymbolLayerGraphic(e=>e.setVisibility(n));const e=this.isVisible(1);this.forEachLabelGraphic(t=>t.setVisibility(e))}return!0}clearVisibilityFlag(e,t=0){return this.setVisibilityFlag(e,void 0,t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(Object(n["k"])(t))return!1;this._extent=Object(b["m"])(),Object(m["d"])(t,this._extent);const r=t.spatialReference;if(!r.equals(e)&&!Object(p["n"])(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return Object(n["l"])(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===e&&this._optimizedGeometry.hasM===t||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t),this._optimizedGeometry.hasZ=e,this._optimizedGeometry.hasM=t),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(e,t,r){let i=e.geometry;return"mesh"!==i.type&&"extent"!==i.type||(i=h["a"].fromExtent("mesh"===i.type?i.extent:i)),Object(g["d"])(i,t,r)}get usedMemory(){let e=Object(s["a"])(this.graphic.attributes);return this.forEachSymbolLayerGraphic(t=>{const r=t.graphics3DSymbolLayer.complexity;if(Object(n["k"])(r))return;const i="draped"===t.type?r.memory.draped:r.memory;e+=i.bytesPerFeature,i.bytesPerCoordinate&&(e+=Object(m["k"])(this.graphic.geometry)*i.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:Object(d["f"])(),num:0},draped:{origin:Object(l["b"])(),num:0}};for(const t of this.graphics)Object(n["k"])(t)||t.computeAttachmentOrigin(e);return e.render.num&&Object(u["h"])(e.render.origin,e.render.origin,1/e.render.num),e.draped.num&&Object(c["g"])(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,r,a,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Object(f["k"])(s.boundingBox):s.boundingBox=Object(f["k"])(),s.requiresDrapedElevation=!1,await Object(i["b"])(this.graphics,async i=>{if(Object(n["k"])(i))return;const o="draped"===i.type?t:e,c=y.acquire(),l=await i.getProjectedBoundingBox(o,r,s.screenSpaceObjects,a,c);isFinite(l[2])&&isFinite(l[5])||(s.requiresDrapedElevation=!0),l&&Object(f["m"])(s.boundingBox,c),y.release(c)}),Object(f["d"])(s.boundingBox)||Object(b["c"])(Object(f["G"])(s.boundingBox,O))?s:null}needsElevationUpdates(){for(const e of this.graphics)if(Object(n["l"])(e)&&("object3d"===e.type||"lod-instance"===e.type)&&e.needsElevationUpdates)return!0;for(const e of this._labelGraphics)if(e&&e.needsElevationUpdates)return!0;return!1}alignWithElevation(e,t,r){this.forEachRenderedGraphic(i=>{"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,this._featureExpressionFeature,r)})}addObjectStateSet(e,t){this.forEachSymbolLayerGraphic(r=>r.addObjectState(e,t))}removeObjectState(e){this.forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}forEachGraphicList(e,t){e.forEach(e=>e&&t(e))}forEachSymbolLayerGraphic(e){this.forEachGraphicList(this.graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)}forEachLabelGraphic(e){this.forEachGraphicList(this._labelGraphics,e)}forEachRenderedGraphic(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)}}function j(e,t){const r=new Array(e);for(let i=0;i<r.length;i++)r[i]=new Array(t);return r}var _=r("7b96"),S=r("e92d"),w=r("ce50"),C=r("9812"),P=r("1c92"),T=r("dae5"),E=r("d791"),A=r("afe1"),R=r("8190"),M=r("668b"),D=r("d1ac"),z=r("2e0f"),I=r("0eb9"),L=r("7f60"),F=r("ba58"),V=(r("e06a"),r("1666")),U=r("7585"),G=r("0278"),N=r("3af1");function B(e){const t=[["position",e.indices]],r=[["position",{size:3,data:e.attributeData.position,exclusive:!0}]];return Object(n["l"])(e.attributeData.color)&&(r.push(["color",{size:4,data:e.attributeData.color,exclusive:!0}]),t.push(["color",new Uint32Array(e.indices.length)])),Object(n["l"])(e.attributeData.uvMapSpace)&&(r.push(["uvMapSpace",{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push(["uvMapSpace",e.indices])),Object(n["l"])(e.attributeData.boundingRect)&&(r.push(["boundingRect",{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push(["boundingRect",e.indices])),Object(n["l"])(e.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new G["a"](r,t)}function k(e){const t=[["position",e.indices],["uv0",e.indices]],r=[["position",{size:3,data:e.attributeData.position,exclusive:!0}],["uv0",{size:2,data:e.attributeData.uv0,exclusive:!0}]];return Object(n["l"])(e.attributeData.mapPosition)&&(r.push(["mapPos",{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push(["mapPos",e.indices])),new G["a"](r,t)}function H(e){switch(e.type){case"extent":if(e instanceof N["a"])return h["a"].fromExtent(e);break;case"polygon":return e}return null}function q(e,t,r,i){const n=Object(V["a"])(e.rings,e.hasZ,1),a=new Float64Array(n.position.length),s=Object(z["d"])(n.position,e.spatialReference,0,a,0,n.position,0,n.position.length/3,t,r,i),o=null!=s;return{position:n.position,mapPosition:a,polygons:Z(n.polygons,n.position,a),outlines:$(n.outlines,n.position,a),projectionSuccess:o,sampledElevation:s}}function W(e,t){const r=Object(V["a"])(e.rings,!1,1),i=Object(p["p"])(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=U["a"];return{position:r.position,polygons:Z(r.polygons,r.position),outlines:$(r.outlines,r.position),projectionSuccess:i}}function $(e,t,r){const i=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;i.push({index:n,count:a,position:t.subarray(e,s),mapPosition:r?r.subarray(e,s):void 0})}return i}function Z(e,t,r){const i=new Array;for(const{index:n,count:a,holeIndices:s,pathLengths:o}of e){if(a<=1)continue;const e=3*n,c=e+3*a,l=s.map(e=>e-n);i.push({index:n,count:a,holeIndices:l,pathLengths:o,position:t.subarray(e,c),mapPosition:r?r.subarray(e,c):void 0})}return i}var Y=r("ec13"),J=r("6611"),X=r("0cb9"),Q=r("5a22"),K=r("dbad");const ee=["polygon","extent"];class te extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(F["k"])(this._getSymbolSize());if(e)throw new w["a"]("graphics3dextrudesymbollayer:invalid-size",e)}const e=Object(n["j"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e),r=Object(d["g"])(t),i=t[3],a=i<1||this.needsDrivenTransparentPass,s={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:i,transparent:a,cullFace:a?0:2,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new K["a"](s),this._bottomMaterial=new K["a"]({...s,cullFace:2}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,ee,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new I["a"]);return this._createAs3DShape(t,e.renderingInfo,r,i,t.uid)}layerOpacityChanged(e,t){const r=Object(n["j"])(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r),a=i<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:i,transparent:a}),this._bottomMaterial.setParameters({opacity:i,transparent:a});const s=this._getLayerOpacity();return e.forEach(e=>{const r=t(e);Object(n["l"])(r)&&r.layerOpacityChanged(s,this._context.isAsync)}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,z["i"])}slicePlaneEnabledChanged(e,t){return this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),e.forEach(e=>{const r=t(e);Object(n["l"])(r)&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(e){let t;var r;return t=e.size&&this._drivenProperties.size?null!=(r=Object(D["a"])(e.size,2))?r:0:this._getSymbolSize(),t/=this._context.renderCoordsHelper.unitInMeters,t}applyRendererDiff(){return 1}_getSymbolSize(){var e;return null!=(e=this.symbolLayer.size)?e:1}_createAs3DShape(e,t,r,i,a){const s=H(e.geometry);if(Object(n["k"])(s))return null;const o=q(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);if(this._logGeometryCreationWarnings(o,s.rings,"rings","ExtrudeSymbol3DLayer"),0===s.rings.length||!s.rings.some(e=>e.length>0))return null;const c=Object(F["a"])(s);if(Object(n["k"])(c))return null;const l=new Array,u=new Array,h=new Array,b=Object(f["h"])(),m=Object(A["d"])(),g=Object(d["f"])(),v=1===this._context.renderCoordsHelper.viewingMode;v||this._context.renderCoordsHelper.worldUpAtPosition(null,g),Object(p["d"])(s.spatialReference,[c.x,c.y,0],m,this._context.renderCoordsHelper.spatialReference);const y=Object(A["d"])();Object(E["c"])(y,m);const O=Object(T["b"])();Object(P["a"])(O,y);const{polygons:x,mapPosition:j,position:S}=o,w=S.length/3,D=new Float64Array(3*w*6),I=new Float64Array(3*w*6),L=new Float64Array(3*w*6),V=new Float64Array(1*w*6);let U=0;for(let n=0;n<x.length;++n){const e=x[n],i=e.count;if(this._context.clippingExtent&&(Object(f["k"])(b),Object(f["n"])(b,e.mapPosition),!Object(f["x"])(b,this._context.clippingExtent)))continue;const a=Object(C["a"])(e.mapPosition,e.holeIndices,3);if(0===a.length)continue;const s=3*i*2+a.length,o=new Uint32Array(s),c=new Uint32Array(a.length),d=6*i,p=3*D.BYTES_PER_ELEMENT,m=new R["v"](D.buffer,U*p,p,(U+d)*p),_=3*I.BYTES_PER_ELEMENT,w=new R["v"](I.buffer,U*_,_,(U+d)*_),P=new Float64Array(L.buffer,3*U*L.BYTES_PER_ELEMENT,3*d),T=new Float64Array(V.buffer,1*U*V.BYTES_PER_ELEMENT,1*d),E=this._getExtrusionSize(t);re(S,j,a,e,m.typedBuffer,P,w.typedBuffer,T,0,o,c,E,g,v),Object(M["e"])(m,m,y),Object(M["a"])(w,w,O),U+=6*i;const z=this._createExtrudeGeometry(o,o.length-c.length,{positions:m.typedBuffer,elevation:P,normals:w.typedBuffer,heights:T},r);l.push(z),u.push(this._material),h.push(A["a"]);const F=this._createExtrudeGeometry(c,0,{positions:m.typedBuffer,elevation:P,normals:w.typedBuffer,heights:T},r);l.push(F),u.push(this._bottomMaterial),h.push(A["a"])}if(0===l.length)return null;const G=new Q["a"]({geometries:l,materials:u,transformations:h,metadata:{layerUid:this._context.layer.uid,graphicUid:a,isElevationSource:!0}});G.transformation=m;const N=Object(Y["a"])(this.symbolLayer,{opacity:this._getLayerOpacity()}),B=Object(n["l"])(N)?{baseMaterial:this._material,edgeMaterials:[N],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,k=new _["a"](this,G,l,null,null,fe,i,B);return k.alignedSampledElevation=o.sampledElevation,k.needsElevationUpdates=Object(z["i"])(i.mode),k}_createExtrudeGeometry(e,t,r,i){const n=new Uint32Array(e.length),a=[["position",{size:3,data:r.positions,exclusive:!0}],["normal",{size:3,data:r.normals,exclusive:!0}],["color",{size:4,data:i,exclusive:!0}],["size",{size:1,data:r.heights,exclusive:!0}]],s=[["position",e],["normal",e],["color",n]];return r.elevation&&(a.push(["mapPos",{size:3,data:r.elevation}]),s.push(["mapPos",e])),new G["a"](a,s,0,t)}}function re(e,t,r,i,n,a,s,o,c,l,u,d,h,p){const f=r.length/3;let b=0,m=2*i.count;ie(e,t,i.index,i.count,r,0,f,n,a,s,o,c,l,u,m,d,h,p),c+=2*i.count,m=0,se(n,a,o,s,b,i.pathLengths[0],i.count,c,l,m,d),c+=4*i.pathLengths[0],m+=2*i.pathLengths[0],b+=i.pathLengths[0];for(let g=1;g<i.pathLengths.length;++g)se(n,a,o,s,b,i.pathLengths[g],i.count,c,l,m,d),c+=4*i.pathLengths[g],m+=2*i.pathLengths[g],b+=i.pathLengths[g]}function ie(e,t,r,i,n,a,s,o,c,l,d,h,p,f,b,m,g,v){Object(u["n"])(me,g);const y=m>0?1:-1;let O=3*r,x=h,j=3*x,_=h+i,S=3*_;for(let P=0;P<i;++P)v&&(me[0]=e[O+0],me[1]=e[O+1],me[2]=e[O+2],Object(u["u"])(me,me)),o[j+0]=e[O+0],o[j+1]=e[O+1],o[j+2]=e[O+2],c[j+0]=t[O+0],c[j+1]=t[O+1],c[j+2]=t[O+2],l[j+0]=-y*me[0],l[j+1]=-y*me[1],l[j+2]=-y*me[2],d[x]=0,o[S+0]=e[O+0]+m*me[0],o[S+1]=e[O+1]+m*me[1],o[S+2]=e[O+2]+m*me[2],c[S+0]=t[O+0],c[S+1]=t[O+1],c[S+2]=t[O+2],l[S+0]=y*me[0],l[S+1]=y*me[1],l[S+2]=y*me[2],d[_]=m,j+=3,S+=3,O+=3,x+=1,_+=1;O=3*a,j=0,S=3*b;const w=m<0?ye:ve,C=m<0?ve:ye;for(let u=0;u<s;++u)f[j+0]=n[O+w[0]],f[j+1]=n[O+w[1]],f[j+2]=n[O+w[2]],p[S+0]=n[O+C[0]]+i,p[S+1]=n[O+C[1]]+i,p[S+2]=n[O+C[2]]+i,j+=3,S+=3,O+=3}function ne(e,t,r,i,n,a,s){i[a]=i[s],s*=3,e[0+(a*=3)]=e[s+0],e[a+1]=e[s+1],e[a+2]=e[s+2],t[a+0]=t[s+0],t[a+1]=t[s+1],t[a+2]=t[s+2],r[a+0]=n[0],r[a+1]=n[1],r[a+2]=n[2]}const ae=Object(d["f"])();function se(e,t,r,i,n,a,s,o,c,l,u){let d=n,h=n+1,p=n+s,f=n+s+1,b=o,m=o+1,g=o+2*a,v=o+2*a+1;u<0&&(d=n+s+1,f=n),l*=3;for(let y=0;y<a;++y)y===a-1&&(u>0?(h=n,f=n+s):(h=n,d=n+s)),he(e,d,h,p,ae),ne(e,t,i,r,ae,b,d),ne(e,t,i,r,ae,m,h),ne(e,t,i,r,ae,g,p),ne(e,t,i,r,ae,v,f),c[l++]=b,c[l++]=g,c[l++]=v,c[l++]=b,c[l++]=v,c[l++]=m,d++,h++,p++,f++,b+=2,m+=2,g+=2,v+=2}const oe=Object(d["f"])(),ce=Object(d["f"])(),le=Object(d["f"])(),ue=Object(d["f"])(),de=Object(d["f"])();function he(e,t,r,i,n){t*=3,r*=3,i*=3,Object(u["z"])(oe,e[t++],e[t++],e[t++]),Object(u["z"])(ce,e[r++],e[r++],e[r++]),Object(u["z"])(le,e[i++],e[i++],e[i++]),Object(u["m"])(ue,ce,oe),Object(u["m"])(de,le,oe),Object(u["j"])(n,de,ue),Object(u["u"])(n,n)}const pe=Object(d["f"])();function fe(e,t,r,i){const n=e.stageObject,a=n.geometryRecords,s=a.length,o="absolute-height"!==t.mode;let c=0;const l=n.transformation,d=Object(E["c"])(Object(A["d"])(),l);for(let h=0;h<s;h+=2){const e=a[h].geometry,s=e.getMutableAttribute("position").data,p=e.vertexAttributes.get("size").data,f=e.vertexAttributes.get("mapPos").data,b=new X["a"](f),m=s.length/3;let g=0,v=!1,y=0;const O=r.spatialReference;for(let n=0;n<m;n++){pe[0]=s[g],pe[1]=s[g+1],pe[2]=s[g+2],Object(z["g"])(b,r,t,i,ge),o&&(y+=ge.sampledElevation),J["a"].TESTS_DISABLE_OPTIMIZATIONS?(Object(u["z"])(be,b.array[b.offset+0],b.array[b.offset+1],ge.z+p[g/3]),i.toRenderCoords(be,O,be),Object(u["t"])(be,be,d)):(Object(u["z"])(be,s[g+0],s[g+1],s[g+2]),Object(u["t"])(be,be,l),i.setAltitude(be,ge.z+p[g/3]),Object(u["t"])(be,be,d)),s[g]=be[0],s[g+1]=be[1],s[g+2]=be[2];const e=Oe/i.unitInMeters;(Math.abs(pe[0]-s[g])>=e||Math.abs(pe[1]-s[g+1])>=e||Math.abs(pe[2]-s[g+2])>=e)&&(v=!0),b.offset+=3,g+=3}v&&(e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[h]),a[h+1].geometry.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(a[h+1])),c+=y/m}return c/s}const be=Object(d["f"])(),me=Object(d["f"])(),ge=new z["a"],ve=[0,2,1],ye=[0,1,2],Oe=.01;var xe=r("9ef0"),je=(r("1fd7"),r("c120")),_e=r("a915"),Se=r("e041"),we=r("7577"),Ce=r("0fc4"),Pe=r("82fa"),Te=r("3dc2"),Ee=r("ac8e"),Ae=r("89cb"),Re=r("ed70"),Me=r("74df");class De{constructor(e,t,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._layerView=null,this.isElevationSource=!1}initialize(e,t,r){this.stage=e,this._layerView=r,this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer}setVisibility(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}}}destroy(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=Object(d["f"])()){return Object(u["z"])(e,0,0,0)}getBoundingBoxObjectSpace(e=Object(f["h"])()){return Object(f["k"])(e)}addObjectState(e,t){0===e&&(this.renderGeometries.forEach(e=>{const r=e.addHighlight();t.addRenderGeometry(e,r,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))}removeObjectState(e){this.renderGeometries.forEach(t=>{e.removeRenderGeometry(t)})}removeRenderGeometryObjectState(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)}computeAttachmentOrigin(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(Le)&&(e.draped.origin[0]+=Le[0],e.draped.origin[1]+=Le[1],e.draped.num++)}async getProjectedBoundingBox(e,t,r,i,a){Object(f["k"])(a);for(let n=0;n<this.renderGeometries.length;n++){const t=this.renderGeometries[n];this._getRenderGeometryProjectedBoundingRect(t,e,ze,r),Object(f["q"])(a,ze)}if(t){let e;Object(f["e"])(a,Le);const r=Object(F["d"])(a,t);try{e=await t.service.queryElevation(Le[0],Le[1],i,r,"ground")}catch(s){}Object(n["l"])(e)&&(a[2]=Math.min(a[2],e),a[5]=Math.max(a[5],e))}return a}_getRenderGeometryProjectedBoundingRect(e,t,r,i){if(this.boundingBox)Object(f["C"])(Ie,this.boundingBox);else{const t=e.boundingSphere,r=t[3];Ie[0]=t[0]-r,Ie[1]=t[1]-r,Ie[2]=t[2]-r,Ie[3]=t[0]+r,Ie[4]=t[1]+r,Ie[5]=t[2]+r}return t(Ie,0,2),this.calculateRelativeScreenBounds&&i.push({location:Object(f["e"])(Ie),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Object(f["G"])(Ie,r)}}const ze=Object(b["m"])(),Ie=Object(f["h"])(),Le=Object(d["f"])();var Fe,Ve=r("5241"),Ue=r("a6c9"),Ge=r("38a4"),Ne=r("9b40");function Be(e){return null!=e}function ke(e){return"number"==typeof e}function He(e){return"string"==typeof e}function qe(e){return null==e||He(e)}function We(e,t){e&&e.push(t)}function $e(e,t,r,i=Object(A["d"])()){const n=e||0,a=t||0,s=r||0;return 0!==n&&Object(E["s"])(i,i,-n/180*Math.PI),0!==a&&Object(E["e"])(i,i,a/180*Math.PI),0!==s&&Object(E["k"])(i,i,s/180*Math.PI),i}function Ze(e,t,r,i,n){const a=e.minSize,s=e.maxSize;if(e.expression)return We(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const e=i.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(Be(e.field))return Be(e.stops)?2===e.stops.length&&ke(e.stops[0].size)&&ke(e.stops[1].size)?(Ye(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(We(n,"Could not convert size info: stops only supported with 2 elements"),!1):ke(a)&&ke(s)&&Be(e.minDataValue)&&Be(e.maxDataValue)?(Ye(a,s,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=Ne["a"][e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/Ne["a"][e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(We(n,"Could not convert size info: proportional size not supported"),!1):(We(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!Be(e.field)){if(e.stops&&e.stops[0]&&ke(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(ke(a))return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=a,t.factor[r]=0,t.type[r]=1,!0}return We(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Ye(e,t,r,i,n,a){const s=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[a]=s>0?e:t,n.maxSize[a]=s>0?t:e,n.offset[a]=e-r*s,n.factor[a]=s}function Je(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return We(i,"Could not convert size info: unsupported property"),null;if(!qe(e.field))return We(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return We(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};let n;switch(e.axis){case"width":return n=Ze(e,t.size,0,r,i),n?t:null;case"height":return n=Ze(e,t.size,2,r,i),n?t:null;case"depth":return n=Ze(e,t.size,1,r,i),n?t:null;case"width-and-depth":return n=Ze(e,t.size,0,r,i),n&&Ze(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return n=Ze(e,t.size,0,r,i),n=n&&Ze(e,t.size,1,r,i),n=n&&Ze(e,t.size,2,r,i),n?t:null;default:return We(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Xe(e,t,r){for(let n=0;n<3;++n){let r=t.unitInMeters;1===e.type[n]&&(r*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let i;if(0!==e.type[0])i=0;else if(0!==e.type[1])i=1;else{if(0===e.type[2])return We(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)0===e.type[n]&&(e.minSize[n]=e.minSize[i],e.maxSize[n]=e.maxSize[i],e.offset[n]=e.offset[i],e.factor[n]=e.factor[i],e.type[n]=e.type[i]);return!0}function Qe(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function Ke(e,t,r){if(e.normalizationField)return We(r,"Could not convert color info: unsupported property"),null;if(He(e.field)){if(!e.stops)return We(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return We(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.color.values[e]=r.value,Qe(t.color.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return We(r,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.color.values[e]=1/0,Qe(t.color.colors,e,r)}}return t}function et(e,t,r){if(e.normalizationField)return We(r,"Could not convert opacity info: unsupported property"),null;if(He(e.field)){if(!e.stops)return We(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return We(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let e=0;e<8;++e){const r=i[Math.min(e,i.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return We(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}function tt(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function rt(e,t,r){if(!He(e.field))return We(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return We(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return tt(e,t.rotation,0),t;case"roll":return tt(e,t.rotation,1),t;case null:case void 0:case"heading":return tt(e,t.rotation,2),t;default:return We(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function it(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,a=!t.supportedTypes||!!t.supportedTypes.rotation,s=!!t.supportedTypes&&!!t.supportedTypes.opacity,o=e.reduce((e,o)=>{if(!e)return e;if(o.valueExpression)return We(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(o.type){case"size":return i?Je(o,e,t,r):e;case"color":return n?Ke(o,e,r):e;case"opacity":return s?et(o,e,r):null;case"rotation":return a?rt(o,e,r):e;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o&&o.size&&!Xe(o.size,t,r)?null:o:null}function nt(e){return e&&null!=e.size}function at(e,t){if(!e)return{enabled:!1};if(J["a"].TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=it(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:ct(r,t),requiresShaderTransformation:nt(r)}:{enabled:!1}}function st(e,t,r){if(!t||!e.enabled)return!1;const i=e.visualVariables,n=it(t.visualVariables,r);return!!n&&!!(ot(i.size,n.size,"size")&&ot(i.color,n.color,"color")&&ot(i.rotation,n.rotation,"rotation")&&ot(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=ct(n,r),e.requiresShaderTransformation=nt(n),!0)}function ot(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===r){const r=e,i=t;for(let e=0;e<3;e++)if(r.type[e]!==i.type[e]||r.offset[e]!==i.offset[e]||r.factor[e]!==i.factor[e])return!1}return!0}function ct(e,t){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=nt(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=Object(T["b"])(),Object(E["j"])(lt),$e(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],lt),Object(P["f"])(r.vvSymbolRotationMatrix,lt)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}!function(e){const t=Object(A["d"])(),r=Object(d["f"])();function i(e,i,n){if(!e.vvSizeEnabled)return n;Object(E["d"])(t,n);const a=e.vvSymbolRotationMatrix;Object(E["t"])(lt,a[0],a[1],a[2],0,a[3],a[4],a[5],0,a[6],a[7],a[8],0,0,0,0,1),Object(E["n"])(t,t,lt);for(let t=0;t<3;++t){const n=e.vvSizeOffset[t]+i[0]*e.vvSizeFactor[t];r[t]=Object(Ge["f"])(n,e.vvSizeMinSize[t],e.vvSizeMaxSize[t])}return Object(E["g"])(t,t,r),Object(E["b"])(t,t,e.vvSymbolAnchor),t}function n(e,t,r){if(!t.vvSizeEnabled)return Object(u["z"])(e,1,1,1);for(let i=0;i<3;++i){const n=t.vvSizeOffset[i]+r[0]*t.vvSizeFactor[i];e[i]=Object(Ge["f"])(n,t.vvSizeMinSize[i],t.vvSizeMaxSize[i])}return e}e.evaluateModelTransform=i,e.evaluateModelTransformScale=n}(Fe||(Fe={}));const lt=Object(A["d"])(),ut=Fe.evaluateModelTransform,dt=Fe.evaluateModelTransformScale;var ht=r("caf7"),pt=r("6061"),ft=r("1e2c"),bt=r("2df1"),mt=r("4cac");const gt=Object(A["d"])(),vt=Object(d["h"])(0,0,1),yt=16,Ot=1.5,xt=128,jt=.5,_t=[jt/2,jt/2,1-jt/2,1-jt/2],St=[xt*jt,xt*jt];class wt extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(e){this._validateOrThrow();const t=this._prepareMaterialParameters(),r=this._getPrimitive();if(Object(n["l"])(r))this._prepareResourcesPrimitive(t,r);else{const r=Object(Ee["g"])(this.symbol,this.symbolLayer),i=Object(Se["i"])(r);i&&"application/json"===i.mediaType?await this._prepareResourcesCIM(t,JSON.parse(i.data),e):await this._prepareResourcesHref(t,r,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=Object(F["k"])(this._getIconSize());if(e)throw new w["a"]("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,t=Math.round(null!=e.size?Object(_e["h"])(e.size):yt);return this._drivenProperties.size?Math.max(t,64):t}_generateTextureCIM(e){const t=this._getGraphicHash(e);let r=""===t?null:this._cimSymbolTextures.get(t);if(!r){const i={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,e,"esriGeometryPoint",i,null,null);this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",n.anchorPosition);const a={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:2};r=new ft["a"](n.imageData,a),this._cimSymbolTextures.set(t,r),this._context.stage.add(r)}return r}_computeSize(e,t){const r=e.width/e.height;return r>1?[t,Math.round(t/r)]:[Math.round(t*r),t]}_prepareMaterialParameters(){const e={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(Ct(t)){const{screenLength:r,minWorldLength:i,maxWorldLength:n}=t.verticalOffset;e.verticalOffset={screenLength:Object(_e["h"])(r),minWorldLength:i||0,maxWorldLength:null!=n?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,t){const r=this._getOutlineSize();if(Pt(t)&&0===r)throw new Error("Nothing to render");this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;const i=this._context.sharedResources.textures.fromData(t,()=>Tt(t));this._texture=i.texture,this._releaseTexture=i,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=_t,e.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/jt,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,t,r){if(!Object(je["a"])("esri-canvas-svg-support")&&Object(Se["x"])(t))throw new w["a"]("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.layerView.view.pixelRatio,o=await Object(i["d"])(this._context.sharedResources.textures.fromUrl(t,s,{signal:r}));if(!1===o.ok)throw Object(a["v"])(o.error),new w["a"]("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${t})`);this._releaseTexture=o.value;const c=o.value.texture,l=c.params;this._size=this._computeSize(l,n),e.textureId=c.id,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,t,i){const n=new mt["a"]({data:t});if(!this._context.sharedResources.cimSymbolRasterizer){const e=(await Promise.all([r.e("chunk-205026ce"),r.e("chunk-4f5f1116")]).then(r.bind(null,"6b49"))).CIMSymbolRasterizer;Object(a["w"])(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new e(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(e=>e.toJSON()):null;let o,c;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,s,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression){const e=this._context.renderer;if(isNaN(e.scaleExpression)){const t=e.scaleExpression,r=await Object(Pe["d"])(t,this._context.layer.spatialReference,s);c=(e,t,i)=>{const n=Object(Ae["a"])(r,e,{$view:i},"esriGeometryPoint",t);return null!==n?n:1}}else o=Number(e.scaleExpression)}this._cimScaleFactorOrFunction=o||c||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Object(a["w"])(i);const u=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(e=>u.get(e).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||Te["b"]}_getOutlineSize(){let e=0;const t=this.symbolLayer;return Object(n["l"])(t.outline)&&null!=t.outline.size?Math.max(Object(_e["h"])(t.outline.size),0):(e=Pt(this._getPrimitive())?Ot:0,Math.max(e,0))}_getOutlineColor(){const e=this._getLayerOpacity(),t=this.symbolLayer,r=Object(n["j"])(t,"outline","color");if(Object(n["l"])(r)){const t=xe["a"].toUnitRGB(r),i=r.a*e;return[t[0],t[1],t[2],i]}return[0,0,0,0]}_getFillColor(){if(Pt(this._getPrimitive()))return Re["b"];const e=Object(n["k"])(this._getPrimitive()),t=Object(n["j"])(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getAnchorPos(e,t){return"relative"===e?Object(l["f"])((t.x||0)+.5,.5-(t.y||0)):e in F["h"]?F["h"][e]:F["h"].center}_createMaterialAndAddToStage(e,t){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(e,this._fastUpdates.materialParameters),this._cimLayers){let r=this._cimSymbolMaterials.get(e.textureId);return r||(r=new bt["a"](e),this._cimSymbolMaterials.set(e.textureId,r),t.add(r)),r}return this._material=new bt["a"](e),t.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=Object(n["s"])(this._releaseTexture)}_getScaleFactor(e,t){if(this._drivenProperties.size&&e.size){for(let t=0;t<3;t++){const r=e.size[t];r&&"symbol-value"!==r&&"proportional"!==r&&(e.size[t]=Object(_e["h"])(r))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;let r,i;if(this._cimLayers){if(!this._cimLayers.length)return null;const e=this._generateTextureCIM(t),n={textureId:e.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(n,this._context.stage),r=[e.params.width,e.params.height]}else r=this._size,i=Object(n["u"])(this._material);const a=Object(Ve["d"])(t.geometry);if(Object(n["k"])(a))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;const s=e.renderingInfo,o=this._getVertexOpacityAndColor(s);let c=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const e=r[0]>r[1]?r[0]:r[1];c=this._getScaleFactor(s,e)}c*=this._symbolTextureRatio;const l=[r[0]*c,r[1]*c],u=this.setGraphicElevationContext(t,new I["a"]);return this.ensureDrapedStatus("on-the-ground"===u.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(t,a,i,o,l,e.layer.uid):this._createAs3DShape(t,a,i,o,l,u,t.uid)}layerOpacityChanged(){const e=this._getFillColor(),t=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:t})}),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(z["e"])(wt.elevationModeChangeTypes,r,i);if(n!==z["b"].UPDATE)return n;const a=Object(z["h"])(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return 0;if(!st(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return 0;Object(n["l"])(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return 2}_defaultElevationInfoNoZ(){return Et}_createAs3DShape(e,t,r,i,n,a,s){const o=this.getFastUpdateAttrValues(e),c=o?e=>ut(this._fastUpdates.materialParameters,o,e):null,l=[ht["a"].createPointGeometry(vt,null,i,n,At,null,o)],u=Object(Ve["a"])(this._context,t,l,[r],a,this._context.layer.uid,s,c);if(null===u)return null;const d=new _["a"](this,u.object,l,null,null,Me["b"],a);return d.alignedSampledElevation=u.sampledElevation,d.needsElevationUpdates=Object(z["h"])(a.mode)||"absolute-height"===a.mode,d.getScreenSize=this._createScreenSizeGetter(n,c),d.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(d.getScreenSize(),1,e),Object(Ve["b"])(d,t,this._context.elevationProvider),d}_createAsOverlay(e,t,r,i,a,s){r.renderPriority=this._renderPriority;const o=Object(Ce["e"])();Object(p["t"])(t,o,this._context.overlaySR),o[2]=U["a"];const c=this._context.clippingExtent;if(Object(n["l"])(c)&&!Object(f["g"])(c,o))return null;const l=this.getFastUpdateAttrValues(e),u=l?e=>ut(this._fastUpdates.materialParameters,l,e):null,d=ht["a"].createPointGeometry(vt,o,i,a,null,null,l),h=new pt["a"](d,r,s,e.uid);o[3]=0,Object(we["c"])(h.boundingSphere,o),h.calculateShaderTransformation=u;const b=new De(this,[h],null);return b.getScreenSize=this._createScreenSizeGetter(a,u),b.calculateRelativeScreenBounds=e=>r.calculateRelativeScreenBounds(b.getScreenSize(),1,e),b}_createScreenSizeGetter(e,t){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const i=e[0]/this._symbolTextureRatio,n=e[1]/this._symbolTextureRatio;return(e=Object(l["b"])())=>{const a=t(gt);return e[0]=a[0]*i+r,e[1]=a[5]*n+r,e}}{const t=e[0]/this._symbolTextureRatio+r,i=e[1]/this._symbolTextureRatio+r;return(e=Object(l["b"])())=>(e[0]=t,e[1]=i,e)}}_fastVisualVariableConvertOptions(){const e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=Object(d["h"])(e,e,e),r=Object(_e["i"])(1),i=e*r;return{modelSize:t,symbolSize:Object(d["h"])(i,i,i),unitInMeters:r,transformation:{anchor:d["c"],scale:d["a"],rotation:d["c"]}}}_getGraphicHash(e){let t="";for(const r of this._cimRequiredFields)t+=r+e.attributes[r];return t}_forEachMaterial(e){Object(n["l"])(this._material)&&e(this._material),this._cimSymbolMaterials.forEach(e)}}function Ct(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}function Pt(e){return!!Object(n["l"])(e)&&("cross"===e||"x"===e)}function Tt(e){let t;const r=xt,i=r*jt;switch(e){case"circle":t=Object(Ue["a"])(r,i);break;case"square":t=Object(Ue["d"])(r,i);break;case"kite":t=Object(Ue["c"])(r,i);break;case"cross":t=Object(Ue["b"])(r,i);break;case"x":t=Object(Ue["g"])(r,i);break;case"triangle":t=Object(Ue["e"])(r,i)}return new ft["a"](t,{mipmap:!1,wrap:{s:33071,t:33071},width:xt,height:xt,components:4,noUnpackFlip:!0})}wt.PRIMITIVE_SIZE=St,wt.elevationModeChangeTypes={definedChanged:z["b"].UPDATE,staysOnTheGround:z["b"].NONE,onTheGroundChanged:z["b"].RECREATE};const Et={mode:"relative-to-ground",offset:0},At=Object(Ce["g"])(0,0,0,1);var Rt=r("d408"),Mt=r("3544"),Dt=r("86ba");const zt=["polyline","polygon","extent"];class It extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=at(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(_e["i"])(1);if(e<0)throw new w["a"]("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=e}}getMaterialParameters(e){const t=Object(n["j"])(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t);this._patternHidesLine&&(r[3]=0);const i=r[3],a={width:1,color:r,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Object(Rt["d"])(this.symbolLayer.cap||"butt"),transparent:i<1||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:Object(Mt["b"])(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};if(this._drivenProperties.size)this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(a.width=Object(_e["h"])(1));else{const e=null!=this.symbolLayer.size?this.symbolLayer.size:Object(_e["i"])(1);a.width=Object(_e["h"])(e)}return this._fastUpdates&&this._fastUpdates.visualVariables?{...a,...this._fastUpdates.materialParameters}:a}get lineMaterial(){return Object(n["k"])(this._lineMaterial)&&(this._lineMaterial=new Dt["a"](this.getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return Object(n["k"])(this._ringMaterial)&&(this._ringMaterial=new Dt["a"](this.getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}destroy(){super.destroy(),this._context.stage.remove(this._lineMaterial),this._lineMaterial=null,this._context.stage.remove(this._ringMaterial),this._ringMaterial=null}getDrivenSize(e){return this._drivenProperties.size&&e.size?Object(_e["h"])(Object(D["b"])(e.size)):1}getSizeFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Object(L["b"])(this._fastUpdates.visualVariables.size.field,e):null}getDrivenColor(e){const t=Object(Ce["g"])(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}getColorFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Object(L["b"])(this._fastUpdates.visualVariables.color.field,e):null}getOpacityFeatureAttributeData(e){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Object(L["b"])(this._fastUpdates.visualVariables.opacity.field,e):null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,zt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new I["a"]);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return 0;if(!st(this._fastUpdates,t,this._vvConvertOptions))return 0;Object(n["l"])(this._lineMaterial)&&this._lineMaterial.setParameters(this._fastUpdates.materialParameters),Object(n["l"])(this._ringMaterial)&&this._ringMaterial.setParameters(this._fastUpdates.materialParameters)}return 2}layerOpacityChanged(){return Object(n["l"])(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial),Object(n["l"])(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial),!0}updateMaterialLayerOpacity(e){const t=e.parameters.color,r=Object(n["j"])(this.symbolLayer,"material","color"),i=this._patternHidesLine?0:this._getCombinedOpacity(r),a=i<1||this.needsDrivenTransparentPass,s=[t[0],t[1],t[2],i];e.setParameters({color:s,transparent:a})}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(z["e"])(It.elevationModeChangeTypes,r,i);if(n!==z["b"].UPDATE)return n;const a=Object(z["h"])(i);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return Object(n["l"])(this._lineMaterial)&&this._lineMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(n["l"])(this._ringMaterial)&&this._ringMaterial.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof N["a"])return h["a"].fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,t,r){const i=e.graphic,a=this._getGeometryAsPolygonOrPolyline(i.geometry),s="polygon"===a.type?a.rings:a.paths,o=new Array,c=new Array,l=new Array,u=Object(f["h"])(),d=Object(Rt["b"])(a,this._context.elevationProvider,this._context.renderCoordsHelper,t),h="polygon"===a.type?"rings":"paths";this._logGeometryCreationWarnings(d,s,h,"LineSymbol3DLayer");for(let m=0;m<d.lines.length;m++){const{position:t,mapPosition:r}=d.lines[m];if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(u),Object(f["n"])(u,r),!Object(f["x"])(u,this._context.clippingExtent)))continue;const i=this._createGeometry(e,t,r,a.type,1);o.push(i),c.push("polygon"===a.type?this.ringMaterial:this.lineMaterial),l.push(A["a"])}if(0===o.length)return null;const p=new Q["a"]({geometries:o,materials:c,transformations:l,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),b=new _["a"](this,p,o,null,null,Me["c"],t);return b.alignedSampledElevation=d.sampledElevation,b.needsElevationUpdates=Object(z["h"])(t.mode),b}_createGeometry(e,t,r,i,n){const a="polygon"===i?1:0,s=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return Object(Rt["a"])({overlayInfo:0===n?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:a,uniformSize:this._uniformSize,attributeData:{position:t,mapPosition:r,size:o?null:this.getDrivenSize(e.renderingInfo),color:s?null:this.getDrivenColor(e.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(e.graphic),colorFeature:this.getColorFeatureAttributeData(e.graphic),opacityFeature:this.getOpacityFeatureAttributeData(e.graphic)}})}_createAsOverlay(e,t){const r=e.graphic,i=this._getGeometryAsPolygonOrPolyline(r.geometry),n="polygon"===i.type?i.rings:i.paths,a="polygon"===i.type?this.ringMaterial:this.lineMaterial;a.renderPriority=this._renderPriority;const s=new Array,o=Object(f["h"])(),c=Object(f["k"])(),l=Object(Rt["c"])(i,this._context.overlaySR),u="polygon"===i.type?"rings":"paths";this._logGeometryCreationWarnings(l,n,u,"LineSymbol3DLayer");for(const d of l.lines){if(Object(f["k"])(o),Object(f["n"])(o,d.position),!Object(f["x"])(o,this._context.clippingExtent))continue;Object(f["m"])(c,o);const n=this._createGeometry(e,d.position,null,i.type,0),l=new pt["a"](n,a,t,r.uid);Object(we["l"])(l.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),s.push(l)}return new De(this,s,c)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return Object(n["l"])(e)&&"style"===e.type&&"none"===e.style}}It.elevationModeChangeTypes={definedChanged:z["b"].RECREATE,staysOnTheGround:z["b"].NONE,onTheGroundChanged:z["b"].RECREATE};var Lt=r("f0ba"),Ft=r("83fa"),Vt=r("4554"),Ut=r("caf1"),Gt=r("1038"),Nt=r("3748");const Bt=["mesh"];class kt extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){J["a"].DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Nt["a"]({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Nt["a"]({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),e=>e.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Bt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(t,new I["a"]),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(e,t){const r=this._getLayerOpacity();return this._materials.forEach(e=>{e.material.setParameters({layerOpacity:r});const t=e.material.parameters;this._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})}),e.forEach(e=>{const i=t(e);Object(n["l"])(i)&&i.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,z["i"])}slicePlaneEnabledChanged(e,t){return this._materials.forEach(e=>{e.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),e.forEach(e=>{const r=t(e);Object(n["l"])(r)&&r.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._materials.forEach(t=>t.material.setParameters({usePBR:e})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return Object(n["k"])(e)?"-":e instanceof xe["a"]?e.toHex():e.contentHash}_materialPropertiesDefault(e,t){const r=this._requiresSymbolVertexColors(),i=!!e.vertexAttributes.color,n=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:i,hasVertexTangents:n,uid:`vc:${i},vt:${n},vct${t},svc:${r}`}}_materialProperties(e,t,r){const i=this._materialPropertiesDefault(e,r);if(!t.material)return i;const{color:n,colorTexture:a,normalTexture:s,doubleSided:o,alphaCutoff:c,alphaMode:l}=t.material,u=this._colorOrTextureUid(n),d=this._colorOrTextureUid(a),h=this._colorOrTextureUid(s);if(i.color=n,i.colorTexture=a,i.normalTexture=s,i.uid=`${i.uid},cmuid:${u},ctmuid:${d},ntmuid:${h},ds:${o},ac:${c},am:${l}`,t.material instanceof Ft["a"]){const{metallic:e,roughness:r,metallicRoughnessTexture:n,emissiveColor:a,emissiveTexture:s,occlusionTexture:o}=t.material,c=this._colorOrTextureUid(n),l=this._colorOrTextureUid(a),u=this._colorOrTextureUid(s),d=this._colorOrTextureUid(o);i.metallic=e,i.roughness=r,i.metallicRoughnessTexture=n,i.emissiveColor=a,i.emissiveTexture=s,i.occlusionTexture=o,i.uid=`${i.uid},mrm:${e},mrr:${r},mrt:${c},emuid:${l},etmuid:${u},otmuid:${d}`}return i}_setInternalColorValueParameters(e,t){t.diffuse=xe["a"].toUnitRGB(e),t.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const t=this._getInternalTexture(e,1);return Object(n["l"])(t)?t.id:null}_getInternalTexture(e,t){const r=this._getLoadableTextureResource(e);if(!r)return null;const i=`${e.contentHash}/${t}`;let n=this._textures.get(i);return n||(n=new ft["a"](r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:1!==t}),this._textures.set(i,n),this._context.stage.add(n),this._context.stage.loadSynchronous(n)),n}_castTextureWrap(e="repeat"){if("string"==typeof e){const t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return 33071;case"mirror":return 33648;default:return 10497}}_setInternalMaterialParameters(e,t){if(Object(n["l"])(e.color)&&this._setInternalColorValueParameters(e.color,t),Object(n["l"])(e.colorTexture)){const r=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);Object(n["l"])(r)?(t.textureId=r.id,t.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):t.textureId=void 0}Object(n["l"])(e.normalTexture)&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),Object(n["l"])(e.emissiveColor)&&(t.emissiveFactor=xe["a"].toUnitRGB(e.emissiveColor)),Object(n["l"])(e.emissiveTexture)&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),Object(n["l"])(e.occlusionTexture)&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),Object(n["l"])(e.metallicRoughnessTexture)&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture))}_setExternalMaterialParameters(e){const t=this._drivenProperties.color;let r=Object(n["l"])(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(t)e.externalColor=Ce["a"];else{const t=Object(n["l"])(this.symbolLayer.material)?this.symbolLayer.material.color:null;Object(n["l"])(t)?e.externalColor=xe["a"].toUnitRGBA(t):(r=null,e.externalColor=Ce["a"])}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const t=e.vertexAttributes.color;if(Object(n["k"])(t))return!1;for(let r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}_getOrCreateMaterial(e,t){var r,i,a;const s=null==(r=t.material)?void 0:r.color,o=null==(i=t.material)?void 0:i.colorTexture,c=null==(a=t.material)?void 0:a.alphaMode,l="blend"===c,u=!("opaque"===c)&&(this._hasTransparentVertexColors(e)||Object(n["l"])(s)&&s.a<1||Object(n["l"])(o)&&o.transparent||l),h=this._materialProperties(e,t,u),p=this._materials.get(h.uid);if(p)return p.material;const f={material:null,isComponentTransparent:u,alphaMode:t.material?t.material.alphaMode:"opaque"},b=null==h.metallicRoughnessTexture&&null==h.metallic&&null==h.roughness,m={usePBR:this._usePBR(),isSchematic:b,vertexColors:h.hasVertexColors,symbolColors:h.hasSymbolVertexColors,vertexTangents:h.hasVertexTangents,ambient:d["c"],diffuse:d["a"],opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};b||(m.mrrFactors=[null!=h.metallic?h.metallic:1,null!=h.roughness?h.roughness:1,.5]),t.material&&(m.doubleSided=t.material.doubleSided,m.cullFace=t.material.doubleSided?0:2,m.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(m),this._setMaterialTransparentParameter(m,f),this._setInternalMaterialParameters(h,m);const g=new K["a"](m);return f.material=g,this._materials.set(h.uid,f),this._context.stage.add(g),g}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?3:1:e.textureAlphaMode="opaque"===t.alphaMode?1:"mask"===t.alphaMode?2:0}_addDebugNormals(e,t,r,i){const n=t.length,a=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*a,e.extent.height*a,e.extent.zmax-e.extent.zmin),o=[],c=[],l=[],d=[];for(let f=0;f<n;f++){const e=t[f],r=e.vertexAttributes.get("position"),i=e.vertexAttributes.get("normal"),n=e.indices.get("position"),a=e.indices.get("normal"),h=r.data,p=i.data;for(let t=0;t<n.length;t++){const e=3*n[t],r=3*a[t];for(let t=0;t<3;t++)o.push(h[e+t]);for(let t=0;t<3;t++)o.push(h[e+t]+p[r+t]*s);if(c.push(c.length),c.push(c.length),t%3==0){this._calculateFaceNormal(h,n,t,Zt),this._getFaceVertices(h,n,t,qt,Wt,$t),Object(u["i"])(qt,qt,Wt),Object(u["i"])(qt,qt,$t),Object(u["h"])(qt,qt,1/3);for(let e=0;e<3;e++)l.push(qt[e]);for(let e=0;e<3;e++)l.push(qt[e]+Zt[e]*s);d.push(d.length),d.push(d.length)}}}const h=new G["a"]([["position",{data:o,size:3,exclusive:!0}]],[["position",new Uint32Array(c)]],2);t.push(h),r.push(this._debugVertexNormalMaterial),i.push(Object(A["c"])(i[0]));const p=new G["a"]([["position",{data:l,size:3,exclusive:!0}]],[["position",new Uint32Array(d)]],2);t.push(p),r.push(this._debugFaceNormalMaterial),i.push(Object(A["c"])(i[0]))}_createAs3DShape(e,t,r,i){const a=e.geometry;if("mesh"!==a.type)return null;const s=this._createGeometryInfo(a,t);if(!s)return null;const{geometries:o,materials:c,transformations:l,objectTransformation:u}=s;J["a"].DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,o,c,l);const d=new Q["a"]({geometries:o,materials:c,transformations:l,metadata:{layerUid:this._context.layer.uid,graphicUid:i}});d.transformation=u;const h=this._createEdgeMaterial(),p=Object(n["l"])(h)?{baseMaterial:c[0],edgeMaterials:[h],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null,f=new _["a"](this,d,o,null,null,Me["b"],r,p);return f.needsElevationUpdates=Object(z["i"])(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,f.elevationContext.centerPointInElevationSR=this.getCenterPointInElevationSR(d),f.alignedSampledElevation=Object(Me["b"])(f,f.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),f}getCenterPointInElevationSR(e){const t=Object(m["j"])(0,0,0,this._context.elevationProvider.spatialReference);return Object(p["w"])([e.transformation[12],e.transformation[13],e.transformation[14]],this._context.renderCoordsHelper.spatialReference,t),t}_createComponentNormals(e,t,r,i){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(e,t,r,i);case"flat":return this._createComponentNormalsFlat(e,i);case"smooth":return this._createComponentNormalsSmooth(e,i);default:return}}_createComponentNormalsSource(e,t,r,i){if(Object(n["k"])(t))return this._createComponentNormalsFlat(e,i);let a=!1;if(!r.trustSourceNormals)for(let n=0;n<i.length;n+=3){this._calculateFaceNormal(e,i,n,Zt);for(let e=0;e<3;e++){const r=3*i[n+e];qt[0]=t[r+0],qt[1]=t[r+1],qt[2]=t[r+2],Object(u["k"])(Zt,qt)<0&&(t[r+0]=-t[r+0],t[r+1]=-t[r+1],t[r+2]=-t[r+2],a=!0)}}return{normals:t,indices:i,didFlipNormals:a}}_createComponentNormalsFlat(e,t){const r=new Float32Array(t.length),i=new Uint32Array(3*t.length);for(let n=0;n<t.length;n+=3){const a=this._calculateFaceNormal(e,t,n,Zt);for(let e=0;e<3;e++)r[n+e]=a[e],i[n+e]=n/3}return{normals:r,indices:i,didFlipNormals:!1}}_createComponentNormalsSmooth(e,t){const r={};for(let a=0;a<t.length;a+=3){const i=this._calculateFaceNormal(e,t,a,Zt);for(let e=0;e<3;e++){const n=t[a+e];let s=r[n];s||(s={normal:Object(d["f"])(),count:0},r[n]=s),Object(u["i"])(s.normal,s.normal,i),s.count++}}const i=new Float32Array(3*t.length),n=new Uint32Array(3*t.length);for(let a=0;a<t.length;a++){const e=r[t[a]];1!==e.count&&(Object(u["u"])(e.normal,e.normal),e.count=1);for(let t=0;t<3;t++)i[3*a+t]=e.normal[t];n[a]=a}return{normals:i,indices:n,didFlipNormals:!1}}_getFaceVertices(e,t,r,i,n,a){const s=3*t[r+0],o=3*t[r+1],c=3*t[r+2];i[0]=e[s+0],i[1]=e[s+1],i[2]=e[s+2],n[0]=e[o+0],n[1]=e[o+1],n[2]=e[o+2],a[0]=e[c+0],a[1]=e[c+1],a[2]=e[c+2]}_calculateFaceNormal(e,t,r,i){return this._getFaceVertices(e,t,r,qt,Wt,$t),Object(u["m"])(Wt,Wt,qt),Object(u["m"])($t,$t,qt),Object(u["j"])(qt,Wt,$t),Object(u["u"])(i,qt),i}_getOrCreateComponents(e){return e.components?e.components:Qt}_createPositionBuffer(e,t){let r=e.vertexAttributes.position;const i=1===t.reprojection?t.transformBeforeProject:null;if(Object(n["l"])(i)&&(r=Object(Vt["h"])(r,new Float64Array(r.length),i)),0===t.reprojection)return t.needsBufferCopy?new Float64Array(r):r;const a=Object(n["l"])(i)?r:new Float64Array(r.length);return Object(p["p"])(r,e.spatialReference,0,a,this._context.renderCoordsHelper.spatialReference,0,r.length/3),a}_createNormalBuffer(e,t,r){let i=e.vertexAttributes.normal;if(Object(n["k"])(i))return null;const a=1===r.reprojection?r.transformBeforeProject:null;if(Object(n["l"])(a)&&(i=Object(Vt["g"])(i,new Float32Array(i.length),a)),"local"===this._context.layerView.view.viewingMode||0===r.reprojection)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;const s=e.vertexAttributes.position,o=Object(n["l"])(a)?i:new Float32Array(i.length);return Object(Vt["c"])(i,s,t,e.spatialReference,o)}_createTangentBuffer(e,t,r){let i=e.vertexAttributes.tangent;if(Object(n["k"])(i))return null;const a=1===r.reprojection?r.transformBeforeProject:null;if(Object(n["l"])(a)&&(i=Object(Vt["i"])(i,new Float32Array(i.length),a)),"local"===this._context.layerView.view.viewingMode||0===r.reprojection)return r.needsBufferCopy&&e.vertexAttributes.normal===i?new Float32Array(i):i;const s=e.vertexAttributes.position,o=Object(n["l"])(a)?i:new Float32Array(i.length);return Object(Vt["e"])(i,s,t,e.spatialReference,o)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){if(this._requiresSymbolVertexColors()){const t=this._getVertexOpacityAndColor(e),r=Object(Ut["b"])(Object(n["j"])(this.symbolLayer,"material","colorMixMode")),i=new Uint8Array(4);return Object(Ut["a"])(t,r,i),i}return null}_createBuffers(e,t){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const i=e.vertexAttributes.normal,a=e.vertexAttributes.uv,s=e.vertexAttributes.tangent;if(Object(n["l"])(i)&&i.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(n["l"])(s)&&s.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Object(n["l"])(a)&&a.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(e),c=this._createPositionBuffer(e,o),l=this._createColorBuffer(e),u=this._createSymbolColorBuffer(t),d=this._createNormalBuffer(e,c,o),h=this._createTangentBuffer(e,c,o);return{positionBuffer:c,normalBuffer:d,tangentBuffer:h,uvBuffer:a,colorBuffer:l,symbolColorBuffer:u,objectTransformation:0===o.reprojection&&Object(n["l"])(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(e,c,d,h),geometryTransformation:0===o.reprojection&&Object(n["l"])(o.geometryTransformation)?o.geometryTransformation:Object(A["d"])()}}_computeReprojectionInfo(e){const t=Object(n["l"])(e.transform)&&e.transform.geographic||2===this._context.renderCoordsHelper.viewingMode?0:1;let r=null;if(Object(n["l"])(e.transform)){if(0===t){const r=Object(A["d"])();return Object(p["d"])(e.spatialReference,e.transform.origin,r,this._context.renderCoordsHelper.spatialReference),{reprojection:t,objectTransformation:r,geometryTransformation:Object(A["c"])(e.transform.localMatrix),needsBufferCopy:!1}}return r=Object(E["w"])(Object(A["d"])(),e.transform.origin),Object(E["n"])(r,r,e.transform.localMatrix),{reprojection:t,transformBeforeProject:r,needsBufferCopy:!0}}return{reprojection:t,needsBufferCopy:!0}}_transformOriginLocal(e,t,r,i){const a=this._context.renderCoordsHelper.spatialReference,s=e.anchor;Ht[0]=s.x,Ht[1]=s.y,Ht[2]=s.z;const o=Object(A["d"])();Object(p["d"])(e.spatialReference,Ht,o,a);const c=R["v"].fromTypedArray(t);if(Object(E["c"])(Yt,o),Object(M["e"])(c,c,Yt),Object(n["l"])(r)||Object(n["l"])(i)){if(Object(P["f"])(Jt,o),Object(P["o"])(Jt,Jt),Object(n["l"])(r)){const e=R["u"].fromTypedArray(r);Object(M["a"])(e,e,Jt)}if(Object(n["l"])(i)){const e=R["u"].fromTypedArray(i,4*i.BYTES_PER_ELEMENT);Object(M["a"])(e,e,Jt)}}return o}_validateFaces(e,t){const r=e.vertexAttributes.position.length/3,i=t.faces;if(i){let e=-1;for(let t=0;t<i.length;t++){const r=i[t];r>e&&(e=r)}if(r<=e)return this.logger.warn(`Vertex index ${e} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,t){return t.faces?t.faces:Object(Gt["d"])(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;const r=this._context.elevationProvider.spatialReference;let i;const n=t.length/3;return e.spatialReference.equals(r)?i=t:(i=new Float64Array(t.length),Object(p["p"])(e.vertexAttributes.position,e.spatialReference,0,i,r,0,n)),Object(f["k"])(Xt),Object(f["n"])(Xt,i,0,n),!Object(f["x"])(Xt,this._context.clippingExtent)}_createGeometryInfo(e,t){if(!Object(p["b"])(e.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const r=this._createBuffers(e,t);if(Object(n["k"])(r))return null;const{positionBuffer:i,uvBuffer:a,colorBuffer:s,symbolColorBuffer:o,normalBuffer:c,tangentBuffer:l,objectTransformation:u,geometryTransformation:d}=r,h=this._getOrCreateComponents(e),f=[],b=[],m=[];let g=!1;for(const p of h){if(!this._validateFaces(e,p))return null;const t=this._getOrCreateFaces(e,p);if(0===t.length)continue;const r=this._createComponentNormals(i,c,p,t);r.didFlipNormals&&(g=!0);const u=[["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:r.normals,exclusive:!0}]],h=[["position",t],["normal",r.indices]];Object(n["l"])(s)&&(u.push(["color",{size:4,data:s,exclusive:!0}]),h.push(["color",t])),Object(n["l"])(o)&&(u.push(["symbolColor",{size:4,data:o,exclusive:!0}]),h.push(["symbolColor",new Uint16Array(t.length)])),Object(n["l"])(a)&&(u.push(["uv0",{size:2,data:a,exclusive:!0}]),h.push(["uv0",t])),Object(n["l"])(l)&&(u.push(["tangent",{size:4,data:l,exclusive:!0}]),h.push(["tangent",t]));const v=new G["a"](u,h);f.push(v),b.push(d),m.push(this._getOrCreateMaterial(e,p))}return g&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:f,transformations:b,materials:m,objectTransformation:u}}_createEdgeMaterial(){const e={opacity:this._getLayerOpacity()};return Object(Y["a"])(this.symbolLayer,e)}}const Ht=Object(d["f"])(),qt=Object(d["f"])(),Wt=Object(d["f"])(),$t=Object(d["f"])(),Zt=Object(d["f"])(),Yt=Object(A["d"])(),Jt=Object(T["b"])(),Xt=Object(f["h"])(),Qt=[new Lt["a"]];var Kt=r("8c11"),er=r("af3d"),tr=r("bea9");class rr{constructor(e,t,r,i){this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=i,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const t=this.lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,t,r){if(this.elevationAligner){Object(v["g"])(this.elevationContext.featureExpressionInfoContext,r);const i=this.elevationAligner(this,this.elevationContext,e,t);Object(n["l"])(i)&&(this.alignedSampledElevation=i)}}getCenterObjectSpace(e=Object(d["f"])()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,or),Object(u["t"])(e,this.lodRenderer.baseBoundingSphere.center,or)}getBoundingBoxObjectSpace(e=Object(f["h"])()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,or);const t=this.lodRenderer.baseBoundingBox;Object(f["k"])(e);for(let r=0;r<8;++r)Object(u["z"])(nr,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),Object(u["t"])(nr,nr,or),Object(f["r"])(e,nr);return e}computeAttachmentOrigin(e){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,or),e.render.origin[0]+=or[12],e.render.origin[1]+=or[13],e.render.origin[2]+=or[14],e.render.num++}async getProjectedBoundingBox(e,t,r,i,a){const s=this.getBoundingBoxObjectSpace(a),o=sr,c=Object(f["y"])(s)?1:o.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,or);for(let n=0;n<c;n++){const e=o[n];nr[0]=s[e[0]],nr[1]=s[e[1]],nr[2]=s[e[2]],Object(u["t"])(nr,nr,or),ir[3*n+0]=nr[0],ir[3*n+1]=nr[1],ir[3*n+2]=nr[2]}if(!e(ir,0,c))return null;Object(f["k"])(s);let l=null;this.calculateRelativeScreenBounds&&(l=this.calculateRelativeScreenBounds());for(let n=0;n<3*c;n+=3){for(let e=0;e<3;e++)s[e]=Math.min(s[e],ir[n+e]),s[e+3]=Math.max(s[e+3],ir[n+e]);l&&r.push({location:ir.slice(n,n+3),screenSpaceBoundingRect:l})}if(t&&(Object(f["e"])(s,ar),"absolute-height"!==this.elevationContext.mode)){let e;const r=Object(F["d"])(s,t);try{e=await t.service.queryElevation(ar[0],ar[1],i,r,"ground")}catch(d){}Object(n["l"])(e)&&Object(f["A"])(s,0,0,-this.alignedSampledElevation+e)}return s}addObjectState(e,t){if(0===e){const r=new tr["a"](e);this.addHighlightId(r),t.addExternal(e=>{this.removeHighlightId(e)},r)}}removeObjectState(e){this._highlights.forEach(t=>e.remove(t))}addHighlightId(e){this._highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}removeHighlightId(e){this._highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const ir=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],nr=Object(d["f"])(),ar=Object(d["f"])(),sr=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],or=Object(A["d"])();var cr=r("f33e");function lr(e){const t=[];return e.stageResources.geometries.forEach((r,i)=>{const n=e.stageResources.materials[i],a=e.stageResources.textures;t.push({material:n,geometry:r,textures:a})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function ur(e){return{levels:e.map(e=>lr(e))}}function dr(e,t=pr){const r=Object(cr["a"])(e);return Math.sqrt(r/(t*Math.PI))}function hr(e){e.levels.forEach(e=>{e.minScreenSpaceRadius||(e.minScreenSpaceRadius=dr(e))})}const pr=.05;var fr,br=r("94a6"),mr=r("9ac8"),gr=r("a803"),vr=r("2ebb"),yr=r("6a07"),Or=r("171c"),xr=r("fa1e"),jr=r("1153"),_r=r("ce6d"),Sr=r("680b"),wr=r("fc00");function Cr(e){let t=Object(wr["a"])().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t=t.u8("state").u8("lodLevel").alignTo(8),t}!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(fr||(fr={}));class Pr{constructor(e){this.localTransform=e.getField("localTransform",R["i"]),this.globalTransform=e.getField("globalTransform",R["i"]),this.modelOrigin=e.getField("modelOrigin",R["v"]),this.model=e.getField("model",R["f"]),this.modelNormal=e.getField("modelNormal",R["f"]),this.modelScaleFactors=e.getField("modelScaleFactors",R["m"]),this.boundingSphere=e.getField("boundingSphere",R["D"]),this.color=e.getField("color",R["C"]),this.featureAttribute=e.getField("featureAttribute",R["C"]),this.state=e.getField("state",R["l"]),this.lodLevel=e.getField("lodLevel",R["l"])}}class Tr extends _r["a"]{constructor(e,t){super(),this._capacity=0,this._size=0,this._next=0,this._layout=Cr(e),this._shaderTransformation=t}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this.grow();const e=this.findSlot();return this._view.state.set(e,fr.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e}removeInstance(e){const t=this._view.state;Object(jr["a"])(e>=0&&e<this._capacity&&t.get(e)&fr.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,fr.ACTIVE)?this.setStateFlags(e,fr.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})}freeInstance(e){const t=this._view.state;Object(jr["a"])(e>=0&&e<this._capacity&&t.get(e)&fr.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=Rr,i=Mr;t.localTransform.getMat(e,Dr),t.globalTransform.getMat(e,zr);const n=Object(E["n"])(zr,zr,Dr);Object(u["z"])(r,n[12],n[13],n[14]),t.modelOrigin.setVec(e,r),Object(P["f"])(i,n),t.model.setMat(e,i);const a=Object(Sr["k"])(Rr,n);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),Object(P["e"])(i,i),Object(P["o"])(i,i),t.modelNormal.setMat(e,i),this.setStateFlags(e,fr.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,Mr),r.modelOrigin.getVec(e,Rr),t[0]=Mr[0],t[1]=Mr[1],t[2]=Mr[2],t[3]=0,t[4]=Mr[3],t[5]=Mr[4],t[6]=Mr[5],t[7]=0,t[8]=Mr[6],t[9]=Mr[7],t[10]=Mr[8],t[11]=0,t[12]=Rr[0],t[13]=Rr[1],t[14]=Rr[2],t[15]=1}applyShaderTransformation(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(Rr,this,e);t*=Math.max(r[0],r[1],r[2])}return t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(Rr,this,e);r.sort(),t*=r[1]}return t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute.getVec(e,t)}setColor(e,t){this._view.color.setVec(e,t)}getColor(e,t){this._view.color.getVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,fr.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this.getStateFlag(e,fr.VISIBLE)}setHighlight(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,fr.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))}getHighlight(e){return this.getStateFlag(e,fr.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}setStateFlag(e,t,r){r?this.setStateFlags(e,t):this.clearStateFlags(e,t)}getStateFlag(e,t){return!!(this._view.state.get(e)&t)}grow(){const e=Math.max(Er,Math.floor(this._capacity*Ar)),t=this._layout.createBuffer(e);if(this._buffer){const e=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(e)}this._capacity=e,this._buffer=t,this._view=new Pr(this._buffer)}findSlot(){const e=this._view.state;let t=this._next;for(;e.get(t)&fr.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t}}const Er=1024,Ar=2,Rr=Object(d["f"])(),Mr=Object(T["b"])(),Dr=Object(A["d"])(),zr=Object(A["d"])();var Ir=r("f895"),Lr=r("0bde");class Fr extends Lr["a"]{constructor(e,t){super(e=>Object(Ir["n"])(this._instanceData.view.boundingSphere.getVec(e,this._tmpSphere)),{maximumDepth:25}),this._tmpSphere=Object(Ir["c"])(),this._tmpMat4=Object(A["d"])(),this._instanceData=e,this._boundingSphere=t}addInstance(e){const t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Object(u["t"])(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Object(Sr["i"])(r),t.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}}class Vr{constructor(e,t){this.thresholdScale=1,this._camera=new Or["a"],this._worldSpaceRadius=e,this._thresholds=t.map(e=>e)}updateCamera(e){this._camera.copyFrom(e)}selectLevel(e,t){const r=this._camera.computeScreenPixelSizeAt(e),i=this._worldSpaceRadius*t/r,n=this._thresholds;let a=-1;for(let s=0;s<n.length;++s)i>=n[s]*this.thresholdScale&&(a=s);return a}}var Ur=r("b061"),Gr=r("9250"),Nr=r("7ce4"),Br=r("0fa6");class kr{constructor(e,t){const r=e.renderContext.rctx,{geometry:i,material:n}=t;this._materialRepository=e.materialRep,n.setParameters({instancedDoublePrecision:!0});const a=n.createBufferWriter(),s=a.vertexBufferLayout,o=a.elementCount(i),c=a.allocate(o);a.write({},i,c,0),this.geometry=i,this.material=n,this.glMaterials=new Ur["a"](n,this._materialRepository),this.vertexBufferLayout=s,this.vbo=Nr["a"].createVertex(r,35044,c.buffer),this.vao=new Br["a"](r,xr["a"],{geometry:Object(vr["a"])(s)},{geometry:this.vbo}),this.vertexCount=o}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,t,r,i,n,a){const s=this.geometry.id;this.material.intersect(this.geometry,null,e.transform.transform,e,r,i,(r,i,o,c,l)=>{if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;const c={layerUid:a.layerUid,graphicUid:a.graphicUid(n),geometryId:s,triangleNr:o};if((null==e.results.min.drapedLayerOrder||l>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(6,c,r,i,e.transform.transform,l),0!==e.options.store&&(null==e.results.max.drapedLayerOrder||l>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(6,c,r,i,e.transform.transform,l),2===e.options.store){const t=Object(Gr["c"])(e.results.min.ray);t.set(6,c,r,i,e.transform.transform,l),e.results.all.push(t)}}})}}class Hr{constructor(e,t){this.minScreenSpaceRadius=e,this.components=t}static async create(e,t,r){const i=await Promise.allSettled(t.components.map(t=>e.schedule(()=>new kr(e,t),r))),n=i.map(e=>"fulfilled"===e.status?e.value:null).filter(e=>e);if(Object(a["n"])(r)||n.length!==i.length){n.forEach(e=>e.destroy()),Object(a["w"])(r);for(const e of i)if("rejected"===e.status)throw e.reason}return new Hr(t.minScreenSpaceRadius,n)}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,t,r,i,n,a){this.components.forEach(s=>s.intersect(e,t,r,i,n,a))}get boundingBox(){if(Object(n["k"])(this._boundingBox)){const e=Object(f["k"])();this.components.forEach(t=>{Object(n["l"])(t.boundingInfo)&&(Object(f["r"])(e,t.boundingInfo.bbMin),Object(f["r"])(e,t.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(Object(n["k"])(this._boundingSphere)){const e=this.boundingBox,t=Object(d["f"])();Object(f["e"])(e,t),this._boundingSphere={center:t,radius:.5*Object(f["j"])(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,t)=>e+t.triangleCount,0)}}class qr{constructor(e,t,r){this._elementSize=t,this._buffer=Nr["a"].createVertex(e,35044),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,t,r,i=0){const n=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this._elementSize,i=t*this._elementSize;this._buffer.setSubData(this._array,r,r,i)}resize(e){const t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setData(t),this._capacity=e}}class Wr{constructor(e){this.modelOriginHi=e.getField("modelOriginHi",R["u"]),this.modelOriginLo=e.getField("modelOriginLo",R["u"]),this.model=e.getField("model",R["f"]),this.modelNormal=e.getField("modelNormal",R["f"]),this.color=e.getField("instanceColor",R["C"]),this.featureAttribute=e.getField("instanceFeatureAttribute",R["C"])}}class $r{constructor(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Object(jr["a"])(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Object(jr["a"])(this._updating,"not updating"),this.size<Jr*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Object(jr["a"])(this._updating,"not updating"),this.isFull&&this.grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),Object(jr["a"])(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){Object(jr["a"])(this._updating,"not updating"),Object(jr["a"])(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)}grow(){const e=Math.max(Zr,Math.floor(this._capacity*Yr));this.resize(e)}shrink(){const e=Math.max(Zr,Math.floor(this._capacity*Xr));this.resize(e)}resize(e){if(Object(jr["a"])(this._updating,"not updating"),e===this._capacity)return;const t=new qr(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this.compactInstances(t);Object(jr["a"])(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Wr(this._instanceBufferLayout.createView(this._buffer.array))}compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}const Zr=1024,Yr=2,Jr=.3,Xr=.5;var Qr=r("7c51"),Kr=r("b623"),ei=r("8539");let ti=function(e){const t=e.baseBoundingSphere.radius,r=e.levels.map(e=>e.minScreenSpaceRadius);return new Vr(t,r)};class ri{constructor(e,t,r,i){this.type=6,this.isGround=!1,this._inverseViewport=Object(l["b"])(),this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Or["a"],this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.canRender=!0,this._symbol=e,this._optionalFields=t,this._metadata=r,this._instanceBufferLayout=Object(K["b"])({instancedDoublePrecision:!0,instanced:t}),this._glInstanceBufferLayout=Object(vr["a"])(this._instanceBufferLayout,1),this._instanceData=new Tr(this._optionalFields,i),this._instanceData.on("instance-added",()=>this.requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this.requestUpdateCycle()),this._instanceData.on("instance-transform-changed",e=>{this.requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(e.index)}),this._instanceData.on("instance-visibility-changed",e=>{this.requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(e.index)}),this._instanceData.on("instance-highlight-changed",()=>this.requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(t=>{const r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e}get renderStats(){const e=this._instanceData.size,t=[];return this._levels.forEach((e,r)=>{const i=this._defaultRenderInstanceData[r],n=this._highlightRenderInstanceData[r],a=i.size+n.size,s=e.triangleCount;t.push({renderedInstances:a,renderedTriangles:a*s,trianglesPerInstance:s})}),{totalInstances:e,renderedInstances:t.reduce((e,t)=>e+t.renderedInstances,0),renderedTriangles:t.reduce((e,t)=>e+t.renderedTriangles,0),levels:t}}async initializeRenderContext(e,t){this._context=e;const r=e.renderContext.rctx,i=await Promise.allSettled(this._symbol.levels.map(i=>(this._defaultRenderInstanceData.push(new $r(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new $r(r,this._instanceBufferLayout)),Hr.create(e,i,t)))),n=i.map(e=>"fulfilled"===e.status?e.value:null).filter(e=>e);if(Object(a["n"])(t)||n.length!==i.length){n.forEach(e=>e.destroy()),Object(a["w"])(t);for(const e of i)if("rejected"===e.status)throw e.reason}this._levels=n,this._levelSelector=ti(this)}uninitializeRenderContext(){this.invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData.forEach(e=>e.destroy()),this._highlightRenderInstanceData.forEach(e=>e.destroy())}get slots(){return[3,5]}get needsHighlight(){return this._highlightRenderInstanceData.reduce((e,t)=>e+t.size,0)>0}prepareRender(e,t){if(J["a"].LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const e=t.equals(this._lastCamera);this._lastCamera.copyFrom(t),e||this.requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(t,r),this.needsUpdates&&this._context.requestRender()}render(e){var t,r;const i=3===e.slot?2:5===e.slot?4:null;if(!i||!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return!1;const n=e.camera;this._inverseViewport[0]=1/n.fullViewport[2],this._inverseViewport[1]=1/n.fullViewport[3];const a={slot:i,origin:[0,0,0],camera:n,inverseViewport:this._inverseViewport,shadowMap:e.shadowMap,shadowMappingEnabled:e.shadowMap.enabled,ssaoHelper:e.ssaoHelper,ssaoEnabled:e.ssaoHelper.enabled,screenToWorldRatio:null,screenToPCSRatio:null,slicePlane:e.sliceHelper&&e.sliceHelper.plane,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:null!=(t=null==(r=e.offscreenRenderingHelper)?void 0:r.depthTexture)?t:null,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:A["a"],ssrEnabled:!1,lighting:e.scenelightingData,transparencyPassType:e.transparencyPassType,terrainLinearDepthTexture:e.multipassTerrainParams.terrainLinearDepthTexture,geometryLinearDepthTexture:e.multipassGeometryParams.geometryLinearDepthTexture,multipassTerrainEnabled:e.multipassTerrainParams.multipassTerrainEnabled,cullAboveGround:e.multipassTerrainParams.cullAboveGround,multipassGeometryEnabled:e.multipassGeometryParams.multipassGeometryEnabled,highlightColorTexture:null};e.rctx.bindVAO();const s=5!==e.pass&&7!==e.pass,o=6!==e.pass;return s&&this._renderComponents(e,i,a,this._defaultRenderInstanceData),o&&this._renderComponents(e,i,a,this._highlightRenderInstanceData),s||o}intersect(e,t,r,i){if(!this.baseMaterial.isVisible())return;const n=Object(d["f"])();Object(u["m"])(n,i,r);const a=n=>{this._instanceData.getCombinedModelTransform(n,oi),e.transform.set(oi),Object(u["t"])(ci,r,e.transform.inverse),Object(u["t"])(li,i,e.transform.inverse);const a=this._instanceData.getState(n),s=this._instanceData.getLodLevel(n);Object(jr["a"])(a&fr.ACTIVE,"invalid instance state"),Object(jr["a"])(s>=0&&s<this._levels.length,"invaid lod level"),this._levels[s].intersect(e,t,ci,li,n,this._metadata)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(a):this.octree.forEachAlongRay(r,n,a)}queryDepthRange(e){return this.queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this.invalidateOctree()}requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this.buildOctree()),this._octree}invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}buildOctree(){const e=new Fr(this._instanceData,this.baseBoundingSphere),t=this._instanceData,r=t.view?t.view.state:null;for(let i=0;i<this._instanceData.capacity;++i)r.get(i)&fr.ACTIVE&&e.addInstance(i);return e}queryDepthRangeOctree(e){const t=e.eye,r=e.viewForward,i=this.octree.findClosest(r,1,e.frustum),n=this.octree.findClosest(r,-1,e.frustum);if(null!=i&&null!=n){this._instanceData.view.boundingSphere.getVec(i,si),Object(u["m"])(si,si,t);const a=Object(u["k"])(si,r)-si[3];this._instanceData.view.boundingSphere.getVec(n,si),Object(u["m"])(si,si,t);const s=Object(u["k"])(si,r)+si[3];return{near:Math.max(e.near,a),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}}startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(e=>{e.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(e=>{e.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}updateInstances(e,t){const r=this._enableLevelSelection,i=this._levelSelector;i.updateCamera(e),this._defaultRenderInstanceData.forEach(e=>{e.beginUpdate()}),this._highlightRenderInstanceData.forEach(e=>{e.beginUpdate()});const n=this._instanceData,a=this._instanceData.view,s=n.size,o=n.capacity;let c=this._instanceIndex;t=Math.min(s,t);for(let l=0;l<t;++l){0===c&&this.startUpdateCycle();const e=a.state.get(c);let s=0;if(!(e&fr.ALLOCATED)){c=(c+1)%o,t++;continue}const l=a.lodLevel.get(c);if(e&fr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[l].freeTail(),e&fr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[l].freeTail(),e&fr.REMOVE)n.freeInstance(c);else if(e&fr.VISIBLE){let t=0;r&&(a.modelOrigin.getVec(c,ai),t=i.selectLevel(ai,n.getCombinedMedianScaleFactor(c))),s=e&~(fr.ACTIVE|fr.TRANSFORM_CHANGED),t>=0&&(e&fr.HIGHLIGHT?(ii(this._highlightRenderInstanceData[t],a,c),s|=fr.HIGHLIGHT_ACTIVE):(ii(this._defaultRenderInstanceData[t],a,c),s|=fr.DEFAULT_ACTIVE)),a.state.set(c,s),a.lodLevel.set(c,t)}else s=e&~(fr.ACTIVE|fr.TRANSFORM_CHANGED),a.state.set(c,s);if(this._octree){const t=!!(e&fr.ACTIVE),r=!!(s&fr.ACTIVE);!t&&r?this._octree.addInstance(c):t&&!r?this._octree.removeInstance(c):t&&r&&e&fr.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%o}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(e=>{e.endUpdate()}),this._highlightRenderInstanceData.forEach(e=>{e.endUpdate()})}_renderComponents(e,t,r,i){this.levels.forEach((n,a)=>{n.components.forEach(n=>{this._renderComponent(e,t,r,i[a],n,a)})})}_renderComponent(e,t,r,i,a,s){if(0===i.size||!a.material.requiresSlot(t))return;const{rctx:o,pass:c}=e,l=a.glMaterials.load(o,c);if(Object(n["k"])(l))return;const u=o.capabilities.instancing,d=l.beginSlot(r),h=d.program;d.bindPipelineState(o,t),o.useProgram(h),l.bind(r,d),o.bindVAO(a.vao),d.ensureAttributeLocations(a.vao),e.isHighlightPass&&Object(yr["b"])(h,r),d.bindDraw(r),J["a"].LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(h.setUniform4fv("externalColor",ui[Math.min(s,ui.length-1)]),h.setUniform1i("colorMixMode",Qr["b"].replace));const p=i.capacity,f=i.headIndex,b=i.tailIndex,m=i.firstIndex,g=this._glInstanceBufferLayout,v=(e,t)=>{Object(ei["a"])(o,xr["a"],i.buffer,g,e),u.drawArraysInstanced(d.primitiveType,0,a.vertexCount,t-e),Object(ei["d"])(o,xr["a"],i.buffer,g)};a.material.parameters.transparent&&null!=m?f>b?(Object(jr["a"])(m>=b&&m<=f,"invalid firstIndex"),v(m,f),v(b,m)):f<b&&(m<=f?(Object(jr["a"])(m>=0&&m<=f,"invalid firstIndex"),v(m,f),v(b,p),v(0,m)):(Object(jr["a"])(m>=b&&m<=p,"invalid firstIndex"),v(m,p),v(0,f),v(b,m))):f>b?v(b,f):f<b&&(v(0,f),v(b,p)),o.bindVAO(null)}}function ii(e,t,r){const i=e.allocateHead();ni(t,r,e.view,i)}function ni(e,t,r,i){Object(Kr["c"])(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}const ai=Object(d["f"])(),si=Object(Ce["e"])(),oi=Object(A["d"])(),ci=Object(d["f"])(),li=Object(d["f"])(),ui=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];class di extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[e,t,r]=Object(n["l"])(this._resources)?this._resources.symbolSize:[1,1,1];return{width:e,depth:t,height:r}}async doLoad(e){if(!this._drivenProperties.size&&Object(F["k"])(this.symbolLayer))throw new Error;const t=this.symbolLayer;if(this.isPrimitive){const r=t.resource?t.resource.primitive:Kt["b"];this._resources=await this._createResourcesForPrimitive(r,e)}else this._resources=await this._createResourcesForUrl(t.resource.href,e);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return Object(n["l"])(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Object(n["j"])(this._resources,"lodRenderer")}setMaterialTransparencyParams(e,t=Object(n["j"])(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return e.transparent=i,e.opacity=r,e.cullFace=i?0:2,e}async _createResourcesForPrimitive(e,t){if(!Object(mr["a"])(e))throw new Error("Unknown object symbol primitive: "+e);const r=this.symbolLayer,i=Object(f["h"])(Object(er["c"])(e)),a=Object(d["g"])(Object(f["F"])(i)),s=Object(d["g"])(Object(er["d"])(a,r)),o=Object(u["s"])(s),c=!1,l=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:d["a"],diffuse:d["a"],slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this.setMaterialTransparencyParams(h);const b=this.symbol;if("point-3d"===b.type&&b.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=b.verticalOffset;h.verticalOffset={screenLength:Object(_e["h"])(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Ce["a"];else{const e=Object(n["l"])(r.material)&&r.material.color,t=Object(n["l"])(e)?xe["a"].toUnitRGBA(e):Ce["a"];h.externalColor=t}this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions(i,s,a,n["q"])),this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new K["a"](h),g=Object(mr["b"])(e,m);if(!g)throw new Error("Unknown object symbol primitive: "+e);const v=Object(cr["d"])(g).map(e=>({opacity:1,transparent:e.parameters.transparent})),y=await this._createStageResources(g,p);return{lodResources:g,lodRenderer:await this._createLodRenderer(g,t),stageResources:y,symbolSize:s,extentPadding:o,isEsriSymbolResource:c,isWosr:l,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:i,resourceSize:a,dispose:n["q"],pivotOffset:n["q"]}}async _createResourcesForUrl(e,t){const r=["transformation"],i={materialParamsMixin:{instanced:r,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=at(this._context.renderer,this._fastVisualVariableConvertOptions(n["q"],n["q"],n["q"],n["q"])),this._fastUpdates.enabled?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const a=this.symbol;if("point-3d"===a.type&&a.verticalOffset){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=a.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:Object(_e["h"])(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0},i.materialParamsMixin.castShadows=!1}i.signal=t,i.usePBR=this._context.physicalBasedRenderingEnabled;const s=i.usePBR,o=await Object(br["fetch"])(e,i),c=o.isEsriSymbolResource,l=o.isWosr,h=o.remove,p=ur(o.lods);hr(p),p.levels.sort((e,t)=>e.minScreenSpaceRadius-t.minScreenSpaceRadius),p.levels[0].minScreenSpaceRadius=Math.min(2,p.levels[0].minScreenSpaceRadius);const b=this._context,m=this.symbolLayer.material,g=this._getExternalColorParameters(m),v=Object(n["j"])(this.symbolLayer,"material","color"),y=this._getCombinedOpacity(v,{hasIntrinsicColor:!0}),O=this.needsDrivenTransparentPass,x=Object(cr["d"])(p),j=Object(cr["d"])(p).map(e=>({opacity:e.parameters.opacity||1,transparent:e.parameters.transparent}));x.forEach(e=>{const t=e.parameters;e.setParameters(g);const r=t.opacity*y,i=r<1||O||t.transparent;e.setParameters({opacity:r,transparent:i}),b.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});const _=o.referenceBoundingBox,S=Object(d["g"])(Object(f["F"])(_)),w=Object(d["g"])(p.levels[0].pivotOffset),C=Object(d["g"])(Object(er["d"])(S,this.symbolLayer)),P=Object(u["s"])(C);st(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(_,C,S,w))&&x.forEach(e=>e.setParameters(this._fastUpdates.materialParameters));const T=await this._createStageResources(p,s);return{lodResources:p,lodRenderer:await this._createLodRenderer(p,t),stageResources:T,symbolSize:C,extentPadding:P,isEsriSymbolResource:c,isWosr:l,originalMaterialParameters:j,physicalBasedRenderingEnabled:s,resourceBoundingBox:_,resourceSize:S,dispose:h,pivotOffset:w}}async _createStageResources(e,t){const r=this._context.stage,i=Object(cr["d"])(e);t!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(i);const n=Object(cr["e"])(e);r.addMany(n),await r.load(n);const a=Object(cr["c"])(e);return r.addMany(a),{materials:i,textures:n,geometries:a}}async _createLodRenderer(e,t){const r=this._context.stage,i={layerUid:this._context.layer.uid,graphicUid:e=>this._instanceIndexToGraphicUid.get(e),notifyGraphicGeometryChanged:e=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(e)),notifyGraphicVisibilityChanged:e=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(e))},n=this._fastUpdates.enabled?{applyTransform:(e,t,r)=>{e.getFeatureAttribute(t,bi),Object(E["d"])(r,ut(this._fastUpdates.materialParameters,bi,r))},scaleFactor:(e,t,r)=>(t.getFeatureAttribute(r,bi),dt(e,this._fastUpdates.materialParameters,bi))}:null,a=new ri(e,this._optionalFields,i,n);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,await r.addRenderPlugin(a.slots,a,t),a}_getExternalColorParameters(e){const t={};return this._drivenProperties.color?t.externalColor=Ce["a"]:Object(n["l"])(e)&&Object(n["l"])(e.color)?t.externalColor=xe["a"].toUnitRGBA(e.color):(t.externalColor=Ce["a"],t.colorMixMode="ignore"),t}destroy(){if(super.destroy(),Object(n["l"])(this._resources)){const e=this._context.stage;e.removeRenderPlugin(this._resources.lodRenderer);const t=this._resources.stageResources;e.removeMany(t.materials),e.removeMany(t.textures),e.removeMany(t.geometries),Object(n["l"])(this._resources.dispose)&&this._resources.dispose(),this._resources=null}}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry))return null;const r=Object(Ve["d"])(t.geometry);if(Object(n["k"])(r))return this.logger.warn("unsupported geometry type for icon symbol: "+t.geometry.type),null;const i=this.setGraphicElevationContext(t,new I["a"]),a=e.renderingInfo;return this._createAs3DShape(t,r,a,i,t.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(Object(n["k"])(this._resources))return!0;const e=this._drivenProperties.opacity,t=!this.isPrimitive,r=this._resources.stageResources.materials,i=this._resources.originalMaterialParameters;for(let a=0;a<r.length;a++){const s=r[a],o=Object(n["j"])(this.symbolLayer,"material","color"),c=i[a],l=this._getCombinedOpacity(o,{hasIntrinsicColor:t})*c.opacity,u=l<1||e||c.transparent;s.setParameters({opacity:l,transparent:u}),this.isPrimitive&&s.setParameters({cullFace:u?0:2})}return!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,z["i"])}slicePlaneEnabledChanged(){if(Object(n["k"])(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(Object(n["k"])(this._resources))return!0;const{stageResources:e,isWosr:t}=this._resources;for(const r of e.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):t||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(e,t){if(Object(n["k"])(this._resources))return 0;const{stageResources:{materials:r},lodRenderer:i,resourceBoundingBox:a,symbolSize:s,resourceSize:o,pivotOffset:c}=this._resources;for(const n in e.diff){if("visualVariables"!==n)return 0;if(!st(this._fastUpdates,t,this._fastVisualVariableConvertOptions(a,s,o,c)))return 0;for(const e of r)e.setParameters(this._fastUpdates.materialParameters);i.notifyShaderTransformationChanged()}return 2}computeComplexity(){return Object(n["k"])(this._resources)?super.computeComplexity():{primitivesPerFeature:Object(cr["b"])(this._resources.lodResources.levels[0]).reduce((e,t)=>e+t.indices.get("position").length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Object(gr["d"])(this.symbol,this.symbolLayer)}}hasLodRenderer(){return Object(n["l"])(this._resources)}_createAs3DShape(e,t,r,i,a){if(!this.hasLodRenderer()||Object(n["k"])(this._resources))return null;const s=this.getFastUpdateAttrValues(e),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?Object(F["g"])(r.color,r.opacity):null,c=this._context.clippingExtent;if(Object(p["t"])(t,hi,this._context.elevationProvider.spatialReference),Object(n["l"])(c)&&!Object(f["g"])(c,hi))return null;const l=this._requiresTerrainElevation(i),u=this._computeGlobalTransform(t,i,fi,mi),d=this._computeLocalTransform(this._resources,this.symbolLayer,r,pi),h=this._resources.lodRenderer.instanceData,b=h.addInstance();this._instanceIndexToGraphicUid.set(b,a),h.setLocalTransform(b,d,!1),h.setGlobalTransform(b,u),s&&h.setFeatureAttribute(b,s),o&&h.setColor(b,o);const m=new rr(this,b,Me["a"],i);return l&&(m.alignedSampledElevation=mi.sampledElevation),m.needsElevationUpdates=Object(z["i"])(i.mode),Object(Ve["b"])(m,t,this._context.elevationProvider),m}_computeGlobalTransform(e,t,r,i){return Object(z["g"])(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,i),hi[0]=e.x,hi[1]=e.y,hi[2]=i.z,Object(p["d"])(e.spatialReference,hi,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,t,r,i){return Object(E["j"])(i),this._applyObjectRotation(r,!1,i),this._applyObjectRotation(t,!0,i),this._applyObjectScale(e,r,i),this._applyAnchor(e,t,i),i}_applyObjectScale(e,t,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,n=Object(F["c"])(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||Object(E["g"])(r,r,n)}prepareSymbolLayerPatch(e){if("partial"!==e.diff.type)return;const t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}updateGeometry(e,t){if(Object(n["k"])(this._resources))return!0;const r=t&&Object(Ve["d"])(t);if(Object(n["k"])(r))return!1;const i=this.getGeometryElevationMode(t);return e.elevationContext.mode===i&&(this._computeGlobalTransform(r,e.elevationContext,fi,mi),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=mi.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,fi,!0),Object(Ve["b"])(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,t){if(!(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition))return;if(Object(n["k"])(this._resources))return;const r=(e,t,r)=>Object(n["v"])(null!=e&&"complete"===e.type?e.newValue:t,r),i=r(t.heading,this.symbolLayer.heading,0),a=r(t.tilt,this.symbolLayer.tilt,0),s=r(t.roll,this.symbolLayer.roll,0),o=r(t.width,this.symbolLayer.width,void 0),c=r(t.height,this.symbolLayer.height,void 0),l=r(t.depth,this.symbolLayer.depth,void 0),u=r(t.anchor,this.symbolLayer.anchor,void 0),h=r(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;const p={heading:i,tilt:a,roll:s,anchor:u,anchorPosition:h},f=this._resources;1===this.loadStatus&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=Object(d["g"])(Object(er["d"])(f.resourceSize,{width:o,height:c,depth:l,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((e,t)=>{const r=this._computeLocalTransform(f,p,t,pi),i=e.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(i,r,!0)})}_preparePatchColor(e,t){if(!t.material||"partial"!==t.material.type)return;const r=t.material.diff;if(!r.color||"complete"!==r.color.type||null==r.color.newValue||null==r.color.oldValue)return;const i=r.color.newValue,a=Object(n["l"])(i)?xe["a"].toUnitRGBA(i):Ce["a"];delete r.color;const s=this._resources;Object(n["k"])(s)||e.graphics3DGraphicPatches.push(e=>{let t;this._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,a),t=this.setMaterialTransparencyParams({},i)):t=this.setMaterialTransparencyParams({externalColor:a},i);for(const r of s.stageResources.materials)r.setParameters(t)})}_requiresTerrainElevation(e){return"absolute-height"!==e.mode}_applyObjectRotation(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return Object(F["b"])(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,t,r){const i=Object(d["f"])();switch(r.anchor){case"center":Object(u["n"])(i,Object(f["e"])(e)),Object(u["v"])(i,i);break;case"top":{const t=Object(f["e"])(e);Object(u["z"])(i,-t[0],-t[1],-e[5]);break}case"bottom":{const t=Object(f["e"])(e);Object(u["z"])(i,-t[0],-t[1],-e[2]);break}case"relative":{const t=Object(f["e"])(e),n=Object(f["F"])(e),a=r.anchorPosition,s=a?Object(d["h"])(a.x,a.y,a.z):d["c"];Object(u["d"])(i,n,s),Object(u["i"])(i,i,t),Object(u["v"])(i,i);break}default:Object(n["l"])(t)?Object(u["v"])(i,t):Object(u["n"])(i,d["c"])}return i}_applyAnchor(e,t,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const i=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,t);i&&Object(E["b"])(r,r,i)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,t,r,i){const a=Object(n["l"])(e)?Object(d["g"])(Object(f["F"])(e)):d["a"],s=Object(n["l"])(e)?this._computeAnchor(e,i,this.symbolLayer):d["c"],o=this._context.renderCoordsHelper.unitInMeters,c=Object(F["c"])(Object(n["l"])(t)?t:void 0,t,r,o),l=Object(d["h"])(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:Object(n["l"])(t)?t:d["a"],unitInMeters:o,transformation:{anchor:s,scale:c,rotation:l}}}}const hi=Object(d["f"])(),pi=Object(A["d"])(),fi=Object(A["d"])(),bi=Object(Ce["e"])(),mi=new z["a"];var gi=r("4212");function vi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function yi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Oi(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function xi(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function ji(e,t){const r=t[0],i=t[1],n=t[2],a=t[3];let s=r*a-n*i;return s?(s=1/s,e[0]=a*s,e[1]=-i*s,e[2]=-n*s,e[3]=r*s,e):null}function _i(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function Si(e){return e[0]*e[3]-e[2]*e[1]}function wi(e,t,r){const i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],c=r[1],l=r[2],u=r[3];return e[0]=i*o+a*c,e[1]=n*o+s*c,e[2]=i*l+a*u,e[3]=n*l+s*u,e}function Ci(e,t,r){const i=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(r),c=Math.cos(r);return e[0]=i*c+a*o,e[1]=n*c+s*o,e[2]=i*-o+a*c,e[3]=n*-o+s*c,e}function Pi(e,t,r){const i=t[0],n=t[1],a=t[2],s=t[3],o=r[0],c=r[1];return e[0]=i*o,e[1]=n*o,e[2]=a*c,e[3]=s*c,e}function Ti(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function Ei(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Ai(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ri(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Mi(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function Di(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function zi(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Ii(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Li(e,t){const r=e[0],i=e[1],n=e[2],a=e[3],s=t[0],o=t[1],c=t[2],l=t[3];return Math.abs(r-s)<=gi["a"]*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=gi["a"]*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-c)<=gi["a"]*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=gi["a"]*Math.max(1,Math.abs(a),Math.abs(l))}function Fi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Vi(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}const Ui=wi,Gi=zi;Object.freeze({__proto__:null,copy:vi,identity:yi,set:Oi,transpose:xi,invert:ji,adjoint:_i,determinant:Si,multiply:wi,rotate:Ci,scale:Pi,fromRotation:Ti,fromScaling:Ei,str:Ai,frob:Ri,LDU:Mi,add:Di,subtract:zi,exactEquals:Ii,equals:Li,multiplyScalar:Fi,multiplyScalarAndAdd:Vi,mul:Ui,sub:Gi});var Ni=r("47f8");class Bi extends G["a"]{constructor(e,t,r,i,n,a){super(e,t),this.path=r,this.geometrySR=i,this.upVectorAlignment=n,this.stencilWidth=a}}function ki(e){return"upVectorAlignment"in e}function Hi(){return[1,0,0,1]}function qi(e){return[e[0],e[1],e[2],e[3]]}function Wi(e,t,r,i){return[e,t,r,i]}function $i(e,t){return new Float64Array(e,t,4)}Object.freeze({__proto__:null,create:Hi,clone:qi,fromValues:Wi,createView:$i});var Zi=r("7289"),Yi=r("d18f");function Ji(){return{up:Object(d["f"])(),right:Object(d["f"])()}}function Xi(e,t,r){Object(u["t"])(e.up,t.up,r),Object(u["t"])(e.right,t.right,r)}function Qi(e,t,r){Object(c["s"])(e,Object(u["k"])(r,t.right),Object(u["k"])(r,t.up))}class Ki{constructor(){this.pos=Object(d["f"])(),this.posES=Object(d["f"])(),this.posGS=Object(d["f"])(),this.vRight=Object(d["f"])(),this.vLeft=Object(d["f"])(),this.frame=Ji(),this.rotationFrame=Ji(),this.rotationRight=Object(l["b"])(),this.rotationAngle=0,this.miterStretch=Hi()}setFrameFromUpVector(e){Object(u["n"])(this.frame.up,e),Object(u["i"])(On,this.vLeft,this.vRight),Object(u["u"])(On,On),Object(u["h"])(yn,this.frame.up,Object(u["k"])(On,this.frame.up)),Object(u["m"])(_n,On,yn),Object(u["u"])(_n,_n),Object(u["j"])(this.frame.right,_n,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){Object(u["n"])(this.rotationFrame.up,this.frame.up),Object(u["n"])(this.rotationFrame.right,this.frame.right),Object(c["s"])(this.rotationRight,1,0),Object(u["h"])(yn,this.frame.up,Object(u["k"])(this.frame.up,this.vLeft)),Object(u["m"])(yn,this.vLeft,yn),Object(u["v"])(yn,yn),Object(u["u"])(yn,yn),Object(u["h"])(On,this.frame.up,Object(u["k"])(this.frame.up,this.vRight)),Object(u["m"])(On,this.vRight,On),Object(u["u"])(On,On),Object(u["j"])(xn,this.rotationFrame.up,this.vLeft);const e=Math.sign(Object(u["k"])(xn,this.vRight));if(this.rotationAngle=e*(Math.PI-Object(Ge["b"])(Object(u["k"])(yn,On))),Math.abs(this.rotationAngle)>0){const e=Object(Ge["q"])(Math.cos(.5*this.rotationAngle));Oi(this.miterStretch,e-1+1,0,0,1)}const t=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*t))}}class en{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(e,t){return this.vertices.push(Object(l["c"])(e)),this.vertexNormals.push(Object(l["c"])(t)),this.vertices.length-1}addUV(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1}addPole(e,t=null){return this.poles.push({position:Object(l["c"])(e),normal:t?Object(l["c"])(t):null}),this.poles.length-1}addSegment(e,t=null,r=null){this.vertexIndices.push(e.v0),this.vertexIndices.push(e.v1),t&&(this.uvIndices.push(t.v0),this.uvIndices.push(t.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(e,t){for(const r of this.vertices)r[0]+=e,r[1]+=t;for(const r of this.poles)r.position[0]+=e,r.position[1]+=t}static circle(e=20){const t=.5,r=new en,i={v0:0,v1:0};r.addPole(Object(l["f"])(0,0));for(let s=0;s<e;++s){const i=2*s*Math.PI/e,n=Math.cos(i),a=Math.sin(i),o=Object(l["f"])(n*t,a*t),c=Object(l["f"])(n,a);r.addVertex(o,c),r.addUV(s/e)}r.addUV(1);for(let s=0;s<e-1;++s){const e={v0:s,v1:s+1},t=e;r.addSegment(e,t,i)}const n={v0:e-1,v1:0},a={v0:e-1,v1:e};return r.addSegment(n,a,i),r}static rect(){const e=1,t=1,r=new en,i=Object(l["f"])(.5*-e,.5*-t),n=Object(l["f"])(.5*e,.5*-t),a=Object(l["f"])(.5*e,.5*t),s=Object(l["f"])(.5*-e,.5*t),o=Object(l["f"])(0,-1),c=Object(l["f"])(1,0),u=Object(l["f"])(0,1),d=Object(l["f"])(-1,0);r.addUV(0),r.addUV(1),r.addPole(Object(l["f"])(0,.5*t),u),r.addPole(Object(l["f"])(0,.5*t)),r.addPole(Object(l["f"])(0,.5*-t)),r.addPole(Object(l["f"])(0,.5*-t),o);const h={v0:0,v1:1};return r.addVertex(i,o),r.addVertex(n,o),r.addSegment({v0:0,v1:1},h,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(a,c),r.addSegment({v0:2,v1:3},h,{v0:2,v1:1}),r.addVertex(a,u),r.addVertex(s,u),r.addSegment({v0:4,v1:5},h,{v0:0,v1:0}),r.addVertex(s,d),r.addVertex(i,d),r.addSegment({v0:6,v1:7},h,{v0:1,v1:2}),r}}class tn{constructor(e){this.vertices=[],this.offset=Object(d["f"])(),this.xform=Object(A["d"])(),this.vertices=e;const t=Math.floor((e.length-1)/2);Object(u["n"])(this.offset,this.vertices[t].pos);for(const r of this.vertices)Object(u["m"])(r.pos,r.pos,this.offset);Object(E["b"])(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length;let t=this.vertices[0];t.index=0,Object(u["z"])(t.vLeft,0,0,0),t.vLeftLength=0,Object(u["m"])(t.vRight,this.vertices[1].pos,t.pos),t.vRightLength=Object(u["s"])(t.vRight),Object(u["u"])(t.vRight,t.vRight);let r=t;for(let i=1;i<e;++i)t=this.vertices[i],t.index=i,Object(u["n"])(t.vLeft,r.vRight),t.vLeftLength=r.vRightLength,i<e-1?(Object(u["m"])(t.vRight,this.vertices[i+1].pos,t.pos),t.vRightLength=Object(u["s"])(t.vRight),Object(u["u"])(t.vRight,t.vRight)):(Object(u["n"])(t.vRight,t.vLeft),t.vRightLength=t.vLeftLength),r=t}}function rn(e,t){let r=null;const i=e.vertices.length,n=.99619469809,a=Object(d["f"])(),s=Object(d["f"])(),o=Object(d["f"])(),c=Object(d["f"])(),l=Object(d["f"])(),h=Object(d["f"])(),p=Object(Zi["d"])();let f=e.vertices[0];Object(u["n"])(s,t),Object(u["z"])(a,0,1,0),ht["a"].makeOrthoBasisDirUpFallback(f.vRight,s,a,a,o,s,n),Object(u["n"])(f.frame.up,s),Object(u["n"])(f.frame.right,o),r=f;for(let d=1;d<i;++d){f=e.vertices[d],Object(u["i"])(l,f.vLeft,f.vRight);let t=Object(u["s"])(l);t>0?(t=1/Math.sqrt(t),l[0]=l[0]*t,l[1]=l[1]*t,l[2]=l[2]*t):(l[0]=f.vRight[0],l[1]=f.vRight[1],l[2]=f.vRight[2]),Object(u["i"])(h,r.pos,r.frame.up),Object(Zi["h"])(f.pos,l,p),Object(Zi["n"])(p,Object(Yi["h"])(h,f.vLeft),c)?(Object(u["m"])(c,c,f.pos),Object(u["u"])(s,c),Object(u["j"])(o,l,s),Object(u["u"])(o,o)):ht["a"].makeOrthoBasisDirUpFallback(l,r.frame.up,r.frame.right,a,o,s,n),Object(u["n"])(f.frame.up,s),Object(u["n"])(f.frame.right,o),r=f}}class nn{numProfilesPerJoin(){return 1}extrude(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],!1)}}class an{constructor(e=.8*Math.PI,t=1){this.cutoffAngle=e,this.numBendSubdivisions=t}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,t,r){const i=Sn;if(Math.abs(e.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Object(E["j"])(wn),Object(E["f"])(wn,wn,.5*-e.rotationAngle+n*e.rotationAngle/this.numBendSubdivisions,e.rotationFrame.up),Xi(i,e.frame,wn);for(let n=0;n<t.vertices.length;++n)Object(c["k"])(t.vertices[n],e.rotationRight)*e.rotationAngle>=0?r(e.index,i,t.vertices[n],t.vertexNormals[n],!1):(Object(c["p"])(mn,t.vertices[n],e.miterStretch),r(e.index,e.frame,mn,t.vertexNormals[n],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let i=0;i<t.vertices.length;++i){const n=Object(c["k"])(t.vertices[i],e.rotationRight)*e.rotationAngle>=0;Object(c["p"])(mn,t.vertices[i],e.miterStretch),r(e.index,e.frame,mn,t.vertexNormals[i],!n)}}}const sn={generateUV:!1};class on{rebuildConnectingProfileGeometry(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],0,0)}}class cn extends on{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class ln extends on{constructor(e,t=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=t,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,t,r){for(let i=0;i<t.vertices.length;++i)r(e.index,e.frame,t.vertices[i],t.vertexNormals[i],this.profilePlaneOffset,0)}rebuildCapGeometry(e,t){const r=gn;Object(c["s"])(r,0,0);const i=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)t(e.index,e.frame,this.profile.vertices[n],r,this.profilePlaneOffset,i)}buildTopology(e,t){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let i=1;i<this.profile.numSegments;++i){const e=this.profile.vertexIndices[2*i+0],n=this.profile.vertexIndices[2*i+1],a=this.vertexBufferStart+e,s=this.vertexBufferStart+n;this.flip?t(s,a,r):t(r,a,s)}}}class un extends on{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}getNumVertices(){let e=0;return e=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(e+=this.profile.vertices.length),e+=this.profile.poles.length,e}getNumIndices(){let e=0;e+=2*this.profile.numSegments*(this.numSegments-1);for(let t=0;t<this.profile.numSegments;++t){const r=this.profile.vertexIndices[2*t+0],i=this.profile.vertexIndices[2*t+1];this.profile.poleIndices[r]===this.profile.poleIndices[i]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,t){const r=e.frame,i=.5*this.sign,n=mn,a=gn;Object(c["s"])(a,0,0);for(let s=0;s<this.profile.poles.length;++s){const n=this.profile.poles[s];n.normal?t(e.index,r,n.position,n.normal,i,0):t(e.index,r,n.position,a,i,this.sign)}if(this.breakNormals)for(let s=0;s<this.profile.vertices.length;++s)t(e.index,r,this.profile.vertices[s],this.profile.vertexNormals[s],0,0);for(let s=0;s<this.numSegments-1;++s){const o=(1-(s+1)/this.numSegments)*Math.PI*.5,l=Math.sin(o),u=Math.cos(o);for(let s=0;s<this.profile.vertices.length;++s){const o=this.profile.poles[this.profile.poleIndices[s]];Object(c["f"])(n,this.profile.vertices[s],o.position),Object(c["g"])(n,n,l),o.normal?(Object(c["m"])(n,n,o.position),t(e.index,r,n,o.normal,i*u,0)):(Object(c["i"])(a,n),Object(c["g"])(a,a,l),Object(c["m"])(n,n,o.position),t(e.index,r,n,a,i*u,this.sign*u))}}}buildTopology(e,t){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const e=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],s=this.vertexBufferStart+this.profile.poleIndices[e],o=this.vertexBufferStart+this.profile.poleIndices[a];let c=r+e,l=r+a;for(let r=0;r<this.numSegments-1;++r){const n=i+r*this.profile.vertices.length+e,s=i+r*this.profile.vertices.length+a;this.flip?(t(n,l,c),t(l,n,s)):(t(c,l,n),t(s,n,l)),c=n,l=s}this.flip?(t(s,l,c),s!==o&&t(s,o,l)):(t(c,l,s),s!==o&&t(l,o,s))}}}class dn{constructor(e,t,r,i,n,a=sn){this.options=a,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=t,this.path=e,this.extruder=r,this.startCap=i,this.endCap=n;const s=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*s+2,this.numVerticesTotal=t.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const o=this.startCap.getNumVertices();this.numVerticesTotal+=o,this.numNormalsTotal+=o,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this.rebuildGeometry(),this.buildTopology()}emitVertex(e,t,r,i,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,n){const t=this.path.vertices[e];this.profileRightAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[0]*t.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=t.rotationRight[1]*t.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(e,t,r,i,n,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=t.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=t.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=t.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=t.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=t.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=t.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=i[1],this.pathVertexData[this._extrusionVertexCount]=e,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}emitTriangle(e,t,r){this.vertexIndices[3*this._triangleCount+0]=e,this.vertexIndices[3*this._triangleCount+1]=t,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[e],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=e,this.normalIndices[3*this._triangleCount+1]=t,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}rebuildGeometry(){const e=(e,t,r,i,n)=>this.emitVertex(e,t,r,i,n),t=(e,t,r,i,n,a)=>this.emitCapVertex(e,t,r,i,n,a);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,t);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,e);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,t),this.startCap.rebuildCapGeometry(this.path.vertices[0],t),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],t),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const e=(e,t,r)=>this.emitTriangle(e,t,r);this._triangleCount=0;const t=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=r*i*2*3;this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let a=0;a<r;++a){const r=this.profile.vertexIndices[2*a],n=this.profile.vertexIndices[2*a+1];for(let a=0;a<i;++a){const i=a*t+r,s=(a+1)*t+n,o=a*t+n;e(i,(a+1)*t+r,s),e(i,s,o)}}this.startCap.buildTopology(this.path.vertices[0],e),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],e)}onPathChanged(){this.rebuildGeometry()}}class hn{constructor(e){this.builder=e}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class pn extends hn{constructor(e){super(e),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;for(let t=0;t<this.builder.numVerticesTotal;++t){let r=this.builder.pathVertexData[t];const i=0===r||r===this.builder.path.vertices.length-1;r*=3;const n=bn;Object(u["z"])(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const a=4*t,s=yn,o=mn,l=On,d=xn,h=jn;let p=0,f=0;if(Object(u["z"])(d,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),Object(u["z"])(h,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),Object(c["s"])(o,this.builder.profileVertexAndNormalData[a]*e[0],this.builder.profileVertexAndNormalData[a+1]*e[1]),i)Object(u["j"])(l,h,d),p=this.builder.profileRightAxisData[a+3]*e[0],f=this.builder.profileUpAxisData[a+3];else{const e=gn,t=vn;Object(c["s"])(e,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);const r=Object(c["l"])(e);Object(c["i"])(e,e);const i=Object(c["k"])(o,e);if(Math.abs(i)>r){Object(c["s"])(t,-e[1],e[0]);const n=Object(c["k"])(o,t);Object(c["g"])(e,e,r*Math.sign(i)),Object(c["g"])(t,t,n),Object(c["m"])(o,e,t)}Object(u["z"])(l,0,0,0)}Object(u["z"])(s,d[0]*o[0]+h[0]*o[1],d[1]*o[0]+h[1]*o[1],d[2]*o[0]+h[2]*o[1]),this.vertexAttributePosition[3*t+0]=n[0]+s[0]+l[0]*p,this.vertexAttributePosition[3*t+1]=n[1]+s[1]+l[1]*p,this.vertexAttributePosition[3*t+2]=n[2]+s[2]+l[2]*p;const b=mn;Object(c["s"])(b,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*t+0]=d[0]*b[0]+h[0]*b[1]+l[0]*f,this.vertexAttributeNormal[3*t+1]=d[1]*b[0]+h[1]*b[1]+l[1]*f,this.vertexAttributeNormal[3*t+2]=d[2]*b[0]+h[2]*b[1]+l[2]*f}}createGeometryData(){const e=[["position",this.builder.vertexIndices],["normal",this.builder.normalIndices]],t=[["position",{size:3,data:this.vertexAttributePosition,exclusive:!0}],["normal",{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;e.push(["color",new Uint32Array(r)]),t.push(["color",{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:t,indices:e}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(e,t,r){const i=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},a=i.length/3;Object(Qr["j"])(e,t,0,a,i,n,void 0,void 0,r)}}class fn extends hn{constructor(e,t,r,i){super(e),this.sizeAttributeValue=t,this.colorAttributeValue=r,this.opacityAttributeValue=i,this.vvData=null,this.baked=new pn(e),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=t,this.vvData[4*n+1]=r,this.vvData[4*n+2]=i;const e=0===n||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=e?1:0}}createGeometryData(){return{vertexAttributes:[["position",{size:3,data:this.builder.originData,exclusive:!0}],["profileRight",{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],["profileUp",{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],["profileVertexAndNormal",{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],["featureValue",{size:4,data:this.vvData,exclusive:!0}]],indices:[["position",this.builder.pathVertexIndices],["profileRight",this.builder.vertexIndices],["profileUp",this.builder.vertexIndices],["profileVertexAndNormal",this.builder.vertexIndices],["featureValue",this.builder.pathVertexIndices]]}}}const bn=Object(d["f"])(),mn=Object(l["b"])(),gn=Object(l["b"])(),vn=Object(l["b"])(),yn=Object(d["f"])(),On=Object(d["f"])(),xn=Object(d["f"])(),jn=Object(d["f"])(),_n=Object(d["f"])(),Sn=Ji(),wn=Object(A["d"])();var Cn=r("d7f7"),Pn=r("35b3"),Tn=r("a4ee"),En=r("d272"),An=r("b49d"),Rn=r("7d11"),Mn=r("c6d7"),Dn=r("d017"),zn=r("8e97"),In=r("c3a4"),Ln=r("ca98"),Fn=r("da35"),Vn=r("7438"),Un=r("c829"),Gn=r("87b7"),Nn=r("af20"),Bn=r("189c");const kn=new Map([["position",0],["profileRight",1],["profileUp",2],["profileVertexAndNormal",3],["featureValue",4]]);class Hn extends Ln["a"]{initializeProgram(e){const t=Hn.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:r.receiveSSAO,doubleSidedMode:r.doubleSidedMode,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new Un["a"](e.rctx,i,kn)}bindPass(e,t){var r,i;Object(zn["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform3fv("size",e.size),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Mn["a"])(this.program,t)),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",e.opacity),0===this.configuration.output?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform3fv("specular",e.specular),this.program.setUniform1f("opacity",e.opacity)):1!==this.configuration.output&&3!==this.configuration.output||Object(zn["b"])(this.program,t.camera.nearFar),Object(An["b"])(this.program,e),null==(r=t.shadowMap)||r.bind(this.program),null==(i=t.ssaoHelper)||i.bind(this.program,t.camera)}bindDraw(e){Object(zn["d"])(this.program,e),Object(En["c"])(this.program,this.configuration,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(zn["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(Dn["c"])(this.program,e),2===this.configuration.output&&Rn["a"].bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)}setPipelineState(e){const t=this.configuration,r=3===e,i=2===e,n=e=>!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode);return Object(Bn["g"])({blending:0!==t.output&&7!==t.output||!t.transparent?null:r?Vn["g"]:Object(Vn["a"])(e),culling:n(t)&&Bn["f"],depthTest:{func:Object(Vn["b"])(e)},depthWrite:r||i?Bn["e"]:null,colorWrite:Bn["d"],stencilWrite:t.sceneHasOcludees?Gn["j"]:null,stencilTest:t.sceneHasOcludees?Gn["e"]:null,polygonOffset:r||i?null:Vn["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}Hn.shader=new In["a"](Nn["a"],()=>r.e("chunk-2d0c7e33").then(r.bind(null,"5310")));class qn extends Fn["a"]{constructor(){super(...arguments),this.output=0,this.doubleSidedMode=0,this.receiveShadows=!1,this.receiveSSAO=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(Tn["a"])([Object(Fn["b"])({count:8})],qn.prototype,"output",void 0),Object(Tn["a"])([Object(Fn["b"])({count:3})],qn.prototype,"doubleSidedMode",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"receiveShadows",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"receiveSSAO",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"vvSize",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"vvColor",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"vvOpacity",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"slicePlaneEnabled",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"transparent",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"sceneHasOcludees",void 0),Object(Tn["a"])([Object(Fn["b"])({count:4})],qn.prototype,"transparencyPassType",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"multipassTerrainEnabled",void 0),Object(Tn["a"])([Object(Fn["b"])()],qn.prototype,"cullAboveGround",void 0);var Wn=r("b4c8"),$n=r("5957");const Zn=jr["a"];class Yn extends Pn["a"]{constructor(e){super(e,Xn),this.supportsEdges=!0,this._vertexAttributeLocations=kn,this.techniqueConfig=new qn,this.vertexBufferLayout=Yn.getVertexBufferLayout(this.parameters)}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,0!==e&&7!==e||(this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?1:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows,this.techniqueConfig.receiveSSAO=!!t.ssaoEnabled&&this.parameters.receiveSSAO),this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.parameters.castShadows}isVisible(){const e=this.parameters;return!!super.isVisible()&&e.opacity>0}intersect(e,t,r,i,a,s,o){const c=e;if(!ki(c))return;const l=c.path,u=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const e=this.parameters.vvSizeOffset,t=this.parameters.vvSizeFactor,r=this.parameters.vvSizeMinSize,i=this.parameters.vvSizeMaxSize,n=l.sizeAttributeValue;u[0]*=Object(Ge["f"])(e[0]+n*t[0],r[0],i[0]),u[1]*=Object(Ge["f"])(e[2]+n*t[2],r[2],i[2])}const d=Math.max(u[0],u[1]),h=e.boundingInfo;if(Object(n["k"])(h))return void this._intersectTriangles(l,u,a,s,o);const p=Object(f["t"])(h.bbMin[0]-d,h.bbMin[1]-d,h.bbMin[2]-d,h.bbMax[0]+d,h.bbMax[1]+d,h.bbMax[2]+d),b=[s[0]-a[0],s[1]-a[1],s[2]-a[2]],m=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),g=[m/b[0],m/b[1],m/b[2]];Object(Qr["f"])(p,a,g,i.tolerance)&&this._intersectTriangles(l,u,a,s,o)}_intersectTriangles(e,t,r,i,n){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,i,n)}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=r.get("position");return Object(Gt["a"])(i,null,!1,t)}createBufferWriter(){return new Qn(this.vertexBufferLayout)}requiresSlot(e){return e===(this.parameters.transparent?4:2)||20===e}createGLMaterial(e){return 0===e.output||7===e.output||1===e.output||2===e.output||4===e.output||3===e.output&&this.parameters.castShadows?new Jn(e):null}static getVertexBufferLayout(e){let t=Object(wr["a"])().vec3f("position").vec4f("profileRight").vec4f("profileUp").vec4f("profileVertexAndNormal");return(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f("featureValue")),t}}class Jn extends Cn["a"]{updateParameters(e){return this.ensureTechnique(Hn,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}_updateShadowState(e){(Object(n["k"])(this.technique)||e.shadowMappingEnabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}beginSlot(e){return 0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const Xn={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...Wn["a"].Default,...Pn["b"]};class Qn{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){const n=e=>{if(t.vertexAttributes.has(e)){const n=t.vertexAttributes.get(e),a=t.indices.get(e);Zn(4===n.size);const s=r.getField(e,R["C"]);if(!s)throw new Error("unable to acquire view for "+e);Object($n["a"])(a,n.data,s,i)}};n("profileRight"),n("profileUp"),n("profileVertexAndNormal"),this.vertexBufferLayout.hasField("featureValue")&&n("featureValue"),Object($n["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}const Kn=["polyline"];class ea extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._intrinsicSize=Object(l["f"])(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const e=Object(n["l"])(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,t=Object(n["l"])(this.symbolLayer.height)?this.symbolLayer.height:e;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[e,1,t],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=at(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path","heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");const i=this.symbolLayer.profile||"circle";switch(i){case"circle":default:this._profile=en.circle(pa);break;case"quad":this._profile=en.rect()}let a=[0,0];switch("center"!==r&&(a={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(a[0],a[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new an(0,da);break;case"bevel":this._extruder=new an(0,1);break;case"miter":this._extruder=new an(.8*Math.PI,1);break;default:this._extruder=new nn}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new cn,this._endCap=new cn;break;case"butt":default:this._startCap=new ln(this._profile,0),this._endCap=new ln(this._profile,0,!0);break;case"square":this._startCap=new ln(this._profile,-.5),this._endCap=new ln(this._profile,.5,!0);break;case"round":{const e="quad"===i;this._startCap=new un({profile:this._profile,flip:!1,breakNormals:e,subdivisions:ha}),this._endCap=new un({profile:this._profile,flip:!0,breakNormals:e,subdivisions:ha});break}}const o=Object(n["j"])(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(o),u=Object(d["g"])(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:u,ambient:u,opacity:h,transparent:p,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||"none"===s?0:2,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Object(c["s"])(this._intrinsicSize,e,t),!Object(F["f"])(this._intrinsicSize[0])||!Object(F["f"])(this._intrinsicSize[1])))throw new w["a"]("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Object(c["g"])(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(Object.assign(f,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new Yn(f)):(f.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new K["a"](f)),this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,Kn,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new I["a"]),i=e.renderingInfo;return this._createAs3DShape(t,i,r,t.uid)}layerOpacityChanged(){const e=Object(n["j"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacity(e),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:t,transparent:r}),!0}layerElevationInfoChanged(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,z["i"])}slicePlaneEnabledChanged(){return this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(e,t){for(const r in e.diff){if("visualVariables"!==r)return 0;if(!st(this._fastUpdates,t,this._vvConvertOptions))return 0;this._material.setParameters(this._fastUpdates.materialParameters)}return 2}getVertexData(e){let t=0;const r=e.paths,i=[],n=e.spatialReference,a=this._context.elevationProvider.spatialReference,s=this._context.renderCoordsHelper.spatialReference;for(const h of r)t+=h.length;const o=new Float64Array(3*t),c=new Float64Array(3*t),l=new Float64Array(3*t);let u=0;for(const h of r){i.push({index:u,numVertices:h.length});for(const t of h)o[u++]=t[0],o[u++]=t[1],o[u++]=e.hasZ?t[2]:0}let d=!0;return n.equals(a)?this._copyVertices(o,0,c,0,t):d=Object(p["p"])(o,n,0,c,a,0,t),a.equals(s)?this._copyVertices(c,0,l,0,t):Object(p["p"])(c,a,0,l,s,0,t),{pathVertexDataInfos:i,vertexDataGS:o,vertexDataES:c,vertexDataRS:l,projectionSuccess:d,terrainElevation:0}}_copyVertices(e,t,r,i,n){t*=3,i*=3;for(let a=0;a<n;++a)r[i++]=e[t++],r[i++]=e[t++],r[i++]=e[t++]}_createAs3DShape(e,t,r,i){const a=e.geometry,s=new Array,o=new Array,c=new Array,l=a.spatialReference,d=Object(f["h"])(),h=this._context.renderCoordsHelper;sa.spatialReference=l;const p=this.getVertexData(a);if(!p.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(p.pathVertexDataInfos.length>0){for(let i=0;i<p.pathVertexDataInfos.length;++i){const a=p.pathVertexDataInfos[i],b=a.index,m=a.numVertices;if(m<2)continue;if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(d),Object(f["n"])(d,p.vertexDataES,3*b,m),!Object(f["x"])(d,this._context.clippingExtent)))continue;const g=[];for(let e=b;e<b+3*m;){const t=e++,i=e++,n=e++,a=new Ki;Object(u["z"])(a.posGS,p.vertexDataGS[t],p.vertexDataGS[i],p.vertexDataGS[n]),Object(u["z"])(a.posES,p.vertexDataES[t],p.vertexDataES[i],p.vertexDataES[n]);const s=Object(z["f"])(a.posES,this._context.elevationProvider,r,h);Object(u["z"])(oa,p.vertexDataRS[t],p.vertexDataRS[i],p.vertexDataRS[n]),h.setAltitude(oa,s),Object(u["z"])(a.pos,oa[0],oa[1],oa[2]),g.push(a)}const v=new tn(g);ta(v,this.upVectorAlignment,this._context.renderCoordsHelper);const y=new dn(v,this._profile,this._extruder,this._startCap,this._endCap);let O=null;if(this._fastUpdates.enabled){const t=this._fastUpdates.visualVariables,r=t.size?Object(L["b"])(t.size.field,e):0,i=t.color?Object(L["b"])(t.color.field,e):0,n=t.opacity?Object(L["b"])(t.opacity.field,e):0;O=new fn(y,r,i,n)}else{const e=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(e[0]*=ra(t.size[0],"symbol-value"===t.size[2]?this.symbolLayer.height||0:t.size[2],this.symbolLayer.width||0),e[1]*=ra(t.size[2],"symbol-value"===t.size[0]?this.symbolLayer.width||0:t.size[0],this.symbolLayer.height||0));let r=null;this._drivenProperties.color&&(r=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(r=r?[r[0],r[1],r[2],t.opacity]:[1,1,1,t.opacity]);const i=new pn(y);i.bake(e),r&&i.bakeVertexColors(r),O=i}const{vertexAttributes:x,indices:j}=O.createGeometryData(),_=new Bi(x,j,O,l,this.upVectorAlignment,this.stencilWidth);s.push(_),o.push(this._material),c.push(O.xform)}if(s.length>0){const e={layerUid:this._context.layer.uid,graphicUid:i},t=new Q["a"]({geometries:s,materials:o,transformations:c,metadata:e}),n=new _["a"](this,t,s,null,null,na,r);return n.alignedSampledElevation=p.terrainElevation,n.needsElevationUpdates=Object(z["i"])(r.mode),n}}else 0!==a.paths.length&&a.paths.some(e=>e.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function ta(e,t,r){switch(t){case"world":for(const t of e.vertices)Object(u["i"])(ca,t.pos,e.offset),r.worldUpAtPosition(ca,oa),t.setFrameFromUpVector(oa),t.computeRotationAxisAndAngleFromUpVector();break;case"path":Object(u["i"])(ca,e.vertices[0].pos,e.offset),r.worldUpAtPosition(ca,oa),rn(e,oa);for(const t of e.vertices){const e=Math.sign(Object(u["k"])(t.frame.right,t.vRight));Object(u["j"])(t.rotationFrame.up,t.vRight,t.vLeft),Object(u["h"])(t.rotationFrame.up,t.rotationFrame.up,e),Object(u["u"])(t.rotationFrame.up,t.rotationFrame.up);const r=Object(u["k"])(t.rotationFrame.up,t.frame.up),i=Object(u["k"])(t.rotationFrame.up,t.frame.right);if(Object(u["h"])(ca,t.frame.up,-i),Object(u["h"])(la,t.frame.right,r),Object(u["i"])(ca,ca,la),Object(u["u"])(t.rotationFrame.right,ca),Qi(t.rotationRight,t.frame,t.rotationFrame.right),Object(u["v"])(ca,t.vLeft),t.rotationAngle=-e*(Math.PI-Object(Ge["b"])(Object(u["k"])(ca,t.vRight))),Math.abs(t.rotationAngle)>0){const e=Object(Ge["q"])(Math.cos(.5*t.rotationAngle));Oi(t.miterStretch,1+(e-1)*t.rotationRight[0]*t.rotationRight[0],(e-1)*t.rotationRight[0]*t.rotationRight[1],(e-1)*t.rotationRight[0]*t.rotationRight[1],1+(e-1)*t.rotationRight[1]*t.rotationRight[1])}const n=Math.PI-t.rotationAngle;t.maxStretchDistance=Math.abs(Math.min(t.vLeftLength,t.vRightLength)*Object(Ge["q"])(Math.cos(.5*n)))}}}function ra(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function ia(e,t,r,i){let n=0;for(const a of e.vertices)Object(z["g"])(a.posES,r,t,i,ua),n+=ua.sampledElevation,Object(u["i"])(oa,a.pos,e.offset),i.setAltitude(oa,ua.z),Object(u["m"])(a.pos,oa,e.offset);return e.updatePathVertexInformation(),n/e.vertices.length}function na(e,t,r,i){const n=e.stageObject,a=n.geometryRecords;let s=0;aa.spatialReference=i.spatialReference;for(const o of a){const e=o.geometry;if(!ki(e))continue;const a=e.path,c=a.builder.path,l=e.geometrySR;sa.spatialReference=l,s+=ia(c,t,r,i),"world"!==e.upVectorAlignment&&ta(c,e.upVectorAlignment,i),a.onPathChanged(),e.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o)}return s/a.length}const aa=Object(m["j"])(0,0,0,null),sa=Object(m["j"])(0,0,0,null),oa=Object(d["f"])(),ca=Object(Ni["c"])(),la=Object(Ni["c"])(),ua=new z["a"],da=3,ha=3,pa=10;var fa=r("f694");function ba(e,t,r,i,n=1){if(r.isGeographic&&2!==i){const e=new Float64Array(t.typedBuffer.length),i=3*t.count,n=Object(fa["e"])(r);for(let r=0;r<i;r+=3)Object(p["l"])(t.typedBuffer,r,e,r,n);t=R["v"].fromTypedArray(e)}Object(c["s"])(_a,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.count;o++)t.getVec(o,va),_a[0]=Math.min(_a[0],va[0]),_a[1]=Math.min(_a[1],va[1]);const a=_a[0]%n,s=_a[1]%n;wa[0]=_a[0]-a,wa[1]=_a[1]-s;for(let o=0;o<t.count;o++)t.getVec(o,va),e.setValues(o,(va[0]-wa[0])/n,(va[1]-wa[1])/n,wa[0]/n,wa[1]/n)}function ma(e,t,r,i,n=1){Object(u["z"])(Oa,1,0,0),Object(u["z"])(xa,0,1,0),Object(u["z"])(ja,0,0,1),Ia(ga,t),Ea(t,ya)&&Aa(ya,Oa,xa,ja,r,ga),Object(c["s"])(_a,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Object(c["s"])(Sa,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let c=0;c<t.count;c++){t.getVec(c,va);const e=Object(u["k"])(Oa,va),r=Object(u["k"])(xa,va);_a[0]=Math.min(_a[0],e),_a[1]=Math.min(_a[1],r),Sa[0]=Math.max(Sa[0],e),Sa[1]=Math.max(Sa[1],r)}const a=Object(u["k"])(ja,ga);Fa(Ca,_a[0],_a[1],a,Oa,xa,ja),Fa(Pa,Sa[0],_a[1],a,Oa,xa,ja),Fa(Ta,_a[0],Sa[1],a,Oa,xa,ja),Object(u["m"])(Pa,Pa,Ca),Object(u["h"])(Pa,Pa,.5),Object(u["m"])(Ta,Ta,Ca),Object(u["h"])(Ta,Ta,.5),Object(u["i"])(Ca,Ca,Pa),Object(u["i"])(Ca,Ca,Ta);const s=_a[0]%n,o=_a[1]%n;wa[0]=_a[0]-s,wa[1]=_a[1]-o;for(let c=0;c<t.count;c++){t.getVec(c,va),e.setValues(c,(Object(u["k"])(Oa,va)-wa[0])/n,(Object(u["k"])(xa,va)-wa[1])/n,wa[0]/n,wa[1]/n);for(let e=0;e<3;e++)i.set(c,e,Ca[e]),i.set(c,e+3,Pa[e]),i.set(c,e+6,Ta[e])}}const ga=Object(d["f"])(),va=Object(d["f"])(),ya=Object(Zi["d"])(),Oa=Object(d["f"])(),xa=Object(d["f"])(),ja=Object(d["f"])(),_a=Object(l["b"])(),Sa=Object(l["b"])(),wa=Object(l["b"])(),Ca=Object(d["f"])(),Pa=Object(d["f"])(),Ta=Object(d["f"])();function Ea(e,t){const r=e.count-1;return Object(Zi["e"])(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function Aa(e,t,r,i,a,s){Object(n["l"])(a)?(a.basisMatrixAtPosition(s,Ra),Object(u["z"])(Ma,Ra[0],Ra[1],Ra[2]),Object(u["z"])(Da,Ra[4],Ra[5],Ra[6]),Object(u["z"])(za,Ra[8],Ra[9],Ra[10])):(Object(u["z"])(Ma,1,0,0),Object(u["z"])(Da,0,1,0),Object(u["z"])(za,0,0,1));const o=Object(Zi["r"])(e);Object(u["k"])(o,za)<0&&Object(u["h"])(o,o,-1),Object(u["n"])(i,o);const c=Object(u["k"])(o,Da),l=Object(u["k"])(o,Ma);Math.abs(c)<Math.abs(l)?(Object(u["f"])(t,Ma,o,-l),Object(u["u"])(t,t),Object(u["j"])(r,t,o),Object(u["u"])(r,r),Object(u["h"])(r,r,-1)):(Object(u["f"])(r,Da,o,-c),Object(u["u"])(r,r),Object(u["j"])(t,r,o),Object(u["u"])(t,t))}const Ra=Object(A["d"])(),Ma=Object(d["f"])(),Da=Object(d["f"])(),za=Object(d["f"])();function Ia(e,t){Object(u["z"])(La,0,0,0);for(let r=0;r<t.count-1;r++)t.getVec(r,va),Object(u["i"])(La,La,va);Object(u["h"])(e,La,1/(t.count-1))}const La=Object(d["f"])();function Fa(e,t,r,i,n,a,s){Object(u["z"])(e,t*n[0]+r*a[0]+i*s[0],t*n[1]+r*a[1]+i*s[1],t*n[2]+r*a[2]+i*s[2])}var Va=r("d36e"),Ua=r("8675"),Ga=r("aeb3");class Na extends Ln["a"]{initializeProgram(e){const t=Na.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:r.style,patternSpacing:r.patternSpacing,lineWidth:r.lineWidth,draped:r.draped,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new Un["a"](e.rctx,i,Ha)}bindPass(e,t){Object(zn["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("matColor",e.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio),this.program.setUniform1f("texelSize",1/t.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),4===this.configuration.output&&Object(yr["b"])(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Mn["a"])(this.program,t))}bindDraw(e){Object(zn["d"])(this.program,e),Object(zn["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(En["c"])(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(Bn["g"])({blending:0===r.output||7===r.output?i?Vn["g"]:Object(Vn["a"])(e):null,culling:Object(Bn["c"])(r.cullFace),depthTest:{func:Object(Vn["b"])(e)},depthWrite:i?r.writeDepth&&Bn["e"]:Object(Vn["c"])(e),colorWrite:Bn["d"],stencilWrite:r.sceneHasOcludees?Gn["j"]:null,stencilTest:r.sceneHasOcludees?t?Gn["f"]:Gn["e"]:null,polygonOffset:i||n?r.polygonOffset&&Ba:Object(Vn["h"])(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}Na.shader=new In["a"](Ga["a"],()=>r.e("chunk-2d208701").then(r.bind(null,"a590")));const Ba={factor:1,units:1};class ka extends Fn["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.enableOffset=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(Tn["a"])([Object(Fn["b"])({count:8})],ka.prototype,"output",void 0),Object(Tn["a"])([Object(Fn["b"])({count:3})],ka.prototype,"cullFace",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"slicePlaneEnabled",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"vertexColors",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"polygonOffset",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"writeDepth",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"sceneHasOcludees",void 0),Object(Tn["a"])([Object(Fn["b"])({count:6})],ka.prototype,"style",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"patternSpacing",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"lineWidth",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"enableOffset",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"draped",void 0),Object(Tn["a"])([Object(Fn["b"])({count:4})],ka.prototype,"transparencyPassType",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"multipassTerrainEnabled",void 0),Object(Tn["a"])([Object(Fn["b"])()],ka.prototype,"cullAboveGround",void 0);const Ha=new Map([["position",0],["color",3],["uvMapSpace",4],["boundingRect",5]]);class qa extends Pn["a"]{constructor(e){super(e,Za),this.supportsEdges=!0,this._vertexAttributeLocations=Ha,this.techniqueConfig=new ka}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Vn["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,r,i,n,a,s){Object(Qr["i"])(e,t,i,n,a,void 0,s)}requiresSlot(e,t){return 20===e||(4===Object(Ur["b"])(t)?2===e:e===(this.parameters.writeDepth?4:7))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.parameters.writeLinearDepth?new Wa(e):null}createBufferWriter(){const e=Object(wr["a"])().vec3f("position").vec4u8("color").vec4f("uvMapSpace");return this.parameters.draped||e.mat3f("boundingRect"),new $a(e)}}class Wa extends Cn["a"]{updateParameters(e){return this.ensureTechnique(Na,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}class $a extends Ua["a"]{write(e,t,r,i){for(const n of this.vertexBufferLayout.fieldNames){const a=t.vertexAttributes.get(n),s=t.indices.get(n);if(a&&s)switch(n){case"position":{Object(jr["a"])(3===a.size);const t=r.getField(n,R["u"]);t&&Object($n["e"])(s,a.data,e.transformation,t,i);break}case"color":{Object(jr["a"])(3===a.size||4===a.size);const e=r.getField(n,R["J"]);e&&Object($n["b"])(s,a.data,a.size,e,i);break}case"uvMapSpace":{Object(jr["a"])(4===a.size);const e=r.getField(n,R["C"]);e&&Object($n["a"])(s,a.data,e,i);break}case"boundingRect":{Object(jr["a"])(9===a.size);const t=r.getField(n,R["f"]);t&&this.writeBoundingRect(s,a.data,e.transformation,t,i);break}}}}writeBoundingRect(e,t,r,i,n){const a=r,s=i.typedBuffer,o=i.typedBufferStride,c=e.length;n*=o;for(let l=0;l<c;++l){const r=9*e[l],i=t[r],c=t[r+1],u=t[r+2];s[n]=a[0]*i+a[4]*c+a[8]*u+a[12],s[n+1]=a[1]*i+a[5]*c+a[9]*u+a[13],s[n+2]=a[2]*i+a[6]*c+a[10]*u+a[14];for(let e=3;e<9;++e)s[n+e]=t[r+e];n+=o}}}const Za={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...Pn["b"]};function Ya(e,t,r){return Xa(Ja(e),t,r)}function Ja(e){return e&&e.pattern||null}function Xa(e,t,r){return Object(n["l"])(e)?"none"===e.style||"solid"===e.style?("none"===e.style&&(t.color=Object(Ce["g"])(0,0,0,0),t.transparent=!0),new Va["a"](t)):(t.style=Qa(e.style),t.draped=r.isDraped,new qa(t)):new Va["a"](t)}function Qa(e){switch(e){case"horizontal":return 0;case"vertical":return 1;case"cross":return 2;case"forward-diagonal":return 3;case"backward-diagonal":return 4;case"diagonal-cross":return 5;default:return}}function Ka(e){return e.material instanceof qa&&!e.material.parameters.draped}function es(e,t){if(Ka(e)){const r=e.geometry.vertexAttributes,i=r.get("position").data,n=r.get("uvMapSpace").data,a=r.get("boundingRect").data;ma(R["C"].fromTypedArray(n),R["v"].fromTypedArray(i),t,R["g"].fromTypedArray(a))}}function ts(e,t,r,i){const n=Object(Me["c"])(e,t,r,i),a=e.stageObject.geometryRecords;for(let s=0;s<a.length;s++)es(a[s],i);return n}const rs=["polyline","polygon","extent"];class is extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}ensureMaterials(){this.ensureFillMaterial(),this.ensureOutlineMaterial()}ensureFillMaterial(){if(Object(n["l"])(this._material))return;const e=Object(n["j"])(this.symbolLayer,"material","color"),t=this._getCombinedOpacityAndColor(e);this._material=Ya(this.symbolLayer,{color:t,transparent:t[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof qa,this._context.stage.add(this._material)}ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(Object(n["l"])(this._outlineMaterial)||!this._isValidOutline(e))return;this._hasOutline=!0;const t=t=>{const r=Object(Mt["b"])(e.pattern);return new Dt["a"]({width:t,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:r,stippleScaleWithLineWidth:!0,cap:Object(Rt["d"])(e.patternCap||"butt")})};this._outlineMaterial=t(Object(_e["h"])(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return Object(n["l"])(e)&&e.size&&e.size>0&&Object(n["l"])(e.color)&&(Object(n["k"])(e.pattern)||"style"!==e.pattern.type||"none"!==e.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,rs,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),i=this.setGraphicElevationContext(t,new I["a"]);return this.ensureDrapedStatus("on-the-ground"===i.mode),this.ensureMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,i)}layerOpacityChanged(){if(Object(n["l"])(this._material)){const e=this._material.parameters.color,t=Object(n["j"])(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t);this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(Object(n["l"])(this._outlineMaterial)){const e=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[e[0],e[1],e[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(z["e"])(is.elevationModeChangeTypes,r,i);if(n!==z["b"].UPDATE)return n;const a=Object(z["h"])(i);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){if(Object(n["l"])(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),Object(n["l"])(this._outlineMaterial)){const e={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,r){const i=H(e.geometry);if(Object(n["k"])(i))return null;as.renderData=q(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),as.color=t;const a=as.renderData.position.length/3;if(this._needsUV&&(as.uvMapSpace=new Float32Array(4*a),as.boundingRect=new Float64Array(9*a)),as.outNum=0,as.outGeometries=[],as.outTransforms=[],as.outMaterials=[],this._createAs3DShapeFill(as),this._hasOutline&&this._createAs3DShapeOutline(as),this._logGeometryCreationWarnings(as.renderData,i.rings,"rings","FillSymbol3DLayer"),0===as.outNum)return null;this._needsUV&&ma(R["C"].fromTypedArray(as.uvMapSpace),R["v"].fromTypedArray(as.renderData.position),this._context.renderCoordsHelper,R["g"].fromTypedArray(as.boundingRect));const s=new Q["a"]({geometries:as.outGeometries,materials:as.outMaterials,transformations:as.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e.uid}}),o=new _["a"](this,s,as.outGeometries,null,null,ts,r);return o.alignedSampledElevation=as.renderData.sampledElevation,o.needsElevationUpdates=Object(z["h"])(r.mode),o}_createAs3DShapeFill(e){const t=e.renderData.polygons;for(const{position:r,mapPosition:i,holeIndices:a,index:s,count:o}of t){if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(ns),Object(f["n"])(ns,i),!Object(f["x"])(ns,this._context.clippingExtent)))continue;const t=Object(C["a"])(i,a,3);if(0===t.length)continue;const c=new Uint32Array(t),l=B({indices:c,attributeData:{position:r,color:e.color,mapPosition:i,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*s*e.uvMapSpace.BYTES_PER_ELEMENT,4*o):null,boundingRect:this._needsUV?new Float64Array(e.boundingRect.buffer,9*s*e.boundingRect.BYTES_PER_ELEMENT,9*o):null}});e.outGeometries.push(l),e.outMaterials.push(Object(n["u"])(this._material)),e.outTransforms.push(A["a"]),e.outNum++}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{mapPosition:i,position:a}=t[r];if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(ns),Object(f["n"])(ns,i),!Object(f["x"])(ns,this._context.clippingExtent)))continue;const s=Object(Rt["a"])({overlayInfo:null,removeDuplicateStartEnd:1,attributeData:{position:a,mapPosition:i}}),o=s.vertexAttributes.get("position");o.data===a&&(o.data=new Float64Array(a)),e.outGeometries.push(s),e.outMaterials.push(Object(n["u"])(this._outlineMaterial)),e.outTransforms.push(A["a"]),e.outNum++}}_createAsOverlay(e,t){const r=H(e.geometry);if(Object(n["k"])(r))return null;Object(n["u"])(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,Object(n["l"])(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),ss.renderData=W(r,this._context.overlaySR),ss.color=t;const i=ss.renderData.position.length/3;return this._needsUV&&(ss.uvMapSpace=new Float32Array(4*i)),ss.outNum=0,ss.outGeometries=[],ss.outBoundingBox=Object(f["k"])(),ss.layerUid=this._context.layer.uid,ss.graphicsUid=e.uid,this._createAsOverlayFill(ss),this._hasOutline&&this._createAsOverlayOutline(ss),this._logGeometryCreationWarnings(ss.renderData,r.rings,"rings","FillSymbol3DLayer"),0===ss.outNum?null:(this._needsUV&&ba(R["C"].fromTypedArray(ss.uvMapSpace),R["v"].fromTypedArray(ss.renderData.position),this._context.overlaySR,this._context.layerView.view.state.viewingMode),ss.outNum>0?new De(this,ss.outGeometries,ss.outBoundingBox):null)}_createAsOverlayFill(e){const t=e.renderData.polygons;for(const{position:r,holeIndices:i,index:a,count:s}of t){if(Object(f["k"])(ns),Object(f["n"])(ns,r),!Object(f["x"])(ns,this._context.clippingExtent))continue;const t=Object(C["a"])(r,i,3);if(0===t.length)continue;Object(f["m"])(e.outBoundingBox,ns);const o=new Uint32Array(t),c=B({indices:o,attributeData:{position:r,color:e.color,uvMapSpace:this._needsUV?new Float32Array(e.uvMapSpace.buffer,4*a*e.uvMapSpace.BYTES_PER_ELEMENT,4*s):null}}),l=new pt["a"](c,Object(n["u"])(this._material),e.layerUid,e.graphicsUid),u=ns;Object(we["l"])(l.boundingSphere,.5*(u[0]+u[3]),.5*(u[1]+u[4]),0,.5*Math.sqrt((u[3]-u[0])*(u[3]-u[0])+(u[4]-u[1])*(u[4]-u[1]))),e.outGeometries.push(l),e.outNum++}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const t=e.renderData.outlines;for(let r=0;r<t.length;++r){const{position:i}=t[r];if(Object(f["k"])(ns),Object(f["n"])(ns,i),!Object(f["x"])(ns,this._context.clippingExtent))continue;Object(f["m"])(e.outBoundingBox,ns);const a=Object(Rt["a"])({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:1,attributeData:{position:i}}),s=new pt["a"](a,Object(n["u"])(this._outlineMaterial),e.layerUid,e.graphicsUid),o=ns;Object(we["l"])(s.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),e.outGeometries.push(s),e.outNum++}}_getOutlineOpacity(){const e=Object(n["j"])(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(Object(n["l"])(e)?e.a:0)}_getOutlineColor(){const e=Object(n["j"])(this.symbolLayer,"outline","color"),t=this._getOutlineOpacity();return Object(F["g"])(Object(n["l"])(e)?xe["a"].toUnitRGB(e):null,t)}get test(){return{createAsOverlay:(e,t)=>this._createAsOverlay(e,t),createAs3DShape:(e,t,r)=>this._createAs3DShape(e,t,r)}}}is.elevationModeChangeTypes={definedChanged:z["b"].RECREATE,staysOnTheGround:z["b"].NONE,onTheGroundChanged:z["b"].RECREATE};const ns=Object(f["h"])(),as={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ss={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};var os=r("38bf"),cs=r("a37d"),ls=r("003f"),us=r("0494"),ds=r("a1ff"),hs=r("c514");class ps extends ls["a"]{constructor(e,t,r){super(),this.type=4,this._glTexture=null,this.events=new _r["a"],this._requiresPowerOfTwo=!Object(hs["a"])(e.gl),this._renderer=new us["a"](t,r)}get width(){return this._renderer.renderedWidth}get height(){return this._renderer.renderedHeight}get textureWidth(){const e=this.width;return this._requiresPowerOfTwo?Object(Ge["n"])(e):e}get textureHeight(){const e=this.height;return this._requiresPowerOfTwo?Object(Ge["n"])(e):e}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}get texcoordScale(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]}get requiresFrameUpdates(){return!1}createDescriptor(e){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){if(Object(n["l"])(this._glTexture))return this._glTexture;const t=Object(us["b"])(fs,this.textureWidth,this.textureHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,this.textureHeight-this._renderer.renderedHeight),this._glTexture=new ds["a"](e,this.createDescriptor(e),t),r.restore(),this._glTexture}unload(){Object(n["l"])(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),this.events.emit("unloaded")}}const fs={canvas:null},bs=[0,0,1];class ms extends L["a"]{constructor(e,t,r,i){super(e,t,r,i),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=Object(F["k"])(this.symbolLayer.size);if(e)throw new w["a"]("graphics3dtextsymbollayer:invalid-size",e)}this._createTextRenderParameters()}_createTextRenderParameters(){const e=this._context.layerView.view.pixelRatio;this._textRenderParameters=cs["a"].fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const t=e.graphic,r=Object(Ve["d"])(t.geometry);if(Object(n["k"])(r))return this.logger.warn("unsupported geometry type for text symbol: "+t.geometry.type),null;const i=this.symbolLayer.text;if(!i)return null;const a=Object(os["d"])(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(t,r,i,a)}createLabel(e,t,r,i){const a=e.graphic,s=Object(Ve["d"])(a.geometry);if(Object(n["k"])(s))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;const o=t.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(a,s,o,t,t,r,i)}setGraphicElevationContext(e,t,r=0){const i=super.setGraphicElevationContext(e,t);return i.addOffsetRenderUnits(r),i}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,t){return gs(e,t,(e,t)=>{this.updateGraphicElevationContext(t,e)}),z["b"].UPDATE}slicePlaneEnabledChanged(e,t){return gs(e,t,e=>{for(const t of e.stageObject.geometryRecords)t.material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(e,t){this.setGraphicElevationContext(e,t.elevationContext,t.metadata.elevationOffset),t.needsElevationUpdates=Object(z["h"])(t.elevationContext.mode)||"absolute-height"===t.elevationContext.mode}_defaultElevationInfoNoZ(){return vs}_createAs3DShape(e,t,r,i,a=ys,s,o){const c=this.setGraphicElevationContext(e,new I["a"],a.elevationOffset),u="polyline"===Object(n["j"])(e.geometry,"type"),d=e.uid,h=this._context.stage.renderView.renderingContext,p=a.anchor in F["h"]?a.anchor:"center",f=F["h"][p],b=Object(n["k"])(o)?new ps(h,r,this._textRenderParameters):null,m={occlusionTest:!0,screenOffset:a.screenOffset,anchorPos:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:!0};if(Object(n["l"])(b)&&(m.textureId=b.id,m.texCoordScale=b.texcoordScale),Object(n["l"])(o)&&(m.textureId=o.id),Object(n["l"])(i)&&Object(n["l"])(i.verticalOffset)){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=i.verticalOffset;m.verticalOffset={screenLength:Object(_e["h"])(e),minWorldLength:t||0,maxWorldLength:null!=r?r:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:e,screenSizePerspectiveSettingsLabels:t}=this._context.sharedResources;m.screenSizePerspective=t.overridePadding(this._textRenderParameters.haloSize),m.screenSizePerspectiveAlignment=e}let g;if(u&&(m.shaderPolygonOffset=1e-4),m.slicePlaneEnabled=this._context.slicePlaneEnabled,Object(n["l"])(s)){const e=JSON.stringify(m);g=s.get(e),Object(n["k"])(g)&&(g=new bt["a"](m),s.add(e,g))}else g=new bt["a"](m);const v=[g],y=a.translation,O=Object(n["l"])(b)?[b.displayWidth,b.displayHeight]:[0,0],x=a.centerOffset,j=bs,S=[0,0],w=[ht["a"].createPointGeometry(j,y,null,O,x,S,null)],C=this._context.layer.uid,P=Object(Ve["a"])(this._context,t,w,v,c,C,d);if(null===P)return null;const T=new _["a"](this,P.object,w,Object(n["k"])(s)?v:null,Object(n["l"])(b)?[b]:null,Me["b"],c);T.alignedSampledElevation=P.sampledElevation,T.needsElevationUpdates=Object(z["h"])(c.mode)||"absolute-height"===c.mode;const{displayWidth:E,displayHeight:A}=Object(n["l"])(b)?b:a;T.getScreenSize=(e=Object(l["b"])())=>(e[0]=E,e[1]=A,e);const R={labelText:r,elevationOffset:a.elevationOffset};return T.metadata=R,Object(Ve["b"])(T,t,this._context.elevationProvider),T}}function gs(e,t,r){e&&e.forEach(e=>{const i=t(e);Object(n["l"])(i)&&r(i,e.graphic)})}const vs={mode:"relative-to-ground",offset:0},ys={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};var Os=r("8048"),xs=r("1f93"),js=r("b855");const _s=["polyline","polygon","extent"];class Ss extends L["a"]{constructor(e,t,r,i){super(e,t,r,i)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const t=e.graphic;if(!this._validateGeometry(t.geometry,_s,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(t,new I["a"]);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}ensureMaterial(){if(Object(n["l"])(this._material))return;const e={...js["a"]},t=this.symbolLayer.color;Object(n["l"])(t)&&(e.color=xe["a"].toUnitRGBA(t));const r=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=Object(n["l"])(this.symbolLayer.waveDirection)?Ss.headingVectorFromAngle(this.symbolLayer.waveDirection):Object(l["f"])(0,0);const i=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,a=js["b"][i];e.waveStrength=a.waveStrength,e.waveTextureRepeat=a.textureRepeat,e.waveVelocity=a.waveVelocity,e.flowStrength=a.perturbationStrength,e.slicePlaneEnabled=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new xs["a"](e),this._context.stage.add(this._material)}layerOpacityChanged(){if(Object(n["k"])(this._material))return!0;const e=this._material.parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[e[0],e[1],e[2],t],transparent:r}),!0}layerElevationInfoChanged(e,t,r){const i=this._elevationContext.mode,n=Object(z["e"])(Ss.elevationModeChangeTypes,r,i);if(n!==z["b"].UPDATE)return n;const a=Object(z["h"])(i);return this.updateGraphics3DGraphicElevationInfo(e,t,()=>a)}slicePlaneEnabledChanged(){return Object(n["l"])(this._material)&&this._material.setParameters({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(e,t,r){const i=H(e.geometry);if(Object(n["k"])(i))return null;Es.renderData=q(i,this._context.elevationProvider,this._context.renderCoordsHelper,t);const a=Es.renderData.position.length/3;if(Es.uvCoords=new Float64Array(2*a),Es.outNum=0,Es.outGeometries=[],Es.outTransforms=[],Es.outMaterials=[],this._create3DShapeGeometries(Es),this._logGeometryCreationWarnings(Es.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===Es.outNum)return null;this._createUVCoordsFromVertices(Es.uvCoords,Es.renderData.mapPosition,a,this._context.elevationProvider.spatialReference);const s=new Q["a"]({geometries:Es.outGeometries,materials:Es.outMaterials,transformations:Es.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),o=new _["a"](this,s,Es.outGeometries,null,null,Me["c"],t);return o.alignedSampledElevation=Es.renderData.sampledElevation,o.needsElevationUpdates=Object(z["h"])(t.mode),o}_createUVCoordsFromVertices(e,t,r,i){const n=Object(Os["f"])(i);Object(b["o"])(Cs);for(let o=0;o<r;o++)Object(c["s"])(Ps,t[3*o+0],t[3*o+1]),Object(b["r"])(Cs,Ps);Object(we["b"])(Cs,Cs,n);const a=Cs[0]%Ss.unitSizeOfTexture,s=Cs[1]%Ss.unitSizeOfTexture;ws[0]=Cs[0]-a,ws[1]=Cs[1]-s;for(let o=0;o<r;o++)e[2*o+0]=(t[3*o+0]*n-ws[0])/Ss.unitSizeOfTexture,e[2*o+1]=(t[3*o+1]*n-ws[1])/Ss.unitSizeOfTexture}_create3DShapeGeometries(e){const t=e.renderData.polygons,r=e.uvCoords;for(const{count:i,index:a,position:s,mapPosition:o,holeIndices:c}of t){if(Object(n["l"])(this._context.clippingExtent)&&(Object(f["k"])(Ts),Object(f["n"])(Ts,o),!Object(f["x"])(Ts,this._context.clippingExtent)))continue;const t=Object(C["a"])(o,c,3);if(0===t.length)continue;const l=new Uint32Array(t),u=new Float64Array(r.buffer,2*a*r.BYTES_PER_ELEMENT,2*i),d=k({indices:l,attributeData:{position:s,uv0:u,mapPosition:o}});e.outGeometries.push(d),e.outMaterials.push(Object(n["u"])(this._material)),e.outTransforms.push(A["a"]),e.outNum++}}_createAsOverlay(e){const t=H(e.geometry);if(Object(n["k"])(t))return null;Object(n["u"])(this._material).renderPriority=this._renderPriority,As.renderData=W(t,this._context.overlaySR);const r=As.renderData.position.length/3;return As.uvCoords=new Float64Array(2*r),As.outNum=0,As.outGeometries=[],As.outBoundingBox=Object(f["k"])(),As.layerUid=this._context.layer.uid,As.graphicsUid=e.uid,this._createAsOverlayWater(As),this._logGeometryCreationWarnings(As.renderData,t.rings,"rings","WaterSymbol3DLayer"),0===As.outNum?null:(this._createUVCoordsFromVertices(As.uvCoords,As.renderData.position,r,this._context.overlaySR),As.outNum>0?new De(this,As.outGeometries,As.outBoundingBox):null)}_createAsOverlayWater(e){const t=e.uvCoords,r=e.renderData.polygons;for(const{position:i,holeIndices:a,index:s,count:o}of r){if(Object(f["k"])(Ts),Object(f["n"])(Ts,i),!Object(f["x"])(Ts,this._context.clippingExtent))continue;Object(f["m"])(e.outBoundingBox,Ts);const r=Object(C["a"])(i,a,3);if(0===r.length)continue;const c=new Uint32Array(r),l=new Float64Array(t.buffer,2*s*t.BYTES_PER_ELEMENT,2*o),u=k({indices:c,attributeData:{position:i,uv0:l}}),d=new pt["a"](u,Object(n["u"])(this._material),e.layerUid,e.graphicsUid),h=Ts;Object(we["l"])(d.boundingSphere,.5*(h[0]+h[3]),.5*(h[1]+h[4]),0,.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]))),e.outGeometries.push(d),e.outNum++}}static headingVectorFromAngle(e){const t=Object(l["b"])(),r=Object(gi["d"])(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}get test(){return{create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}Ss.unitSizeOfTexture=100,Ss.elevationModeChangeTypes={definedChanged:z["b"].RECREATE,staysOnTheGround:z["b"].NONE,onTheGroundChanged:z["b"].RECREATE};const ws=Object(l["b"])(),Cs=Object(b["m"])(),Ps=Object(l["b"])(),Ts=Object(f["h"])(),Es={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},As={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Rs=S["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Ms(e,t,r,i){const n=zs[e.type]&&zs[e.type][t.type]||Ds[t.type];return n?new n(e,t,r,i):(Rs.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)}const Ds={icon:wt,object:di,line:It,path:ea,fill:is,extrude:te,text:ms,water:Ss};const zs={"mesh-3d":{fill:kt}};var Is=r("5e82");class Ls extends Is["a"]{constructor(e,t,r){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(e){this._symbol=e;for(let t=0;t<e.symbolLayers.length;t++){const r=this.symbolLayers[t];Object(n["k"])(r)||(r.symbol=e,r.symbolLayer=e.symbolLayers.items[t])}}get symbol(){return this._symbol}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const s=[];for(let i=0;i<r;i++){const n=t.getItemAt(i);if(!1===n.enabled)continue;Fs.renderPriority=1-(1+i)/r,Fs.renderPriorityStep=1/r,Fs.ignoreDrivers=n._ignoreDrivers;const o=Ms(this.symbol,n,this._context,Fs);s.push(Object(a["s"])(e,()=>{this.symbolLayers[i]=null,o.destroy()})),this.symbolLayers[i]=o}await Object(i["b"])(this.symbolLayers,async(e,t)=>{if(Object(n["l"])(e))try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch{this.symbolLayers[t]=null}});for(const i of s)null==i||i.remove();if(s.length=0,Object(a["w"])(e),this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return Object(n["l"])(t)?t.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(e,t){const r=e.graphic,i=new Array(this.symbolLayers.length);for(let s=0;s<this.symbolLayers.length;s++){const t=this.symbolLayers[s];i[s]=Object(n["l"])(t)?t.createGraphics3DGraphic(e):null}const a=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new x(r,t||this,i,e.layer,a)}get complexity(){return Object(gr["f"])(this.symbolLayers.map(e=>Object(n["j"])(e,"complexity")))}globalPropertyChanged(e,t){const r=this.symbolLayers.length;for(let i=0;i<r;i++){const r=this.symbolLayers[i],a=e=>{const t=e.graphics[i];return t instanceof _["a"]?t:null};if(Object(n["l"])(r)&&!r.globalPropertyChanged(e,t,a))return!1}return!0}applyRendererDiff(e,t){return 1!==this.loadStatus?0:this.symbolLayers.reduce((r,i)=>0!==r&&Object(n["l"])(i)?Math.min(r,i.applyRendererDiff(e,t)):r,2)}prepareSymbolPatch(e){if(2===this.loadStatus)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const r=t.symbolLayers.diff;this.symbolLayers.forEach((t,i)=>{if(Object(n["k"])(t))return;const a=r[i];if(a){const r={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(r),e.symbolStatePatches.push(...r.symbolLayerStatePatches),r.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((e,t)=>{const a=e.graphics[i];Object(n["l"])(a)&&r.graphics3DGraphicPatches.forEach(e=>e(a,t))})}})}updateGeometry(e,t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(Object(n["k"])(i))continue;const a=e.graphics[r];if(Object(n["k"])(a)||!i.updateGeometry(a,t))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const r=this.symbolLayers[t];if(Object(n["k"])(r))continue;const i=e.graphics[t];Object(n["l"])(i)&&r.onRemoveGraphic(i)}}getFastUpdateStatus(){let e=0,t=0,r=0;return this.symbolLayers.forEach(i=>{Object(n["k"])(i)||(0===i.loadStatus?e++:i.isFastUpdatesEnabled()?r++:t++)}),{loading:e,slow:t,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)Object(n["l"])(e)&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const Fs={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1}},6415:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("e92d");const n=i["a"].getLogger("esri.views.3d.support.buffer.math")},6611:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r("a4ee"),n=r("fc29"),a=r("59b2"),s=(r("b50f"),r("c120"),r("cea0"),r("d386"));let o=class extends n["a"]{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(i["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"SHOW_POI",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(i["a"])([Object(a["b"])()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o=Object(i["a"])([Object(s["a"])("esri.views.3d.support.DebugFlags")],o);const c=new o},"661c":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r("38a4");function n(e,t,r=0){const n=Object(i["f"])(e,0,c);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*l(n*s[i]))}function a(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*o[i];return r}const s=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],c=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},"668b":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return n}));var i=r("6415");function n(e,t,r){if(e.count!==t.count)return void i["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=r[0],s=r[1],o=r[2],c=r[4],l=r[5],u=r[6],d=r[8],h=r[9],p=r[10],f=r[12],b=r[13],m=r[14],g=e.typedBuffer,v=e.typedBufferStride,y=t.typedBuffer,O=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*v,t=i*O,r=y[t],n=y[t+1],x=y[t+2];g[e]=a*r+c*n+d*x+f,g[e+1]=s*r+l*n+h*x+b,g[e+2]=o*r+u*n+p*x+m}}function a(e,t,r){if(e.count!==t.count)return void i["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=r[0],s=r[1],o=r[2],c=r[3],l=r[4],u=r[5],d=r[6],h=r[7],p=r[8],f=e.typedBuffer,b=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*b,t=i*g,r=m[t],n=m[t+1],v=m[t+2];f[e]=a*r+c*n+d*v,f[e+1]=s*r+l*n+h*v,f[e+2]=o*r+u*n+p*v}}function s(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<i;c++){const e=c*a,t=c*o;n[e]=r*s[t],n[e+1]=r*s[t+1],n[e+2]=r*s[t+2]}}function o(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride;for(let o=0;o<r;o++){const e=o*n,t=o*s,r=a[t],c=a[t+1],l=a[t+2],u=Math.sqrt(r*r+c*c+l*l);if(u>0){const t=1/u;i[e]=t*r,i[e+1]=t*c,i[e+2]=t*l}}}function c(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<i;c++){const e=c*a,t=c*o;n[e]=s[t]>>r,n[e+1]=s[t+1]>>r,n[e+2]=s[t+2]>>r}}Object.freeze({__proto__:null,transformMat4:n,transformMat3:a,scale:s,normalize:o,shiftRight:c})},"66af":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r("a4ee"),n=r("3795"),a=r("59b2"),s=(r("b50f"),r("c120"),r("cea0"),r("d386")),o=r("d2f2");const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(e){super.postscript(e),Object(o["b"])(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=Object(n["m"])(this.view.defaultsFromMap,"heightModelInfoReady");this.handles.add(e),await e;const t=Object(o["c"])(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(t)throw t}};return Object(i["a"])([Object(a["b"])()],t.prototype,"view",void 0),Object(i["a"])([Object(a["b"])()],t.prototype,"slicePlaneEnabled",void 0),t=Object(i["a"])([Object(s["a"])("esri.views.3d.layers.LayerView3D")],t),t}},6750:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("501b"),n=r("3886");function a(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?s(e,t):o(e)}function s(e,t){const r=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(i["a"]),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("camPos","vec3"),e.vertex.code.add(n["a"]`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - camPos);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),e.vertex.code.add(n["a"]`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${c};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),e.vertex.code.add(n["a"]`
  ${t.stippleRequiresStretchMeasure?n["a"]`vec3`:n["a"]`vec2`} computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {
  `),r&&e.vertex.code.add(n["a"]`
      if (segmentLengthPseudoScreen >= patternLength) {

        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?n["a"]`return vec3(0.0, segmentLengthScreenRounded, repetitions / flooredRepetitions);`:n["a"]`return vec2(0.0, segmentLengthScreenRounded);`}
      }
    `),e.vertex.code.add(n["a"]`
      ${t.stippleRequiresStretchMeasure?n["a"]`return vec3(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen, 1.0)`:n["a"]`return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen)`};
    }
  `),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(n["a"]`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),e.fragment.code.add(n["a"]`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?n["a"]`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n["a"]`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?n["a"]`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      return (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?n["a"]`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n["a"]`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?e.fragment.code.add(n["a"]`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(n["a"]`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function o(e){e.fragment.code.add(n["a"]`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const c=n["a"].float(.4)},"697e":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r("b2b2"),n=r("ecd7"),a=r("f2e0"),s=r("e431");class o{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,r,i,n,s){this.id=Object(a["b"])(),this.geometry=e,this.material=t,this.transformation=r,this.instanceParameters=i,this.origin=n,this._shaderTransformation=s,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(i["l"])(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(s["t"])(e,e,this.getStaticTransformation()),!0)}}o.pool=new n["a"](o)},"6a21":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r("c120"),n=r("3886");function a({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(n["a"]`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(n["a"]`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function s(e){return!!Object(i["a"])("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},"6b38":function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var i=r("6c97"),n=r("38a4"),a=r("d791"),s=r("afe1"),o=r("e431"),c=r("0b2d"),l=r("8188"),u=r("f694"),d=r("4261"),h=r("9180"),p=r("bd7e"),f=r("7289"),b=r("d18f"),m=r("de58");const g=.5*Math.PI,v=g/Math.PI*180;class y{constructor(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:Object(c["f"])(),direction:Object(c["f"])()};for(let t=0;t<4;t++)this.extent[t]={origin:Object(c["f"])(),direction:Object(c["f"])(),cap:{next:null,direction:Object(c["f"])()}},this.planes[t]=Object(f["d"])();this.planes[4]=Object(f["d"])(),this.planes[5]=Object(f["d"])(),this.planesWithoutFar=this.planes.slice(0,5)}update(e,t,r,i=!0){const n=this.extent;this.toRenderBoundingExtent(e,t,r),Object(o["i"])(this.center.origin,n[0].origin,n[2].origin),Object(o["h"])(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),i||Object(o["h"])(this.center.direction,this.center.direction,-1);for(let a=0;a<4;a++){const e=n[a];this.renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);const t=n[3===a?0:a+1];e.cap.next=t.origin,Object(o["y"])(e.cap.direction,e.origin,t.origin),Object(f["j"])(e.direction,e.cap.direction,e.origin,this.planes[a]),i||Object(o["h"])(e.direction,e.direction,-1)}Object(f["j"])(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[4]),i?Object(f["q"])(this.planes[4],this.planes[5]):(Object(f["c"])(this.planes[4],this.planes[5]),Object(f["q"])(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t,this.minGlobalAltitude=.9*Object(u["e"])(this.maxSpanSpatialReference).radius}isVisibleInFrustum(e,t,r=!1){if(null==e)return!1;if(1===this.renderCoordsHelper.viewingMode){const r=this.maxSpanSpatialReference.isGeographic?v:g*t;if(this.maxSpan>r)return!0;if(e.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){const t=this.extent[0];return!(r||!e.intersectsRay(Object(b["h"])(t.origin,t.direction)))}for(let n=0;n<this.extent.length;n++){const t=this.extent[n];if(!r&&e.intersectsRay(Object(b["h"])(t.origin,t.direction)))return!0;if(e.intersectsLineSegment(Object(p["f"])(t.origin,t.cap.next,C),t.cap.direction))return!0}const i=r?this.planes:this.planesWithoutFar;for(let n=0;n<e.lines.length;n++){const t=e.lines[n];if(Object(m["b"])(i,t.origin,t.endpoint,t.direction))return!0}return!1}toRenderBoundingExtentGlobal(e,t,r){const i=5;Object(h["e"])(e,x),x[2]=r,Object(l["d"])(t,x,j,this.renderCoordsHelper.spatialReference),Object(a["c"])(_,j),Object(d["k"])(S);for(const{x0:a,x1:s,y0:c,y1:u}of O)for(let h=0;h<i;h++){const p=h/(i-1);x[0]=Object(n["l"])(e[a],e[s],p),x[1]=Object(n["l"])(e[c],e[u],p),x[2]=r,Object(l["y"])(x,t,x,this.renderCoordsHelper.spatialReference),Object(o["t"])(x,x,_),Object(d["r"])(S,x)}Object(o["z"])(this.extent[0].origin,S[0],S[1],S[2]),Object(o["z"])(this.extent[1].origin,S[3],S[1],S[2]),Object(o["z"])(this.extent[2].origin,S[3],S[4],S[2]),Object(o["z"])(this.extent[3].origin,S[0],S[4],S[2]);for(let n=0;n<4;++n)Object(o["t"])(this.extent[n].origin,this.extent[n].origin,j)}toRenderBoundingExtentLocal(e,t,r){Object(l["n"])(e,t,w,this.renderCoordsHelper.spatialReference),Object(o["z"])(this.extent[0].origin,w[0],w[1],r),Object(o["z"])(this.extent[1].origin,w[2],w[1],r),Object(o["z"])(this.extent[2].origin,w[2],w[3],r),Object(o["z"])(this.extent[3].origin,w[0],w[3],r)}toRenderBoundingExtent(e,t,r){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(e,t,r);break;case 2:this.toRenderBoundingExtentLocal(e,t,r);break;default:Object(i["a"])(this.renderCoordsHelper.viewingMode)}}isVisibleInFrustumGlobal(e){if(Object(o["k"])(this.center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const r=this.extent[t];if(Object(o["k"])(r.direction,e.direction)<0)return!0}return!1}}const O=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],x=Object(c["f"])(),j=Object(s["d"])(),_=Object(s["d"])(),S=Object(d["h"])(),w=Object(h["m"])(),C=Object(p["d"])()},"6cb2":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("5876"),n=r("3886");function a(e,t){t.symbolColor?(e.include(i["a"]),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(n["a"]`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`):e.vertex.code.add(n["a"]`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`)}},7079:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r("d047"),n=r("9617"),a=r("501b"),s=r("3886");function o(e,t){t.multipassGeometryEnabled&&e.vertex.include(n["b"]),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(s["a"]`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?s["a"]`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(i["a"]),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(a["a"]),e.fragment.code.add(s["a"]`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?s["a"]`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},7088:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add("ssaoTex","sampler2D"),r.uniforms.add("viewportPixelSz","vec4"),r.code.add(i["a"]`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
}`)):r.code.add(i["a"]`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}},"70a2":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a}));const i=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const r=this[t];this[t]=null,r&&"function"==typeof r.dispose&&r.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class n extends(i(class{})){}function a(){return(e,t)=>{var r,i;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(r=null==(i=e._managedDisposables)?void 0:i.slice())?r:[]),e._managedDisposables.unshift(t)}}},"713b":function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return d}));var i=r("d272"),n=r("4db9"),a=r("6d5b"),s=r("6a07"),o=r("6750"),c=r("ebd5"),l=r("3886"),u=r("690a");function d(e){const t=new u["a"];return t.include(n["a"],{linearDepth:!1}),t.include(a["a"],e),t.include(o["a"],{...e,stippleRequiresStretchMeasure:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3")),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(l["a"]`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.vertex.code.add(l["a"]`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped||t.vertex.code.add(l["a"]`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(l["a"]`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?t.vertex.code.add(l["a"]`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):t.vertex.code.add(l["a"]`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(l["a"]`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),t.vertex.code.add(l["a"]`}`),4===e.output&&t.include(s["a"]),t.include(i["a"],e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(l["a"]`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${l["a"].float(c["c"])}) {
      discard;
    }

    ${0===e.output?l["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?l["a"]`outputHighlight();`:""}
  }
  `),t}const h=Object.freeze({__proto__:null,build:d})},7289:function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return M})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return f})),r.d(t,"h",(function(){return p})),r.d(t,"i",(function(){return d})),r.d(t,"j",(function(){return S})),r.d(t,"k",(function(){return w})),r.d(t,"l",(function(){return P})),r.d(t,"m",(function(){return T})),r.d(t,"n",(function(){return C})),r.d(t,"o",(function(){return A})),r.d(t,"p",(function(){return E})),r.d(t,"q",(function(){return _})),r.d(t,"r",(function(){return F})),r.d(t,"s",(function(){return D})),r.d(t,"t",(function(){return z})),r.d(t,"u",(function(){return j})),r.d(t,"v",(function(){return I})),r.d(t,"w",(function(){return l}));var i=r("38a4"),n=r("b2b2"),a=r("e431"),s=r("0b2d"),o=(r("f895"),r("7361"));function c(e=V){return[e[0],e[1],e[2],e[3]]}function l(e,t,r,i){return d(e,t,r,i,o["e"].get())}function u(e,t=c()){return d(e[0],e[1],e[2],e[3],t)}function d(e,t,r,i,n=c()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function h(e,t,r){return Object(a["n"])(r,e),r[3]=t,r}function p(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function f(e,t,r,i=c()){const n=r[0]-t[0],a=r[1]-t[1],s=r[2]-t[2],o=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],d=a*u-s*l,h=s*o-n*u,p=n*l-a*o,f=d*d+h*h+p*p,b=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;i[0]=d*b,i[1]=h*b,i[2]=p*b,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2])}function b(e,t,r,i,n){if(e.count<3)return!1;e.getVec(r,g);let s=i,o=!1;for(;s<e.count-1&&!o;)e.getVec(s,v),s++,o=!Object(a["r"])(g,v);if(!o)return!1;for(s=Math.max(s,n),o=!1;s<e.count&&!o;)e.getVec(s,y),s++,Object(a["m"])(O,g,v),Object(a["u"])(O,O),Object(a["m"])(x,v,y),Object(a["u"])(x,x),o=!Object(a["r"])(g,y)&&!Object(a["r"])(v,y)&&Math.abs(Object(a["k"])(O,x))<m;return o?(f(g,v,y,t),!0):(0!==r||1!==i||2!==n)&&b(e,t,0,1,2)}const m=.99619469809,g=Object(s["f"])(),v=Object(s["f"])(),y=Object(s["f"])(),O=Object(s["f"])(),x=Object(s["f"])();function j(e,t,r){return e!==r&&u(e,r),r[3]=-Object(a["k"])(F(r),t),r}function _(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function S(e,t,r,i){return Object(a["j"])(y,t,e),p(r,y,i)}function w(e,t,r,i){return L(e,t,Object(a["m"])(o["d"].get(),r,t),U,i)}function C(e,t,r){return!!Object(n["l"])(t)&&L(e,t.origin,t.direction,G,r)}function P(e,t,r){return L(e,t.origin,t.vector,0,r)}function T(e,t,r){return L(e,t.origin,t.vector,1,r)}function E(e,t){return I(e,t)>=0}function A(e,t){const r=t[0],i=t[1],n=t[2],a=t[3],s=t[4],o=t[5];return e[0]*(e[0]>0?r:a)+e[1]*(e[1]>0?i:s)+e[2]*(e[2]>0?n:o)+e[3]>=0}function R(e,t){const r=Object(a["k"])(F(e),t.ray.direction),i=-I(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function M(e,t){const r=Object(a["k"])(F(e),t.ray.direction),i=-I(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function D(e,t,r){const i=Object(a["h"])(o["d"].get(),F(e),-e[3]),n=z(e,Object(a["m"])(o["d"].get(),t,i),o["d"].get());return Object(a["i"])(r,n,i),r}function z(e,t,r){const i=Object(a["h"])(o["d"].get(),F(e),Object(a["k"])(F(e),t));return Object(a["m"])(r,t,i),r}function I(e,t){return Object(a["k"])(F(e),t)+e[3]}function L(e,t,r,n,s){const o=Object(a["k"])(F(e),r);if(0===o)return!1;let c=-(Object(a["k"])(F(e),t)+e[3])/o;return 1&n&&(c=Object(i["f"])(c,0,1)),!(!(4&n)&&c<0||!(8&n)&&c>1)&&(Object(a["i"])(s,t,Object(a["h"])(s,r,c)),!0)}function F(e){return e}const V=[0,0,1,0],U=12,G=8},"748f":function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d}));var i=r("ce6d"),n=r("af40"),a=r("b2b2"),s=r("8a44"),o=r("003f");const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var l=r("0bde");class u extends o["a"]{constructor(e,t=""){var r,a,o;super(),this.apiLayerUid=t,this.type=0,this.events=new i["a"],this.isSliceable=!1,this._objects=new s["a"],this._stageHandles=new n["a"],this.apiLayerUid=t,this.isVisible=null==(r=null==e?void 0:e.isVisible)||r,this.isPickable=null==(a=null==e?void 0:e.isPickable)||a,this.updatePolicy=null!=(o=null==e?void 0:e.updatePolicy)?o:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of c)this._stageHandles.add(this.events.on(t,r=>e.handleEvent(t,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(a["l"])(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(a["l"])(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(a["l"])(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(a["l"])(this._octree)&&this._octree.remove(t)}}sync(){Object(a["l"])(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(a["l"])(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(a["k"])(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(a["e"])(this._octree)}_createOctree(){this._octree=new l["a"](e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function d(e){return Object(a["l"])(e)&&0===e.type}},"74df":function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return p}));var i=r("b2b2"),n=r("d791"),a=r("afe1"),s=r("e431"),o=r("0b2d"),c=r("8188"),l=r("2e0f"),u=r("ba58"),d=r("6611"),h=r("0cb9");function p(e,t,r,i){const n=e.stageObject,a=r.spatialReference,s=n.geometryRecords,o="absolute-height"!==t.mode;let u=0;for(const p of s){const e=p.geometry,s=p.getShaderTransformation();y[0]=s[12],y[1]=s[13],y[2]=s[14],e.invalidateBoundingInfo();const f=e.getMutableAttribute("position"),b=f.data,m=e.vertexAttributes.get("mapPos").data,x=f.size,j=b.length/x,S=new h["a"](m,a);let w=0,C=!1,P=0;for(let n=0;n<j;n++){if(O[0]=b[w],O[1]=b[w+1],O[2]=b[w+2],Object(l["g"])(S,r,t,i,_),o&&(P+=_.sampledElevation),d["a"].TESTS_DISABLE_OPTIMIZATIONS)b[w]=S.array[S.offset],b[w+1]=S.array[S.offset+1],b[w+2]=_.z,Object(c["p"])(b,a,w,b,i.spatialReference,w,1),b[w]-=y[0],b[w+1]-=y[1],b[w+2]-=y[2],C=!0;else{v[0]=b[w]+y[0],v[1]=b[w+1]+y[1],v[2]=b[w+2]+y[2],i.setAltitude(v,_.z),b[w]=v[0]-y[0],b[w+1]=v[1]-y[1],b[w+2]=v[2]-y[2];const e=g/i.unitInMeters;(Math.abs(O[0]-b[w])>=e||Math.abs(O[1]-b[w+1])>=e||Math.abs(O[2]-b[w+2])>=e)&&(C=!0)}w+=x,S.offset+=3}u+=P/j,C&&n.geometryVertexAttrsUpdated(p)}return u/s.length}function f(e,t,r,i){const a=e.stageObject,o=t.centerPointInElevationSR;let h=0;a.metadata.usesVerticalDistanceToGround?(Object(l["g"])(o,r,t,i,_),Object(u["j"])(a,_.verticalDistanceToGround),h=_.sampledElevation):(Object(l["g"])(o,r,t,i,_),"absolute-height"!==t.mode&&(h=_.sampledElevation));const p=Object(n["d"])(b,a.transformation),f=Object(s["z"])(j,p[12],p[13],p[14]);d["a"].TESTS_DISABLE_OPTIMIZATIONS?(v[0]=o.x,v[1]=o.y,v[2]=_.z,Object(c["d"])(o.spatialReference,v,p,i.spatialReference)&&(a.transformation=p)):i.setAltitudeOfTransformation(_.z,p);const m=g/i.unitInMeters;return(Math.abs(p[12]-f[0])>=m||Math.abs(p[13]-f[1])>=m||Math.abs(p[14]-f[2])>=m)&&(a.transformation=p),h}const b=Object(a["d"])();function m(e,t,r,n){const a=e.graphics3DSymbolLayer.lodRenderer;if(Object(i["k"])(a))return 0;const o=t.centerPointInElevationSR;Object(l["g"])(o,r,t,n,_);const u="absolute-height"!==t.mode?_.sampledElevation:0,h=a.instanceData,p=e.instanceIndex,f=x;h.getGlobalTransform(p,f);const b=Object(s["z"])(j,f[12],f[13],f[14]);d["a"].TESTS_DISABLE_OPTIMIZATIONS?(v[0]=o.x,v[1]=o.y,v[2]=_.z,Object(c["d"])(o.spatialReference,v,f,n.spatialReference)&&h.setGlobalTransform(p,f)):n.setAltitudeOfTransformation(_.z,f);const m=g/n.unitInMeters;return(d["a"].TESTS_DISABLE_OPTIMIZATIONS||Math.abs(f[12]-b[0])>=m||Math.abs(f[13]-b[1])>=m||Math.abs(f[14]-b[2])>=m)&&h.setGlobalTransform(p,f),u}const g=.01,v=Object(o["f"])(),y=Object(o["f"])(),O=Object(o["f"])(),x=Object(a["d"])(),j=Object(o["f"])(),_=new l["a"]},7585:function(e,t,r){"use strict";r.d(t,"a",(function(){return ee})),r.d(t,"b",(function(){return $})),r.d(t,"c",(function(){return te}));var i=r("a4ee"),n=r("fc29"),a=r("ce6d"),s=r("af40"),o=r("e92d"),c=r("28eb"),l=r("b2b2"),u=r("8a44"),d=r("c47a"),h=r("3795"),p=r("59b2"),f=(r("b50f"),r("c120"),r("cea0"),r("d386")),b=r("d791"),m=r("02f1"),g=r("0b2d"),v=r("afe1"),y=r("6611"),O=r("4294"),x=r("738e"),j=(r("7ce4"),r("d267")),_=(r("1956"),r("d17d"),r("9f8b"),r("a1ff"));r("0fa6");class S{constructor(e,t){this.size=Object(x["a"])(),this._fbo=null,this._fbo=new j["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l["f"])(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}class w{constructor(e){const t=(t,r,i=!0)=>({type:r,fbo:new S(e,i),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(0,0),t(0,1),t(5,2,!1),t(3,3),t(0,4)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>C)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((e,t)=>e+t.fbo.gpuMemoryUsage,0)}}const C=1e3;var P=r("0e88"),T=r("70a2"),E=r("171c"),A=r("4395"),R=r("d5f7"),M=r("adf1"),D=r("9250"),z=r("d6e5"),I=r("fdc9"),L=r("9def"),F=r("191a");let V=class extends n["a"]{constructor(){super(...arguments),this._pending=new U,this._changes=new I["a"],this._materialRenderers=new Map,this._sortedMaterialRenderers=new u["a"],this._hasHighlights=!1,this._hasWater=!1}dispose(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(c["c"])(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Object(L["a"])(this._changes);let t=!1,r=!1,i=!1;return e.forEach((e,n)=>{let a=this._materialRenderers.get(n);if(!a&&e.adds.length>0&&(a=new F["a"](this.rctx,this.materialRepository,n),this._materialRenderers.set(n,a),t=!0,r=!0,i=!0),!a)return;const s=r||a.hasHighlights,o=i||a.hasWater;a.modify(e),r=r||s!==a.hasHighlights,i=i||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(n),a.dispose(),t=!0)}),this._changes.clear(),t&&this.updateSortedMaterialRenderers(),r&&(this._hasHighlights=Object(c["c"])(this._materialRenderers,e=>e.hasHighlights)),i&&(this._hasWater=Object(c["c"])(this._materialRenderers,e=>e.hasWater)),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=this._pending.empty;for(const r of e)this._pending.adds.add(r);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const r of e)this._pending.adds.has(r)?(this._pending.removed.add(r),this._pending.adds.delete(r)):this._pending.removed.has(r)||this._pending.removes.add(r);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=i,e.updateType=t}r&&this._changes.updates.length>0&&this.notifyChange("updating")}updateLogic(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:r})=>t=r.updateLogic(e)||t),t}render(e,t){for(let r=0;r<this._sortedMaterialRenderers.length;r++){const i=this._sortedMaterialRenderers.data[r];i.material.shouldRender(e)&&i.materialRenderer.render(t.slot,e.pass,t)}}updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push({material:r,materialRenderer:t})}),this._sortedMaterialRenderers.sort((e,t)=>{const r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(i["a"])([Object(p["b"])()],V.prototype,"rctx",void 0),Object(i["a"])([Object(p["b"])()],V.prototype,"materialRepository",void 0),Object(i["a"])([Object(p["b"])()],V.prototype,"updating",null),V=Object(i["a"])([Object(f["a"])("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],V);class U{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}var G=r("7aed"),N=r("2bc9"),B=r("2245"),k=r("c1c0"),H=r("9305"),q=r("8539");const W=o["a"].getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let $=class extends(Object(T["b"])(n["a"])){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new B["a"],this._handles=new s["a"],this._frameTask=H["a"],this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new u["a"],this._geometries=new Map,this.worldToPCSRatio=1,this.events=new a["a"],this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new z["a"](this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new k["a"](e.renderingContext),this._shaderTechniqueRepository=new P["a"]({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Object(h["a"])(t,"loadingState",()=>this.events.emit("content-changed")),Object(h["a"])(this,"spatialReference",e=>this._localOrigins=new M["a"](e))]),this._materialRepository=new A["a"](e.textureRepository,this._shaderTechniqueRepository,e=>{(e.renderOccluded&te)>0!==this._rendersOccluded&&this.updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new N["a"](Object(g["h"])(1,1,1))]),this._bindParameters={slot:20,highlightDepthTexture:Object(R["b"])(this._rctx),camera:X,inverseViewport:Object(m["b"])(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:v["a"],ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._frameTask=this.view.resourceController.scheduler.registerTask(H["b"].STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._layerRenderers.forEach(e=>e.dispose()),this._layerRenderers.clear(),this._debugTextureTechnique=Object(l["s"])(this._debugTextureTechnique),this._debugPatternTexture=Object(l["f"])(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l["f"])(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l["f"])(this._shaderTechniqueRepository),this._temporaryFBO=Object(l["f"])(this._temporaryFBO),this._quadVAO=Object(l["f"])(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedLayerRenderersDirty||this._frameTask.updating||Object(c["c"])(this._layerRenderers,e=>e.updating)}get hasOverlays(){return Object(l["l"])(this._overlays)&&Object(l["l"])(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l["l"])(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l["l"])(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(i,r,e)||t}return t}get overlays(){return Object(l["v"])(this._overlays,[])}ensureDrapeTargets(e){Object(l["l"])(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=Object(d["a"])(e,e=>1===e.drapeTargetType)})}ensureDrapeSources(e){Object(l["l"])(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=Object(c["c"])(e,(e,t)=>1===t.drapeSourceType),t.hasDrapedRasterSource=Object(c["c"])(e,(e,t)=>0===t.drapeSourceType)})}ensureOverlays(e,t){Object(l["k"])(this._overlays)&&(this._overlayRenderTarget=new w(this._rctx),this._overlays=[new O["a"](0,this._overlayRenderTarget),new O["a"](1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(l["f"])(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}_processLayers(e,t){let r=!1;for(const[i,n]of this._layerRenderers){if(e.done)break;(i.destroyed||t(i))&&(n.commitChanges()&&(r=!0,e.madeProgress()),n.isEmpty&&(r=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(i),this._handles.remove(i)))}this.updateSortedLayerRenderers(),r&&(Object(l["l"])(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}processSyncLayers(){this._processLayers(H["d"],e=>1===e.updatePolicy)}addGeometries(e,t,r){for(const i of e)Object(l["k"])(i.origin)&&(i.origin=this._localOrigins.getOrigin(i.boundingSphere)),this._geometries.set(i.id,i);this.ensureLayerRenderer(t).add(e),2===r&&this.notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,r){for(const n of e)this._geometries.delete(Object(l["u"])(n.id));const i=this._layerRenderers.get(t);i&&(i.remove(e),2===r&&this.notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,r){const i=this._layerRenderers.get(t);if(i)switch(i.modify(e,r),r){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else W.warn("Attempted to update geometry for nonexistent layer")}notifyGraphicGeometryChanged(e,t){if(Object(l["k"])(t.notifyGraphicGeometryChanged))return;let r;for(const i of e){const e=i.graphicUid;Object(l["l"])(e)&&e!==r&&(t.notifyGraphicGeometryChanged(e),r=e)}}notifyGraphicVisibilityChanged(e,t){if(Object(l["k"])(t.notifyGraphicVisibilityChanged))return;let r;for(const i of e){const e=i.graphicUid;Object(l["l"])(e)&&e!==r&&(t.notifyGraphicVisibilityChanged(e),r=e)}}updateHighlights(e,t){const r=this._layerRenderers.get(t);r?r.modify(e,8):W.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!y["a"].OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateLogic(e){let t=!1;return this._layerRenderers.forEach(r=>t=r.updateLogic(e)||t),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(0===i.numViews)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const n=t.renderPass;if(this.isEmpty()||5===n&&!this.hasHighlights||3===n&&!this.hasWater||!e.hasSomeSizedView())return!1;const a=t.fbo;if(!a.isValid())return!1;const s=2*e.resolution,o=e.resolution;a.resize(s,o);const c=this._rctx;X.pixelRatio=e.pixelRatio*r,this._renderContext.pass=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===n?21:20,e.applyViewport(this._rctx),a.bind(c),0===e.index&&(c.setClearColor(0,0,0,0),c.clearSafe(16384));const u=1===t.type?2:4===t.type?1:0;if(1===u&&(this._renderContext.renderOccludedMask=te),y["a"].OVERLAY_DRAW_DEBUG_TEXTURE&&1!==u)for(let l=0;l<i.numViews;l++)this.setViewParameters(i.extents[l],e,X),this.drawDebugTexture(e.resolution,Y[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll(({layerView:t,renderer:r})=>{if(2===u&&Object(l["l"])(t)&&0===t.drapeSourceType)return;const d=Object(l["l"])(t)&&Object(l["l"])(t.fullOpacity)&&t.fullOpacity<1&&0===n;d&&(this.bindTemporaryFramebuffer(this._rctx,s,o),c.clearSafe(16384));for(let n=0;n<i.numViews;n++)this.setViewParameters(i.extents[n],e,X),r.render(this._renderContext,this._bindParameters);d&&Object(l["l"])(this._temporaryFBO)&&(a.bind(c),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,Object(l["u"])(Object(l["u"])(t).fullOpacity),3,e.index))}),c.bindFramebuffer(null),a.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){Object(l["k"])(this._temporaryFBO)&&(this._temporaryFBO=new S(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}intersect(e,t,r,i){let n=0;this._geometries.forEach(a=>{if(i&&!i(a))return;this._intersectRenderGeometry(a,r,t,0,e,n);const s=this.longitudeCyclical;s&&(a.boundingSphere[0]-a.boundingSphere[3]<s.min&&this._intersectRenderGeometry(a,r,t,s.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>s.max&&this._intersectRenderGeometry(a,r,t,-s.range,e,n)),n++})}_intersectRenderGeometry(e,t,r,i,n,a){if(!e.instanceParameters.visible)return;let s=0;Object(l["l"])(e.transformation)&&(i+=e.transformation[12],s=e.transformation[13]),Q[0]=r[0]-i,Q[1]=r[1]-s,Q[2]=1,K[0]=r[0]-i,K[1]=r[1]-s,K[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,Q,K,(r,i,s)=>{J(t,s,e.material.renderPriority,a,n,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}ensureLayerRenderer(e){let t=this._layerRenderers.get(e);return t||(t=new V({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,t),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",()=>this.events.emit("content-changed")),e),this._handles.add(Object(h["a"])(t,"updating",()=>this.notifyChange("updating")),e)),t}updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const e=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach(t=>{const r=t,i=this._layerRenderers.get(r);i&&(this._sortedLayerRenderers.push(new Z(r,i)),e.delete(i))}),e.forEach(e=>this._sortedLayerRenderers.push(new Z(null,e)))}setViewParameters(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,Object(b["p"])(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Object(b["j"])(r.viewMatrix),Object(b["b"])(r.viewMatrix,r.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=r,this._bindParameters.camera=r,this._bindParameters.inverseViewport[0]=1/r.fullViewport[2],this._bindParameters.inverseViewport[1]=1/r.fullViewport[3]}updateHasWater(){const e=Object(c["c"])(this._layerRenderers,e=>e.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}updateHasHighlights(){const e=Object(c["c"])(this._layerRenderers,e=>e.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}updateRendersOccluded(){const e=Object(c["c"])(this._layerRenderers,e=>e.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}drawDebugTexture(e,t){const r=this._rctx;this.ensureDebugPatternResources(e,e);const i=this._debugTextureTechnique.program;r.useProgram(i),this._debugTextureTechnique.bindPipelineState(r),i.setUniform4f("color",t[0],t[1],t[2],1),i.bindTexture(this._debugPatternTexture,"tex"),r.bindVAO(this._quadVAO),r.drawArrays(5,0,Object(q["e"])(this._quadVAO,"geometry"))}ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const r=new Uint8Array(e*t*4);let i=0;for(let a=0;a<t;a++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(a/10);s<2||o<2||10*s>e-20||10*o>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&s&&1&o?1&n^1&a?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new _["a"](this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r);const n=new G["b"];n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(G["a"],n),this._quadVAO=Object(R["d"])(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};Object(i["a"])([Object(p["b"])()],$.prototype,"_frameTask",void 0),Object(i["a"])([Object(p["b"])()],$.prototype,"_sortedLayerRenderersDirty",void 0),Object(i["a"])([Object(T["c"])()],$.prototype,"_shaderTechniqueRepository",void 0),Object(i["a"])([Object(T["c"])()],$.prototype,"_stippleTextureRepository",void 0),Object(i["a"])([Object(p["b"])({constructOnly:!0})],$.prototype,"view",void 0),Object(i["a"])([Object(p["b"])()],$.prototype,"worldToPCSRatio",void 0),Object(i["a"])([Object(p["b"])()],$.prototype,"spatialReference",void 0),Object(i["a"])([Object(p["b"])({type:Boolean,readOnly:!0})],$.prototype,"updating",null),$=Object(i["a"])([Object(f["a"])("esri.views.3d.terrain.OverlayRenderer")],$);class Z{constructor(e,t){this.layerView=e,this.renderer=t}}const Y=[[1,.5,.5],[.5,.5,1]];function J(e,t,r,i,n,a,s){const o={layerUid:a,graphicUid:s,triangleNr:t},c=t=>{t.set(3,o,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&c(n.results.min),0!==n.options.store&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&c(n.results.max),2===n.options.store){const e=Object(D["c"])(n.ray);c(e),n.results.all.push(e)}}const X=new E["a"];X.near=1,X.far=1e4,X.relativeElevation=null;const Q=Object(g["f"])(),K=Object(g["f"])(),ee=-2,te=4},"7abc":function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("0b2d");class n{constructor(e,t){this.vec3=e,this.id=t}}function a(e,t,r,a){return new n(Object(i["h"])(e,t,r),a)}},"7aed":function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h}));var i=r("a4ee"),n=r("3e44"),a=r("c3a4"),s=r("ca98"),o=r("da35"),c=r("fa1e"),l=r("c829"),u=r("189c");class d extends s["a"]{initializeProgram(e){const t=d.shader.get().build();return new l["a"](e.rctx,t,c["a"])}initializePipeline(){return this.configuration.hasAlpha?Object(u["g"])({blending:Object(u["h"])(770,1,771,771),colorWrite:u["d"]}):Object(u["g"])({colorWrite:u["d"]})}}d.shader=new a["a"](n["a"],()=>r.e("chunk-2d0b3143").then(r.bind(null,"279a")));class h extends o["a"]{constructor(){super(...arguments),this.hasAlpha=!1}}Object(i["a"])([Object(o["b"])()],h.prototype,"hasAlpha",void 0)},"7b96":function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r("b2b2"),n=r("e431"),a=r("0b2d"),s=r("4261"),o=r("f895"),c=r("e9d6"),l=r("ba58");class u{constructor(e,t,r,i,n,a,s,o=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._uniqueGeometries=r,this._uniqueMaterials=i,this._uniqueTextures=n,this.elevationAligner=a,this.elevationContext=s,this._edgeState=o,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=e,this.stageObject=t}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(e,t){this._stageLayer=t,this._stage=e,e.addMany(this._uniqueMaterials),e.addMany(this._uniqueGeometries),e.addMany(this._uniqueTextures),e.load(this._uniqueTextures),e.add(this.stageObject)}destroy(){const e=this._stage;this._stageLayer&&(e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.removeMany(this._uniqueTextures)),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)&&t.removeObject(this.stageObject),this.stageObject.dispose(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(e,t){if(Object(i["k"])(this._edgeState))return;const r=d(this._edgeState.baseMaterial);let n=!1;for(const i of this._edgeState.edgeMaterials)i.objectTransparency!==r&&(i.objectTransparency=r,n=!0);n&&this.resetEdgeObject(t),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,t){Object(i["k"])(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:e},!t),this._edgeState.properties.slicePlaneEnabled=e)}setVisibility(e){if(null!=this._stage&&this._visible!==e&&(this._visible=e,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),Object(i["l"])(this._edgeState))){const t=this._stage.renderView.ensureEdgeView();t.hasObject(this.stageObject)?t.updateObjectVisibility(this.stageObject,e):e&&this.addOrUpdateEdgeObject(t,!1)}}get visible(){return this._visible}alignWithElevation(e,t,r,n){null!=this.elevationAligner&&(Object(i["l"])(r)&&Object(c["g"])(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e,t),this.resetEdgeObject(n))}getCenterObjectSpace(e=Object(a["f"])()){return Object(n["n"])(e,Object(o["g"])(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(e=Object(s["h"])()){const t=this.stageObject.boundingVolumeObjectSpace;return Object(s["E"])(e,t.min),Object(s["D"])(e,t.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const t=this.stageObject.transformation;e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++}else for(const t of this.stageObject.geometryRecords)t.computeAttachmentOrigin(f)&&(Object(n["t"])(f,f,this.stageObject.transformation),Object(n["i"])(e.render.origin,e.render.origin,f),e.render.num++)}async getProjectedBoundingBox(e,t,r,a,o){const c=this.getBoundingBoxObjectSpace(o),u=b,d=Object(s["y"])(c)?1:u.length;for(let i=0;i<d;i++){const e=u[i];p[0]=c[e[0]],p[1]=c[e[1]],p[2]=c[e[2]],Object(n["t"])(p,p,this.stageObject.transformation),h[3*i+0]=p[0],h[3*i+1]=p[1],h[3*i+2]=p[2]}if(!e(h,0,d))return null;Object(s["k"])(c);let m=null;this.calculateRelativeScreenBounds&&(m=this.calculateRelativeScreenBounds());for(let i=0;i<3*d;i+=3){for(let e=0;e<3;e++)c[e]=Math.min(c[e],h[i+e]),c[e+3]=Math.max(c[e+3],h[i+e]);m&&r.push({location:h.slice(i,i+3),screenSpaceBoundingRect:m})}if(t&&t.service&&"absolute-height"!==this.elevationContext.mode){Object(s["e"])(c,f);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let r=0;if(t.useViewElevation)r=Object(i["v"])(t.service.getElevation(f[0],f[1],e),0);else try{const n=Object(l["d"])(c,t);r=Object(i["v"])(await t.service.queryElevation(f[0],f[1],a,n,e),0)}catch(g){}Object(s["A"])(c,0,0,-this.alignedSampledElevation+r)}return c}addObjectState(e,t){0===e&&t.addObject(this.stageObject,this.stageObject.highlight()),1===e&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(Object(i["k"])(this._edgeState))return;const t=this._stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(t,e):t.removeObject(this.stageObject)}addOrUpdateEdgeObject(e,t){const r=this._edgeState;if(Object(i["k"])(r))return;const n=d(r.baseMaterial);for(const i of r.edgeMaterials)i.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!t).then(()=>{var e;return null==(e=this._stageLayer)?void 0:e.sync()})}}function d(e){return e.isVisible?e.parameters.transparent?1:2:0}const h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=Object(a["f"])(),f=Object(a["f"])(),b=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},"7c1d":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){const t=i["a"]`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=i["a"]`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}},"7cb4":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("dfaf"),n=r("5211"),a=r("3886");function s(e,t){e.include(i["a"],t),e.fragment.code.add(a["a"]`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),1===t.attributeTextureCoordinates&&e.fragment.code.add(a["a"]`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`),2===t.attributeTextureCoordinates&&(e.include(n["a"]),e.fragment.code.add(a["a"]`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))}},"7cfb":function(e,t,r){"use strict";function i(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=r?r.count:t.count;let c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*s;for(let u=0;u<o;++u)i[c]=a[l],c+=n,l+=s}function n(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}r.d(t,"a",(function(){return n}));Object.freeze({__proto__:null,copy:i,makeDense:n})},"7d11":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("c332"),n=r("bc40"),a=r("3886");function s(e,t){0===t.normalType||1===t.normalType?(e.include(i["a"],t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(a["a"]`void forwardNormal() {
vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
}`)):2===t.normalType?(e.include(n["a"],t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(a["a"]`
    void forwardNormal() {
      vNormalWorld = ${1===t.viewingMode?a["a"]`normalize(vPositionWorldCameraRelative);`:a["a"]`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(a["a"]`void forwardNormal() {}`)}!function(e){function t(e,t){e.setUniformMatrix4fv("viewNormal",t)}e.bindUniforms=t}(s||(s={}))},"7e21":function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var i=r("d272"),n=r("4db9"),a=r("c332"),s=r("dfaf"),o=r("7d11"),c=r("c2d1"),l=r("6a07"),u=r("be24"),d=r("ebd5"),h=r("3886");function p(e,t){const r=e.vertex.code,p=e.fragment.code;1!==t.output&&3!==t.output||(e.include(n["a"],{linearDepth:!0}),e.include(s["a"],t),e.include(u["a"],t),e.include(c["a"],t),e.include(i["a"],t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add(h["a"]`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);
forwardTextureCoordinates();
}`),e.include(d["a"],t),p.add(h["a"]`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?h["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),2===t.output&&(e.include(n["a"],{linearDepth:!1}),e.include(a["a"],t),e.include(o["a"],t),e.include(s["a"],t),e.include(u["a"],t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),r.add(h["a"]`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===t.normalType?h["a"]`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),e.include(i["a"],t),e.include(d["a"],t),p.add(h["a"]`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?h["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===t.normalType?h["a"]`
            vec3 normal = screenDerivativeNormal(vPositionView);`:h["a"]`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),4===t.output&&(e.include(n["a"],{linearDepth:!1}),e.include(s["a"],t),e.include(u["a"],t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add(h["a"]`void main(void) {
vpos = calculateVPos();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),e.include(i["a"],t),e.include(d["a"],t),e.include(l["a"]),p.add(h["a"]`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?h["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}},"7e2d":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("c6ac");function n(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=r?r.count:t.count;let c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*s;for(let u=0;u<o;++u){for(let e=0;e<9;++e)i[c+e]=a[l+e];c+=n,l+=s}}Object.freeze({__proto__:null,copy:n});function a(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=r?r.count:t.count;let c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*s;for(let u=0;u<o;++u){for(let e=0;e<16;++e)i[c+e]=a[l+e];c+=n,l+=s}}Object.freeze({__proto__:null,copy:a});r("7cfb"),r("dc56"),r("4c96"),r("1c20");function s(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Object(i["a"])(e.ElementType)))}},"7e6b":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("a4ee"),n=r("6a0e"),a=r("59b2"),s=(r("b50f"),r("c120"),r("cea0"),r("d386")),o=r("a9ab");let c=class extends n["a"]{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:Object(o["c"])(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}};Object(i["a"])([Object(a["b"])()],c.prototype,"geometries",void 0),Object(i["a"])([Object(a["b"])({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0),Object(i["a"])([Object(a["b"])()],c.prototype,"transformation",void 0),Object(i["a"])([Object(a["b"])()],c.prototype,"transformForward",void 0),c=Object(i["a"])([Object(s["a"])("esri.rest.support.ProjectParameters")],c);const l=c},"7f60":function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return m}));var i=r("9ef0"),n=(r("c120"),r("e92d")),a=r("b2b2"),s=r("0b2d"),o=r("0fc4"),c=r("2e0f"),l=r("0eb9"),u=r("e9d6"),d=r("ba58"),h=r("5e82"),p=r("a803");const f=n["a"].getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class b extends h["a"]{constructor(e,t,r,i){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this.complexity=null,this.logger=f,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=e,this.symbolLayer=t,this._renderPriority=i.renderPriority,this._renderPriorityStep=i.renderPriorityStep,this._elevationContext=new l["a"],this.complexity=this.computeComplexity(),this._updateDrivenProperties(i.ignoreDrivers),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,t,r,i){const n=e.projectionSuccess,a="polygons"in e?e.polygons:null,s=i+" geometry failed to be created";let o=null;n?!t.length||1===t.length&&!t[0].length?o=`${s} (no ${r} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?a&&0===a.length&&"rings"===r&&t.length>0&&t[0].length>2&&(o=s+" (filled rings should use clockwise winding - try reversing the order of vertices)"):o=`${s} (${r} should be defined as a 2D array)`:o=s+" (failed to project geometry to view spatial reference)",o&&f.warnOncePerTick(o)}_validateGeometry(e,t=null,r=null){if(Object(a["l"])(t)&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+" symbol: "+e.type),!1;if("point"===e.type){const t=e;if(!isFinite(t.x)||!isFinite(t.y))return f.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return g}_defaultElevationInfoZ(){return v}_updateElevationContext(){Object(a["l"])(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,t){const r=Object(a["u"])(e.geometry),i=this.getDefaultElevationInfo(r);t.unit=null!=this._elevationContext.unit?this._elevationContext.unit:i.unit,t.mode=this.getGeometryElevationMode(r,i),t.offsetMeters=Object(a["v"])(this._elevationContext.meterUnitOffset,Object(a["v"])(i.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode;n&&(t.mode="relative-to-ground",t.offsetMeters=0);const s=n?u["h"]:this._elevationContext.featureExpressionInfoContext;return t.updateFeatureExpressionInfoContext(s,e,this._context.layer),t}prepareSymbolLayerPatch(e){}updateGeometry(e,t){return!1}onRemoveGraphic(e){}_updateDrivenProperties(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};if(e)return void(this._drivenProperties=t);const r=this._context.renderer;r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach(e=>{switch(e.type){case"color":if(t.color=!0,e.stops)for(let r=0;r<e.stops.length;r++){const i=e.stops[r].color;i&&(t.opacity=!0,i.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),this._drivenProperties=t}_getLayerOpacity(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const e=this._context.layer.opacity;return null==e?1:e}_getCombinedOpacity(e,t=y){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(Object(a["l"])(e)?r*=e.a:t.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,t=y){const r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return Object(d["g"])(null,r);const n=Object(a["l"])(e)?i["a"].toUnitRGB(e):s["a"];return Object(d["g"])(n,r)}_getVertexOpacityAndColor(e,t=null){const r=this._drivenProperties.color?e.color:null,i=this._drivenProperties.opacity?e.opacity:null,n=Object(d["g"])(r,i);return Object(a["l"])(t)&&(n[0]*=t,n[1]*=t,n[2]*=t,n[3]*=t),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Object(p["c"])(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r);case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,e)!==c["b"].RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(e,t,r){let i=c["b"].UPDATE;return e.forEach(e=>{const n=t(e);if(Object(a["l"])(n)){const t=e.graphic;this.setGraphicElevationContext(t,n.elevationContext),n.needsElevationUpdates=r(n.elevationContext.mode)}else i=c["b"].RECREATE}),i}applyRendererDiff(e,t){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,r=t.size?m(t.size.field,e):0,i=t.color?m(t.color.field,e):0,n=t.opacity?m(t.opacity.field,e):0;return Object(o["g"])(r,i,n,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&f.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}}function m(e,t){const r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}const g={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"},y={hasIntrinsicColor:!1}},8202:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var i=r("a4ee"),n=r("fc29"),a=r("ce6d"),s=r("af40"),o=r("b2b2"),c=r("59b2"),l=(r("b50f"),r("c120"),r("cea0"),r("d386")),u=r("8a44"),d=r("9180"),h=r("9305");const p=.05;class f{constructor(){this._extents=new u["a"]({allocator:e=>e||Object(d["m"])()}),this._tmpExtent=Object(d["m"])(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this.contains(e)||(this.removeContained(e),Object(d["l"])(this._extents.pushNew(),e),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(e){return this.mergeTight(e),e.hasProgressed}mergeTight(e=h["d"]){const t=this._extents,r=new Set;let i=0;for(;i!==t.length;){t.sort((e,t)=>e[0]-t[0]),i=t.length,r.clear();for(let i=0;i<t.length;++i){if(e.done)return;const n=t.getItemAt(i);for(let e=i+1;e<t.length;++e){const i=t.getItemAt(e);if(i[0]>=n[2])break;r.add(i)}r.forEach(i=>{if(n===i)return;if(i[2]<=n[0])return void r.delete(i);const a=Object(d["d"])(n),s=Object(d["d"])(i),o=this._tmpExtent;Object(d["q"])(n,i,o);const c=a+s;(Object(d["d"])(o)-c)/c<p&&(Object(d["l"])(n,o),r.delete(i),t.remove(i),e.madeProgress())}),r.add(n)}}this._dirty=!1}contains(e){return this._extents.some(t=>Object(d["g"])(t,e))}removeContained(e){this._extents.filterInPlace(t=>!Object(d["g"])(e,t))}get test(){const e=this;return{containsPoint:t=>e._extents.some(e=>Object(d["h"])(e,t))}}}let b=class extends n["a"]{constructor(){super(...arguments),this.dirtyExtents=new f,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new s["a"],this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new a["a"]}setup(e,t,r,i){this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;const n=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",e=>this._elevationChanged(e)),this.layerView.watch("suspended",()=>this.suspendedChange()),n.registerTask(h["b"].ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange("updating")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run(()=>this.dirtyExtents.merge(e));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.layerView.view.renderCoordsHelper,r=0===this.graphicsCore.effectiveUpdatePolicy;for(const i of this.dirtyGraphicsSet.keys()){const n=this.graphicsCore.getGraphics3DGraphicById(i);if(this.dirtyGraphicsSet.delete(i),Object(o["l"])(n)&&(n.alignWithElevation(this.elevationProvider,t,r),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),r=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:r});const i=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,r,e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);Object(o["l"])(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)}),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-i)+.9*this.averageExtentUpdateSize,e.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((e,t)=>this.dirtyGraphicsSet.add(t))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:r}=e;if(this.layerView.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:r})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}};Object(i["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"updating",null),Object(i["a"])([Object(c["b"])({readOnly:!0})],b.prototype,"updatingRemaining",null),b=Object(i["a"])([Object(l["a"])("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],b);const m=b},"83fa":function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i,n=r("a4ee"),a=r("9ef0"),s=r("b2b2"),o=r("59b2"),c=(r("b50f"),r("c120"),r("cea0"),r("d386")),l=r("dee7"),u=r("88da");let d=i=class extends l["a"]{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=Object(s["l"])(e)?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return Object(s["l"])(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:Object(s["l"])(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:Object(s["l"])(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:Object(s["l"])(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:Object(s["l"])(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};Object(n["a"])([Object(o["b"])({type:a["a"],json:{write:!0}})],d.prototype,"emissiveColor",void 0),Object(n["a"])([Object(o["b"])({type:u["a"],json:{write:!0}})],d.prototype,"emissiveTexture",void 0),Object(n["a"])([Object(o["b"])({type:u["a"],json:{write:!0}})],d.prototype,"occlusionTexture",void 0),Object(n["a"])([Object(o["b"])({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"metallic",void 0),Object(n["a"])([Object(o["b"])({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],d.prototype,"roughness",void 0),Object(n["a"])([Object(o["b"])({type:u["a"],json:{write:!0}})],d.prototype,"metallicRoughnessTexture",void 0),d=i=Object(n["a"])([Object(c["a"])("esri.geometry.support.MeshMaterialMetallicRoughness")],d);const h=d},"84f4":function(e,t,r){"use strict";function i(e){return"point"===e.type}r.d(t,"a",(function(){return i}))},8675:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return s}));var i=r("fc00"),n=r("5957");const a=Object(i["a"])().vec3f("position"),s=Object(i["a"])().vec3f("position").vec2f("uv0"),o=Object(i["a"])().vec3f("position").vec4u8("color");class c{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(n["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}},"86ba":function(e,t,r){"use strict";r.d(t,"a",(function(){return U}));var i=r("e92d"),n=r("38a4"),a=r("b2b2"),s=r("a915"),o=r("3349"),c=r("e431"),l=r("0b2d"),u=r("bd7e"),d=r("7289"),h=r("fc00"),p=r("1038"),f=r("d7f7"),b=r("b061"),m=r("35b3"),g=r("1153"),v=r("b4c8"),y=r("b623"),O=r("9a68"),x=r("a4ee"),j=r("d272"),_=r("6a07"),S=r("c6d7"),w=r("be24"),C=r("8e97"),P=r("c3a4"),T=r("ca98"),E=r("da35"),A=r("7438"),R=r("c829"),M=r("87b7"),D=r("189c");const z=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);class I extends T["a"]{constructor(e,t,r){super(e,t,r),this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&4!==this.configuration.output}initializeProgram(e){const t=I.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:r.stippleScaleWithLineWidth,stipplePreferContinuous:r.stipplePreferContinuous,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new R["a"](e.rctx,i,z)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(C["c"])(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(_["b"])(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(S["a"])(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(w["d"])(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:i,pixels:n}=Object(a["l"])(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};if(this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){const t=Object(a["u"])(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(a["v"])(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){Object(C["d"])(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(C["a"])(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(j["c"])(this.program,this.configuration,e),this.program.rebindTextures()}makePipelineState(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(D["g"])({blending:0===r.output||7===r.output?i?A["g"]:Object(A["a"])(e):null,depthTest:{func:Object(A["b"])(e)},depthWrite:i?!r.transparent&&r.writeDepth&&D["e"]:Object(A["c"])(e),colorWrite:D["d"],stencilWrite:r.sceneHasOcludees?M["j"]:null,stencilTest:r.sceneHasOcludees?t?M["f"]:M["e"]:null,polygonOffset:i||n?r.polygonOffset&&L:A["d"]})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&L;return e.occluder&&(this._occluderPipelineTransparent=Object(D["g"])({blending:A["g"],polygonOffset:t,depthTest:M["a"],depthWrite:null,colorWrite:D["d"],stencilWrite:null,stencilTest:M["h"]}),this._occluderPipelineOpaque=Object(D["g"])({blending:A["g"],polygonOffset:t,depthTest:M["a"],depthWrite:null,colorWrite:D["d"],stencilWrite:M["i"],stencilTest:M["g"]}),this._occluderPipelineMaskWrite=Object(D["g"])({blending:null,polygonOffset:t,depthTest:M["b"],depthWrite:null,colorWrite:null,stencilWrite:M["j"],stencilTest:M["f"]})),this._occludeePipelineState=this.makePipelineState(this.configuration.transparencyPassType,!0),this.makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?10===e?this._occluderPipelineTransparent:9===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}I.shader=new P["a"](O["b"],()=>r.e("chunk-2d213386").then(r.bind(null,"ac6d")));const L={factor:0,units:-4};class F extends E["a"]{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(x["a"])([Object(E["b"])({count:8})],F.prototype,"output",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"occluder",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"slicePlaneEnabled",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"transparent",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"polygonOffset",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"writeDepth",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"draped",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"stippleEnabled",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"stippleOffColorEnabled",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"stippleScaleWithLineWidth",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"stipplePreferContinuous",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"roundCaps",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"roundJoins",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"vvSize",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"vvColor",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"vvOpacity",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"falloffEnabled",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"innerColorEnabled",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"sceneHasOcludees",void 0),Object(x["a"])([Object(E["b"])({count:4})],F.prototype,"transparencyPassType",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"multipassTerrainEnabled",void 0),Object(x["a"])([Object(E["b"])()],F.prototype,"cullAboveGround",void 0);const V=i["a"].getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class U extends m["a"]{constructor(e){super(e,N),this._vertexAttributeLocations=z,this.techniqueConfig=new F,this.layout=this.createLayout()}isClosed(e,t){return q(this.parameters,e,t)}dispose(){}getPassParameters(){return this.parameters}getTechniqueConfig(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=20===t.slot;const r=Object(a["l"])(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&Object(a["l"])(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.roundCaps=2===this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&Object(a["l"])(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=8===this.parameters.renderOccluded,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,r,i,n,s,o,c,l){Object(a["l"])(l)?this.intersectDrapedLineGeometry(e,i,l,s,o):this.intersectLineGeometry(e,t,r,i,o)}intersectDrapedLineGeometry(e,t,r,i,a){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size");let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];c*=Object(n["f"])(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(c*=o.data[0]);const l=i[0],u=i[1],d=(c/2+4)*e.screenToWorldRatio;let h=Number.MAX_VALUE,p=0;for(let f=0;f<s.length-5;f+=3){const e=s[f],t=s[f+1],r=l-e,i=u-t,a=s[f+3]-e,o=s[f+4]-t,c=Object(n["f"])((a*r+o*i)/(a*a+o*o),0,1),d=a*c-r,b=o*c-i,m=d*d+b*b;m<h&&(h=m,p=f/3)}h<d*d&&a(r.dist,r.normal,p,!1)}intersectLineGeometry(e,t,r,i,a){if(!i.options.selectionMode||Object(y["d"])(t))return;if(!Object(g["g"])(r))return void V.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes,l=s.get("position").data;let h=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=s.get("sizeFeatureAttribute").data[0];h*=Object(n["f"])(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s.has("size")&&(h*=s.get("size").data[0]);const p=i.camera,f=J;Object(o["c"])(f,i.point);const b=h*p.pixelRatio/2+4*p.pixelRatio;Object(c["z"])(se[0],f[0]-b,f[1]+b,0),Object(c["z"])(se[1],f[0]+b,f[1]+b,0),Object(c["z"])(se[2],f[0]+b,f[1]-b,0),Object(c["z"])(se[3],f[0]-b,f[1]-b,0);for(let n=0;n<4;n++)if(!p.unprojectFromRenderScreen(se[n],oe[n]))return;Object(d["g"])(p.eye,oe[0],oe[1],ce),Object(d["g"])(p.eye,oe[1],oe[2],le),Object(d["g"])(p.eye,oe[2],oe[3],ue),Object(d["g"])(p.eye,oe[3],oe[0],de);let m=Number.MAX_VALUE,v=0;const O=H(this.parameters,s,e.indices)?l.length-2:l.length-5;for(let n=0;n<O;n+=3){W[0]=l[n]+r[12],W[1]=l[n+1]+r[13],W[2]=l[n+2]+r[14];const e=(n+3)%l.length;if($[0]=l[e]+r[12],$[1]=l[e+1]+r[13],$[2]=l[e+2]+r[14],Object(d["v"])(ce,W)<0&&Object(d["v"])(ce,$)<0||Object(d["v"])(le,W)<0&&Object(d["v"])(le,$)<0||Object(d["v"])(ue,W)<0&&Object(d["v"])(ue,$)<0||Object(d["v"])(de,W)<0&&Object(d["v"])(de,$)<0)continue;if(p.projectToRenderScreen(W,X),p.projectToRenderScreen($,Q),X[2]<0&&Q[2]>0){Object(c["m"])(Z,W,$);const e=p.frustum,t=-Object(d["v"])(e[4],W)/Object(c["k"])(Z,Object(d["r"])(e[4]));Object(c["h"])(Z,Z,t),Object(c["i"])(W,W,Z),p.projectToRenderScreen(W,X)}else if(X[2]>0&&Q[2]<0){Object(c["m"])(Z,$,W);const e=p.frustum,t=-Object(d["v"])(e[4],$)/Object(c["k"])(Z,Object(d["r"])(e[4]));Object(c["h"])(Z,Z,t),Object(c["i"])($,$,Z),p.projectToRenderScreen($,Q)}else if(X[2]<0&&Q[2]<0)continue;X[2]=0,Q[2]=0;const t=Object(u["e"])(Object(u["f"])(X,Q,te),f);t<m&&(m=t,Object(c["n"])(K,W),Object(c["n"])(ee,$),v=n/3)}const x=i.rayBegin,j=i.rayEnd;if(m<b*b){let e=Number.MAX_VALUE;if(Object(u["a"])(Object(u["f"])(K,ee,te),Object(u["f"])(x,j,re),Y)){Object(c["m"])(Y,Y,x);const t=Object(c["s"])(Y);Object(c["h"])(Y,Y,1/t),e=t/Object(c["p"])(x,j)}a(e,Y,v,!1)}}computeAttachmentOrigin(e,t){const r=e.vertexAttributes;if(!r)return null;const i=e.indices,n=r.get("position");return Object(p["a"])(n,i?i.get("position"):null,i&&H(this.parameters,r,i),t)}createLayout(){const e=Object(h["a"])().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.parameters.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.parameters.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.parameters.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new B(this.layout,this.parameters)}requiresSlot(e,t){if(20===e)return!0;if(8===this.parameters.renderOccluded)return 2===e||9===e||10===e;const r=Object(b["b"])(t);return 0===r||7===r?e===(this.parameters.writeDepth?4:7):2===e}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new G(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return Object(a["l"])(e)&&e[3]<1&&e[3]>0}}class G extends f["a"]{updateParameters(e){return this.ensureTechnique(I,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const N={width:0,color:[1,1,1,1],join:"miter",cap:0,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...m["b"],...v["a"].Default};class B{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=O["a"]+r}}isClosed(e){return H(this.parameters,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.parameters.cap){case 1:case 2:return 1;default:return 0}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,r=e.indices.get("position").length/2+1,i=this.isClosed(e);let n=i?2:2*t;const a=i?0:1,s=i?r:r-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=a;e<s;++e)n+=4+2*t[e]}else n+=(s-a)*(2*this.numJoinSubdivisions+4);return n+=2,n}write(e,t,r,i){var n;const a=ie,s=ne,o=ae,l=t.vertexAttributes.get("position").data,u=t.indices&&t.indices.get("position"),d=null==(n=t.vertexAttributes.get("distanceToStart"))?void 0:n.data,h=this.numCapSubdivisions(t);u&&u.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=null;t.vertexAttributes.has("subdivisions")&&(p=t.vertexAttributes.get("subdivisions").data);let f=1,b=0;this.parameters.vvSizeEnabled?b=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(f=t.vertexAttributes.get("size").data[0]);let m=[1,1,1,1],g=0;this.parameters.vvColorEnabled?g=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(m=t.vertexAttributes.get("color").data);let v=0;this.parameters.vvOpacityEnabled&&(v=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const y=l.length/3,O=e.transformation,x=new Float32Array(r.buffer),j=this.vertexBufferLayout.stride/4;let _=i*j;const S=_;let w=0;const C=(e,t,r,i,n,a,s)=>{if(x[_++]=t[0],x[_++]=t[1],x[_++]=t[2],x[_++]=i,x[_++]=s,x[_++]=n,x[_++]=e[0],x[_++]=e[1],x[_++]=e[2],x[_++]=r[0],x[_++]=r[1],x[_++]=r[2],this.parameters.vvSizeEnabled?x[_++]=b:x[_++]=f,this.parameters.vvColorEnabled)x[_++]=g;else{const e=Math.min(4*a,m.length-4);x[_++]=m[e+0],x[_++]=m[e+1],x[_++]=m[e+2],x[_++]=m[e+3]}this.parameters.vvOpacityEnabled&&(x[_++]=v)};_+=j,Object(c["z"])(s,l[0],l[1],l[2]),O&&Object(c["t"])(s,s,O);const P=this.isClosed(t);if(P){const e=l.length-3;Object(c["z"])(a,l[e],l[e+1],l[e+2]),O&&Object(c["t"])(a,a,O)}else{Object(c["n"])(a,s),Object(c["z"])(o,l[3],l[4],l[5]),O&&Object(c["t"])(o,o,O);for(let e=0;e<h;++e){const t=1-e/h;C(a,s,o,t,-4,0,w),C(a,s,o,t,4,0,w)}C(a,s,o,0,-4,0,w),C(a,s,o,0,4,0,w),Object(c["n"])(a,s),Object(c["n"])(s,o)}const T=P?0:1,E=P?y:y-1,A=d?(e,t,r)=>w=d[r]:(e,t,r)=>w+=Object(c["p"])(e,t);for(let R=T;R<E;R++){const e=(R+1)%y*3;Object(c["z"])(o,l[e+0],l[e+1],l[e+2]),O&&Object(c["t"])(o,o,O),A(a,s,R),C(a,s,o,0,-1,R,w),C(a,s,o,0,1,R,w);const t=p?p[R]:this.numJoinSubdivisions;for(let r=0;r<t;++r){const e=(r+1)/(t+1);C(a,s,o,e,-1,R,w),C(a,s,o,e,1,R,w)}C(a,s,o,1,-2,R,w),C(a,s,o,1,2,R,w),Object(c["n"])(a,s),Object(c["n"])(s,o)}if(P)Object(c["z"])(o,l[3],l[4],l[5]),O&&Object(c["t"])(o,o,O),w=A(a,s,E),C(a,s,o,0,-1,T,w),C(a,s,o,0,1,T,w);else{w=A(a,s,E),C(a,s,o,0,-5,E,w),C(a,s,o,0,5,E,w);for(let e=0;e<h;++e){const t=(e+1)/h;C(a,s,o,t,-5,E,w),C(a,s,o,t,5,E,w)}}k(x,S+j,x,S,j),_=k(x,_-j,x,_,j)}}function k(e,t,r,i,n){for(let a=0;a<n;a++)r[i++]=e[t++];return i}function H(e,t,r){return q(e,t.get("position").data,r?r.get("position"):null)}function q(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}const W=Object(l["f"])(),$=Object(l["f"])(),Z=Object(l["f"])(),Y=Object(l["f"])(),J=Object(l["f"])(),X=Object(s["e"])(),Q=Object(s["e"])(),K=Object(l["f"])(),ee=Object(l["f"])(),te=Object(u["d"])(),re=Object(u["d"])(),ie=Object(l["f"])(),ne=Object(l["f"])(),ae=Object(l["f"])(),se=[Object(s["e"])(),Object(s["e"])(),Object(s["e"])(),Object(s["e"])()],oe=[Object(l["f"])(),Object(l["f"])(),Object(l["f"])(),Object(l["f"])()],ce=Object(d["d"])(),le=Object(d["d"])(),ue=Object(d["d"])(),de=Object(d["d"])()},"88da":function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var i,n=r("a4ee"),a=(r("c120"),r("6a0e")),s=r("59b2"),o=(r("b50f"),r("cea0")),c=r("afcf"),l=r("d386"),u=r("09db"),d=r("fcf2"),h=r("4dc1");const p=new WeakMap;let f=0,b=i=class extends a["a"]{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const n={type:"image-element",src:Object(d["e"])(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){const i=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this.encodeImageData(i)};t[r]=n}else if(e instanceof HTMLVideoElement){const n={type:"video-element",src:Object(d["e"])(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=n}else{const i={type:"image-data",imageData:this.encodeImageData(e)};t[r]=i}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this.decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this.decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){const e=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(".png"===e||"data:image/png;"===r)return!0}return!1}set transparent(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return null!=this.url?t(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(p.has(this.data)||p.set(this.data,++f),t(p.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this.cloneWrap()};return new i(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return Object(h["h"])(r,e.width,e.height)}imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}static from(e){return"string"==typeof e?new i({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new i({data:e}):Object(o["d"])(i,e)}};Object(n["a"])([Object(s["b"])({type:String,json:{write:d["f"]}})],b.prototype,"url",null),Object(n["a"])([Object(s["b"])({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),Object(s["b"])()],b.prototype,"data",null),Object(n["a"])([Object(u["a"])("data")],b.prototype,"writeData",null),Object(n["a"])([Object(c["a"])("data")],b.prototype,"readData",null),Object(n["a"])([Object(s["b"])({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null),Object(n["a"])([Object(s["b"])({json:{write:!0}})],b.prototype,"wrap",void 0),Object(n["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"contentHash",null),b=i=Object(n["a"])([Object(l["a"])("esri.geometry.support.MeshTexture")],b);const m=b},"89cb":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("ce50"),n=r("e92d"),a=r("008c");function s(e,t,r,i,a){const s=e.referencesGeometry()&&a?c(t,i,a):t,o=e.repurposeFeature(s);try{return e.evaluate({...r,$feature:o})}catch(l){return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const o=new Map;function c(e,t,r){const{transform:i,hasZ:n,hasM:a}=r;o.has(t)||o.set(t,l(t));const s=o.get(t)(e.geometry,i,n,a);return{...e,geometry:s}}function l(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>Object(a["e"])(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>Object(a["f"])(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>Object(a["g"])(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>Object(a["d"])(r,t,e,i,n);default:return n["a"].getLogger("esri.views.2d.support.arcadeOnDemand").error(new i["a"]("mapview-arcade","Unable to handle geometryType: "+e)),e=>e}}},"8c4b":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("38a4");function n(e,t,r){var n;const l=e.byteLength/(4*t),u=new Uint32Array(e,0,l*t);let d=new Uint32Array(l);const h=null!=(n=null==r?void 0:r.minReduction)?n:0,p=(null==r?void 0:r.originalIndices)||null,f=p?p.length:0,b=(null==r?void 0:r.componentOffsets)||null;let m=0;if(b)for(let i=0;i<b.length-1;i++){const e=b[i+1]-b[i];e>m&&(m=e)}else m=l;const g=Math.floor(1.1*m)+1;(null==c||c.length<2*g)&&(c=new Uint32Array(Object(i["n"])(2*g)));for(let i=0;i<2*g;i++)c[i]=0;let v=0;const y=!!b&&!!p,O=y?f:l,x=y?new Uint32Array(f):null,j=1.96;let _=0!==h?Math.ceil(4*j*j/(h*h)*h*(1-h)):O,S=1,w=b?b[1]:O;for(let i=0;i<O;i++){if(i===_){const e=1-v/i;if(e+j*Math.sqrt(e*(1-e)/i)<h)return null;_*=2}if(i===w){for(let e=0;e<2*g;e++)c[e]=0;if(p)for(let e=b[S-1];e<b[S];e++)x[e]=d[p[e]];w=b[++S]}const e=y?p[i]:i,r=e*t,n=o(u,r,t);let s=n%g,l=v;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(a(u,r,e*t,t)){l=d[e];break}}s++,s>=g&&(s-=g)}l===v&&(c[2*s]=n,c[2*s+1]=e+1,v++),d[e]=l}if(0!==h&&1-v/l<h)return null;if(y){for(let e=b[S-1];e<x.length;e++)x[e]=d[p[e]];d=x}const C=new Uint32Array(t*v);v=0;for(let i=0;i<O;i++)d[i]===v&&(s(u,(y?p[i]:i)*t,C,v*t,t),v++);if(p&&!y){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=d[p[t]];d=e}return{buffer:C.buffer,indices:d,uniqueCount:v}}function a(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function s(e,t,r,i,n){for(let a=0;a<n;a++)r[i+a]=e[t+a]}function o(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let c=null},9250:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return O}));var i=r("b2b2"),n=r("d791"),a=r("afe1"),s=r("e431"),o=r("0b2d"),c=r("7577"),l=r("0fc4"),u=r("d18f");class d{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}var h=r("a978"),p=r("89bf"),f=r("b623");const b=1e-5;class m{constructor(e){this.options=new d,this._results=new v,this.transform=new p["a"],this.tolerance=b,this.verticalOffset=null,this._ray=Object(u["c"])(),this._rayEnd=Object(o["f"])(),this._rayBeginTransformed=Object(o["f"])(),this._rayEndTransformed=Object(o["f"])(),this.viewingMode=null==e?1:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay(Object(u["f"])(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&Object(u["b"])(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(s["i"])(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,n,a){this.point=t,this.filterPredicate=n,this.tolerance=null==r?b:r;const s=Object(p["d"])(this.verticalOffset);if(Object(i["l"])(e)&&e.length>0){const t=a?e=>{a(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator&&r.getSpatialQueryAccelerator();Object(i["l"])(e)?(Object(i["l"])(s)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll(e=>t(e))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const r=e.transformation,n=Object(p["d"])(this.verticalOffset);for(const o of t){const{geometry:t,material:c,instanceParameters:l}=o;if(Object(f["d"])(l))continue;const u=t.id;this.transform.setAndInvalidateLazyTransforms(r,o.getShaderTransformation()),Object(s["t"])(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Object(s["t"])(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const d=this.transform.transform;Object(i["l"])(n)&&(n.objectTransform=this.transform),c.intersect(t,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,r,n,s,o,c)=>{if(t>=0){if(Object(i["l"])(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;if(s){if(null==this._results.hud.dist||t<this._results.hud.dist){const i={object:e,geometryId:u,triangleNr:n,center:c};this._results.hud.set(1,i,t,r,a["a"],o)}return}const l=i=>i.set(0,{object:e,geometryId:u,triangleNr:n},t,r,d,o);if((null==this._results.min.drapedLayerOrder||o>=this._results.min.drapedLayerOrder)&&(null==this._results.min.dist||t<this._results.min.dist)&&l(this._results.min),0!==this.options.store&&(null==this._results.max.drapedLayerOrder||o<this._results.max.drapedLayerOrder)&&(null==this._results.max.dist||t>this._results.max.dist)&&l(this._results.max),2===this.options.store){const i=O(this._ray);i.set(0,{object:e,geometryId:u,triangleNr:n},t,r,d),this._results.all.push(i)}}},o.shaderTransformation)}}sortResults(){this._results.all.sort((e,t)=>e.dist!==t.dist?Object(i["v"])(e.dist,0)-Object(i["v"])(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?Object(i["v"])(e.drapedLayerOrder,Number.MAX_VALUE)-Object(i["v"])(t.drapedLayerOrder,Number.MAX_VALUE):Object(i["v"])(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-Object(i["v"])(e.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function g(e){return new m(e)}class v{constructor(){this._min=new y(Object(u["c"])()),this._max=new y(Object(u["c"])()),this._hud=new y(Object(u["c"])()),this._ground=new y(Object(u["c"])())}get min(){return this._min}get max(){return this._max}get hud(){return this._hud}get ground(){return this._ground}init(e){this._min.init(e),this._max.init(e),this._hud.init(e),this._ground.init(e),this.all=[]}}class y{constructor(e){this.intersector=0,this.normal=Object(o["f"])(),this.transformation=Object(a["d"])(),this._ray=Object(u["c"])(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return Object(i["l"])(this.dist)?(Object(s["h"])(x,this.ray.direction,this.dist),Object(s["s"])(x)):null}getIntersectionPoint(e){return!!Object(h["c"])(this)&&(Object(s["h"])(x,this.ray.direction,this.dist),Object(s["i"])(e,this.ray.origin,x),!0)}getTransformedNormal(e){return Object(s["n"])(j,this.normal),j[3]=0,Object(c["m"])(j,j,this.transformation),Object(s["n"])(e,j),Object(s["u"])(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=0,Object(u["b"])(e,this._ray)}set(e,t,r,c,l,u,d){this.intersector=e,this.dist=r,Object(s["n"])(this.normal,Object(i["v"])(c,o["b"])),Object(n["d"])(this.transformation,Object(i["v"])(l,a["a"])),this.target=t,this.drapedLayerOrder=u,this.drapedLayerGraphicOrder=d}copy(e){Object(u["b"])(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s["n"])(this.normal,e.normal),Object(n["d"])(this.transformation,e.transformation)}}function O(e){return new y(e)}const x=Object(o["f"])(),j=Object(l["e"])()},"94a6":function(e,t,r){"use strict";r.r(t),r.d(t,"fetch",(function(){return P})),r.d(t,"gltfToEngineResources",(function(){return E})),r.d(t,"parseUrl",(function(){return T}));var i=r("49b8"),n=r("b2b2"),a=r("1c92"),s=r("dae5"),o=r("d791"),c=r("afe1"),l=r("e431"),u=r("0b2d"),d=r("4261"),h=r("8190"),p=r("668b"),f=r("e4c1"),b=r("7e2d"),m=r("2b60"),g=r("3c3b"),v=r("087c"),y=r("22f5"),O=r("0278"),x=r("1e2c"),j=r("dbad"),_=r("0613"),S=r("dc56"),w=r("1c20"),C=r("4c96");async function P(e,t){const r=T(Object(i["a"])(e));if("wosr"===r.fileType){const e=await(t.cache?t.cache.loadWOSR(r.url,t):Object(y["a"])(r.url,t)),i=Object(y["b"])(e,t);return{lods:[i],referenceBoundingBox:i.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const a=await(t.cache?t.cache.loadGLTF(r.url,t,t.usePBR):Object(g["a"])(new m["a"](t.streamDataRequester),r.url,t,t.usePBR)),s=Object(n["j"])(a.model.meta,"ESRI_proxyEllipsoid");a.meta.isEsriSymbolResource&&Object(n["l"])(s)&&-1!==a.meta.uri.indexOf("/RealisticTrees/")&&M(a,s);const o=a.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:a.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},c={...t.materialParamsMixin,treeRendering:a.customMeta.esriTreeRendering};if(null!=r.specifiedLodIndex){const e=E(a,o,c,r.specifiedLodIndex);let t=e[0].boundingBox;return 0!==r.specifiedLodIndex&&(t=E(a,o,c,0)[0].boundingBox),{lods:e,referenceBoundingBox:t,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}const l=E(a,o,c);return{lods:l,referenceBoundingBox:l[0].boundingBox,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}function T(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function E(e,t,r,i){const o=e.model,c=Object(s["b"])(),l=new Array,u=new Map,m=new Map;return o.lods.forEach((e,s)=>{if(void 0!==i&&s!==i)return;const g={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(n["l"])(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(d["k"])()};l.push(g),e.parts.forEach(e=>{const i=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=o.materials.get(e.material),l=Object(n["l"])(e.attributes.texCoord0),v=Object(n["l"])(e.attributes.normal),y=A(s.alphaMode);if(!u.has(i)){if(l){if(Object(n["l"])(s.textureColor)&&!m.has(s.textureColor)){const e=o.textures.get(s.textureColor),t={...e.parameters,preMultiplyAlpha:1!==y};m.set(s.textureColor,new x["a"](e.data,t))}if(Object(n["l"])(s.textureNormal)&&!m.has(s.textureNormal)){const e=o.textures.get(s.textureNormal);m.set(s.textureNormal,new x["a"](e.data,e.parameters))}if(Object(n["l"])(s.textureOcclusion)&&!m.has(s.textureOcclusion)){const e=o.textures.get(s.textureOcclusion);m.set(s.textureOcclusion,new x["a"](e.data,e.parameters))}if(Object(n["l"])(s.textureEmissive)&&!m.has(s.textureEmissive)){const e=o.textures.get(s.textureEmissive);m.set(s.textureEmissive,new x["a"](e.data,e.parameters))}if(Object(n["l"])(s.textureMetallicRoughness)&&!m.has(s.textureMetallicRoughness)){const e=o.textures.get(s.textureMetallicRoughness);m.set(s.textureMetallicRoughness,new x["a"](e.data,e.parameters))}}const a=s.color[0]**(1/_["a"]),c=s.color[1]**(1/_["a"]),d=s.color[2]**(1/_["a"]),h=s.emissiveFactor[0]**(1/_["a"]),p=s.emissiveFactor[1]**(1/_["a"]),f=s.emissiveFactor[2]**(1/_["a"]),b=Object(n["l"])(s.textureColor)&&l?m.get(s.textureColor):null;u.set(i,new j["a"]({...t,transparent:0===y,textureAlphaMode:y,textureAlphaCutoff:s.alphaCutoff,diffuse:[a,c,d],ambient:[a,c,d],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:v?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(n["l"])(b)?b.id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(n["l"])(s.textureNormal)&&l?m.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:Object(n["l"])(b)&&!!b.params.preMultiplyAlpha,occlusionTextureId:Object(n["l"])(s.textureOcclusion)&&l?m.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(n["l"])(s.textureEmissive)&&l?m.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(n["l"])(s.textureMetallicRoughness)&&l?m.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[h,p,f],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...r}))}const P=R(e.indices||e.attributes.position.count,e.primitiveType),T=e.attributes.position.count,E=Object(b["a"])(h["u"],T);Object(p["e"])(E,e.attributes.position,e.transform);const M=[["position",{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],D=[["position",P]];if(Object(n["l"])(e.attributes.normal)){const t=Object(b["a"])(h["u"],T);Object(a["a"])(c,e.transform),Object(p["a"])(t,e.attributes.normal,c),M.push(["normal",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["normal",P])}if(Object(n["l"])(e.attributes.tangent)){const t=Object(b["a"])(h["C"],T);Object(a["a"])(c,e.transform),Object(f["c"])(t,e.attributes.tangent,c),M.push(["tangent",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["tangent",P])}if(Object(n["l"])(e.attributes.texCoord0)){const t=Object(b["a"])(h["m"],T);Object(S["b"])(t,e.attributes.texCoord0),M.push(["uv0",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["uv0",P])}if(Object(n["l"])(e.attributes.color)){const t=Object(b["a"])(h["J"],T);if(4===e.attributes.color.elementCount)e.attributes.color instanceof h["C"]?Object(f["b"])(t,e.attributes.color,255):e.attributes.color instanceof h["J"]?Object(w["a"])(t,e.attributes.color):e.attributes.color instanceof h["H"]&&Object(f["b"])(t,e.attributes.color,1/256);else{Object(w["b"])(t,255,255,255,255);const r=new h["B"](t.buffer,0,4);e.attributes.color instanceof h["u"]?Object(p["d"])(r,e.attributes.color,255):e.attributes.color instanceof h["B"]?Object(C["a"])(r,e.attributes.color):e.attributes.color instanceof h["z"]&&Object(p["d"])(r,e.attributes.color,1/256)}M.push(["color",{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),D.push(["color",P])}const z=new O["a"](M,D);g.stageResources.geometries.push(z),g.stageResources.materials.push(u.get(i)),l&&(Object(n["l"])(s.textureColor)&&g.stageResources.textures.push(m.get(s.textureColor)),Object(n["l"])(s.textureNormal)&&g.stageResources.textures.push(m.get(s.textureNormal)),Object(n["l"])(s.textureOcclusion)&&g.stageResources.textures.push(m.get(s.textureOcclusion)),Object(n["l"])(s.textureEmissive)&&g.stageResources.textures.push(m.get(s.textureEmissive)),Object(n["l"])(s.textureMetallicRoughness)&&g.stageResources.textures.push(m.get(s.textureMetallicRoughness))),g.numberOfVertices+=T;const I=z.boundingInfo;Object(n["l"])(I)&&(Object(d["r"])(g.boundingBox,I.getBBMin()),Object(d["r"])(g.boundingBox,I.getBBMax()))})}),l}function A(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":case null:case void 0:return 1}}function R(e,t){switch(t){case 4:return Object(v["c"])(e);case 5:return Object(v["b"])(e);case 6:return Object(v["a"])(e)}}function M(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(const a of i.parts){const i=a.attributes.normal;if(Object(n["k"])(i))return;const s=a.attributes.position,d=s.count,p=Object(u["f"])(),f=Object(u["f"])(),m=Object(u["f"])(),g=Object(b["a"])(h["J"],d),v=Object(b["a"])(h["u"],d),y=Object(o["c"])(Object(c["d"])(),a.transform);for(let n=0;n<d;n++){s.getVec(n,f),i.getVec(n,p),Object(l["t"])(f,f,a.transform),Object(l["m"])(m,f,t.center),Object(l["e"])(m,m,t.radius);const o=m[2],c=Object(l["s"])(m),u=Math.min(.45+.55*c*c,1);Object(l["e"])(m,m,t.radius),Object(l["t"])(m,m,y),Object(l["u"])(m,m),r+1!==e.model.lods.length&&e.model.lods.length>1&&Object(l["l"])(m,m,p,o>-1?.2:Math.min(-4*o-3.8,1)),v.setVec(n,m),g.set(n,0,255*u),g.set(n,1,255*u),g.set(n,2,255*u),g.set(n,3,255)}a.attributes.normal=v,a.attributes.color=g}}}},9617:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r("d047"),n=r("3886");function a(e){e.include(i["a"]),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(n["a"]`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function s(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},9714:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("7b7d"),n=r("0646");class a{constructor(e,t){this.owner=t,this.properties={},this.afterDispatchHandle=null;for(const r in e){const t=e[r],n=new i["a"](t,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=Object(n["a"])(()=>this.release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const t=this.properties[e];for(const e of t.acquired)Object(n["b"])(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null}get(e){const t=this.owner._get(e),r=this.properties[e];let i=r.pool.acquire();for(r.acquired.push(i);i===t;)r.acquired.push(i),i=r.pool.acquire();return i}release(){for(const e in this.properties){const t=this.properties[e];let r=0;for(const e of t.acquired)Object(n["b"])(e)?t.acquired[r++]=e:t.pool.release(e);t.acquired.length=r}}}},9812:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i,n,a,s={exports:{}};i=s,n=function(){function e(e,r,n){n=n||2;var a,s,o,l,u,d,h,p=r&&r.length,f=p?r[0]*n:e.length,b=t(e,0,f,n,!0),m=[];if(!b||b.next===b.prev)return m;if(p&&(b=c(e,r,b,n)),e.length>80*n){a=o=e[0],s=l=e[1];for(var g=n;g<f;g+=n)(u=e[g])<a&&(a=u),(d=e[g+1])<s&&(s=d),u>o&&(o=u),d>l&&(l=d);h=0!==(h=Math.max(o-a,l-s))?1/h:0}return i(b,m,n,a,s,h),m}function t(e,t,r,i,n){var a,s;if(n===M(e,t,r,i)>0)for(a=t;a<r;a+=i)s=E(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=E(a,e[a],e[a+1],s);if(s&&x(s,s.next)){var o=s.next;A(s),s=o}return s}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!x(i,i.next)&&0!==O(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(A(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,c,l,u,d,h){if(e){!h&&d&&f(e,l,u,d);for(var p,b,m=e;e.prev!==e.next;)if(p=e.prev,b=e.next,d?a(e,l,u,d):n(e))t.push(p.i/c),t.push(e.i/c),t.push(b.i/c),A(e),e=b.next,m=b.next;else if((e=b)===m){h?1===h?i(e=s(r(e),t,c),t,c,l,u,d,2):2===h&&o(e,t,c,l,u,d):i(r(e),t,c,l,u,d,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(O(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(v(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&O(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,r,i){var n=e.prev,a=e,s=e.next;if(O(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,c=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,u=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,d=m(o,c,t,r,i),h=m(l,u,t,r,i),p=e.prevZ,f=e.nextZ;p&&p.z>=d&&f&&f.z<=h;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&O(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&O(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&O(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=h;){if(f!==e.prev&&f!==e.next&&v(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&O(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function s(e,t,i){var n=e;do{var a=n.prev,s=n.next.next;!x(a,s)&&j(a,n,n.next,s)&&C(a,s)&&C(s,a)&&(t.push(a.i/i),t.push(n.i/i),t.push(s.i/i),A(n),A(n.next),n=e=s),n=n.next}while(n!==e);return r(n)}function o(e,t,n,a,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&y(c,l)){var u=T(c,l);return c=r(c,c.next),u=r(u,u.next),i(c,t,n,a,s,o),void i(u,t,n,a,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,i,n,a){var s,o,c,u=[];for(s=0,o=i.length;s<o;s++)(c=t(e,i[s]*a,s<o-1?i[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),u.push(g(c));for(u.sort(l),s=0;s<u.length;s++)n=r(n=d(u[s],n),n.next);return n}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function d(e,t){var i=h(e,t);if(!i)return t;var n=T(i,e),a=r(i,i.next);let s=u(n);return r(s,s.next),a=u(a),u(t===i?a:t)}function h(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r;var c,l=r,u=r.x,d=r.y,h=1/0;i=r;do{n>=i.x&&i.x>=u&&n!==i.x&&v(a<d?n:s,a,u,d,a<d?s:n,a,i.x,i.y)&&(c=Math.abs(a-i.y)/(n-i.x),C(i,e)&&(c<h||c===h&&(i.x>r.x||i.x===r.x&&p(r,i)))&&(r=i,h=c)),i=i.next}while(i!==l);return r}function p(e,t){return O(e.prev,e,t.prev)<0&&O(t.next,e,e.next)<0}function f(e,t,r,i){var n=e;do{if(null===n.z&&(n.z=m(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,f(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,b(n)}function b(e){var t,r,i,n,a,s,o,c,l=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,o=0,t=0;t<l&&(o++,i=i.nextZ);t++);for(c=l;o>0||c>0&&i;)0!==o&&(0===c||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,l*=2}while(s>1);return e}function m(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function v(e,t,r,i,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(i-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(n-s)*(i-o)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!w(e,t)&&(C(e,t)&&C(t,e)&&P(e,t)&&(O(e.prev,e,t.prev)||O(e,t.prev,t))||x(e,t)&&O(e.prev,e,e.next)>0&&O(t.prev,t,t.next)>0)}function O(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function j(e,t,r,i){var n=S(O(e,t,r)),a=S(O(e,t,i)),s=S(O(r,i,e)),o=S(O(r,i,t));return n!==a&&s!==o||!(0!==n||!_(e,r,t))||!(0!==a||!_(e,i,t))||!(0!==s||!_(r,e,i))||!(0!==o||!_(r,t,i))}function _(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function S(e){return e>0?1:e<0?-1:0}function w(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&j(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function C(e,t){return O(e.prev,e,e.next)<0?O(e,t,e.next)>=0&&O(e,e.prev,t)>=0:O(e,t,e.prev)<0||O(e,e.next,t)<0}function P(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function T(e,t){var r=new R(e.i,e.x,e.y),i=new R(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function E(e,t,r,i){var n=new R(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,r,i){for(var n=0,a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,a=n?t[0]*r:e.length,s=Math.abs(M(e,0,a,r));if(n)for(var o=0,c=t.length;o<c;o++){var l=t[o]*r,u=o<c-1?t[o+1]*r:e.length;s-=Math.abs(M(e,l,u,r))}var d=0;for(o=0;o<i.length;o+=3){var h=i[o]*r,p=i[o+1]*r,f=i[o+2]*r;d+=Math.abs((e[h]-e[f])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[f+1]-e[h+1]))}return 0===s&&0===d?0:Math.abs((d-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[n][a][s]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e},void 0!==(a=n())&&(i.exports=a);const o=s.exports},"9a68":function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return b}));var i=r("d272"),n=r("e6aa"),a=r("c2d1"),s=r("d047"),o=r("6750"),c=r("c6d7"),l=r("c51b"),u=r("ebd5"),d=r("4377"),h=r("3886"),p=r("690a");const f=1;function b(e){const t=new p["a"],r=e.stippleEnabled&&e.roundCaps,b=e.falloffEnabled||r,m=e.innerColorEnabled,g=e.stippleEnabled&&e.stippleScaleWithLineWidth||e.roundCaps,v=e.stippleEnabled&&e.stippleScaleWithLineWidth;return t.extensions.add("GL_OES_standard_derivatives"),t.include(l["a"]),t.include(n["a"],e),t.include(o["a"],{...e,stippleRequiresStretchMeasure:r}),1===e.output&&t.include(a["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),g&&t.varyings.add("vLineWidth","float"),v&&t.varyings.add("vLineSizeInv","float"),m&&t.varyings.add("vLineDistance","float"),b&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),e.roundCaps&&t.varyings.add("vCapPosition","vec2"),r&&t.varyings.add("vStipplePatternStretch","float"),t.vertex.code.add(h["a"]`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(h["a"]`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(h["a"]`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(h["a"]`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;
    vpos = position;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${g?h["a"]`vLineWidth = lineWidth;`:""}
      ${v?h["a"]`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),e.stippleEnabled&&t.vertex.code.add(h["a"]`float isEndVertex = float(!isStartVertex);
vec4 segmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), isEndVertex);
vec2 segmentOrigin = segmentInfo.xy;
vec2 segment = segmentInfo.zw;`),t.vertex.code.add(h["a"]`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(h["a"]`
        vec2 startDir;
        vec2 endDir;

        if (leftLen < 0.001) {
          startDir = right;
        }
        else{
          startDir = left;
        }
        startDir = normalize(startDir);
        startDir = PERPENDICULAR(startDir);

        if (rightLen < 0.001) {
          endDir = left;
        }
        else{
          endDir = right;
        }
        endDir = normalize(endDir);
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?h["a"]`min(1.0, subdivisionFactor * ${h["a"].float((f+2)/(f+1))})`:h["a"]`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):t.vertex.code.add(h["a"]`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(h["a"]`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;
capDisplacementDir *= subdivisionFactor;
}`),t.vertex.code.add(h["a"]`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${b||m?h["a"]`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${m?h["a"]`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${b?h["a"]`vLineDistanceNorm = lineDistNorm;`:""}

    ${e.roundCaps?h["a"]`vCapPosition = isJoin ? vec2(0.0) : dpos;`:""}

    pos.xy += dpos;
  `),e.stippleEnabled&&(e.draped||t.vertex.code.add(h["a"]`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(h["a"]`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));`),e.draped?t.vertex.code.add(h["a"]`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):t.vertex.code.add(h["a"]`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(h["a"]`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      // The 0.5 factor on the screen length is to correct for pixel ratio (it is calculated at double resolution)
      ${r?h["a"]`
            vec3 stippleSegmentInfo = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
            vStippleDistanceLimits = stippleSegmentInfo.xy;
            vStipplePatternStretch = stippleSegmentInfo.z;`:h["a"]`
            vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);`}

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;
    `)),t.vertex.code.add(h["a"]`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`),e.multipassTerrainEnabled&&(t.fragment.include(s["a"]),t.include(c["b"],e)),t.include(i["a"],e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(d["a"]),t.fragment.code.add(h["a"]`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.roundCaps&&t.fragment.code.add(h["a"]`
    float fragmentRadius = length(vCapPosition);
    float fragmentSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
    float capCoverage = clamp(0.5 - fragmentSDF, 0.0, 1.0);
    if (capCoverage < ${h["a"].float(u["c"])}) {
      discard;
    }
  `),r?t.fragment.code.add(h["a"]`
      vec2 stipplePosition = vec2(
        max(1.0 - getStippleSDF() * 2.0 * vStipplePatternStretch, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${h["a"].float(u["c"])}, stippleCoverage);
    `):t.fragment.code.add(h["a"]`float stippleAlpha = getStippleAlpha();`),t.fragment.code.add(h["a"]`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),t.fragment.uniforms.add("pixelRatio","float"),e.innerColorEnabled&&t.fragment.code.add(h["a"]`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),t.fragment.code.add(h["a"]`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(h["a"]`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`),t.fragment.code.add(h["a"]`
    if (finalColor.a < ${h["a"].float(u["c"])}) {
      discard;
    }

    ${7===e.output?h["a"]`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?h["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?h["a"]`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?h["a"]`outputDepth(linearDepth);`:""}
  }
  `),t}const m=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:f,build:b})},"9ac8":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));r("c120");var i=r("caf7");function n(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function a(e,t){const r=(e,r,n=!1)=>({levels:e.map(e=>{const a=r(e.tesselation);return n&&i["a"].cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>i["a"].createPolySphereGeometry(.5,e,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>i["a"].createBoxGeometry(1));case"cone":return r(s,e=>i["a"].createConeGeometry(1,.5,e,!1),!0);case"inverted-cone":return r(s,e=>i["a"].createConeGeometry(1,.5,e,!0),!0);case"cylinder":return r(s,e=>i["a"].createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>i["a"].createTetrahedronGeometry(1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>i["a"].createDiamondGeometry(1),!0);default:return}}const s=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},"9def":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("fdc9");function n(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new i["b"],t.set(e,r)),r};return e.adds.forAll(e=>{a(e)&&r(e.material).adds.push(e)}),e.removes.forAll(e=>{a(e)&&r(e.material).removes.push(e)}),e.updates.forAll(e=>{a(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)}),t}function a(e){return e.data.indexCount>=1}},a37d:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r("9ef0"),n=r("b2b2"),a=r("a915"),s=r("0fc4");class o{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.fillStyle=this.colorToRGBA(e.color),this.haloStyle=this.colorToRGB(e.halo.color)}colorToRGB(e){return`rgb(${e.slice(0,3).map(e=>Math.floor(255*e)).toString()})`}colorToRGBA(e){return`rgba(${e.slice(0,3).map(e=>Math.floor(255*e)).toString()},${e[3]})`}static fromSymbol(e,t=1){const r=Object(n["j"])(e,"material","color"),c=Object(n["l"])(r)?i["a"].toUnitRGBA(r):s["b"],l=e.halo,u=null!=e.size?Object(a["h"])(e.size):12,d={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"},h=Object(n["l"])(l)&&Object(n["l"])(l.color)&&l.size>0?{size:Object(a["h"])(l.size),color:i["a"].toUnitRGBA(l.color)}:{size:0,color:s["b"]};return new o({size:u,color:c,font:d,halo:h,pixelRatio:t})}}},a571:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n}));var i=r("a9ab");function n(e){return{geometryType:Object(i["c"])(e[0]),geometries:e.map(e=>e.toJSON())}}function a(e,t,r){const n=Object(i["b"])(t);return e.map(e=>{const t=n.fromJSON(e);return t.spatialReference=r,t})}},a5b5:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return u}));var i,n=r("d272"),a=r("7c1d"),s=r("d0cb"),o=r("9617"),c=r("3886"),l=r("690a");function u(e){const t=new l["a"];return t.include(a["a"]),t.include(s["a"],e),t.include(n["a"],e),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2"),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassGeometryEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(c["a"]`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?c["a"]`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.screenSizePerspectiveEnabled?c["a"]`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:c["a"]`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.multipassGeometryEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?c["a"]`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:c["a"]`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.screenSizePerspectiveEnabled?c["a"]`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:c["a"]`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),t.fragment.uniforms.add("color","vec4"),t.fragment.uniforms.add("borderColor","vec4"),e.multipassGeometryEnabled&&(t.fragment.include(o["b"],e),t.fragment.uniforms.add("inverseViewport","vec2")),t.fragment.code.add(c["a"]`
    void main() {
      ${e.multipassGeometryEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?c["a"]`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:c["a"]`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function d(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}!function(e){function t(e,t,r){d(e,"color",t.color),e.setUniform1f("pixelRatio",r),e.setUniform2f("screenOffset",t.screenOffset[0]*r,t.screenOffset[1]*r),null!==t.borderColor?(d(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",r)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))}e.bindUniforms=t}(i||(i={}));const h=Object.freeze({__proto__:null,build:u,get LineCallout(){return i}})},a6c9:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return l}));r("c120");var i=r("661c");function n(e,t,r){switch(e){case"circle":default:return a(t,r);case"square":return s(t,r);case"cross":return c(t,r);case"x":return l(t,r);case"kite":return o(t,r);case"triangle":return u(t,r)}}function a(e,t){const r=e,n=new Uint8Array(4*r*r),a=r/2-.5,s=t/2;for(let o=0;o<r;o++)for(let t=0;t<r;t++){const c=t+r*o,l=t-a,u=o-a;let d=Math.sqrt(l*l+u*u)-s;d=d/e+.5,Object(i["a"])(d,n,4*c)}return n}function s(e,t){return d(e,t,!1)}function o(e,t){return d(e,t,!0)}function c(e,t){return h(e,t,!1)}function l(e,t){return h(e,t,!0)}function u(e,t){const r=new Uint8Array(4*e*e),n=1,a=-.5,s=Math.sqrt(n*n+a*a),o=(e-t)/2;for(let c=0;c<e;c++)for(let l=0;l<e;l++){const u=c*e+l,d=(l-o)/t,h=(c-o+.75)/t,p=-(n*d+a*h)/s,f=(n*(d-1)+a*-h)/s,b=-h,m=Math.max(p,f,b);Object(i["a"])(m*t/e+.5,r,4*u)}return r}function d(e,t,r){r&&(t/=Math.SQRT2);const n=new Uint8Array(4*e*e);for(let a=0;a<e;a++)for(let s=0;s<e;s++){let o=s-.5*e+.25,c=.5*e-a-.75;const l=a*e+s;if(r){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}let u=Math.max(Math.abs(o),Math.abs(c))-.5*t;u=u/e+.5,Object(i["a"])(u,n,4*l)}return n}function h(e,t,r){r&&(t*=Math.SQRT2);const n=.5*t,a=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let t=0;t<e;t++){let o=t-.5*e,c=.5*e-s-1;const l=s*e+t;if(r){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}let u;o=Math.abs(o),c=Math.abs(c),u=o>c?o>n?Math.sqrt((o-n)*(o-n)+c*c):c:c>n?Math.sqrt(o*o+(c-n)*(c-n)):o,u=u/e+.5,Object(i["a"])(u,a,4*l)}return a}},a7d7:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c}));var i=r("47f8"),n=r("7cb4"),a=r("3886");const s=Object(i["d"])(0,.6,.2);function o(e,t){const r=e.fragment,i=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&i&&e.include(n["a"],t),2!==t.pbrMode?(0===t.pbrMode&&r.code.add(a["a"]`float getBakedOcclusion() { return 1.0; }`),1===t.pbrMode&&(r.uniforms.add("emissionFactor","vec3"),r.uniforms.add("mrrFactors","vec3"),r.code.add(a["a"]`vec3 mrr;
vec3 emission;
float occlusion;`),t.hasMetalnessAndRoughnessTexture&&(r.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texMetallicRoughnessSize","vec2"),r.code.add(a["a"]`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texEmissionSize","vec2"),r.code.add(a["a"]`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&r.uniforms.add("texOcclusionSize","vec2"),r.code.add(a["a"]`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(a["a"]`float getBakedOcclusion() { return 1.0; }`),r.code.add(a["a"]`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `))):r.code.add(a["a"]`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function c(e,t,r=!1){r||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},a803:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return d}));var i=r("6c97"),n=r("b2b2"),a=r("8c11"),s=r("9ac8"),o=r("ec13"),c=r("f33e");const l={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function u(e){return"web-style"===e.type?l:d(e.symbolLayers.toArray().map(t=>f(e,t)))}function d(e){let t=0,r=0,i=0,a=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const c of e)Object(n["k"])(c)||(t+=c.primitivesPerFeature,r+=c.primitivesPerCoordinate,i+=c.drawCallsPerFeature,o.bytesPerFeature+=c.memory.bytesPerFeature,o.bytesPerFeatureLabel+=c.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=c.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=c.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=c.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=c.memory.bytesPerCoordinate,a=a||c.estimated,++s);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:a,memory:o,numComplexities:s}}function h(e){const t=d(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const p={};function f(e,t){const r=b(e,t),s=Object(o["d"])(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:s,estimated:!1,memory:r};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:s,estimated:!1,memory:r}:Object(n["l"])(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...m(t.resource&&t.resource.primitive||a["b"]),memory:r};case"path":{const e=3,n=3,a=10;let s=0,o=0;switch(t.profile){case"circle":s=a;break;case"quad":s=4;break;default:return void Object(i["a"])(t.profile)}switch(t.join){case"round":o=e;break;case"miter":case"bevel":o=1;break;default:return void Object(i["a"])(t.join)}const c=2*s,l=s*o*2;let u=-2*l-c;switch(t.cap){case"none":break;case"butt":case"square":u+=2*(s-1);break;case"round":u+=2*(s*(n-1)*2+s);break;default:return}return{primitivesPerFeature:u,primitivesPerCoordinate:l+c,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function b(e,t){const r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?g.EXTRUDE_EDGES:g.EXTRUDE;case"fill":return Object(n["l"])(t.outline)&&t.outline.size>0?g.FILL_OUTLINE:g.FILL;case"water":return g.FILL;case"line":return"round"===t.join?g.LINE_ROUND:g.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return g.PATH_ROUND_CIRCLE;case"quad":return g.PATH_ROUND_QUAD;default:return void Object(i["a"])(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return g.PATH_MITER_CIRCLE;case"quad":return g.PATH_MITER_QUAD;default:return void Object(i["a"])(t.profile)}default:return void Object(i["a"])(t.join)}case"object":return r?g.OBJECT_POINT:g.OBJECT_POLYGON;case"icon":case"text":return r?g.ICON_POINT:g.ICON_POLYGON;default:return}}function m(e){let t=p[e];if(t)return t;const r=Object(s["b"])(e,null);return t={primitivesPerFeature:Object(c["b"])(r.levels[0]).reduce((e,t)=>e+t.indices.get("position").length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},p[e]=t,t}const g={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}},a978:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return c}));var i=r("b2b2"),n=r("e431"),a=r("0b2d"),s=r("0d9f");function o(e){return Object(i["l"])(e)&&Object(i["l"])(e.dist)}function c(e){return(t,r,i)=>(Object(n["l"])(d,t,r,i),!Object(s["f"])(e,d))}function l(e){return o(e)&&0===e.intersector&&!!e.target}function u(e){return o(e)&&1===e.intersector&&!!e.target&&Object(i["l"])(e.target.center)}const d=Object(a["f"])()},aab5:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){const r=e.fragment;r.code.add(i["a"]`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),1===t.doubleSidedMode?r.code.add(i["a"]`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`):2===t.doubleSidedMode?r.code.add(i["a"]`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`):r.code.add(i["a"]`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`)}},ac91:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r("2eab"),n=r("cea0"),a=r("a9ab"),s=r("bb72"),o=r("a571"),c=r("7e6b");const l=Object(n["m"])(c["a"]);async function u(e,t,r){t=l(t);const n=Object(s["c"])(e),c={...n.query,f:"json",...t.toJSON()},u=t.outSpatialReference,d=Object(a["c"])(t.geometries[0]),h=Object(s["a"])(c,r);return Object(i["default"])(n.path+"/project",h).then(({data:{geometries:e}})=>Object(o["a"])(e,d,u))}},adf1:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r("b2b2"),n=r("f2e0"),a=r("afe1"),s=r("e431"),o=r("0b2d"),c=r("8188"),l=r("0278"),u=r("7abc"),d=r("5a22"),h=r("748f"),p=r("86ba");class f{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Object(n["b"])()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){if(Object(i["l"])(b))return this._origins.set(this._rootOriginId,Object(u["a"])(b[0],b[1],b[2],this._rootOriginId)),this.getOrigin(e);const t=Object(u["a"])(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,t),t}const r=this._gridSize,n=Math.round(e[0]/r),a=Math.round(e[1]/r),o=Math.round(e[2]/r),c=`${n}/${a}/${o}`;let l=this._origins.get(c);const d=.5*r;if(Object(s["m"])(m,e,t.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),m[0]<d&&m[1]<d&&m[2]<d){if(l){const t=Math.max(...m);if(Object(s["m"])(m,e,l.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),Math.max(...m)<t)return l}return t}return l||(l=Object(u["a"])(n*r,a*r,o*r,c),this._origins.set(c,l)),l}_drawOriginBox(e,t=[1,1,0,1]){const r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new p["a"]({width:2,color:t}),i.add(this._material);const e=new h["a"]({isPickable:!1}),r=new d["a"]({castShadow:!1});i.add(r),e.add(r),i.add(e),this._objects.set(n,r)}const s=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],u=o.length,f=new Array(3*u),b=new Uint16Array(2*(u-1)),m=.5*this._gridSize;for(let a=0;a<u;a++)f[3*a+0]=e[0]+(1&o[a]?m:-m),f[3*a+1]=e[1]+(2&o[a]?m:-m),f[3*a+2]=e[2]+(4&o[a]?m:-m),a>0&&(b[2*a+0]=a-1,b[2*a+1]=a);Object(c["p"])(f,this._originSR,0,f,r.renderSpatialReference,0,u);const g=new l["a"]([["position",{size:3,data:f,exclusive:!0}]],[["position",b]],2);i.add(g),s.addGeometry(g,this._material,a["a"])}}let b=null;const m=Object(o["f"])()},aeb3:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return g}));var i=r("d272"),n=r("4db9"),a=r("6d5b"),s=r("c2d1"),o=r("6a07"),c=r("d047"),l=r("c6d7"),u=r("ebd5"),d=r("4377"),h=r("3886"),p=r("690a");const f=.70710678118,b=f,m=.08715574274;function g(e){const t=new p["a"];e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=1===e.output;t.include(n["a"],{linearDepth:r}),t.include(a["a"],e),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),r&&(t.include(s["a"],e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),e.draped?t.vertex.uniforms.add("worldToScreenRatio","float"):(t.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),t.vertex.uniforms.add("camPos","vec3"),t.attributes.add("boundingRect","mat3")),t.attributes.add("position","vec3"),t.attributes.add("uvMapSpace","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const g=3===e.style||4===e.style||5===e.style;return g&&t.vertex.code.add(h["a"]`
      const mat2 rotate45 = mat2(${h["a"].float(f)}, ${h["a"].float(-b)},
                                 ${h["a"].float(b)}, ${h["a"].float(f)});
    `),e.draped||(t.vertex.code.add(h["a"]`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),t.vertex.code.add(h["a"]`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),t.vertex.code.add(h["a"]`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${h["a"].float(m)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `)),t.vertex.code.add(h["a"]`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${g?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${g?" * rotate45":""};

      ${e.draped?"":h["a"]`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${h["a"].float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),t.vertex.code.add(h["a"]`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?h["a"]`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:h["a"]`transformPosition(proj, view, vpos);`}
    }
  `),t.include(i["a"],e),t.fragment.include(d["a"]),t.fragment.uniforms.add("matColor","vec4"),e.draped&&t.fragment.uniforms.add("texelSize","float"),4===e.output&&t.include(o["a"]),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(l["b"],e)),4!==e.output&&(t.fragment.code.add(h["a"]`
      const float lineWidth = ${h["a"].float(e.lineWidth)};
      const float spacing = ${h["a"].float(e.patternSpacing)};
      const float spacingINV = ${h["a"].float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||t.fragment.code.add(h["a"]`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),t.fragment.code.add(h["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==e.output?h["a"]`color.a *= ${v(e)};`:""}

      if (color.a < ${h["a"].float(u["c"])}) {
        discard;
      }

      ${7===e.output?h["a"]`gl_FragColor = vec4(color.a);`:""}

      ${0===e.output?h["a"]`gl_FragColor = color; ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===e.output?h["a"]`outputHighlight();`:""}
      ${1===e.output?h["a"]`outputDepth(linearDepth);`:""};
    }
  `),t}function v(e){function t(t){return e.draped?h["a"]`coverage(vuv.${t}, texelSize)`:h["a"]`sample(vuv.${t})`}switch(e.style){case 3:case 0:return t("y");case 4:case 1:return t("x");case 5:case 2:return h["a"]`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const y=Object.freeze({__proto__:null,build:g})},af20:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return y}));var i=r("bd75"),n=r("d272"),a=r("4db9"),s=r("b49d"),o=r("c2d1"),c=r("6a07"),l=r("d047"),u=r("7088"),d=r("ea4b"),h=r("c6d7"),p=r("aab5"),f=r("040b"),b=r("d017"),m=r("4377"),g=r("3886"),v=r("690a");function y(e){const t=new v["a"];return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.varyings.add("vpos","vec3"),t.include(s["a"],e),0!==e.output&&7!==e.output||(t.include(a["a"],{linearDepth:!1}),e.receiveShadows&&t.include(b["a"],e),t.include(i["a"],e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(g["a"]`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${0===e.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(l["a"]),t.include(h["b"],e)),7===e.output&&(t.include(n["a"],e),t.fragment.uniforms.add("camPos","vec3"),t.fragment.uniforms.add("localOrigin","vec3"),t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(g["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),0===e.output&&(t.include(n["a"],e),t.include(d["a"],e),t.include(u["a"],e),e.receiveShadows&&t.include(b["a"],e),t.include(p["a"],e),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),t.fragment.include(m["a"]),t.fragment.code.add(g["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),1!==e.output&&3!==e.output||(t.include(a["a"],{linearDepth:!0}),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("depth","float"),t.vertex.code.add(g["a"]`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(n["a"],e),t.include(o["a"],e),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(g["a"]`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),2===e.output&&(t.include(a["a"],{linearDepth:!1}),t.include(f["a"],e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(g["a"]`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n["a"],e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(g["a"]`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),4===e.output&&(t.include(a["a"],{linearDepth:!1}),t.include(f["a"],e),t.vertex.uniforms.add("viewNormal","mat4"),t.varyings.add("vnormal","vec3"),t.vertex.code.add(g["a"]`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(n["a"],e),t.include(c["a"]),t.fragment.code.add(g["a"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const O=Object.freeze({__proto__:null,build:y})},b061:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r("b2b2");class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach((e,t)=>{Object(i["l"])(e)&&this._repository.release(this._material,a(t))})}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,a(t)));const r=this._map.get(t);if(Object(i["l"])(r)){if(2===r.ensureResources(e))return r;this._repository.requestRender()}return null}}function a(e){switch(e){default:case 0:return 0;case 1:return 7;case 4:case 7:case 6:return 3;case 3:return 2;case 2:return 1;case 5:return 4}}},b09a:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.attributes.add("position","vec3"),e.vertex.code.add(i["a"]`vec3 positionModel() { return position; }`)}},b0ab:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return P}));var i=r("bd75"),n=r("17ca"),a=r("d272"),s=r("4db9"),o=r("d539"),c=r("c332"),l=r("b09a"),u=r("6cb2"),d=r("dfaf"),h=r("6d5b"),p=r("17b0"),f=r("7e21"),b=r("d047"),m=r("7088"),g=r("ea4b"),v=r("c6d7"),y=r("5d5f"),O=r("a7d7"),x=r("d017"),j=r("be24"),_=r("ebd5"),S=r("3626"),w=r("3886"),C=r("690a");function P(e){const t=new C["a"],r=t.vertex.code,P=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(l["a"]),t.varyings.add("vpos","vec3"),t.include(j["a"],e),t.include(o["a"],e),t.include(p["a"],e),0!==e.output&&7!==e.output||(t.include(c["a"],e),t.include(s["a"],{linearDepth:!1}),e.offsetBackfaces&&t.include(n["a"]),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(d["a"],e),t.include(i["a"],e),t.include(u["a"],e),t.include(h["a"],e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),r.add(w["a"]`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${w["a"].float(_["c"])}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          ${e.multipassTerrainEnabled?w["a"]`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),7===e.output&&(t.include(a["a"],e),t.include(_["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(b["a"]),t.include(v["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(S["a"]),P.add(w["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?w["a"]`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?w["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:w["a"]`vec4 texColor = vec4(1.0);`}
        ${e.attributeColor?w["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w["a"]`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `)),0===e.output&&(t.include(a["a"],e),t.include(g["a"],e),t.include(m["a"],e),t.include(_["a"],e),e.receiveShadows&&t.include(x["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(b["a"]),t.include(v["b"],e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(O["b"],e),t.include(y["a"],e),t.fragment.include(S["a"]),P.add(w["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?w["a"]`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?w["a"]`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:w["a"]`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===e.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.attributeColor?w["a"]`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:w["a"]`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${w["a"]`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?w["a"]`vec3 normalGround = normalize(vpos + localOrigin);`:w["a"]`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:w["a"]``}
        ${1===e.pbrMode||2===e.pbrMode?w["a"]`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(f["a"],e),t}const T=Object.freeze({__proto__:null,build:P})},b49d:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r("b09a"),n=r("3886");function a(e,t){e.attributes.add("featureValue","vec4"),e.vertex.code.add(n["a"]`bool isCapVertex() {
return featureValue.w == 1.0;
}`),e.vertex.uniforms.add("size","vec3"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(n["a"]`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):e.vertex.code.add(n["a"]`vec2 getSize(){
return size.xy;
}`),t.vvOpacity?(e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(n["a"]`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):e.vertex.code.add(n["a"]`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(n["a"]`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):e.vertex.code.add(n["a"]`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(i["a"]),e.attributes.add("profileRight","vec4"),e.attributes.add("profileUp","vec4"),e.attributes.add("profileVertexAndNormal","vec4"),e.vertex.code.add(n["a"]`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),e.vertex.code.add(n["a"]`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),e.vertex.code.add(n["a"]`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),e.vertex.code.add(n["a"]`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}function s(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}},b4c8:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i,n=r("dae5"),a=r("47f8");!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(a["d"])(1,1,1),vvSizeMaxSize:Object(a["d"])(100,100,100),vvSizeOffset:Object(a["d"])(0,0,0),vvSizeFactor:Object(a["d"])(1,1,1),vvSizeValue:Object(a["d"])(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(n["b"])()}}(i||(i={}));const s=i},b855:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r("02f1"),n=r("35b3");const a={waveStrength:.06,waveTextureRepeat:32,waveDirection:Object(i["f"])(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...n["b"]},s={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}},ba58:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return A})),r.d(t,"c",(function(){return C})),r.d(t,"d",(function(){return R})),r.d(t,"e",(function(){return j})),r.d(t,"f",(function(){return E})),r.d(t,"g",(function(){return S})),r.d(t,"h",(function(){return M})),r.d(t,"i",(function(){return w})),r.d(t,"j",(function(){return _})),r.d(t,"k",(function(){return T}));var i=r("b2b2"),n=r("d791"),a=r("afe1"),s=r("02f1"),o=r("0b2d"),c=r("7577"),l=r("0fc4"),u=r("8188"),d=r("4261"),h=r("9180"),p=r("57e5"),f=r("32ed"),b=r("1a54"),m=r("d3cf");function g(e,t){if("point"===e.type)return x(e,t,!1);if(Object(m["d"])(e))switch(e.type){case"extent":return x(e.center,t,!1);case"polygon":return x(e.centroid,t,!1);case"polyline":return x(v(e),t,!0);case"mesh":return x(e.origin,t,!1)}else switch(e.type){case"extent":return x(y(e),t,!0);case"polygon":return x(O(e),t,!0);case"polyline":return x(v(e),t,!0)}}function v(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=Object(f["f"])(t,Object(f["e"])(t)/2);return Object(b["j"])(r[0],r[1],r[2],e.spatialReference)}function y(e){const t=isFinite(e.zmin);return Object(b["j"])(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function O(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=Object(p["b"])(e.rings,e.hasZ);return Object(b["j"])(r[0],r[1],r[2],e.spatialReference)}function x(e,t,r){const i=r?e:Object(m["a"])(e);return t&&e?Object(u["s"])(e,i,t)?i:null:i}function j(e,t,r,i=0){if(e){t||(t=Object(h["m"])());const n=e;let a=.5*n.width*(r-1),s=.5*n.height*(r-1);return n.width<1e-7*n.height?a+=s/20:n.height<1e-7*n.width&&(s+=a/20),Object(c["l"])(t,n.xmin-a-i,n.ymin-s-i,n.xmax+a+i,n.ymax+s+i),t}return null}function _(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute("auxpos1");i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[r]))}}function S(e,t){const r=Object(l["d"])(l["a"]);return Object(i["l"])(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),Object(i["l"])(t)?r[3]=t:Object(i["l"])(e)&&e.length>3&&(r[3]=e[3]),r}function w(e,t,r,n,a,s=[0,0,0,0]){for(let o=0;o<3;++o)Object(i["l"])(e)&&null!=e[o]?s[o]=e[o]:Object(i["l"])(r)&&null!=r[o]?s[o]=r[o]:s[o]=a[o];return Object(i["l"])(t)?s[3]=t:Object(i["l"])(n)?s[3]=n:s[3]=a[3],s}function C(e=o["a"],t,r,n=1){const a=new Array(3);if(Object(i["k"])(t)||Object(i["k"])(r))a[0]=1,a[1]=1,a[2]=1;else{let i,n=0;for(let s=2;s>=0;s--){const o=e[s];let c;const l=null!=o,u=0===s&&!i&&!l,d=r[s];"symbol-value"===o||u?c=0!==d?t[s]/d:1:l&&"proportional"!==o&&isFinite(o)&&(c=0!==d?o/d:1),null!=c&&(a[s]=c,i=c,n=Math.max(n,Math.abs(c)))}for(let e=2;e>=0;e--)null==a[e]?a[e]=i:0===a[e]&&(a[e]=.001*n)}for(let i=2;i>=0;i--)a[i]/=n;return Object(o["g"])(a)}function P(e){return null!=e.isPrimitive}function T(e){return P(e)&&(e=[e.width,e.depth,e.height]),E(e)?null:"Symbol sizes may not be negative values"}function E(e){if(Array.isArray(e)){for(const t of e)if(!E(t))return!1;return!0}return null==e||e>=0}function A(e,t,r,i=Object(a["d"])()){const s=e||0,o=t||0,c=r||0;return 0!==s&&Object(n["s"])(i,i,-s/180*Math.PI),0!==o&&Object(n["e"])(i,i,o/180*Math.PI),0!==c&&Object(n["k"])(i,i,c/180*Math.PI),i}function R(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(d["y"])(e)?t.minDemResolutionForPoints:.01*Object(d["z"])(e)}const M={"bottom-left":Object(s["f"])(0,0),bottom:Object(s["f"])(.5,0),"bottom-right":Object(s["f"])(1,0),left:Object(s["f"])(0,.5),center:Object(s["f"])(.5,.5),right:Object(s["f"])(1,.5),"top-left":Object(s["f"])(0,1),top:Object(s["f"])(.5,1),"top-right":Object(s["f"])(1,1)}},bb49:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return m}));var i=r("a4ee"),n=r("b2b2"),a=r("3795"),s=r("59b2"),o=(r("b50f"),r("c120"),r("cea0"),r("d386")),c=r("66af"),l=r("ebae"),u=r("0efb"),d=r("ba58"),h=r("eec2"),p=r("365a");const f=1.2;let b=class extends(Object(c["a"])(p["a"])){constructor(){super(...arguments),this.type="graphics-3d",this.frustumVisibility=new l["a"],this.slicePlaneEnabled=!1,this.drapeSourceType=1,this.suspendResumeExtent=null,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set("graphics3d",new u["a"]({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",()=>this.graphics3d.graphicsCore.opacityChange()),this.handles.add(this.layer.on("graphic-update",e=>this.graphics3d.graphicsCore.graphicUpdateHandler(e))),this.addResolvingPromise(Object(h["a"])(this).then(e=>this.fullExtentInLocalViewSpatialReference=e)),this.layer.internal?this.notifyChange("updating"):this.handles.add(Object(a["m"])(this.view,"basemapTerrain.ready",()=>this.notifyChange("updating")))}destroy(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))}get legendEnabled(){return this.canResume()&&!this.frustumVisibility.suspended}get suspendInfo(){var e;const t={};return Object(n["l"])(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(t.outsideScaleRange=!0),t.outsideOfView=!(null==(e=this.frustumVisibility)||!e.suspended),t}async fetchPopupFeatures(e,t){return Object(n["l"])(t)?t.clientGraphics:null}notifyGraphicGeometryChanged(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)}get graphics3DGraphics(){return this.graphics3d.graphicsCore.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}get symbolUpdateType(){return this.graphics3d.graphicsCore.symbolUpdateType}getGraphicFromGraphicUid(e){return this.graphics3d.getGraphicFromGraphicUid(e)}whenGraphicBounds(e,t){return this.graphics3d.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphics3d.getSymbolLayerSize(e,t)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(e){return this.graphics3d.maskOccludee(e)}highlight(e){return this.graphics3d.highlight(e)}get updatePolicy(){var e;return(null==(e=this.graphics3d)?void 0:e.graphicsCore.effectiveUpdatePolicy)||1}canResume(){var e;return super.canResume()&&!(null!=(e=this.graphics3d)&&e.suspended)}isUpdating(){var e,t;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(e=this.view)&&null!=(t=e.basemapTerrain)&&t.ready))}setupSuspendResumeExtent(){const e=()=>{this.suspendResumeExtent=Object(d["e"])(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,f,this.graphics3d.graphicsCore.extentPadding),this.frustumVisibility.setExtent(this.suspendResumeExtent)};Object(a["a"])(this.graphics3d.graphicsCore,"computedExtent",()=>e(),!0),Object(a["e"])(this.graphics3d.graphicsCore,"extentPadding",()=>e(),!0)}get performanceInfo(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}};Object(i["a"])([Object(s["b"])({aliasOf:"layer.graphics"})],b.prototype,"loadedGraphics",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"suspended",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"legendEnabled",null),Object(i["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"updating",void 0),Object(i["a"])([Object(s["b"])()],b.prototype,"layer",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"frustumVisibility",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"graphics3d",void 0),Object(i["a"])([Object(s["b"])({type:Boolean})],b.prototype,"slicePlaneEnabled",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],b.prototype,"suspendInfo",null),b=Object(i["a"])([Object(o["a"])("esri.views.3d.layers.GraphicsLayerView3D")],b);const m=b},bc40:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("dae5"),n=r("afe1"),a=r("0b2d"),s=r("b09a"),o=r("6a21"),c=r("3886");function l(e,t){e.include(s["a"]),e.vertex.include(o["a"],t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(c["a"]`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
uTransform_WorldFromModel_TL,
uTransform_WorldFromModel_TH,
-uTransform_WorldFromView_TL,
-uTransform_WorldFromView_TH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 position_view() {
return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = position_view();
gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(c["a"]`vec3 positionWorld() {
return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
}`)}!function(e){class t{constructor(){this.worldFromModel_RS=Object(i["b"])(),this.worldFromModel_TH=Object(a["f"])(),this.worldFromModel_TL=Object(a["f"])()}}e.ModelTransform=t;class r{constructor(){this.worldFromView_TH=Object(a["f"])(),this.worldFromView_TL=Object(a["f"])(),this.viewFromCameraRelative_RS=Object(i["b"])(),this.projFromView=Object(n["d"])()}}function s(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)}function o(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}e.ViewProjectionTransform=r,e.bindModelTransform=s,e.bindViewProjTransform=o}(l||(l={}))},bea9:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("f2e0");class n{constructor(e){this.channel=e,this.id=Object(i["b"])()}}},c1c0:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("661c"),n=r("b2b2"),a=(r("7ce4"),r("d267"),r("c120"),r("1956"),r("d17d"),r("9f8b"),r("a1ff"));r("0fa6");class s{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach(e=>e.texture=Object(n["f"])(e.texture)),this.cache.clear()}acquire(e){if(Object(n["k"])(e))return null;const t=this.patternId(e),r=this.cache.get(t);if(r)return r.refCount++,r.bind;const i=e.pixelRatio,{encodedData:s,sdfNormalizer:c,pixels:l,paddedPixels:u}=o(e.pattern,i),d=l/i,h={refCount:1,texture:null,bind:e=>(Object(n["k"])(h.texture)&&(h.texture=new a["a"](this._rctx,{width:u,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},s)),e.bindTexture(h.texture,"stipplePatternTexture"),{pixelSize:d,sdfNormalizer:c,pixels:l})};return this.cache.set(t,h),h.bind}release(e){if(Object(n["k"])(e))return;const t=this.patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&(Object(n["l"])(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}swap(e,t){const r=this.acquire(t);return this.release(e),r}patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}function o(e,t){const r=e.map(e=>Math.round(e*t)),n=1/t,a=Math.floor(r.reduce((e,t)=>e+t)),s=r.reduce((e,t)=>Math.max(e,t)),o=(Math.floor(.5*(s-1))+.5)*n,c=[];let l=1;for(const i of r){for(let e=0;e<i;e++){const t=l*(Math.min(e,i-1-e)+.5)*n/o*.5+.5;c.push(t)}l=-l}const u=Math.round(r[0]/2),d=[...c.slice(u),...c.slice(0,u)],h=a+2,p=new Uint8Array(4*h);let f=4;for(const b of d)Object(i["a"])(b,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,sdfNormalizer:o,paddedPixels:h,pixels:a}}},c332:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("3886");function n(e){const t=i["a"]`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function a(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(i["a"]`vec3 normalModel() {
return normal;
}`)),1===t.normalType&&(e.include(n),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(i["a"]`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i["a"]`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}},caf1:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r("38a4"),n=r("b2b2");function a(e){switch(e){case"multiply":default:return 1;case"ignore":return 2;case"replace":return 3;case"tint":return 4}}function s(e,t,r){if(Object(n["k"])(e)||2===t)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const a=Object(i["f"])(Math.round(e[3]*c),0,c),s=0===a||4===t?0:3===t?l:u;r[0]=Object(i["f"])(Math.round(e[0]*o),0,o),r[1]=Object(i["f"])(Math.round(e[1]*o),0,o),r[2]=Object(i["f"])(Math.round(e[2]*o),0,o),r[3]=a+s}const o=255,c=85,l=c,u=2*c},caf7:function(e,t,r){"use strict";r.d(t,"a",(function(){return y}));var i,n=r("e431"),a=r("47f8"),s=r("0b2d"),o=r("7289"),c=r("d18f");!function(e){function t(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)}function r(e,t){const r=e[t],i=e[t+1],n=e[t+2],a=1/Math.sqrt(r*r+i*i+n*n);e[t]*=a,e[t+1]*=a,e[t+2]*=a}function i(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r}function n(e,t,r,i,n,a=t){(n=n||e)[a]=e[t]+r[i],n[a+1]=e[t+1]+r[i+1],n[a+2]=e[t+2]+r[i+2]}function a(e,t,r,i,n,a=t){(n=n||e)[a]=e[t]-r[i],n[a+1]=e[t+1]-r[i+1],n[a+2]=e[t+2]-r[i+2]}e.length=t,e.normalize=r,e.scale=i,e.add=n,e.subtract=a}(i||(i={}));var l=r("0278"),u=r("1038"),d=r("1153");const h=i;var p,f,b,m;!function(e){const t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)s[6*l+e]=l;const o=new Uint16Array(36);for(let l=0;l<6;l++)o[6*l+0]=0,o[6*l+1]=1,o[6*l+2]=2,o[6*l+3]=2,o[6*l+4]=3,o[6*l+5]=0;function c(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let i=0;i<8;i++)t[3*i]=r[i][0]*e[0],t[3*i+1]=r[i][1]*e[1],t[3*i+2]=r[i][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}],["uv0",{size:2,data:n}]],[["position",a],["normal",s],["uv0",o]])}e.createGeometry=c}(p||(p={})),function(e){const t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function s(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let i=0;i<6;i++)t[3*i]=r[i][0]*e[0],t[3*i+1]=r[i][1]*e[1],t[3*i+2]=r[i][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i}]],[["position",n],["normal",a]])}e.createGeometry=s}(f||(f={})),function(e){const t=.5,r=0,i=Object(a["d"])(-t,r,-t),s=Object(a["d"])(t,r,-t),o=Object(a["d"])(0,r,t),c=Object(a["d"])(0,r+t,0),u=Object(a["c"])(),d=Object(a["c"])(),h=Object(a["c"])(),p=Object(a["c"])(),f=Object(a["c"])();Object(n["m"])(u,i,c),Object(n["m"])(d,i,s),Object(n["j"])(h,u,d),Object(n["u"])(h,h),Object(n["m"])(u,s,c),Object(n["m"])(d,s,o),Object(n["j"])(p,u,d),Object(n["u"])(p,p),Object(n["m"])(u,o,c),Object(n["m"])(d,o,i),Object(n["j"])(f,u,d),Object(n["u"])(f,f);const b=[i,s,o,c],m=[0,-1,0,h[0],h[1],h[2],p[0],p[1],p[2],f[0],f[1],f[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function y(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let r=0;r<4;r++)t[3*r]=b[r][0]*e[0],t[3*r+1]=b[r][1]*e[1],t[3*r+2]=b[r][2]*e[2];return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:m}]],[["position",new Uint16Array(g)],["normal",new Uint16Array(v)]])}e.createGeometry=y}(b||(b={})),function(e){function t(e,t,r,i={uv:!0}){const n=-Math.PI,a=2*Math.PI,s=-Math.PI/2,o=Math.PI,c=Math.max(3,Math.floor(t)),u=Math.max(2,Math.floor(r)),d=(c+1)*(u+1),h=new Float32Array(3*d),p=new Float32Array(3*d),f=new Float32Array(2*d),b=[];let m=0;for(let l=0;l<=u;l++){const t=[],r=l/u,i=s+r*o,d=Math.cos(i);for(let s=0;s<=c;s++){const o=s/c,l=n+o*a,u=Math.cos(l)*d,b=Math.sin(i),g=-Math.sin(l)*d;h[3*m]=u*e,h[3*m+1]=b*e,h[3*m+2]=g*e,p[3*m]=u,p[3*m+1]=b,p[3*m+2]=g,f[2*m]=o,f[2*m+1]=r,t.push(m),++m}b.push(t)}const g=new Uint32Array(2*c*(u-1)*3);m=0;for(let l=0;l<u;l++)for(let e=0;e<c;e++){const t=b[l][e],r=b[l][e+1],i=b[l+1][e+1],n=b[l+1][e];0===l?(g[m++]=t,g[m++]=i,g[m++]=n):l===u-1?(g[m++]=t,g[m++]=r,g[m++]=i):(g[m++]=t,g[m++]=r,g[m++]=i,g[m++]=i,g[m++]=n,g[m++]=t)}const v=[["position",g],["normal",g]],y=[["position",{size:3,data:h,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]];return i.uv&&(y.push(["uv0",{size:2,data:f,exclusive:!0}]),v.push(["uv0",g])),i.offset&&(v[0][0]="offset",y[0][0]="offset",v.push(["position",new Uint32Array(g.length)]),y.push(["position",{size:3,data:Float64Array.from(i.offset),exclusive:!0}])),new l["a"](y,v)}function r(e,t,r){const i=e;let n,a;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],a=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let l=0;l<n.length;l+=3)h.scale(n,l,e/h.length(n,l));let s={};function o(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(s[i])return s[i];let a=n.length;return n.length+=3,h.add(n,3*t,n,3*r,n,a),h.scale(n,a,e/h.length(n,a)),a/=3,s[i]=a,a}for(let l=0;l<t;l++){const e=a.length,t=new Uint32Array(4*e);for(let r=0;r<e;r+=3){const e=a[r],i=a[r+1],n=a[r+2],s=o(e,i),c=o(i,n),l=o(n,e),u=4*r;t[u]=e,t[u+1]=s,t[u+2]=l,t[u+3]=i,t[u+4]=c,t[u+5]=s,t[u+6]=n,t[u+7]=l,t[u+8]=c,t[u+9]=s,t[u+10]=c,t[u+11]=l}a=t,s={}}const c=new Float32Array(n);for(let l=0;l<c.length;l+=3)h.normalize(c,l);const u=[["position",a],["normal",a]],d=[["position",{size:3,data:new Float32Array(n),exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}]];return new l["a"](d,u)}function i(e,t,r,i,n,a,s){const o=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const u=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],d=null!=i&&2===i.length?i:[1,1],h=[["position",{size:3,data:o,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:a.length,data:a}],["color",{size:4,data:u,exclusive:!0}],["size",{size:2,data:d}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);h.push(["auxpos1",{size:4,data:e}])}if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);h.push(["auxpos2",{size:4,data:e}])}return new l["a"](h,null,1)}function m(e,t,r,i,n,a,s,o){if(null!=e){const{data:t}=o.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=r){const{data:e}=o.getMutableAttribute("color");e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3]}if(null!=i){const{data:e}=o.getMutableAttribute("size");e[0]=i[0],e[1]=i[1]}if(null!=n){const{data:e}=o.getMutableAttribute("auxpos1");e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=a){const{data:e}=o.getMutableAttribute("uv0");e[0]=a[0],e[1]=a[1]}if(null!=s){const{data:e}=o.getMutableAttribute("auxpos2");e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}}function y(e,t){const r=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),a=new Uint32Array(e.length);for(let s=0;s<e.length;s++)r[3*s]=e[s][0],r[3*s+1]=e[s][1],r[3*s+2]=e[s][2],t&&(i[3*s]=t[s][0],i[3*s+1]=t[s][1],i[3*s+2]=t[s][2]),n[s]=s,a[s]=0;return t||(i[0]=0,i[1]=1,i[2]=0),new l["a"]([["position",{size:3,data:r,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",n],["normal",t?n:a],["uv0",a]],1)}function O(){const e=[0,0,0,0,0,100,100,0,0],t=new Uint16Array([0,1,2]),r=[0,1,0],i=new Uint16Array([0,0,0]),n=[0,0],a=new Uint16Array([0,0,0]);return new l["a"]([["position",{size:3,data:e,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:n,exclusive:!0}]],[["position",t],["normal",i],["uv0",a]])}e.createBoxGeometry=p.createGeometry,e.createDiamondGeometry=f.createGeometry,e.createTetrahedronGeometry=b.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=r,e.createPointGeometry=i,e.updatePointGeometry=m,e.createPointArrayGeometry=y,e.createTriangleGeometry=O;const x=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function j(e=x){const t=new Array(12);for(let a=0;a<4;a++)for(let r=0;r<3;r++)t[3*a+r]=e[a][r];const r=new Uint32Array([0,1,2,2,3,0]),i=[0,0,1],n=new Uint32Array([0,0,0,0,0,0]);return new l["a"]([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:i,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",r],["normal",n],["uv0",r],["color",n]])}function _(e,t,r,i,n=!0,s=!0){let o=0;const c=t,u=e;let d=Object(a["d"])(0,o,0),h=Object(a["d"])(0,o+u,0),p=Object(a["d"])(0,-1,0),f=Object(a["d"])(0,1,0);i&&(o=u,h=Object(a["d"])(0,0,0),d=Object(a["d"])(0,o,0),p=Object(a["d"])(0,1,0),f=Object(a["d"])(0,-1,0));const b=[h,d],m=[p,f],g=r+2,v=Math.sqrt(u*u+c*c);if(i)for(let l=r-1;l>=0;l--){const e=l*(2*Math.PI/r),t=Object(a["d"])(Math.cos(e)*c,o,Math.sin(e)*c);b.push(t);const i=Object(a["d"])(u*Math.cos(e)/v,-c/v,u*Math.sin(e)/v);m.push(i)}else for(let l=0;l<r;l++){const e=l*(2*Math.PI/r),t=Object(a["d"])(Math.cos(e)*c,o,Math.sin(e)*c);b.push(t);const i=Object(a["d"])(u*Math.cos(e)/v,c/v,u*Math.sin(e)/v);m.push(i)}const y=new Uint32Array(2*(r+2)*3),O=new Uint32Array(2*(r+2)*3);let x=0,j=0;if(n){for(let e=3;e<b.length;e++)y[x++]=1,y[x++]=e-1,y[x++]=e,O[j++]=0,O[j++]=0,O[j++]=0;y[x++]=b.length-1,y[x++]=2,y[x++]=1,O[j++]=0,O[j++]=0,O[j++]=0}if(s){for(let e=3;e<b.length;e++)y[x++]=e,y[x++]=e-1,y[x++]=0,O[j++]=e,O[j++]=e-1,O[j++]=1;y[x++]=0,y[x++]=2,y[x++]=b.length-1,O[j++]=1,O[j++]=2,O[j++]=m.length-1}const _=new Float32Array(3*g);for(let a=0;a<g;a++)_[3*a]=b[a][0],_[3*a+1]=b[a][1],_[3*a+2]=b[a][2];const S=new Float32Array(3*g);for(let a=0;a<g;a++)S[3*a]=m[a][0],S[3*a+1]=m[a][1],S[3*a+2]=m[a][2];return new l["a"]([["position",{size:3,data:_,exclusive:!0}],["normal",{size:3,data:S,exclusive:!0}]],[["position",y],["normal",O]])}function S(e,t,r,i,s,o){const c=i?Object(a["a"])(i):Object(a["d"])(1,0,0),u=s?Object(a["a"])(s):Object(a["d"])(0,0,0);o=null==o||o;const d=Object(a["c"])();Object(n["u"])(d,c);const h=Object(a["c"])();Object(n["h"])(h,d,Math.abs(e));const p=Object(a["c"])();Object(n["h"])(p,h,-.5),Object(n["i"])(p,p,u);const f=Object(a["d"])(0,1,0);Math.abs(1-Object(n["k"])(d,f))<.2&&Object(n["z"])(f,0,0,1);const b=Object(a["c"])();Object(n["j"])(b,d,f),Object(n["u"])(b,b),Object(n["j"])(f,b,d);const m=2*r+(o?2:0),g=r+(o?2:0),v=new Float32Array(3*m),y=new Float32Array(3*g),O=new Float32Array(2*m),x=new Uint32Array(3*r*(o?4:2)),j=new Uint32Array(3*r*(o?4:2));o&&(v[3*(m-2)+0]=p[0],v[3*(m-2)+1]=p[1],v[3*(m-2)+2]=p[2],O[2*(m-2)]=0,O[2*(m-2)+1]=0,v[3*(m-1)+0]=v[3*(m-2)+0]+h[0],v[3*(m-1)+1]=v[3*(m-2)+1]+h[1],v[3*(m-1)+2]=v[3*(m-2)+2]+h[2],O[2*(m-1)]=1,O[2*(m-1)+1]=1,y[3*(g-2)+0]=-d[0],y[3*(g-2)+1]=-d[1],y[3*(g-2)+2]=-d[2],y[3*(g-1)+0]=d[0],y[3*(g-1)+1]=d[1],y[3*(g-1)+2]=d[2]);const _=function(e,t,r){x[e]=t,j[e]=r};let S=0;const w=Object(a["c"])(),C=Object(a["c"])();for(let a=0;a<r;a++){const e=a*(2*Math.PI/r);Object(n["h"])(w,f,Math.sin(e)),Object(n["h"])(C,b,Math.cos(e)),Object(n["i"])(w,w,C),y[3*a+0]=w[0],y[3*a+1]=w[1],y[3*a+2]=w[2],Object(n["h"])(w,w,t),Object(n["i"])(w,w,p),v[3*a+0]=w[0],v[3*a+1]=w[1],v[3*a+2]=w[2],O[2*a+0]=a/r,O[2*a+1]=0,v[3*(a+r)+0]=v[3*a+0]+h[0],v[3*(a+r)+1]=v[3*a+1]+h[1],v[3*(a+r)+2]=v[3*a+2]+h[2],O[2*(a+r)+0]=a/r,O[2*a+1]=1;const i=(a+1)%r;_(S++,a,a),_(S++,a+r,a),_(S++,i,i),_(S++,i,i),_(S++,a+r,a),_(S++,i+r,i)}if(o){for(let e=0;e<r;e++){const t=(e+1)%r;_(S++,m-2,g-2),_(S++,e,g-2),_(S++,t,g-2)}for(let e=0;e<r;e++){const t=(e+1)%r;_(S++,e+r,g-1),_(S++,m-1,g-1),_(S++,t+r,g-1)}}return new l["a"]([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:y,exclusive:!0}],["uv0",{size:2,data:O,exclusive:!0}]],[["position",x],["normal",j],["uv0",x]])}function w(t,r,i,n,a){i=i||10,n=null==n||n,Object(d["a"])(t.length>1);const s=[[0,0,0]],o=[],c=[];for(let e=0;e<i;e++){o.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;c.push([Math.cos(t)*r,Math.sin(t)*r])}return e.createPathExtrusionGeometry(c,t,s,o,n,a)}function C(e,t,r,i,u,d=Object(a["d"])(0,0,0)){const h=e.length,p=new Float32Array(t.length*h*3+(6*r.length||0)),f=new Float32Array(t.length*h*3+(r?6:0)),b=(t.length-1)*h*6+3*i.length*2,m=new Uint32Array(b),v=new Uint32Array(b);let y=0,O=0,x=0,j=0;const _=Object(a["c"])(),S=Object(a["c"])(),w=Object(a["c"])(),C=Object(a["c"])(),P=Object(a["c"])(),T=Object(a["c"])(),E=Object(a["c"])(),A=Object(s["f"])(),R=Object(a["c"])(),D=Object(a["c"])(),z=Object(a["c"])(),I=Object(a["c"])(),L=Object(a["c"])(),F=Object(o["d"])();Object(n["z"])(R,0,1,0),Object(n["m"])(S,t[1],t[0]),Object(n["u"])(S,S),u?(Object(n["i"])(A,t[0],d),Object(n["u"])(w,A)):Object(n["z"])(w,0,0,1),M(S,w,R,R,P,w,g),Object(n["n"])(C,w),Object(n["n"])(I,P);for(let a=0;a<r.length;a++)Object(n["h"])(T,P,r[a][0]),Object(n["h"])(A,w,r[a][2]),Object(n["i"])(T,T,A),Object(n["i"])(T,T,t[0]),p[y++]=T[0],p[y++]=T[1],p[y++]=T[2];f[O++]=-S[0],f[O++]=-S[1],f[O++]=-S[2];for(let n=0;n<i.length;n++)m[x++]=i[n][0]>0?i[n][0]:-i[n][0]-1+r.length,m[x++]=i[n][1]>0?i[n][1]:-i[n][1]-1+r.length,m[x++]=i[n][2]>0?i[n][2]:-i[n][2]-1+r.length,v[j++]=0,v[j++]=0,v[j++]=0;let V=r.length;const U=r.length-1;for(let a=0;a<t.length;a++){let r=!1;a>0&&(Object(n["n"])(_,S),a<t.length-1?(Object(n["m"])(S,t[a+1],t[a]),Object(n["u"])(S,S)):r=!0,Object(n["i"])(D,_,S),Object(n["u"])(D,D),Object(n["i"])(z,t[a-1],C),Object(o["h"])(t[a],D,F),Object(o["n"])(F,Object(c["h"])(z,_),A)?(Object(n["m"])(A,A,t[a]),Object(n["u"])(w,A),Object(n["j"])(P,D,w),Object(n["u"])(P,P)):M(D,C,I,R,P,w,g),Object(n["n"])(C,w),Object(n["n"])(I,P)),u&&(Object(n["i"])(A,t[a],d),Object(n["u"])(L,A));for(let i=0;i<h;i++)if(Object(n["h"])(T,P,e[i][0]),Object(n["h"])(A,w,e[i][1]),Object(n["i"])(T,T,A),Object(n["u"])(E,T),f[O++]=E[0],f[O++]=E[1],f[O++]=E[2],Object(n["i"])(T,T,t[a]),p[y++]=T[0],p[y++]=T[1],p[y++]=T[2],!r){const e=(i+1)%h;m[x++]=V+i,m[x++]=V+h+i,m[x++]=V+e,m[x++]=V+e,m[x++]=V+h+i,m[x++]=V+h+e;for(let t=0;t<6;t++)v[j++]=m[x-6+t]-U}V+=h}const G=t[t.length-1];for(let a=0;a<r.length;a++)Object(n["h"])(T,P,r[a][0]),Object(n["h"])(A,w,r[a][1]),Object(n["i"])(T,T,A),Object(n["i"])(T,T,G),p[y++]=T[0],p[y++]=T[1],p[y++]=T[2];const N=O/3;f[O++]=S[0],f[O++]=S[1],f[O++]=S[2];const B=V-h;for(let n=0;n<i.length;n++)m[x++]=i[n][0]>=0?V+i[n][0]:-i[n][0]-1+B,m[x++]=i[n][2]>=0?V+i[n][2]:-i[n][2]-1+B,m[x++]=i[n][1]>=0?V+i[n][1]:-i[n][1]-1+B,v[j++]=N,v[j++]=N,v[j++]=N;return new l["a"]([["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:f,exclusive:!0}]],[["position",m],["normal",v]])}function P(e,t,r){Object(d["a"])(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(d["a"])(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(d["a"])(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(d["a"])(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const i=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let a=0,s=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)i[a++]=e[l][t];l>0&&(n[s++]=l-1,n[s++]=l)}const o=[],c=[];if(o.push(["position",n]),c.push(["position",{size:3,data:i,exclusive:!0}]),t){const r=new Float32Array(3*t.length);let i=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)r[i++]=t[n][e];o.push(["normal",n]),c.push(["normal",{size:3,data:r,exclusive:!0}])}return r&&(c.push(["color",{size:4,data:r}]),o.push(["color",Object(u["d"])(r.length/4)])),new l["a"](c,o,2)}function T(e,t,r,i,n=0){const a=new Array(18),s=[[-t,n,i/2],[r,n,i/2],[0,e+n,i/2],[-t,n,-i/2],[r,n,-i/2],[0,e+n,-i/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)a[3*c]=s[c][0],a[3*c+1]=s[c][1],a[3*c+2]=s[c][2];return new l["a"]([["position",{size:3,data:a,exclusive:!0}]],[["position",o]])}function E(e,t){const r=e.getMutableAttribute("position").data;for(let i=0;i<r.length;i+=3){const e=r[i],a=r[i+1],s=r[i+2];Object(n["z"])(v,e,a,s),Object(n["t"])(v,v,t),r[i]=v[0],r[i+1]=v[1],r[i+2]=v[2]}}function A(e,t=e){const r=e.vertexAttributes,i=r.get("position").data,n=r.get("normal").data;if(n){const e=t.getMutableAttribute("normal").data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute("position").data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}return t}function R(e,t,r,i,a){return!(Math.abs(Object(n["k"])(t,e))>a)&&(Object(n["j"])(r,e,t),Object(n["u"])(r,r),Object(n["j"])(i,r,e),Object(n["u"])(i,i),!0)}function M(e,t,r,i,n,a,s){return R(e,t,n,a,s)||R(e,r,n,a,s)||R(e,i,n,a,s)}e.createSquareGeometry=j,e.createConeGeometry=_,e.createCylinderGeometry=S,e.createTubeGeometry=w,e.createPathExtrusionGeometry=C,e.createPolylineGeometry=P,e.createExtrudedTriangle=T,e.transformInPlace=E,e.cgToGIS=A,e.makeOrthoBasisDirUp=R,e.makeOrthoBasisDirUpFallback=M}(m||(m={}));const g=.99619469809,v=Object(a["c"])(),y=m},d0cb:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r("2f98"),n=r("3886");function a(e,t){const r=e;r.include(i["a"]),r.attributes.add("position","vec3"),r.attributes.add("normal","vec3"),r.attributes.add("auxpos1","vec4"),r.vertex.uniforms.add("proj","mat4"),r.vertex.uniforms.add("view","mat4"),r.vertex.uniforms.add("viewNormal","mat4"),r.vertex.uniforms.add("viewport","vec4"),r.vertex.uniforms.add("camPos","vec3"),r.vertex.uniforms.add("polygonOffset","float"),r.vertex.uniforms.add("cameraGroundRelative","float"),r.vertex.uniforms.add("pixelRatio","float"),r.vertex.uniforms.add("perDistancePixelRatio","float"),r.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&r.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),r.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),r.vertex.constants.add("smallOffsetAngle","float",.984807753012208),r.vertex.code.add(n["a"]`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.vertex.code.add(n["a"]`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||r.vertex.code.add(n["a"]`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),r.vertex.code.add(n["a"]`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?n["a"]`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?n["a"]`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.vertex.code.add(n["a"]`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function s(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},d1ac:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u}));var i=r("9ef0"),n=r("b2b2"),a=r("d297");function s(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&Object(n["l"])(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function o(e,t){if(Object(n["l"])(e.symbol))return e.symbol;const r=s(e,t);return Object(n["l"])(r)&&"dot-density"!==r.type?r.getSymbol(e,t):null}function c(e,t){const r=s(e,t),i=o(e,t);if(Object(n["k"])(i))return null;const c={renderer:r,symbol:i};if(Object(n["k"])(r)||!("visualVariables"in r)||!r.visualVariables)return c;const l=Object(a["getVisualVariableValues"])(r,e,t),u=["proportional","proportional","proportional"];for(const{variable:n,value:a}of l)switch(n.type){case"color":c.color=a.toRgba();break;case"size":if("outline"===n.target)c.outlineSize=a;else{const e=n.axis,t=n.useSymbolValue?"symbol-value":a;switch(e){case"width":u[0]=t;break;case"depth":u[1]=t;break;case"height":u[2]=t;break;case"width-and-depth":u[0]=u[1]=t;break;default:u[0]=u[1]=u[2]=t}}break;case"opacity":c.opacity=a;break;case"rotation":switch(n.axis){case"tilt":c.tilt=a;break;case"roll":c.roll=a;break;default:c.heading=a}}return"proportional"===u[0]&&"proportional"===u[1]&&"proportional"===u[2]||(c.size=u),c}async function l(e,t){if(Object(n["l"])(e.symbol))return e.symbol;const r=s(e,t);return Object(n["l"])(r)&&r.getSymbolAsync(e,{...t,abortOptions:{signal:t.signal}})}async function u(e,t){const r=s(e,t),n=await l(e,t);if(!n)return null;const o={renderer:r,symbol:n};if(!r||!("visualVariables"in r)||!r.visualVariables)return o;const c=Object(a["getVisualVariableValues"])(r,e,t),u=["proportional","proportional","proportional"];for(const{variable:a,value:s}of c)if("color"===a.type)o.color=i["a"].toUnitRGBA(s);else if("size"===a.type)if("outline"===a.target)o.outlineSize=s;else{const e=a.axis,t=a.useSymbolValue?"symbol-value":s;"width"===e?u[0]=t:"depth"===e?u[1]=t:"height"===e?u[2]=t:u[0]=u[1]="width-and-depth"===e?t:u[2]=t}else"opacity"===a.type?o.opacity=s:"rotation"===a.type&&"tilt"===a.axis?o.tilt=s:"rotation"===a.type&&"roll"===a.axis?o.roll=s:"rotation"===a.type&&(o.heading=s);return(isFinite(u[0])||isFinite(u[1])||isFinite(u[2]))&&(o.size=u),o}function d(e,t=0){const r=e[t];return"number"==typeof r&&isFinite(r)?r:null}function h(e){for(let t=0;t<3;t++){const r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}},d359:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return y})),r.d(t,"g",(function(){return j})),r.d(t,"h",(function(){return O})),r.d(t,"i",(function(){return x})),r.d(t,"j",(function(){return v})),r.d(t,"k",(function(){return g})),r.d(t,"l",(function(){return S}));var i=r("2119"),n=r("d791"),a=r("e431"),s=r("0b2d"),o=r("7577"),c=r("0fc4"),l=r("4f8b"),u=r("7289"),d=r("7361");function h(e){return e?[Object(u["d"])(e[0]),Object(u["d"])(e[1]),Object(u["d"])(e[2]),Object(u["d"])(e[3]),Object(u["d"])(e[4]),Object(u["d"])(e[5])]:[Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])(),Object(u["d"])()]}function p(){return[Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])(),Object(s["f"])()]}function f(e,t=h()){for(let r=0;r<6;r++)Object(u["c"])(e[r],t[r])}function b(e,t,r,i=P){const s=Object(n["n"])(d["a"].get(),t,e);Object(n["c"])(s,s);for(let n=0;n<8;++n){const e=Object(o["m"])(d["e"].get(),w[n],s);Object(a["z"])(i[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}m(r,i)}function m(e,t){Object(u["g"])(t[4],t[0],t[3],e[0]),Object(u["g"])(t[1],t[5],t[6],e[1]),Object(u["g"])(t[4],t[5],t[1],e[2]),Object(u["g"])(t[3],t[2],t[6],e[3]),Object(u["g"])(t[0],t[1],t[2],e[4]),Object(u["g"])(t[5],t[4],t[7],e[5])}function g(e,t){for(let r=0;r<6;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function v(e,t){return _(e,Object(l["c"])(t,C.get()))}function y(e,t){for(let r=0;r<6;r++){const i=e[r];if(!Object(u["b"])(i,t))return!1}return!0}function O(e,t,r){return _(e,Object(l["b"])(t,r,C.get()))}function x(e,t){for(let r=0;r<6;r++)if(Object(u["v"])(e[r],t)>0)return!1;return!0}function j(e,t){for(let r=0;r<6;r++)if(Object(u["o"])(e[r],t))return!1;return!0}function _(e,t){for(let r=0;r<6;r++)if(!Object(u["a"])(e[r],t))return!1;return!0}const S={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},w=[Object(c["g"])(-1,-1,-1,1),Object(c["g"])(1,-1,-1,1),Object(c["g"])(1,1,-1,1),Object(c["g"])(-1,1,-1,1),Object(c["g"])(-1,-1,1,1),Object(c["g"])(1,-1,1,1),Object(c["g"])(1,1,1,1),Object(c["g"])(-1,1,1,1)],C=new i["a"](l["a"]),P=p()},d36e:function(e,t,r){"use strict";r.d(t,"a",(function(){return w}));var i=r("d7f7"),n=r("b061"),a=r("35b3"),s=r("7438"),o=r("8675"),c=r("7c51"),l=r("a4ee"),u=r("d272"),d=r("6a07"),h=r("c6d7"),p=r("8e97"),f=r("c3a4"),b=r("ca98"),m=r("da35"),g=r("fa1e"),v=r("c829"),y=r("87b7"),O=r("1962"),x=r("189c");class j extends b["a"]{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,OITEnabled:0===r.transparencyPassType,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new v["a"](e.rctx,i,g["a"])}bindPass(e,t){Object(p["c"])(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(d["b"])(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(h["a"])(this.program,t))}bindDraw(e){Object(p["d"])(this.program,e),this.program.rebindTextures(),Object(u["c"])(this.program,this.configuration,e)}createPipeline(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(x["g"])({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?s["g"]:Object(s["a"])(e),culling:Object(x["c"])(r.cullFace),depthTest:{func:Object(s["b"])(e)},depthWrite:i||n?r.writeDepth&&x["e"]:null,colorWrite:x["d"],stencilWrite:r.sceneHasOcludees?y["j"]:null,stencilTest:r.sceneHasOcludees?t?y["f"]:y["e"]:null,polygonOffset:i||n?r.polygonOffset&&_:Object(s["h"])(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.createPipeline(this.configuration.transparencyPassType,!0),this.createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}j.shader=new f["a"](O["a"],()=>r.e("chunk-2d0de726").then(r.bind(null,"864f")));const _={factor:1,units:1};class S extends m["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(l["a"])([Object(m["b"])({count:8})],S.prototype,"output",void 0),Object(l["a"])([Object(m["b"])({count:3})],S.prototype,"cullFace",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"slicePlaneEnabled",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"vertexColors",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"transparent",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"polygonOffset",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"enableOffset",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"writeDepth",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"sceneHasOcludees",void 0),Object(l["a"])([Object(m["b"])({count:4})],S.prototype,"transparencyPassType",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"multipassTerrainEnabled",void 0),Object(l["a"])([Object(m["b"])()],S.prototype,"cullAboveGround",void 0);class w extends a["a"]{constructor(e){super(e,P),this.supportsEdges=!0,this.techniqueConfig=new S}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<s["e"],this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,r,i,n,a,s){Object(c["i"])(e,t,i,n,a,void 0,s)}requiresSlot(e,t){return 20===e||(4===Object(n["b"])(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.parameters.writeLinearDepth?new C(e):null}createBufferWriter(){return new o["a"](o["b"])}}class C extends i["a"]{updateParameters(e){return this.ensureTechnique(j,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const P={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...a["b"]}},d3cf:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return l}));var i=r("8d60"),n=(r("c120"),r("7ffa")),a=r("b2b2"),s=r("a21b"),o=r("a9ab"),c=r("1a54");function l(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if(d(e))return e;const r=new i["a"]({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=Object(n["a"])(e.symbol),r.attributes=Object(n["a"])(e.attributes),r.geometry=p(e.geometry),r}function p(e){return Object(a["k"])(e)?null:l(e)?e:Object(o["a"])(f(e))}function f(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:r,y:i,z:n,m:a}=e;return{x:r,y:i,z:n,m:a,spatialReference:t}}case"polygon":{const{rings:r,hasZ:i,hasM:n}=e;return{rings:b(r),hasZ:i,hasM:n,spatialReference:t}}case"polyline":{const{paths:r,hasZ:i,hasM:n}=e;return{paths:b(r),hasZ:i,hasM:n,spatialReference:t}}case"extent":{const{xmin:r,xmax:i,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:u,hasM:d}=e;return{xmin:r,xmax:i,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:u,hasM:d,spatialReference:t}}case"multipoint":{const{points:r,hasZ:i,hasM:n}=e;return{points:v(r)?m(r):r,hasZ:i,hasM:n,spatialReference:t}}default:return}}function b(e){return g(e)?e.map(e=>m(e)):e}function m(e){return e.map(e=>Object(s["n"])(e))}function g(e){for(const t of e)if(0!==t.length)return v(t);return!1}function v(e){return e.length&&(Object(s["d"])(e[0])||Object(s["e"])(e[0]))}function y(e,t){if(!e)return null;let r;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=Object(c["j"])(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}},d408:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return y})),r.d(t,"d",(function(){return z}));r("c120");var i=r("38a4"),n=r("b2b2"),a=r("a21b"),s=r("3349"),o=r("e431"),c=r("0b2d"),l=r("8188"),u=r("f694"),d=r("1666"),h=r("ed70"),p=r("2e0f"),f=r("7585"),b=r("0278");function m(e){const t=[],r=[];O(e,r,t);const i=r[0][1].data,n=t[0][1].length,a=new Uint16Array(n);return x(e,r,t),j(e,r,t,a),S(e,r,t,a),_(e,r,t,a),w(e,r,t,a),C(e,r,t,a),P(e,r,t,i),T(e,r,t,i),new b["a"](r,t,2)}function g(e,t,r,i){const n="polygon"===e.type?1:0,a="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(d["a"])(a,e.hasZ,n),c=new Float64Array(s.length),l=Object(p["d"])(s,e.spatialReference,0,c,0,s,0,s.length/3,t,r,i),u=null!=l;return{lines:u?v(o,s,c):[],projectionSuccess:u,sampledElevation:l}}function v(e,t,r){const i=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;i.push({position:t.subarray(e,s),mapPosition:r?r.subarray(e,s):void 0})}return i}function y(e,t){const r="polygon"===e.type?1:0,i="polygon"===e.type?e.rings:e.paths,{position:n,outlines:a}=Object(d["a"])(i,!1,r),s=Object(l["p"])(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=f["a"];return{lines:s?v(a,n):[],projectionSuccess:s}}function O(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=e,s=A(i)&&1===n,o=i.length/3-(s?1:0),c=new Uint32Array(2*(o-1)),l=s?Object(a["m"])(i,0,i.length-3):i;let u=0;for(let a=0;a<o-1;a++)c[u++]=a,c[u++]=a+1;t.push(["position",{size:3,data:l,exclusive:s}]),r.push(["position",c])}function x(e,t,r){const i=e.attributeData.mapPosition;Object(n["k"])(i)||(r.push(["mapPos",r[0][1]]),t.push(["mapPos",{size:3,data:i}]))}function j(e,t,r,i){if(Object(n["l"])(e.attributeData.colorFeature))return;const a=e.attributeData.color;t.push(["color",{size:4,data:Object(n["v"])(a,h["c"])}]),r.push(["color",i])}function _(e,t,r,i){const a=e.attributeData.colorFeature;Object(n["k"])(a)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([a])}]),r.push(["color",i]))}function S(e,t,r,i){if(Object(n["l"])(e.attributeData.sizeFeature))return;const a=e.attributeData.size;t.push(["size",{size:1,data:[Object(n["v"])(a,1)]}]),r.push(["size",i])}function w(e,t,r,i){const a=e.attributeData.sizeFeature;Object(n["k"])(a)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([a])}]),r.push(["sizeFeatureAttribute",i]))}function C(e,t,r,i){const a=e.attributeData.opacityFeature;Object(n["k"])(a)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([a])}]),r.push(["opacityFeatureAttribute",i]))}function P(e,t,r,a){if("round"!==e.join)return;const s=a.length/3,c=new Float32Array(s),l=R,u=M;Object(o["z"])(l,0,0,0);const d=Object(n["v"])(e.uniformSize,1);for(let n=-1;n<s;++n){const e=n<0?s+n:n,t=(n+1)%s;if(Object(o["z"])(u,a[3*t+0]-a[3*e+0],a[3*t+1]-a[3*e+1],a[3*t+2]-a[3*e+2]),Object(o["u"])(u,u),n>=0){const e=(Math.PI-Object(i["b"])(Object(o["k"])(l,u)))*D*1*E(d);c[n]=Math.max(Math.floor(e),0)}Object(o["h"])(l,u,-1)}t.push(["subdivisions",{size:1,data:c}]),r.push(["subdivisions",r[0][1]])}function T(e,t,r,i){if(Object(n["k"])(e.overlayInfo)||1!==e.overlayInfo.renderCoordsHelper.viewingMode||!e.overlayInfo.spatialReference.isGeographic)return;const a=new Float64Array(i.length),c=Object(u["e"])(e.overlayInfo.spatialReference);for(let n=0;n<a.length;n+=3)Object(l["l"])(i,n,a,n,c);const d=i.length/3,h=new Float32Array(d+1);let p=R,f=M,b=0,m=0;Object(o["z"])(p,a[m++],a[m++],a[m++]),h[0]=0;for(let n=1;n<d+1;++n)n===d&&(m=0),Object(o["z"])(f,a[m++],a[m++],a[m++]),b+=Object(s["d"])(p,f),h[n]=b,[p,f]=[f,p];t.push(["distanceToStart",{size:1,data:h}]),r.push(["distanceToStart",r[0][1]])}function E(e){return 1.863798+-2.0062872/(1+e/18.2313)**.8856294}function A(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const R=Object(c["f"])(),M=Object(c["f"])(),D=4/Math.PI;function z(e){switch(e){case"butt":return 0;case"square":return 1;case"round":return 2;default:return null}}},d539:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var i=r("0b2d"),n=r("6a21"),a=r("3886"),s=r("9cc4");function o(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(n["a"],t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const r=[a["a"]`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,a["a"]`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?a["a"]`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,a["a"]`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,a["a"]`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,t.vertexTangents?a["a"]`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:a["a"]``];e.vertex.code.add(r[0]),e.vertex.code.add(r[1]),e.vertex.code.add(r[2]),2===t.output&&e.vertex.code.add(r[3]),e.vertex.code.add(r[4])}!function(e){class t{}function r(e,t){Object(s["b"])(t,c,l,3),e.setUniform3fv("viewOriginHi",c),e.setUniform3fv("viewOriginLo",l)}e.Uniforms=t,e.bindCustomOrigin=r}(o||(o={}));const c=Object(i["f"])(),l=Object(i["f"])()},d56e:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("3886"),n=r("1956");function a(e,t){const r=i["a"]`
  /*
  *  ${t.name}
  *  ${0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":""}
  */
  `;Object(n["c"])()&&(e.fragment.code.add(r),e.vertex.code.add(r))}},d6e5:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r("171c");class n{constructor(e){this.rctx=e,this.camera=null,this.lastFrameCamera=new i["a"],this.pass=0,this.slot=2,this.highlightDepthTexture=null,this.renderOccludedMask=s,this.hasOccludees=!1}resetRenderOccludedMask(){this.renderOccludedMask=s}get isHighlightPass(){return 5===this.pass}}class a extends n{constructor(e,t,r,i,n,a){super(e),this.offscreenRenderingHelper=t,this.scenelightingData=r,this.shadowMap=i,this.ssaoHelper=n,this.sliceHelper=a}}const s=13},d97e:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r("b2b2");function n(e,t){return e?t?4:3:t?3:2}function a(e,t,r,a,c){if(Object(i["k"])(t)||!t.lengths.length)return null;const l="upperLeft"===(null==c?void 0:c.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const u=e.coords,d=[],h=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:p,coords:f}=t,b=n(r,a);let m=0;for(const i of p){const e=s(h,f,m,i,r,a,l);e&&d.push(e),m+=i*b}if(d.sort((e,t)=>{let i=l*e[2]-l*t[2];return 0===i&&r&&(i=e[4]-t[4]),i}),d.length){let e=6*d[0][2];u[0]=d[0][0]/e,u[1]=d[0][1]/e,r&&(e=6*d[0][4],u[2]=0!==e?d[0][3]/e:0),(u[0]<h[0]||u[0]>h[1]||u[1]<h[2]||u[1]>h[3]||r&&(u[2]<h[4]||u[2]>h[5]))&&(u.length=0)}if(!u.length){const e=t.lengths[0]?o(f,0,p[0],r,a):null;if(!e)return null;u[0]=e[0],u[1]=e[1],r&&e.length>2&&(u[2]=e[2])}return e}function s(e,t,r,i,a,s,o=1){const c=n(a,s);let l=r,u=r+c,d=0,h=0,p=0,f=0,b=0;for(let n=0,g=i-1;n<g;n++,l+=c,u+=c){const r=t[l],i=t[l+1],n=t[l+2],s=t[u],o=t[u+1],c=t[u+2];let m=r*o-s*i;f+=m,d+=(r+s)*m,h+=(i+o)*m,a&&(m=r*c-s*n,p+=(n+c)*m,b+=m),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),a&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(f*o>0&&(f*=-1),b*o>0&&(b*=-1),!f)return null;const m=[d,h,.5*f];return a&&(m[3]=p,m[4]=.5*b),m}function o(e,t,r,i,a){const s=n(i,a);let o=t,h=t+s,p=0,f=0,b=0,m=0;for(let n=0,g=r-1;n<g;n++,o+=s,h+=s){const t=e[o],r=e[o+1],n=e[o+2],a=e[h],s=e[h+1],g=e[h+2],v=i?l(t,r,n,a,s,g):c(t,r,a,s);if(v)if(p+=v,i){const e=d(t,r,n,a,s,g);f+=v*e[0],b+=v*e[1],m+=v*e[2]}else{const e=u(t,r,a,s);f+=v*e[0],b+=v*e[1]}}return p>0?i?[f/p,b/p,m/p]:[f/p,b/p]:r>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function c(e,t,r,i){const n=r-e,a=i-t;return Math.sqrt(n*n+a*a)}function l(e,t,r,i,n,a){const s=i-e,o=n-t,c=a-r;return Math.sqrt(s*s+o*o+c*c)}function u(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function d(e,t,r,i,n,a){return[e+.5*(i-e),t+.5*(n-t),r+.5*(a-r)]}},d981:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n}));var i=r("3886");function n(e){e.fragment.code.add(i["a"]`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function a(e){e.fragment.code.add(i["a"]`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},dbad:function(e,t,r){"use strict";r.d(t,"a",(function(){return V})),r.d(t,"b",(function(){return k}));var i=r("dae5"),n=r("e431"),a=r("0b2d"),s=r("fc00"),o=r("ebd5"),c=r("68af"),l=r("35b3"),u=r("7438"),d=r("89bf"),h=r("5957"),p=r("7c51"),f=r("a4ee"),b=r("d272"),m=r("d539"),g=r("17b0"),v=r("6a07"),y=r("c6d7"),O=r("a7d7"),x=r("d017"),j=r("be24"),_=r("6a21"),S=r("8e97"),w=r("c3a4"),C=r("ca98"),P=r("da35"),T=r("fa1e"),E=r("c829"),A=r("87b7"),R=r("0310"),M=r("189c");class D extends C["a"]{initializeProgram(e){const t=D.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?3:0,doubleSidedMode:r.doubleSidedMode,vertexTangents:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(_["b"])(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new E["a"](e.rctx,i,T["a"])}bindPass(e,t){var r,i;Object(S["c"])(this.program,t.camera.projectionMatrix);const n=this.configuration.output;(1===this.configuration.output||t.multipassTerrainEnabled||3===n)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(y["a"])(this.program,t)),7===n&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",p["b"][e.colorMixMode])),0===n?(t.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",p["b"][e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&Object(O["c"])(this.program,e,this.configuration.isSchematic)):4===n&&Object(v["b"])(this.program,t),Object(j["c"])(this.program,e),Object(g["b"])(this.program,e,t),Object(p["a"])(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==e.textureAlphaMode&&3!==e.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(r=t.shadowMap)||r.bind(this.program),null==(i=t.ssaoHelper)||i.bind(this.program,t.camera)}bindDraw(e){const t=this.configuration.instancedDoublePrecision?Object(a["h"])(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;Object(S["e"])(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&Object(S["a"])(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&m["a"].bindCustomOrigin(this.program,t),Object(b["b"])(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Object(x["d"])(this.program,e,t)}setPipeline(e,t){const r=this.configuration,i=3===e,n=2===e;return Object(M["g"])({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?u["g"]:Object(u["a"])(e),culling:z(r)&&Object(M["c"])(r.cullFace),depthTest:{func:Object(u["b"])(e)},depthWrite:i||n?r.writeDepth&&M["e"]:null,colorWrite:M["d"],stencilWrite:r.sceneHasOcludees?A["j"]:null,stencilTest:r.sceneHasOcludees?t?A["f"]:A["e"]:null,polygonOffset:i||n?null:Object(u["h"])(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}function z(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}D.shader=new w["a"](R["a"],()=>r.e("chunk-2d0cb6c5").then(r.bind(null,"4a35")));class I extends P["a"]{constructor(){super(...arguments),this.output=0,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.isSchematic=!1,this.vertexColors=!1,this.offsetBackfaces=!1,this.symbolColors=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.sliceHighlightDisabled=!1,this.receiveAmbientOcclusion=!1,this.screenSizePerspective=!1,this.textureAlphaPremultiplied=!1,this.hasColorTexture=!1,this.usePBR=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.vertexTangents=!1,this.normalsTypeDerivate=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparent=!1,this.enableOffset=!0,this.cullFace=0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(f["a"])([Object(P["b"])({count:8})],I.prototype,"output",void 0),Object(f["a"])([Object(P["b"])({count:4})],I.prototype,"alphaDiscardMode",void 0),Object(f["a"])([Object(P["b"])({count:3})],I.prototype,"doubleSidedMode",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"isSchematic",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"vertexColors",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"offsetBackfaces",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"symbolColors",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"vvSize",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"vvColor",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"verticalOffset",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"receiveShadows",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"slicePlaneEnabled",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"sliceHighlightDisabled",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"receiveAmbientOcclusion",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"screenSizePerspective",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"textureAlphaPremultiplied",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"hasColorTexture",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"usePBR",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"hasEmissionTexture",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"hasOcclusionTexture",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"hasNormalTexture",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"instanced",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"instancedColor",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"instancedDoublePrecision",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"vertexTangents",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"normalsTypeDerivate",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"writeDepth",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"sceneHasOcludees",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"transparent",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"enableOffset",void 0),Object(f["a"])([Object(P["b"])({count:3})],I.prototype,"cullFace",void 0),Object(f["a"])([Object(P["b"])({count:4})],I.prototype,"transparencyPassType",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"multipassTerrainEnabled",void 0),Object(f["a"])([Object(P["b"])()],I.prototype,"cullAboveGround",void 0);var L=r("b0ab");class F extends D{initializeProgram(e){const t=F.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,pbrMode:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangents:!1,attributeTextureCoordinates:r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(_["b"])(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new E["a"](e.rctx,i,T["a"])}}F.shader=new w["a"](L["a"],()=>r.e("chunk-2d0ab897").then(r.bind(null,"1662")));class V extends l["a"]{constructor(e){super(e,G),this.supportsEdges=!0,this.techniqueConfig=new I,this.vertexBufferLayout=B(this.parameters),this.instanceBufferLayout=e.instanced?k(this.parameters):null}isVisibleInPass(e){return 4!==e&&6!==e&&7!==e||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const t=e.instanced,r=e.vertexColors,i=e.symbolColors,n=!!t&&t.indexOf("color")>-1,a=e.vvColorEnabled,s="replace"===e.colorMixMode,o=e.opacity>0,c=e.externalColor&&e.externalColor[3]>0;return r&&(n||a||i)?!!s||o:r?s?c:o:n||a||i?!!s||o:s?c:o}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.vertexTangents=this.parameters.vertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?0:this.parameters.cullFace,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?1:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&this.parameters.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoEnabled&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<u["e"]),this.techniqueConfig}intersect(e,t,r,i,a,s,o){if(null!==this.parameters.verticalOffset){const e=i.camera;Object(n["z"])(Y,r[12],r[13],r[14]);let t=null;switch(i.viewingMode){case 1:t=Object(n["u"])($,Y);break;case 2:t=Object(n["n"])($,W)}let o=0;if(null!==this.parameters.verticalOffset){const r=Object(n["m"])(J,Y,e.eye),i=Object(n["s"])(r),a=Object(n["h"])(r,r,1/i);let s=null;this.parameters.screenSizePerspective&&(s=Object(n["k"])(t,a)),o+=Object(p["l"])(e,i,this.parameters.verticalOffset,s,this.parameters.screenSizePerspective)}Object(n["h"])(t,t,o),Object(n["A"])(Z,t,i.transform.inverseRotation),a=Object(n["m"])(H,a,Z),s=Object(n["m"])(q,s,Z)}Object(p["i"])(e,t,i,a,s,Object(d["d"])(i.verticalOffset),o)}requiresSlot(e){return e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2)||20===e}createGLMaterial(e){return 0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output?new U(e):null}createBufferWriter(){return new N(this.vertexBufferLayout,this.instanceBufferLayout)}}class U extends c["a"]{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(t.treeRendering?F:D,e)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMappingEnabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return 0!==this._output&&7!==this._output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),this.bindTextures(t.program)}}const G={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:2,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(i["b"])(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:o["b"],textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...l["b"]};class N{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,i){Object(h["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,i)}}function B(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=Object(s["a"])().vec3f("position").vec3f("normal");return e.vertexTangents&&r.vec4f("tangent"),t&&r.vec2f("uv0"),e.vertexColors&&r.vec4u8("color"),e.symbolColors&&r.vec4u8("symbolColor"),r}function k(e){let t=Object(s["a"])();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}const H=Object(a["f"])(),q=Object(a["f"])(),W=Object(a["h"])(0,0,1),$=Object(a["f"])(),Z=Object(a["f"])(),Y=Object(a["f"])(),J=Object(a["f"])()},dc56:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r("c6ac");function n(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride,o=r?r.count:t.count;let c=(r&&r.dstIndex?r.dstIndex:0)*n,l=(r&&r.srcIndex?r.srcIndex:0)*s;for(let u=0;u<o;++u)i[c]=a[l],i[c+1]=a[l+1],c+=n,l+=s}function a(e,t,r){const a=e.typedBuffer,s=e.typedBufferStride,o=t.typedBuffer,c=t.typedBufferStride,l=r?r.count:t.count;let u=(r&&r.dstIndex?r.dstIndex:0)*s,d=(r&&r.srcIndex?r.srcIndex:0)*c;if(Object(i["b"])(t.elementType)){const e=Object(i["d"])(t.elementType);if(Object(i["c"])(t.elementType))for(let t=0;t<l;++t)a[u]=Math.max(o[d]/e,-1),a[u+1]=Math.max(o[d+1]/e,-1),u+=s,d+=c;else for(let t=0;t<l;++t)a[u]=o[d]/e,a[u+1]=o[d+1]/e,u+=s,d+=c}else n(e,t,r);return e}function s(e,t,r,i){var n,a;const s=e.typedBuffer,o=e.typedBufferStride,c=null!=(n=null==i?void 0:i.count)?n:e.count;let l=(null!=(a=null==i?void 0:i.dstIndex)?a:0)*o;for(let u=0;u<c;++u)s[l]=t,s[l+1]=r,l+=o}Object.freeze({__proto__:null,copy:n,normalizeIntegerBuffer:a,fill:s})},de58:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o}));var i=r("02f1"),n=r("e431"),a=r("0b2d"),s=r("7289");function o(e,t,r,i){return h(e,t,r,u(i,t,r,!0))}function c(e,t,r,i){const a=Object(n["k"])(r,Object(n["m"])(e,i,t));return Object(n["i"])(e,t,Object(n["h"])(e,r,a))}const l={dir:Object(a["f"])(),len:0,clip:Object(i["b"])()};function u(e,t,r,i){const a=l;return e?(r&&i&&(a.len=Object(n["p"])(t,r)),Object(n["n"])(a.dir,e)):i?(a.len=Object(n["p"])(t,r),Object(n["m"])(a.dir,r,t),Object(n["h"])(a.dir,a.dir,1/a.len)):(Object(n["m"])(a.dir,r,t),Object(n["u"])(a.dir,a.dir)),a}function d(e,t,r){const i=Object(n["k"])(Object(s["r"])(e),r.dir),a=-Object(s["v"])(e,t);if(a<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return a>0;if((a<0||i<0)&&!(a<0&&i<0))return!0;const o=a/i;return i>0?o<r.clip[1]&&(r.clip[1]=o):o>r.clip[0]&&(r.clip[0]=o),r.clip[0]<=r.clip[1]}function h(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<e.length;n++)if(!d(e[n],t,i))return!1;return!0}},dea3:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){const t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(i["a"]`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},dee7:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i,n=r("a4ee"),a=r("9ef0"),s=r("6a0e"),o=r("b2b2"),c=r("59b2"),l=(r("b50f"),r("c120"),r("cea0"),r("d386")),u=r("88da");let d=i=class extends s["a"]{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=Object(o["l"])(e)?e.get(this):null;if(r)return r;const n=new i(this.clonePropertiesWithDeduplication(t));return Object(o["l"])(e)&&e.set(this,n),n}clonePropertiesWithDeduplication(e){return{color:Object(o["l"])(this.color)?this.color.clone():null,colorTexture:Object(o["l"])(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:Object(o["l"])(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};Object(n["a"])([Object(c["b"])({type:a["a"],json:{write:!0}})],d.prototype,"color",void 0),Object(n["a"])([Object(c["b"])({type:u["a"],json:{write:!0}})],d.prototype,"colorTexture",void 0),Object(n["a"])([Object(c["b"])({type:u["a"],json:{write:!0}})],d.prototype,"normalTexture",void 0),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],d.prototype,"alphaMode",void 0),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],d.prototype,"alphaCutoff",void 0),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:!0}})],d.prototype,"doubleSided",void 0),d=i=Object(n["a"])([Object(l["a"])("esri.geometry.support.MeshMaterial")],d);const h=d},df77:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c}));var i=r("d047"),n=r("3886");function a(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n["a"]`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function s(e,t){e.bindTexture(t.lastFrameColorTexture,"lastFrameColorMap"),e.setUniformMatrix4fv("reprojectionMat",t.reprojectionMatrix),e.setUniformMatrix4fv("rpProjectionMat",t.camera.projectionMatrix)}function o(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(i["a"]),e.include(a),e.fragment.code.add(n["a"]`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function c(e,t){t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),s(e,t))}},dfaf:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(i["a"]`void forwardTextureCoordinates() {
vuv0 = uv0;
}`)),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(i["a"]`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`)),0===t.attributeTextureCoordinates&&e.vertex.code.add(i["a"]`void forwardTextureCoordinates() {}`)}},e2e8:function(e,t,r){"use strict";r.r(t),r.d(t,"getGeometryServiceURL",(function(){return c})),r.d(t,"projectGeometry",(function(){return l}));var i=r("1325"),n=r("ce50"),a=r("0224"),s=r("ac91"),o=r("7e6b");async function c(e=null,t){var r,s;if(i["a"].geometryServiceUrl)return i["a"].geometryServiceUrl;if(!e)throw new n["a"]("internal:geometry-service-url-not-configured");let o;o="portal"in e?e.portal||a["a"].getDefault():e,await o.load({signal:t});const c=null==(r=o.helperServices)||null==(s=r.geometry)?void 0:s.url;if(!c)throw new n["a"]("internal:geometry-service-url-not-configured");return c}async function l(e,t,r=null,i){const a=await c(r,i),l=new o["a"];l.geometries=[e],l.outSpatialReference=t;const u=await Object(s["a"])(a,l,{signal:i});if(u&&Array.isArray(u)&&1===u.length)return u[0];throw new n["a"]("internal:geometry-service-projection-failed")}},e384:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("b2b2"),n=r("5e82"),a=r("a803");class s extends n["a"]{constructor(e,t,r){super(t),this.symbol=e,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this.convert(t),await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:a["e"]}globalPropertyChanged(e,t){return!!Object(i["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(e,t):0}prepareSymbolPatch(e){Object(i["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,t){return!!Object(i["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(e,t)}onRemoveGraphic(){}getFastUpdateStatus(){return Object(i["l"])(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){Object(i["l"])(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}},e4c1:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a}));var i=r("6415");function n(e,t,r){if(e.count!==t.count)return void i["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=r[0],s=r[1],o=r[2],c=r[3],l=r[4],u=r[5],d=r[6],h=r[7],p=r[8],f=r[9],b=r[10],m=r[11],g=r[12],v=r[13],y=r[14],O=r[15],x=e.typedBuffer,j=e.typedBufferStride,_=t.typedBuffer,S=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*j,t=i*S,r=_[t],n=_[t+1],w=_[t+2],C=_[t+3];x[e]=a*r+l*n+p*w+g*C,x[e+1]=s*r+u*n+f*w+v*C,x[e+2]=o*r+d*n+b*w+y*C,x[e+3]=c*r+h*n+m*w+O*C}}function a(e,t,r){if(e.count!==t.count)return void i["a"].error("source and destination buffers need to have the same number of elements");const n=e.count,a=r[0],s=r[1],o=r[2],c=r[3],l=r[4],u=r[5],d=r[6],h=r[7],p=r[8],f=e.typedBuffer,b=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride;for(let i=0;i<n;i++){const e=i*b,t=i*g,r=m[t],n=m[t+1],v=m[t+2],y=m[t+3];f[e]=a*r+c*n+d*v,f[e+1]=s*r+l*n+h*v,f[e+2]=o*r+u*n+p*v,f[e+3]=y}}function s(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<i;c++){const e=c*a,t=c*o;n[e]=r*s[t],n[e+1]=r*s[t+1],n[e+2]=r*s[t+2],n[e+3]=r*s[t+3]}}function o(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,o=t.typedBufferStride;for(let c=0;c<i;c++){const e=c*a,t=c*o;n[e]=s[t]>>r,n[e+1]=s[t+1]>>r,n[e+2]=s[t+2]>>r,n[e+3]=s[t+3]>>r}}Object.freeze({__proto__:null,transformMat4:n,transformMat3:a,scale:s,shiftRight:o})},e550:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r("d981"),n=r("f159"),a=r("5d5f"),s=r("df77"),o=r("3886");function c(e,t){e.include(a["a"],t),e.include(n["a"]),e.include(i["a"]),t.ssrEnabled&&e.include(s["a"],t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(o["a"]`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(o["a"]`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`),t.ssrEnabled?e.fragment.code.add(o["a"]`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):e.fragment.code.add(o["a"]`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)}},e6aa:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(i["a"]`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add("size","float"),e.vertex.code.add(i["a"]`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(i["a"]`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(i["a"]`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(i["a"]`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add("color","vec4"),e.vertex.code.add(i["a"]`vec4 getColor(){
return applyOpacity(color);
}`))}},e6bc:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t,r){this.graphic=e,this.renderingInfo=t,this.layer=r}}},e9d6:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return h})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return f}));var i=r("e92d"),n=r("d3cf"),a=r("82fa");const s=i["a"].getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){const t=e&&e.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function l(e,t,r){const i=e&&e.expression;if("string"!=typeof i)return null;const n=m(i);if(null!=n)return{cachedResult:n};const s=await Object(a["e"])(),o=s.arcadeUtils,c=o.createSyntaxTree(i);return o.dependsOnView(c)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(c),context:o.createExecContext(null,{sr:t}),modules:s}}}function u(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function d(e,t){if(null!=e&&!b(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=Object(n["b"])(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(b(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function p(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||"0"===i||(r=null),r}const f={cachedResult:0};function b(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},ea44:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return g}));var i=r("bd75"),n=r("d272"),a=r("4db9"),s=r("6a07"),o=r("d047"),c=r("c6d7"),l=r("040b"),u=r("d017"),d=r("e550"),h=r("33e2"),p=r("ebd5"),f=r("4377"),b=r("3886"),m=r("690a");function g(e){const t=new m["a"];return t.include(a["a"],{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(l["a"],e),t.include(i["a"],e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(b["a"]`
      void main(void) {
        if (waterColor.a < ${b["a"].float(p["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===e.output?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(o["a"]),t.include(c["b"],e)),7===e.output&&(t.include(n["a"],e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b["a"]`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),0===e.output&&(t.include(h["a"],e),t.include(n["a"],e),e.receiveShadows&&t.include(u["a"],e),t.include(d["a"],e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(f["a"]),t.fragment.code.add(b["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${e.receiveShadows?b["a"]`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),2===e.output&&(t.include(l["a"],e),t.include(h["a"],e),t.include(n["a"],e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b["a"]`
        void main(void) {
          if (waterColor.a < ${b["a"].float(p["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(b["a"]`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(b["a"]`
        void main(void) {
          if (waterColor.a < ${b["a"].float(p["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b["a"]`void main() {
gl_FragColor = waterColor;
}`)),4===e.output&&(t.include(s["a"]),t.varyings.add("vpos","vec3"),t.vertex.code.add(b["a"]`
      void main(void) {
        if (waterColor.a < ${b["a"].float(p["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n["a"],e),t.fragment.code.add(b["a"]`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const v=Object.freeze({__proto__:null,build:g})},ea4b:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r("2906"),n=r("7088"),a=r("dea3"),s=r("5d5f"),o=r("c51b"),c=r("d017"),l=r("3886");function u(e,t){const r=e.fragment;e.include(a["a"]),e.include(n["a"],t),0!==t.pbrMode&&e.include(s["a"],t),e.include(i["a"],t),t.receiveShadows&&e.include(c["a"],t),r.uniforms.add("lightingGlobalFactor","float"),r.uniforms.add("ambientBoostFactor","float"),e.include(o["a"]),r.code.add(l["a"]`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),r.code.add(l["a"]`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${1===t.viewingMode?l["a"]`normalize(vPosWorld)`:l["a"]`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),r.code.add(l["a"]`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),0===t.pbrMode||4===t.pbrMode?r.code.add(l["a"]`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`):1!==t.pbrMode&&2!==t.pbrMode||(r.code.add(l["a"]`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(l["a"]`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),r.code.add(l["a"]`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = abs(dot(normal, ambientDir));
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.code.add(l["a"]`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(l["a"]`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===t.pbrMode?l["a"]`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:l["a"]`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}},ebae:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r("a4ee"),n=r("fc29"),a=r("af40"),s=r("3795"),o=r("59b2"),c=(r("b50f"),r("c120"),r("cea0"),r("d386")),l=r("f694"),u=r("6b38"),d=r("9305");const h=1.2;let p=class extends n["a"]{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new a["a"],this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new u["a"]({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,r=t.basemapTerrain,i=t.resourceController.scheduler;this.handles.add([t.on("resize",()=>this.viewChange()),t.state.watch("camera",()=>this.viewChange(),!0),i.registerTask(d["b"].FRUSTUM_VISIBILITY,this),r.on("elevation-bounds-change",()=>this.elevationBoundsChange())]),"local"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(s["a"])(r,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),Object(s["a"])(t,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,r="local"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=r||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*Object(l["e"])(e.spatialReference).radius;else{const{min:r,max:i}=e.basemapTerrain.elevationBounds;t=r-Math.max(1,(i-r)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set("updating",!1),!this.extent)return void this._set("suspended",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=Object(l["e"])(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}};Object(i["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"suspended",void 0),Object(i["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"updating",void 0),p=Object(i["a"])([Object(c["a"])("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],p);const f=p},ec13:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return l}));var i=r("9ef0"),n=(r("c120"),r("b2b2")),a=r("a915"),s=r("0fc4");function o(e){return"fill"===e.type}function c(e){return"extrude"===e.type}function l(e){return e&&e.enabled&&(c(e)||o(e))&&Object(n["l"])(e.edges)}function u(e){return e&&e.enabled&&e.edges||null}function d(e,t){return h(u(e),t)}function h(e,t){if(Object(n["k"])(e))return null;const r=Object(n["l"])(e.color)?Object(s["f"])(i["a"].toUnitRGBA(e.color)):Object(s["g"])(0,0,0,0),o=Object(a["h"])(e.size),c=Object(a["h"])(e.extensionLength);switch(e.type){case"solid":return p({color:r,size:o,extensionLength:c,...t});case"sketch":return f({color:r,size:o,extensionLength:c,...t});default:return}}function p(e){return{...b,...e,type:"solid"}}function f(e){return{...m,...e,type:"sketch"}}const b={color:Object(s["g"])(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},m={color:Object(s["g"])(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}},ed70:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return s}));var i=r("0fc4");const n=1.2,a=i["b"],s=i["a"]},eec2:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r("b2b2"),n=r("9786"),a=r("e2e8");function s(e){const t=e.view.spatialReference,r=e.layer.fullExtent,s=Object(i["l"])(r)&&r.spatialReference;if(Object(i["k"])(r)||!s)return Promise.resolve(null);if(s.equals(t))return Promise.resolve(r.clone());const o=Object(n["d"])(r,t);return Object(i["l"])(o)?Promise.resolve(o):e.view.state.isLocal?Object(a["projectGeometry"])(r,t,e.layer.portalItem).then(t=>!e.destroyed&&t?t:void 0).catch(()=>null):Promise.resolve(null)}},f0b9:function(e,t,r){"use strict";function i(e){return 32+e.length}function n(){return 16}function a(e){if(!e)return 0;let t=32;for(const r in e)if(e.hasOwnProperty(r)){const a=e[r];switch(typeof a){case"string":t+=i(a);break;case"number":t+=n();break;case"boolean":t+=4}}return t}function s(e,t){return 32+e.length*t}r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return i}))},f0ba:function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var i,n=r("a4ee"),a=r("6a0e"),s=r("7ffa"),o=r("e92d"),c=r("59b2"),l=r("1a3e"),u=r("d386"),d=r("cea0"),h=r("dee7"),p=r("83fa"),f=r("f5e7");const b=o["a"].getLogger("esri.geometry.support.MeshComponent");let m=i=class extends a["a"]{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return Object(d["d"])(i,e)}castFaces(e){return Object(f["b"])(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},b)}castMaterial(e){return Object(d["d"])(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?p["a"]:h["a"],e)}clone(){return new i({faces:Object(s["a"])(this.faces),shading:this.shading,material:Object(s["a"])(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:Object(s["a"])(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new i(r)}};Object(n["a"])([Object(c["b"])({json:{write:!0}})],m.prototype,"faces",void 0),Object(n["a"])([Object(l["a"])("faces")],m.prototype,"castFaces",null),Object(n["a"])([Object(c["b"])({type:h["a"],json:{write:!0}})],m.prototype,"material",void 0),Object(n["a"])([Object(l["a"])("material")],m.prototype,"castMaterial",null),Object(n["a"])([Object(c["b"])({type:String,json:{write:!0}})],m.prototype,"shading",void 0),Object(n["a"])([Object(c["b"])({type:Boolean})],m.prototype,"trustSourceNormals",void 0),m=i=Object(n["a"])([Object(u["a"])("esri.geometry.support.MeshComponent")],m);const g=m},f159:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("3886");function n(e){e.fragment.code.add(i["a"]`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},f33e:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return a}));var i=r("b50f");function n(e){const t=[];return e.levels.forEach(e=>{e.components.forEach(e=>{t.push(e.material)})}),Object(i["o"])(t)}function a(e){const t=new Array;return e.levels.forEach(e=>{e.components.forEach(e=>{e.textures&&t.push(...e.textures)})}),Object(i["o"])(t)}function s(e){const t=[];return e.components.forEach(e=>{t.push(e.geometry)}),Object(i["o"])(t)}function o(e){const t=[];return e.levels.forEach(e=>{e.components.forEach(e=>{t.push(e.geometry)})}),Object(i["o"])(t)}function c(e){return s(e).reduce((e,t)=>e+t.indexCount/3,0)}},f5e7:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return g}));var i,n=r("a4ee"),a=r("6a0e"),s=r("7ffa"),o=r("e92d"),c=r("59b2"),l=r("1a3e"),u=r("d386");const d=o["a"].getLogger("esri.geometry.support.MeshVertexAttributes");let h=i=class extends a["a"]{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return f(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},d)}castPosition(e){return e&&e instanceof Float32Array&&d.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),f(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},d)}castUv(e){return f(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},d)}castNormal(e){return f(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},d)}castTangent(e){return f(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},d)}clone(){const e={position:Object(s["a"])(this.position),uv:Object(s["a"])(this.uv),normal:Object(s["a"])(this.normal),tangent:Object(s["a"])(this.tangent),color:Object(s["a"])(this.color)};return new i(e)}clonePositional(){const e={position:Object(s["a"])(this.position),normal:Object(s["a"])(this.normal),tangent:Object(s["a"])(this.tangent),uv:this.uv,color:this.color};return new i(e)}};function p(e,t,r,i){const{loggerTag:n,stride:a}=t;return e.length%a!=0?(i.error(n,"Invalid array length, expected a multiple of "+a),new r([])):e}function f(e,t,r,i,n){if(!e)return e;if(e instanceof t)return p(e,i,t,n);for(const a of r)if(e instanceof a)return p(new t(e),i,t,n);if(Array.isArray(e))return p(new t(e),i,t,n);{const i=r.map(e=>`'${e.name}'`);return n.error(`Failed to set property, expected one of ${i}, but got ${e.constructor.name}`),new t([])}}function b(e,t,r){t[r]=m(e)}function m(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}Object(n["a"])([Object(c["b"])({json:{write:b}})],h.prototype,"color",void 0),Object(n["a"])([Object(l["a"])("color")],h.prototype,"castColor",null),Object(n["a"])([Object(c["b"])({nonNullable:!0,json:{write:b}})],h.prototype,"position",void 0),Object(n["a"])([Object(l["a"])("position")],h.prototype,"castPosition",null),Object(n["a"])([Object(c["b"])({json:{write:b}})],h.prototype,"uv",void 0),Object(n["a"])([Object(l["a"])("uv")],h.prototype,"castUv",null),Object(n["a"])([Object(c["b"])({json:{write:b}})],h.prototype,"normal",void 0),Object(n["a"])([Object(l["a"])("normal")],h.prototype,"castNormal",null),Object(n["a"])([Object(c["b"])({json:{write:b}})],h.prototype,"tangent",void 0),Object(n["a"])([Object(l["a"])("tangent")],h.prototype,"castTangent",null),h=i=Object(n["a"])([Object(u["a"])("esri.geometry.support.MeshVertexAttributes")],h);const g=h},f9d0:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var r;return null==(r=this._outer.get(e))?void 0:r.get(t)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach((t,r)=>e(t,r))}}},fdc9:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s}));var i=r("8a44");class n{constructor(){this.adds=new i["a"],this.removes=new i["a"],this.updates=new i["a"]({allocator:e=>e||new a,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class a{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}}}]);
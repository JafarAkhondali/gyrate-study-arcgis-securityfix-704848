{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/layers/support/sublayerUtils.js","webpack:///./node_modules/@arcgis/core/layers/mixins/ArcGISMapService.js","webpack:///./node_modules/@arcgis/core/geometry/support/scaleUtils.js","webpack:///./node_modules/@arcgis/core/layers/MapImageLayer.js","webpack:///./node_modules/@arcgis/core/core/Version.js","webpack:///./node_modules/@arcgis/core/layers/support/ExportImageParameters.js","webpack:///./node_modules/@arcgis/core/layers/mixins/SublayersOwner.js"],"names":["e","n","i","flatten","sublayers","length","some","originIdOf","r","source","type","mapLayerId","id","gdbVersion","slice","reverse","toArray","map","o","t","minScale","layerDefinition","y","m","super","arguments","this","capabilities","copyright","fullExtent","legendEnabled","spatialReference","version","s","split","toLowerCase","trim","operations","supportsQuery","supportsExportMap","supportsExportTiles","supportsTileMap","exportMap","exportTiles","indexOf","p","exportTilesAllowed","a","l","supportsDynamicLayers","u","tileInfo","c","cimVersion","parse","since","supportsArcadeExpressionForLabeling","supportsSublayersChanges","supportsSublayerVisibility","supportsSublayerDefinitionExpression","maxExportTilesCount","currentVersion","hasOwnProperty","fetchAllLayersAndTables","_allLayersAndTablesMap","get","load","_allLayersAndTablesPromise","url","path","responseType","query","f","customParameters","then","Map","data","layers","set","result","error","readOnly","prototype","json","read","Boolean","origins","service","enabled","write","target","extent","width","R","alwaysRefetch","dpi","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","isReference","labelsVisible","operationalLayerType","sourceJSON","signal","addResolvingPromise","loadFromPortal","supportedTypes","_fetchService","Promise","resolve","supportedImageFormatTypes","loaded","origin","createSublayersForOrigin","writeSublayerStructure","forEach","push","originOf","Object","keys","visibleLayers","filter","visible","pixelRatio","clone","shiftCentralMeridian","layer","scale","toJSON","destroy","rotation","wkid","JSON","stringify","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","timestamp","_ts","parsedUrl","createExportImageParameters","Date","now","dynamicLayers","catch","reject","returnUpdates","fromJSON","allSublayers","ssl","replace","overridePolicy","ignoreOrigin","value","J","major","minor","_context","lessThan","match","parseInt","h","definitionExpression","labelingInfo","opacity","maxScale","renderer","hasDynamicLayers","visibleSublayers","toExportImageJSON","serviceSublayers","_get","_set","handles","remove","add","on","notifyChange","propertyName","join","reduce","commitProperty","unshift","format","transparent","layerDefs","Number","b","getLogger","parentLayerId","d","ofType","root","rootCollectionNames","getChildrenFunction","sublayersSourceJSON","2","3","4","5","watch","_handleSublayersChange","context","setDefaultOrigin","find","Set","defaultVisibility","has","items","readSublayers","parent","item","preventDefault","allowNull"],"mappings":"gHAIA,SAASA,EAAEA,EAAEC,EAAEC,GAAG,OAAGD,EAAEE,QAAQ,EAAGC,UAAUJ,KAAKA,GAAIK,SAASL,EAAEK,WAAwBL,EAAEM,KAAMN,GAAGA,EAAEO,WAAW,YAAYL,GAAGF,EAAEO,WAAW,YAAYL,GAAGF,EAAEO,WAAW,YAAYL,GAAGF,EAAEO,WAAW,gBAAgBL,GAAGF,EAAEO,WAAW,WAAWL,GAAGF,EAAEO,WAAW,iBAAiBL,GAAGF,EAAEO,WAAW,UAAUL,KAAMM,EAAER,EAAEC,IAAG,SAASA,EAAED,EAAEC,EAAEC,GAAG,QAAQF,EAAEM,KAAMN,IAAI,MAAMC,EAAED,EAAES,OAAO,SAASR,GAAG,cAAcA,EAAES,MAAMT,EAAEU,aAAaX,EAAEY,MAAMX,EAAEY,YAAYZ,EAAEY,aAAaX,EAAEW,cAAcb,EAAEO,WAAW,YAAY,GAAGP,EAAEO,WAAW,gBAAgB,GAAGP,EAAEO,WAAW,WAAW,GAAGP,EAAEO,WAAW,iBAAiB,MAAOC,EAAER,EAAEC,GAAG,SAASO,EAAER,EAAEC,GAAG,IAAID,IAAIA,EAAEK,OAAO,OAAM,EAAG,MAAMG,EAAEP,EAAEa,QAAQC,UAAUZ,QAAQ,EAAGC,UAAUJ,KAAKA,GAAGA,EAAEgB,UAAUD,WAAYE,IAAKjB,GAAGA,EAAEY,IAAKI,UAAU,GAAGhB,EAAEK,OAAOG,EAAEH,OAAO,OAAM,EAAG,IAAIH,EAAE,EAAE,MAAMgB,EAAEV,EAAEH,OAAO,IAAI,MAAMO,GAAGO,KAAKnB,EAAE,CAAC,KAAKE,EAAEgB,GAAGV,EAAEN,KAAKiB,GAAGjB,IAAI,GAAGA,GAAGgB,EAAE,OAAM,EAAG,OAAM,EAAG,SAAShB,EAAEF,GAAG,QAAQA,GAAGA,EAAEM,KAAMN,GAAG,MAAMA,EAAEoB,UAAUpB,EAAEqB,iBAAiB,MAAMrB,EAAEqB,gBAAgBD,UAJ18B,uG,oCCAA,gOAIuyB,MAAME,EAAEA,IAAI,IAAIC,EAAE,cAAcD,EAAE,cAAcE,SAASC,WAAWC,KAAKC,kBAAa,EAAOD,KAAKE,UAAU,KAAKF,KAAKG,WAAW,KAAKH,KAAKI,eAAc,EAAGJ,KAAKK,iBAAiB,KAAKL,KAAKM,QAAQ,KAAK,iBAAiBhC,EAAEQ,GAAG,MAAMyB,EAAEzB,EAAEmB,cAAcnB,EAAEmB,aAAaO,MAAM,KAAKjB,IAAKjB,GAAGA,EAAEmC,cAAcC,QAAS,IAAIH,EAAE,MAAM,CAACI,WAAW,CAACC,eAAc,EAAGC,mBAAkB,EAAGC,qBAAoB,EAAGC,iBAAgB,GAAIC,UAAU,KAAKC,YAAY,MAAM,MAAMxB,EAAEO,KAAKhB,KAAKQ,GAAG,IAAIe,EAAEW,QAAQ,SAAS1C,GAAG,IAAI+B,EAAEW,QAAQ,OAAOC,IAAIrC,EAAEsC,mBAAmBC,GAAG,IAAId,EAAEW,QAAQ,WAAWI,EAAE,SAAS7B,KAAKX,EAAEyC,sBAAsBC,EAAE,SAAS/B,KAAKX,EAAE2C,UAAUH,GAAGI,EAAE,SAASjC,KAAKX,EAAE2C,UAAUH,GAAG1B,EAAE,SAASH,EAAEI,IAAIf,EAAE6C,YAAY,OAAEC,MAAM9C,EAAE6C,YAAYE,MAAM,EAAE,GAAG,MAAM,CAAClB,WAAW,CAACC,cAAcpB,EAAEqB,kBAAkBrC,EAAEsC,oBAAoBK,EAAEJ,gBAAgBM,GAAGL,UAAUxC,EAAE,CAACsD,oCAAoCjC,EAAEkC,yBAAyBnC,EAAE2B,sBAAsBD,EAAEU,2BAA2BR,EAAES,qCAAqCP,GAAG,KAAKT,YAAYE,EAAE,CAACe,qBAAqBpD,EAAEoD,qBAAqB,MAAM,YAAY5D,EAAEQ,GAAG,IAAIyB,EAAEzB,EAAEqD,eAAe,OAAO5B,IAAIA,EAAEzB,EAAEsD,eAAe,iBAAiBtD,EAAEsD,eAAe,UAAU,GAAGtD,EAAEsD,eAAe,6BAA6B,KAAK,KAAK7B,EAAE,wBAAwBjC,EAAEQ,GAAG,aAAakB,KAAKqC,wBAAwBvD,GAAGkB,KAAKsC,uBAAuBC,IAAIjE,GAAG,8BAA8BA,SAAS0B,KAAKwC,KAAKlE,GAAG0B,KAAKyC,6BAA6BzC,KAAKyC,2BAA2B,qBAAE,eAAEzC,KAAK0C,KAAKC,KAAK,UAAU,CAACC,aAAa,OAAOC,MAAM,CAACC,EAAE,UAAU9C,KAAK+C,oBAAoBC,KAAM1E,IAAI0B,KAAKsC,uBAAuB,IAAIW,IAAI,IAAI,MAAMnE,KAAKR,EAAE4E,KAAKC,OAAOnD,KAAKsC,uBAAuBc,IAAItE,EAAEI,GAAGJ,GAAG,MAAM,CAACuE,OAAO/E,EAAE4E,OAAS5E,IAAG,CAAEgF,MAAMhF,MAAO,MAAMQ,QAAQkB,KAAKyC,2BAA2B,GAAG,eAAEnE,GAAG,WAAWQ,EAAE,OAAOA,EAAEuE,OAAO,MAAMvE,EAAEwE,QAAQ,OAAO,eAAE,CAAC,eAAE,CAACC,UAAS,KAAM1D,EAAE2D,UAAU,oBAAe,GAAQ,eAAE,CAAC,eAAE,UAAU,eAAe,CAAC,eAAe,qBAAqB,sBAAsB,wBAAwB,cAAc3D,EAAE2D,UAAU,mBAAmB,MAAM,eAAE,CAAC,eAAE,CAACC,KAAK,CAACC,KAAK,CAAC3E,OAAO,qBAAqBc,EAAE2D,UAAU,iBAAY,GAAQ,eAAE,CAAC,eAAE,CAACxE,KAAK,UAAKa,EAAE2D,UAAU,kBAAa,GAAQ,eAAE,CAAC,eAAE,SAAI3D,EAAE2D,UAAU,UAAK,GAAQ,eAAE,CAAC,eAAE,CAACxE,KAAK2E,QAAQF,KAAK,CAACG,QAAQ,CAACC,QAAQ,CAACH,KAAK,CAACI,SAAQ,KAAMJ,KAAK,CAAC3E,OAAO,cAAcgF,MAAM,CAACC,OAAO,kBAAkBnE,EAAE2D,UAAU,qBAAgB,GAAQ,eAAE,CAAC,eAAE,SAAI3D,EAAE2D,UAAU,oBAAe,GAAQ,eAAE,CAAC,eAAE,CAACxE,KAAK,UAAKa,EAAE2D,UAAU,wBAAmB,GAAQ,eAAE,CAAC,kBAAK3D,EAAE2D,UAAU,eAAU,GAAQ,eAAE,CAAC,eAAE,UAAU,CAAC,iBAAiB,eAAe,SAAS,+BAA+B3D,EAAE2D,UAAU,cAAc,MAAM3D,EAAE,eAAE,CAAC,eAAE,wCAAwCA,GAAGA,I,oCCJ15G,oFAIoF,MAAMvB,EAAE,GAAG,SAASQ,EAAEA,EAAEN,GAAG,MAAMgB,EAAEhB,GAAGM,EAAEmF,OAAOvC,EAAE5C,EAAEoF,MAAM1C,EAAE,eAAEhC,GAAGA,EAAEa,kBAAkB,OAAOb,GAAGkC,EAAElC,EAAE0E,MAAMxC,EAAEF,EAAE,OAAElD,EAAE,EAAE,SAASE,EAAEM,EAAEN,GAAG,OAAOM,GAAG,eAAEN,GAAG,OAAEF,K,oCCJvO,qcAI85D,IAAI6F,EAAE,cAAc,cAAD,CAAG,eAAE,eAAE,eAAE,eAAE,eAAE,eAAE,eAAE,eAAE,eAAE,eAAE,eAAE,oBAAe,eAAe7F,GAAGwB,SAASxB,GAAG0B,KAAKoE,eAAc,EAAGpE,KAAKqE,IAAI,GAAGrE,KAAKb,WAAW,KAAKa,KAAKsE,YAAY,QAAQtE,KAAKuE,eAAe,KAAKvE,KAAKwE,cAAc,KAAKxE,KAAKyE,mBAAkB,EAAGzE,KAAK0E,YAAY,KAAK1E,KAAK2E,eAAc,EAAG3E,KAAK4E,qBAAqB,wBAAwB5E,KAAK6E,WAAW,KAAK7E,KAAKtB,UAAU,KAAKsB,KAAKhB,KAAK,YAAYgB,KAAK0C,IAAI,KAAK,kBAAkBpE,EAAEQ,GAAG,MAAM,iBAAiBR,EAAE,CAACoE,IAAIpE,KAAKQ,GAAGR,EAAE,KAAKA,GAAG,MAAMmB,EAAE,eAAEnB,GAAGA,EAAEwG,OAAO,KAAK,OAAO9E,KAAK+E,oBAAoB/E,KAAKgF,eAAe,CAACC,eAAe,CAAC,gBAAgB3G,GAAG0E,KAAK,IAAKhD,KAAKkF,cAAczF,GAAI,IAAKO,KAAKkF,cAAczF,KAAM0F,QAAQC,QAAQpF,MAAM,gBAAgB1B,EAAEQ,GAAG,MAAMW,EAAEX,EAAEuG,0BAA0B,OAAO5F,GAAGA,EAAEyB,QAAQ,UAAU,EAAE,QAAQ,QAAQ,eAAe5C,EAAEQ,EAAEW,EAAEc,GAAG,IAAIP,KAAKsF,SAAShH,EAAE,OAAO,MAAMkB,EAAElB,EAAEc,QAAQC,UAAUZ,QAAQ,EAAGC,UAAUJ,KAAKA,GAAGA,EAAEgB,UAAUD,WAAYC,UAAU,IAAId,GAAE,EAAG,GAAGwB,KAAKC,cAAcD,KAAKC,aAAaU,WAAWE,mBAAmBb,KAAKC,aAAae,UAAUO,sBAAsB,CAAC,MAAMjD,EAAE,eAAEiC,EAAEgF,QAAQ,GAAG,IAAIjH,EAAE,CAAC,MAAMA,EAAE0B,KAAKwF,yBAAyB,WAAW9G,UAAUF,EAAE,eAAEgB,EAAElB,EAAE,QAAQ,GAAGA,EAAE,EAAE,CAAC,MAAMA,EAAE0B,KAAKwF,yBAAyB,eAAehH,EAAE,eAAEgB,EAAElB,EAAEI,UAAU,eAAEJ,EAAEiH,UAAU,MAAMlE,EAAE,GAAGF,EAAE,CAACsE,uBAAuBjH,KAAK+B,GAAG,IAAIhC,EAAEC,EAAEgB,EAAEkG,QAASpH,IAAI,MAAMQ,EAAER,EAAEyF,MAAM,GAAG5C,GAAGE,EAAEsE,KAAK7G,GAAGP,EAAEA,GAAG,SAASD,EAAEsH,SAAS,aAAcvE,EAAEzC,KAAMN,GAAGuH,OAAOC,KAAKxH,GAAGK,OAAO,KAAMG,EAAEqE,OAAO9B,GAAG9C,IAAIO,EAAEiH,cAAcvG,EAAEwG,OAAQ1H,GAAGA,EAAE2H,SAAU1G,IAAKjB,GAAGA,EAAEY,KAAM,4BAA4BZ,EAAEQ,EAAEW,EAAEc,GAAG,MAAMf,EAAEe,GAAGA,EAAE2F,YAAY,EAAE5H,GAAG0B,KAAKM,SAAS,KAAKhC,EAAEA,EAAE6H,QAAQC,wBAAwB,MAAM5H,EAAE,IAAI,OAAE,CAAC6H,MAAMrG,KAAKsG,MAAM,eAAE,CAACrC,OAAO3F,EAAE4F,MAAMpF,IAAIU,IAAI6B,EAAE7C,EAAE+H,SAAS/H,EAAEgI,UAAU,MAAMrF,GAAGZ,IAAIA,EAAEkG,UAAUzG,KAAKM,QAAQ,KAAK,GAAG,CAACmG,UAAUlG,EAAEkG,UAAU5G,EAAEvB,GAAGA,EAAE+B,iBAAiB9B,EAAEsB,EAAE6G,MAAMC,KAAKC,UAAU/G,EAAE0G,UAAUlF,EAAEgD,KAAK7E,EAAE,MAAM8B,EAAE,GAAG,GAAG,MAAMf,GAAGA,EAAEsG,WAAW,CAAC,MAAMC,MAAMxI,EAAEyI,IAAIjI,GAAGyB,EAAEsG,WAAWN,SAASjF,EAAE0F,KAAK1I,GAAGQ,GAAGR,IAAIQ,EAAE,GAAGR,EAAE,GAAG,MAAMA,EAAE,OAAOA,KAAK,MAAMQ,EAAE,OAAOA,SAASkB,KAAKiH,WAAWjH,KAAKiH,SAASC,cAAc5F,EAAE0F,KAAK,aAAa,MAAM,CAACG,KAAK7I,GAAGA,EAAE8I,KAAK,IAAI9I,EAAE+I,KAAK,IAAI/I,EAAEgJ,KAAK,IAAIhJ,EAAEiJ,KAAKC,OAAOjJ,EAAEkJ,QAAQlJ,EAAEmJ,KAAK5I,EAAE,IAAIW,KAAK4B,KAAKF,KAAKG,GAAG,iBAAiBhD,EAAEQ,EAAEW,EAAEc,GAAG,MAAMf,EAAE,CAACoD,aAAa,SAASrC,GAAGA,EAAEoH,YAAYnI,EAAEqD,MAAM,IAAIrD,EAAEqD,MAAM+E,IAAIrH,EAAEoH,YAAYpH,GAAGA,EAAEuE,SAAStF,EAAEsF,OAAOvE,EAAEuE,QAAQ9E,KAAK+C,kBAAkB8C,OAAOC,KAAK9F,KAAK+C,kBAAkBpE,SAASa,EAAEqD,MAAM,IAAI7C,KAAK+C,oBAAoBvD,EAAEqD,QAAQ,MAAMrE,EAAEwB,KAAK6H,UAAUlF,KAAK,UAAUtB,EAAE,IAAIrB,KAAK6H,UAAUhF,SAAS7C,KAAK8H,4BAA4BxJ,EAAEQ,EAAEW,EAAEc,GAAGuC,EAAE,QAAQ8E,IAAI5H,KAAKoE,cAAc2D,KAAKC,MAAM,MAAM,OAAG,MAAM3G,EAAE4G,eAAgBjI,KAAKC,aAAae,UAAUO,uBAA2P/B,EAAEqD,MAAMrD,EAAEqD,MAAM,IAAIxB,KAAK7B,EAAEqD,OAAOrD,EAAEqD,MAAMxB,EAAS,qBAAE7C,EAAEgB,GAAGwD,KAAM1E,GAAGA,EAAE4E,MAAOgF,MAAO5J,IAAI,GAAG,eAAEA,GAAG,MAAMA,EAAE,MAAM,IAAI,OAAE,kCAAkC,yBAAyBE,EAAI,CAAC8E,MAAMhF,OAAvZ6G,QAAQgD,OAAO,IAAI,OAAE,2CAA2C,WAAWnI,KAAK0C,kIAAkI,CAACG,MAAMxB,KAAqM,6BAA6B/C,EAAE,IAAI,MAAMQ,EAAE,IAAIR,EAAEuE,MAAM,CAACuF,eAAc,EAAGtF,EAAE,UAAUI,KAAKzD,SAAS,qBAAEO,KAAK0C,IAAI5D,IAAImF,OAAO1D,EAAEJ,WAAWX,EAAEqH,WAAWrI,GAAGiB,EAAE4B,EAAEd,GAAGf,EAAE,MAAM,CAACW,WAAWkB,GAAG,OAAEgH,SAAShH,GAAGwF,WAAWrI,GAAG,OAAE6J,SAAS,CAACvB,MAAMtI,EAAE,GAAGuI,IAAIvI,EAAE,MAAM,UAAU,OAAO,eAAEwB,KAAM1B,IAAIA,EAAE0B,KAAKsI,gBAAiB,oBAAoBhK,GAAG,GAAG0B,KAAK6E,WAAW,YAAY7E,KAAK0D,KAAK1D,KAAK6E,WAAW,CAACU,OAAO,UAAU7C,IAAI1C,KAAK6H,YAAY,MAAM3E,KAAKpE,EAAEyJ,IAAI9I,SAAS,qBAAEO,KAAK6H,UAAUlF,KAAK,CAACE,MAAM,CAACC,EAAE,UAAU9C,KAAK6H,UAAUhF,SAAS7C,KAAK+C,kBAAkB+B,OAAOxG,IAAImB,IAAIO,KAAK0C,IAAI1C,KAAK0C,IAAI8F,QAAQ,UAAU,WAAWxI,KAAK6E,WAAW/F,EAAEkB,KAAK0D,KAAK5E,EAAE,CAACyG,OAAO,UAAU7C,IAAI1C,KAAK6H,cAAc,eAAE,CAAC,kBAAK1D,EAAEX,UAAU,qBAAgB,GAAQ,eAAE,CAAC,kBAAKW,EAAEX,UAAU,WAAM,GAAQ,eAAE,CAAC,kBAAKW,EAAEX,UAAU,kBAAa,GAAQ,eAAE,CAAC,kBAAKW,EAAEX,UAAU,mBAAc,GAAQ,eAAE,CAAC,eAAE,cAAc,CAAC,+BAA+BW,EAAEX,UAAU,kBAAkB,MAAM,eAAE,CAAC,eAAE,CAACC,KAAK,CAACG,QAAQ,CAACC,QAAQ,CAACH,KAAK,CAAC3E,OAAO,wBAAwBoF,EAAEX,UAAU,sBAAiB,GAAQ,eAAE,CAAC,eAAE,CAACC,KAAK,CAACG,QAAQ,CAACC,QAAQ,CAACH,KAAK,CAAC3E,OAAO,uBAAuBoF,EAAEX,UAAU,qBAAgB,GAAQ,eAAE,CAAC,kBAAKW,EAAEX,UAAU,yBAAoB,GAAQ,eAAE,CAAC,eAAE,CAACxE,KAAK2E,QAAQF,KAAK,CAACC,MAAK,EAAGK,MAAM,CAACD,SAAQ,EAAG2E,eAAe,KAAI,CAAE3E,SAAQ,SAAUK,EAAEX,UAAU,mBAAc,GAAQ,eAAE,CAAC,eAAE,CAACC,KAAK,CAACC,MAAK,EAAGK,OAAM,MAAOI,EAAEX,UAAU,qBAAgB,GAAQ,eAAE,CAAC,eAAE,CAACxE,KAAK,CAAC,4BAA4BmF,EAAEX,UAAU,4BAAuB,GAAQ,eAAE,CAAC,eAAE,CAACC,KAAK,CAACC,MAAK,EAAGK,OAAM,MAAOI,EAAEX,UAAU,oBAAe,GAAQ,eAAE,CAAC,kBAAKW,EAAEX,UAAU,kBAAa,GAAQ,eAAE,CAAC,eAAE,CAACC,KAAK,CAACM,MAAM,CAAC2E,cAAa,OAAQvE,EAAEX,UAAU,iBAAY,GAAQ,eAAE,CAAC,eAAE,YAAY,CAACL,OAAO,CAACnE,KAAK,CAAC,SAAI+G,cAAc,CAAC/G,KAAK,CAAC,YAAOmF,EAAEX,UAAU,iBAAiB,MAAM,eAAE,CAAC,eAAE,CAACxE,KAAK,CAAC,OAAO,OAAO,oBAAoBmF,EAAEX,UAAU,gBAAW,GAAQ,eAAE,CAAC,eAAE,CAACC,KAAK,CAACC,MAAK,GAAIH,UAAS,EAAGoF,MAAM,eAAexE,EAAEX,UAAU,YAAO,GAAQ,eAAE,CAAC,eAAE,SAAIW,EAAEX,UAAU,WAAM,GAAQW,EAAE,eAAE,CAAC,eAAE,8BAA8BA,GAAG,IAAIyE,EAAEzE,EAAiB,gB,oCCJ12N,kDAI0B,MAAMrF,EAAE,YAAYW,EAAEX,EAAEU,EAAE,IAAIQ,KAAK6I,MAAMpJ,EAAEO,KAAK8I,MAAMhK,EAAEkB,KAAK+I,SAASvJ,EAAE,SAASC,EAAEX,GAAG,OAAOkB,KAAK6I,MAAMpJ,GAAGA,IAAIO,KAAK6I,OAAO7I,KAAK8I,MAAMhK,EAAE,MAAMW,EAAEX,GAAG,OAAOkB,KAAKgJ,SAASvJ,EAAEX,GAAG,SAASA,GAAG,GAAGkB,KAAK6I,QAAQ/J,EAAE+J,MAAM,CAAC,MAAMrJ,EAAEQ,KAAK+I,UAAU/I,KAAK+I,SAAS,IAAIxI,EAAEP,KAAK+I,UAAU/I,KAAK+I,SAAS,IAAI,MAAM,IAAI,OAAEvJ,EAAE,sBAAsB,kBAAkBe,gBAAgBP,KAAK6I,wDAAwD,CAACvI,QAAQxB,KAAK,QAAQ,OAAO,IAAIA,EAAEkB,KAAK6I,MAAM7I,KAAK8I,MAAM9I,KAAK+I,UAAU,aAAavJ,EAAEe,EAAE,IAAI,MAAMjC,EAAEE,GAAGgB,EAAEgB,MAAM,KAAKjC,EAAE,cAAc,IAAID,IAAIA,EAAE2K,QAAQ3K,EAAE2K,MAAM1K,GAAI,MAAM,IAAI,QAAGgC,GAAGA,EAAE,KAAK,kBAAkB,8DAA8D,CAACD,QAAQd,IAAI,IAAIhB,IAAIA,EAAEyK,QAAQzK,EAAEyK,MAAM1K,GAAI,MAAM,IAAI,QAAGgC,GAAGA,EAAE,KAAK,kBAAkB,8DAA8D,CAACD,QAAQd,IAAI,MAAM6B,EAAE6H,SAAS5K,EAAE,IAAI6K,EAAED,SAAS1K,EAAE,IAAI,OAAO,IAAIM,EAAEuC,EAAE8H,EAAE5I,M,oCCJ75B,0LAIgoB,MAAMe,EAAE,CAAC2E,QAAQ,mBAAmBmD,qBAAqB,YAAYC,aAAa,mBAAmB1E,cAAc,mBAAmB2E,QAAQ,mBAAmB5J,SAAS,mBAAmB6J,SAAS,mBAAmBC,SAAS,mBAAmBzK,OAAO,oBAAoB,IAAIR,EAAE,cAAc,cAAD,CAAG,SAAI,YAAYD,GAAGwB,MAAMxB,GAAG0B,KAAKsG,MAAM,EAAE,UAAUtG,KAAKqG,MAAM,KAAK,oBAAoB,IAAIrG,KAAKyJ,iBAAiB,OAAO,KAAK,MAAMnL,EAAE0B,KAAK0J,iBAAiBnK,IAAKjB,GAAGA,EAAEqL,qBAAsB,OAAOrL,EAAEK,OAAOgI,KAAKC,UAAUtI,GAAG,KAAK,uBAAuB,OAAO0B,KAAKqG,OAAO,eAAErG,KAAK0J,iBAAiB1J,KAAKqG,MAAMuD,iBAAiB5J,KAAKqG,OAAO,UAAU/H,GAAG0B,KAAK6J,KAAK,WAAWvL,IAAI0B,KAAK8J,KAAK,QAAQxL,GAAG0B,KAAK+J,QAAQC,OAAO,SAAS1L,GAAG0B,KAAK+J,QAAQE,IAAI,CAAC3L,EAAEgK,aAAa4B,GAAG,SAAS,IAAKlK,KAAKmK,aAAa,qBAAsB7L,EAAE4L,GAAG,kBAAmB5L,GAAG0B,KAAKmK,aAAa7I,EAAEhD,EAAE8L,iBAAkB,UAAU,aAAa,MAAM9L,EAAE0B,KAAK0J,iBAAiB,OAAOpL,EAAEA,EAAEK,OAAO,QAAQL,EAAEiB,IAAKjB,GAAGA,EAAEY,IAAKmL,KAAK,KAAK,UAAU,KAAK,gBAAgB,MAAM/L,EAAE0B,KAAK0J,iBAAiB1D,OAAQ1H,GAAG,MAAMA,EAAE8K,sBAAuB,OAAO9K,EAAEK,OAAOgI,KAAKC,UAAUtI,EAAEgM,OAAO,CAAEhM,EAAEQ,KAAKR,EAAEQ,EAAEI,IAAIJ,EAAEsK,qBAAqB9K,GAAI,KAAK,KAAK,cAAc0B,KAAKuK,eAAe,UAAUvK,KAAKuK,eAAe,aAAavK,KAAKuK,eAAe,iBAAiBvK,KAAKuK,eAAe,cAAc,MAAMjM,EAAE0B,KAAKqG,MAAM,OAAO/H,IAAIA,EAAEiM,eAAe,OAAOjM,EAAEiM,eAAe,eAAejM,EAAEiM,eAAe,qBAAqBjM,EAAEiM,eAAe,gBAAgBvK,KAAK6J,KAAK,YAAY,GAAG,EAAE,uBAAuB,MAAMvL,EAAE,GAAG,IAAI0B,KAAKqG,MAAM,OAAO/H,EAAE,MAAMQ,EAAEkB,KAAKqG,MAAM3H,UAAU6B,EAAEzB,IAAI,MAAMW,EAAEO,KAAKsG,MAAM9H,EAAE,IAAIiB,EAAE4B,EAAE,IAAIvC,EAAEY,UAAUD,GAAGX,EAAEY,SAASF,EAAE,IAAIV,EAAEyK,UAAU9J,GAAGX,EAAEyK,SAASzK,EAAEmH,UAAUzH,GAAG6C,GAAG7B,KAAKV,EAAEJ,UAAUI,EAAEJ,UAAUgH,QAAQnF,GAAGjC,EAAEkM,QAAQ1L,KAAKA,GAAGA,EAAE4G,QAAQnF,GAAG,MAAMd,EAAEO,KAAK6J,KAAK,oBAAoB,OAAOpK,GAAGA,EAAEd,SAASL,EAAEK,QAAQc,EAAEb,KAAK,CAAEE,EAAEyB,IAAIjC,EAAEiC,KAAKzB,GAAIR,EAAEmB,EAAE,SAAS,MAAMnB,EAAE0B,KAAKqG,MAAM,IAAIvH,EAAE,CAACuF,IAAI/F,EAAE+F,IAAIoG,OAAOnM,EAAEgG,YAAYoG,YAAYpM,EAAEmG,kBAAkBtF,WAAWb,EAAEa,YAAY,MAAM,OAAOa,KAAKyJ,kBAAkBzJ,KAAKiI,cAAcnJ,EAAEmJ,cAAcjI,KAAKiI,cAAcnJ,EAAE,IAAIA,EAAEqE,OAAOnD,KAAKmD,OAAOwH,UAAU3K,KAAK2K,WAAW7L,IAAI,eAAE,CAAC,eAAE,CAACyE,UAAS,KAAMhF,EAAEiF,UAAU,gBAAgB,MAAM,eAAE,CAAC,eAAE,CAACD,UAAS,KAAMhF,EAAEiF,UAAU,mBAAmB,MAAM,eAAE,CAAC,kBAAKjF,EAAEiF,UAAU,QAAQ,MAAM,eAAE,CAAC,eAAE,CAACD,UAAS,KAAMhF,EAAEiF,UAAU,SAAS,MAAM,eAAE,CAAC,eAAE,CAACD,UAAS,KAAMhF,EAAEiF,UAAU,YAAY,MAAM,eAAE,CAAC,eAAE,CAACxE,KAAK4L,UAAUrM,EAAEiF,UAAU,aAAQ,GAAQ,eAAE,CAAC,eAAE,SAAIjF,EAAEiF,UAAU,kBAAa,GAAQ,eAAE,CAAC,eAAE,CAACD,UAAS,KAAMhF,EAAEiF,UAAU,UAAU,MAAM,eAAE,CAAC,eAAE,CAACD,UAAS,KAAMhF,EAAEiF,UAAU,mBAAmB,MAAMjF,EAAE,eAAE,CAAC,eAAE,6CAA6CA,I,kCCJvtG,oOAIgyB,MAAMsM,EAAE,OAAEC,UAAU,yBAAyB,SAAS3J,EAAE7C,EAAEQ,GAAG,MAAMyB,EAAE,GAAGd,EAAE,GAAG,OAAOnB,GAAGA,EAAEoH,QAASpH,IAAI,MAAMkB,EAAE,IAAI,OAAE,GAAGA,EAAEkE,KAAKpF,EAAEQ,GAAGW,EAAED,EAAEN,IAAIM,EAAE,MAAMlB,EAAEyM,gBAAgB,IAAIzM,EAAEyM,cAAc,CAAC,MAAMjM,EAAEW,EAAEnB,EAAEyM,eAAejM,EAAEJ,YAAYI,EAAEJ,UAAU,IAAII,EAAEJ,UAAU8L,QAAQhL,QAAQe,EAAEiK,QAAQhL,KAAMe,GAAGA,EAAE,MAAMyK,EAAE,OAAEC,OAAO,QAAG,SAASnI,EAAExE,EAAEQ,GAAGR,GAAGA,EAAEoH,QAASpH,IAAIQ,EAAER,GAAGA,EAAEI,WAAWJ,EAAEI,UAAUC,QAAQmE,EAAExE,EAAEI,UAAUI,KAAM,MAAMqK,EAAErK,IAAI,IAAIqK,EAAE,cAAcrK,EAAE,eAAeR,GAAGwB,SAASxB,GAAG0B,KAAKsI,aAAa,IAAI,OAAE,CAAC4C,KAAKlL,KAAKmL,oBAAoB,CAAC,aAAaC,oBAAoB9M,GAAGA,EAAEI,YAAYsB,KAAKqL,oBAAoB,CAACC,EAAE,GAAGC,EAAE,GAAGC,EAAE,GAAGC,EAAE,IAAIzL,KAAK0L,MAAM,YAAY,CAAEpN,EAAEQ,IAAIkB,KAAK2L,uBAAuBrN,EAAEQ,IAAI,GAAI,cAAcR,EAAEQ,GAAG,IAAIA,IAAIR,EAAE,OAAO,MAAM+M,oBAAoB5L,GAAGO,KAAKR,EAAE,eAAEV,EAAEyG,QAAQ,GAAG/F,EAAE,EAAE,OAAO,GAAGC,EAAED,GAAG,CAACoM,QAAQ9M,EAAEiH,cAAczH,EAAEyH,eAAetG,EAAED,GAAGuG,cAAc5C,OAAO7E,EAAE6E,QAAQ1D,EAAED,GAAG2D,QAAQ3D,EAAE,EAAE,OAAOQ,KAAK8J,KAAK,mBAAmB9J,KAAKwF,yBAAyB,WAAW9G,WAAW,MAAMA,UAAU2C,EAAEkE,OAAOjE,GAAGtB,KAAKwF,yBAAyB,gBAAgBjH,EAAE,eAAEyB,MAAMzB,EAAEsN,iBAAiBvK,GAAGtB,KAAK8J,KAAK,YAAY,IAAIkB,EAAE3J,IAAI9C,EAAEsN,iBAAiB,QAAQ,iBAAiBvN,GAAG,OAAO0B,KAAKsI,aAAawD,KAAMhN,GAAGA,EAAEI,KAAKZ,GAAI,yBAAyB,OAAO0B,KAAKwF,yBAAyB,WAAW9G,UAAU,yBAAyBJ,GAAG,MAAMQ,EAAE,eAAE,iBAAiBR,EAAE,UAAUA,GAAG,IAAIiC,EAAE,EAAEd,EAAEO,KAAKqL,oBAAoB,GAAGlI,OAAO3D,EAAEQ,KAAKqL,oBAAoB,GAAGO,QAAQvK,EAAE,KAAK,MAAM9C,EAAE,CAAC,EAAE,EAAE,GAAGyH,OAAQ1H,GAAGA,GAAGQ,GAAI,IAAI,MAAMN,KAAKD,EAAE,CAAC,MAAMD,EAAE0B,KAAKqL,oBAAoB7M,GAAG,eAAEF,EAAE6E,UAAU5C,EAAE/B,EAAEiB,EAAEnB,EAAE6E,OAAO3D,EAAElB,EAAEsN,QAAQtN,EAAEyH,gBAAgB1E,EAAE,CAAC0E,cAAczH,EAAEyH,cAAc6F,QAAQtN,EAAEsN,WAAW,MAAMpK,EAAE,CAAC,EAAE,EAAE,GAAGwE,OAAQ1H,GAAGA,EAAEiC,GAAGjC,GAAGQ,GAAI,IAAIc,EAAE,KAAK,IAAI,MAAMpB,KAAKgD,EAAE,CAAC,MAAM2B,OAAO7E,EAAEyH,cAAcjH,EAAE8M,QAAQrL,GAAGP,KAAKqL,oBAAoB7M,GAAGF,IAAIsB,EAAE,CAACuD,OAAO7E,EAAEsN,QAAQrL,IAAIzB,IAAIuC,EAAE,CAAC0E,cAAcjH,EAAE8M,QAAQrL,IAAI,MAAMsK,EAAE1J,EAAE1B,EAAED,GAAG2J,EAAE,IAAIlG,IAAIpD,EAAE,IAAIkM,IAAI,GAAGnM,EAAE,IAAI,MAAMpB,KAAKoB,EAAEuD,OAAOgG,EAAE/F,IAAI5E,EAAEU,GAAGV,GAAG,GAAG6C,EAAE,IAAI,MAAM7C,KAAK6C,EAAE0E,cAAclG,EAAEoK,IAAIzL,GAAG,OAAOsE,EAAE+H,EAAGvM,IAAIsB,GAAGtB,EAAEoF,KAAKyF,EAAE5G,IAAIjE,EAAEY,IAAIU,EAAEgM,SAASvK,GAAG/C,EAAEoF,KAAK,CAACsI,kBAAkBnM,EAAEoM,IAAI3N,EAAEY,KAAKmC,EAAEuK,WAAY,CAACrG,OAAO,eAAEhF,GAAG7B,UAAU,IAAIsM,EAAE,CAACkB,MAAMrB,KAAK,KAAKvM,EAAEQ,GAAGgB,MAAM4D,KAAKpF,EAAEQ,GAAGkB,KAAKmM,cAAc7N,EAAEQ,GAAG,uBAAuBR,EAAEQ,GAAGA,IAAIA,EAAE4G,QAASpH,IAAIA,EAAE8N,OAAO,KAAK9N,EAAE+H,MAAM,OAAQrG,KAAK+J,QAAQC,OAAO,oBAAoB1L,IAAIA,EAAEoH,QAASpH,IAAIA,EAAE8N,OAAOpM,KAAK1B,EAAE+H,MAAMrG,OAAQA,KAAK+J,QAAQE,IAAI,CAAC3L,EAAE4L,GAAG,YAAY,EAAGmC,KAAK/N,MAAMA,EAAE8N,OAAOpM,KAAK1B,EAAE+H,MAAMrG,OAAQ1B,EAAE4L,GAAG,eAAe,EAAGmC,KAAK/N,MAAMA,EAAE8N,OAAO,KAAK9N,EAAE+H,MAAM,QAAS,mBAAmB,SAASrG,KAAKhB,MAAMgB,KAAK+J,QAAQE,IAAI3L,EAAE4L,GAAG,iBAAkB5L,IAAIuM,EAAEvH,MAAM,IAAI,OAAE,qCAAqC,wEAAwE,CAAC+C,MAAMrG,QAAQ1B,EAAEgO,mBAAoB,sBAAsB,OAAO,eAAE,CAAC,eAAE,CAAC/I,UAAS,KAAM4F,EAAE3F,UAAU,oBAAe,GAAQ,eAAE,CAAC,eAAE,CAACD,UAAS,EAAGvE,KAAK,OAAEiM,OAAO,WAAM9B,EAAE3F,UAAU,wBAAmB,GAAQ,eAAE,CAAC,eAAE,CAACmF,MAAM,KAAK3J,KAAKgM,EAAEvH,KAAK,CAACC,MAAK,EAAGK,MAAM,CAACwI,WAAU,EAAG7D,cAAa,OAAQS,EAAE3F,UAAU,iBAAY,GAAQ,eAAE,CAAC,eAAE,CAACD,UAAS,KAAM4F,EAAE3F,UAAU,2BAAsB,GAAQ2F,EAAE,eAAE,CAAC,eAAE,sCAAsCA,GAAGA","file":"js/chunk-792b91aa.367d997c.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nfunction e(e,n,i){if(n.flatten((({sublayers:e})=>e)).length!==e.length)return!0;return!!e.some((e=>e.originIdOf(\"minScale\")>i||e.originIdOf(\"maxScale\")>i||e.originIdOf(\"renderer\")>i||e.originIdOf(\"labelingInfo\")>i||e.originIdOf(\"opacity\")>i||e.originIdOf(\"labelsVisible\")>i||e.originIdOf(\"source\")>i))||!r(e,n)}function n(e,n,i){return!!e.some((e=>{const n=e.source;return!(!n||\"map-layer\"===n.type&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===i.gdbVersion))||e.originIdOf(\"renderer\")>2||e.originIdOf(\"labelingInfo\")>2||e.originIdOf(\"opacity\")>2||e.originIdOf(\"labelsVisible\")>2}))||!r(e,n)}function r(e,n){if(!e||!e.length)return!0;const r=n.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const o=r.length;for(const{id:t}of e){for(;i<o&&r[i]!==t;)i++;if(i>=o)return!1}return!0}function i(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}export{n as isExportDynamic,i as isSublayerOverhaul,e as shouldWriteSublayerStructure};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{reader as s}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{urlToObject as o}from\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{throwIfAborted as i}from\"../../core/promiseUtils.js\";import p from\"../../geometry/SpatialReference.js\";import a from\"../../geometry/Extent.js\";import l from\"../../request.js\";import{Version as n}from\"../../core/Version.js\";import{id as u,popupEnabled as c}from\"../support/commonProperties.js\";const y=y=>{let m=class extends y{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=null}readCapabilities(e,r){const s=r.capabilities&&r.capabilities.split(\",\").map((e=>e.toLowerCase().trim()));if(!s)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const t=this.type,o=-1!==s.indexOf(\"query\"),i=-1!==s.indexOf(\"map\"),p=!!r.exportTilesAllowed,a=-1!==s.indexOf(\"tilemap\"),l=\"tile\"!==t&&!!r.supportsDynamicLayers,u=\"tile\"!==t&&(!r.tileInfo||l),c=\"tile\"!==t&&(!r.tileInfo||l),y=\"tile\"!==t,m=!!r.cimVersion&&n.parse(r.cimVersion).since(1,4);return{operations:{supportsQuery:o,supportsExportMap:i,supportsExportTiles:p,supportsTileMap:a},exportMap:i?{supportsArcadeExpressionForLabeling:m,supportsSublayersChanges:y,supportsDynamicLayers:l,supportsSublayerVisibility:u,supportsSublayerDefinitionExpression:c}:null,exportTiles:p?{maxExportTilesCount:+r.maxExportTilesCount}:null}}readVersion(e,r){let s=r.currentVersion;return s||(s=r.hasOwnProperty(\"capabilities\")||r.hasOwnProperty(\"tables\")?10:r.hasOwnProperty(\"supportedImageFormatTypes\")?9.31:9.3),s}async fetchSublayerInfo(e,r){return await this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap.get(e)}async fetchAllLayersAndTables(e){await this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=l(o(this.url).path+\"/layers\",{responseType:\"json\",query:{f:\"json\",...this.customParameters}}).then((e=>{this._allLayersAndTablesMap=new Map;for(const r of e.data.layers)this._allLayersAndTablesMap.set(r.id,r);return{result:e.data}}),(e=>({error:e}))));const r=await this._allLayersAndTablesPromise;if(i(e),\"result\"in r)return r.result;throw r.error}};return e([r({readOnly:!0})],m.prototype,\"capabilities\",void 0),e([s(\"service\",\"capabilities\",[\"capabilities\",\"exportTilesAllowed\",\"maxExportTilesCount\",\"supportsDynamicLayers\",\"tileInfo\"])],m.prototype,\"readCapabilities\",null),e([r({json:{read:{source:\"copyrightText\"}}})],m.prototype,\"copyright\",void 0),e([r({type:a})],m.prototype,\"fullExtent\",void 0),e([r(u)],m.prototype,\"id\",void 0),e([r({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:\"showLegend\"},write:{target:\"showLegend\"}}})],m.prototype,\"legendEnabled\",void 0),e([r(c)],m.prototype,\"popupEnabled\",void 0),e([r({type:p})],m.prototype,\"spatialReference\",void 0),e([r()],m.prototype,\"version\",void 0),e([s(\"version\",[\"currentVersion\",\"capabilities\",\"tables\",\"supportedImageFormatTypes\"])],m.prototype,\"readVersion\",null),m=e([t(\"esri.layers.mixins.ArcGISMapService\")],m),m};export{y as ArcGISMapService};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{getMetersPerUnitForSR as t,inchesPerMeter as n}from\"../../core/unitUtils.js\";const e=96;function r(r,i){const o=i||r.extent,c=r.width,u=t(o&&o.spatialReference);return o&&c?o.width/c*u*n*e:0}function i(r,i){return r/(t(i)*n*e)}function o(r,i){return r*(t(i)*n*e)}function c(t,n){const e=t.extent,r=t.width,o=i(n,e.spatialReference);return e.clone().expand(o*r/e.width)}export{c as getExtentForScale,i as getResolutionForScale,r as getScale,o as getScaleForResolution};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{isSome as r}from\"../core/maybe.js\";import\"../core/Logger.js\";import{Integer as t}from\"../core/accessorSupport/ensureType.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import{reader as o}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import p from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import{nameToId as m}from\"../core/accessorSupport/PropertyOrigin.js\";import\"../portal/support/resourceExtension.js\";import{isAbortError as n}from\"../core/promiseUtils.js\";import l from\"../geometry/Extent.js\";import c from\"../request.js\";import{loadAll as u}from\"../core/loadAll.js\";import y from\"./Layer.js\";import h from\"../TimeExtent.js\";import{MultiOriginJSONMixin as d}from\"../core/MultiOriginJSONSupport.js\";import{url as f}from\"./support/commonProperties.js\";import{OperationalLayer as g}from\"./mixins/OperationalLayer.js\";import{ArcGISService as j}from\"./mixins/ArcGISService.js\";import{BlendLayer as b}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as x}from\"./mixins/CustomParametersMixin.js\";import{PortalLayer as v}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as S}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as w}from\"./mixins/ScaleRangeLayer.js\";import{TemporalLayer as O}from\"./mixins/TemporalLayer.js\";import{HandleOwnerMixin as L}from\"../core/HandleOwner.js\";import{getScale as E}from\"../geometry/support/scaleUtils.js\";import{ArcGISMapService as I}from\"./mixins/ArcGISMapService.js\";import P from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as M}from\"./support/sublayerUtils.js\";import{SublayersOwner as q}from\"./mixins/SublayersOwner.js\";import{ExportImageParameters as N}from\"./support/ExportImageParameters.js\";let R=class extends(b(O(w(S(q(I(j(g(v(d(x(L(y))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).then((()=>this._fetchService(t)),(()=>this._fetchService(t)))),Promise.resolve(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let i=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=m(s.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;i=M(o,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");i=M(o,e.sublayers,m(e.origin))}}const a=[],p={writeSublayerStructure:i,...s};let n=i;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,s){const o=s&&s.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const i=new N({layer:this,scale:E({extent:e,width:r})*o}),a=i.toJSON();i.destroy();const p=!s||!s.rotation||this.version<10.3?{}:{rotation:-s.rotation},m=e&&e.spatialReference,n=m.wkid||JSON.stringify(m.toJSON());a.dpi*=o;const l={};if(null!=s&&s.timeExtent){const{start:e,end:r}=s.timeExtent.toJSON();l.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(l.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:n,imageSR:n,size:r+\",\"+t,...a,...p,...l}}async fetchImage(e,r,t,s){const o={responseType:\"image\"};s&&s.timestamp&&(o.query={...o.query,_ts:s.timestamp}),s&&s.signal&&(o.signal=s.signal),this.customParameters&&Object.keys(this.customParameters).length&&(o.query={...this.customParameters,...o.query});const i=this.parsedUrl.path+\"/export\",a={...this.parsedUrl.query,...this.createExportImageParameters(e,r,t,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null};if(null!=a.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return Promise.reject(new p(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:a}));o.query?o.query={...a,...o.query}:o.query=a;return c(i,o).then((e=>e.data)).catch((e=>{if(n(e))throw e;throw new p(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${i}`,{error:e})}))}async fetchRecomputedExtents(e={}){const r={...e,query:{returnUpdates:!0,f:\"json\"}},{data:t}=await c(this.url,r),{extent:s,fullExtent:o,timeExtent:i}=t,a=s||o;return{fullExtent:a&&l.fromJSON(a),timeExtent:i&&h.fromJSON({start:i[0],end:i[1]})}}loadAll(){return u(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:r,ssl:t}=await c(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters},signal:e});t&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r,this.read(r,{origin:\"service\",url:this.parsedUrl})}};e([s()],R.prototype,\"alwaysRefetch\",void 0),e([s()],R.prototype,\"dpi\",void 0),e([s()],R.prototype,\"gdbVersion\",void 0),e([s()],R.prototype,\"imageFormat\",void 0),e([o(\"imageFormat\",[\"supportedImageFormatTypes\"])],R.prototype,\"readImageFormat\",null),e([s({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],R.prototype,\"imageMaxHeight\",void 0),e([s({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],R.prototype,\"imageMaxWidth\",void 0),e([s()],R.prototype,\"imageTransparency\",void 0),e([s({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],R.prototype,\"isReference\",void 0),e([s({json:{read:!1,write:!1}})],R.prototype,\"labelsVisible\",void 0),e([s({type:[\"ArcGISMapServiceLayer\"]})],R.prototype,\"operationalLayerType\",void 0),e([s({json:{read:!1,write:!1}})],R.prototype,\"popupEnabled\",void 0),e([s()],R.prototype,\"sourceJSON\",void 0),e([s({json:{write:{ignoreOrigin:!0}}})],R.prototype,\"sublayers\",void 0),e([a(\"sublayers\",{layers:{type:[P]},visibleLayers:{type:[t]}})],R.prototype,\"writeSublayers\",null),e([s({type:[\"show\",\"hide\",\"hide-children\"]})],R.prototype,\"listMode\",void 0),e([s({json:{read:!1},readOnly:!0,value:\"map-image\"})],R.prototype,\"type\",void 0),e([s(f)],R.prototype,\"url\",void 0),R=e([i(\"esri.layers.MapImageLayer\")],R);var J=R;export default J;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport t from\"./Error.js\";class r{constructor(t,r,o=\"\"){this.major=t,this.minor=r,this._context=o}lessThan(t,r){return this.major<t||t===this.major&&this.minor<r}since(t,r){return!this.lessThan(t,r)}validate(r){if(this.major!==r.major){const o=this._context&&this._context+\":\",s=this._context&&this._context+\" \";throw new t(o+\"unsupported-version\",`Required major ${s}version is '${this.major}', but got '\\${version.major}.\\${version.minor}'`,{version:r})}}clone(){return new r(this.major,this.minor,this._context)}static parse(o,s=\"\"){const[e,i]=o.split(\".\"),n=/^\\s*\\d+\\s*$/;if(!e||!e.match||!e.match(n)){throw new t((s&&s+\":\")+\"invalid-version\",\"Expected major version to be a number, but got '${version}'\",{version:o})}if(!i||!i.match||!i.match(n)){throw new t((s&&s+\":\")+\"invalid-version\",\"Expected minor version to be a number, but got '${version}'\",{version:o})}const a=parseInt(e,10),h=parseInt(i,10);return new r(a,h,s)}}export{r as Version};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import t from\"../../core/Accessor.js\";import{combinedViewLayerTimeExtentProperty as i}from\"./commonProperties.js\";import{HandleOwnerMixin as a}from\"../../core/HandleOwner.js\";import{isExportDynamic as o}from\"./sublayerUtils.js\";const l={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let n=class extends(a(t)){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&o(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(l[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,r)=>(e[r.id]=r.definitionExpression,e)),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,a=0===r.minScale||t<=r.minScale,o=0===r.maxScale||t>=r.maxScale;r.visible&&(i||a&&o)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([r({readOnly:!0})],n.prototype,\"dynamicLayers\",null),e([r({readOnly:!0})],n.prototype,\"hasDynamicLayers\",null),e([r()],n.prototype,\"layer\",null),e([r({readOnly:!0})],n.prototype,\"layers\",null),e([r({readOnly:!0})],n.prototype,\"layerDefs\",null),e([r({type:Number})],n.prototype,\"scale\",void 0),e([r(i)],n.prototype,\"timeExtent\",void 0),e([r({readOnly:!0})],n.prototype,\"version\",null),e([r({readOnly:!0})],n.prototype,\"visibleSublayers\",null),n=e([s(\"esri.layers.mixins.ExportImageParameters\")],n);export{n as ExportImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import r from\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{getProperties as s}from\"../../core/accessorSupport/utils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import a from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import{nameToId as i,idToName as l}from\"../../core/accessorSupport/PropertyOrigin.js\";import\"../../portal/support/resourceExtension.js\";import n from\"../../core/Collection.js\";import u from\"../../core/CollectionFlattener.js\";import y from\"../support/Sublayer.js\";import{isSublayerOverhaul as c}from\"../support/sublayerUtils.js\";const b=r.getLogger(\"esri.layers.TileLayer\");function p(e,r){const s=[],t={};return e?(e.forEach((e=>{const o=new y;if(o.read(e,r),t[o.id]=o,null!=e.parentLayerId&&-1!==e.parentLayerId){const r=t[e.parentLayerId];r.sublayers||(r.sublayers=[]),r.sublayers.unshift(o)}else s.unshift(o)})),s):s}const d=n.ofType(y);function f(e,r){e&&e.forEach((e=>{r(e),e.sublayers&&e.sublayers.length&&f(e.sublayers,r)}))}const h=r=>{let h=class extends r{constructor(...e){super(...e),this.allSublayers=new u({root:this,rootCollectionNames:[\"sublayers\"],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{}},this.watch(\"sublayers\",((e,r)=>this._handleSublayersChange(e,r)),!0)}readSublayers(e,r){if(!r||!e)return;const{sublayersSourceJSON:t}=this,o=i(r.origin);if(o<2)return;if(t[o]={context:r,visibleLayers:e.visibleLayers||t[o].visibleLayers,layers:e.layers||t[o].layers},o>2)return;this._set(\"serviceSublayers\",this.createSublayersForOrigin(\"service\").sublayers);const{sublayers:a,origin:l}=this.createSublayersForOrigin(\"web-document\"),n=s(this);n.setDefaultOrigin(l),this._set(\"sublayers\",new d(a)),n.setDefaultOrigin(\"user\")}findSublayerById(e){return this.allSublayers.find((r=>r.id===e))}createServiceSublayers(){return this.createSublayersForOrigin(\"service\").sublayers}createSublayersForOrigin(e){const r=i(\"web-document\"===e?\"web-map\":e);let s=2,t=this.sublayersSourceJSON[2].layers,o=this.sublayersSourceJSON[2].context,a=null;const n=[3,4,5].filter((e=>e<=r));for(const i of n){const e=this.sublayersSourceJSON[i];c(e.layers)&&(s=i,t=e.layers,o=e.context,e.visibleLayers&&(a={visibleLayers:e.visibleLayers,context:e.context}))}const u=[3,4,5].filter((e=>e>s&&e<=r));let y=null;for(const i of u){const{layers:e,visibleLayers:r,context:s}=this.sublayersSourceJSON[i];e&&(y={layers:e,context:s}),r&&(a={visibleLayers:r,context:s})}const b=p(t,o),h=new Map,m=new Set;if(y)for(const i of y.layers)h.set(i.id,i);if(a)for(const i of a.visibleLayers)m.add(i);return f(b,(e=>{y&&e.read(h.get(e.id),y.context),a&&e.read({defaultVisibility:m.has(e.id)},a.context)})),{origin:l(s),sublayers:new d({items:b})}}read(e,r){super.read(e,r),this.readSublayers(e,r)}_handleSublayersChange(e,r){r&&(r.forEach((e=>{e.parent=null,e.layer=null})),this.handles.remove(\"sublayers-owner\")),e&&(e.forEach((e=>{e.parent=this,e.layer=this})),this.handles.add([e.on(\"after-add\",(({item:e})=>{e.parent=this,e.layer=this})),e.on(\"after-remove\",(({item:e})=>{e.parent=null,e.layer=null}))],\"sublayers-owner\"),\"tile\"===this.type&&this.handles.add(e.on(\"before-changes\",(e=>{b.error(new a(\"tilelayer:sublayers-non-modifiable\",\"Sublayer can't be added, moved, or removed from the layer's sublayers\",{layer:this})),e.preventDefault()})),\"sublayers-owner\"))}};return e([t({readOnly:!0})],h.prototype,\"allSublayers\",void 0),e([t({readOnly:!0,type:n.ofType(y)})],h.prototype,\"serviceSublayers\",void 0),e([t({value:null,type:d,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],h.prototype,\"sublayers\",void 0),e([t({readOnly:!0})],h.prototype,\"sublayersSourceJSON\",void 0),h=e([o(\"esri.layers.mixins.SublayersOwner\")],h),h};export{h as SublayersOwner,f as forEachSublayer};\n"],"sourceRoot":""}
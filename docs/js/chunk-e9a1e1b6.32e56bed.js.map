{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateSet.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStateSet.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js","webpack:///./node_modules/@arcgis/core/views/layers/support/FeatureFilter.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFilterVisibility.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/floorFilterUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/ExtentSet.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"],"names":["this","items","e","t","push","type","objectStateId","object","s","renderGeometry","owner","remove","length","_removeObjectStateItem","splice","forEach","channel","removeHighlight","removeOcclude","removeRenderGeometryObjectState","i","stateType","objectIdField","objectStateSet","ids","Set","paused","graphic","attributes","has","uid","_graphicsCore","_stateSets","Array","removeAll","a","h","releaseSet","set","handle","indexOf","addObjectStateSet","removeObjectState","add","graphics3DGraphics","get","_addObjectStateSet","setUid","initializeSet","hasGraphic","_removeObjectStateSet","states","d","m","esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelCrosses","esriSpatialRelDisjoint","esriSpatialRelEnvelopeIntersects","esriSpatialRelIndexIntersects","esriSpatialRelOverlaps","esriSpatialRelTouches","esriSpatialRelWithin","esriSpatialRelRelation","u","esriSRUnit_Meter","esriSRUnit_Kilometer","esriSRUnit_Foot","esriSRUnit_StatuteMile","esriSRUnit_NauticalMile","esriSRUnit_USNauticalMile","super","where","geometry","spatialRelationship","hiddenIds","distance","objectIds","units","timeExtent","enabled","_set","r","o","n","p","l","String","prototype","types","json","read","write","source","reader","target","writer","from","Number","overridePolicy","readOnly","j","y","getLogger","_","filter","_dirty","_querying","_handles","_queryResult","_layerView","_core","_objectIdField","layer","_queryEngine","layerView","task","FILTER_VISIBILITY","view","resourceController","scheduler","registerTask","_update","_needsUpdate","_graphicsChanged","dirty","filterChanged","destroy","clear","modifyGraphics3DGraphicVisibilities","clearVisibilityFlag","notifyChange","active","hasVisibilityFlag","setVisibilityFlag","recomputeFilter","size","clone","intersection","done","executeQueryForIdSet","then","catch","warn","error","_getFeatureId","madeProgress","objectId","V","watchUpdatingTracking","suspendResumeExtentMode","dataExtent","suspendResumeExtent","scaleVisibility","suspended","outsideScaleRange","frustumVisibility","outsideOfView","graphicsCore","updating","frustumVisibilityEnabled","scaleVisibilityEnabled","filterVisibilityEnabled","timeExtentVisibilityEnabled","geometryType","elevationAlignmentEnabled","preferredUpdatePolicy","elevationFeatureExpressionEnabled","graphicSymbolSupported","hasZ","hasM","updateClippingExtent","filterVisibility","elevationAlignment","layerMinMaxScaleChangeHandler","addPromise","elevationInfoChange","updateVisibilityInfo","updateLabelingInfo","setup","basemapTerrain","spatialIndex","queryGraphicUIDsInExtent","elevationProvider","labeler","addGraphicsOwner","deconflictor","deconfliction","labeling","objectStates","rendererChange","opacityChange","setupSuspendResumeExtent","_updateClippingExtent","startCreateGraphics","labelsEnabled","acquireSet","queryObjectIds","setObjectIds","highlight","toArray","isArray","fieldsIndex","map","setUids","S","clippingArea","setClippingExtent","spatialReference","recreateAllGraphics","updateSuspendResumeExtent","watch","computedExtent","suspendResumeExtentChanged","extentToSuspendResumeRect","equals","extentPadding","setExtent","aliasOf","constructOnly","dependsOn","v","floorInfo","floors","f","floorField","join","extents","allocator","tempExtent","contains","removeContained","pushNew","mergeTight","pop","hasProgressed","sort","getItemAt","delete","c","g","some","filterInPlace","containsPoint","arguments","dirtyExtents","globalDirty","dirtyGraphicsSet","handles","updateElevation","events","needsUpdate","on","_elevationChanged","suspendedChange","ELEVATION_ALIGNMENT","update","empty","markAllGraphicsElevationDirty","run","merge","_updateDirtyGraphics","_updateDirtyExtents","setDirty","renderCoordsHelper","asyncUpdates","keys","getGraphics3DGraphicById","alignWithElevation","emit","extent","needsElevationUpdates","context","elevationInfo","mode","xmin","xmax","ymin","ymax","_dataQueryEngineInstance","outSpatialReference","toJSON","ensureDataQueryEngine","dataQueryEngine","_ensureQueryJSON","executeQueryForCount","count","executeQueryForExtent","fromJSON","executeQueryForIds","executeQueryForLatestObservations","features","sourceLayer","executeQuery","defaultQueryJSON","timeInfo","queryGeometryType","fields","graphics3d","featureStore","name","toLowerCase","extentIntersectionDirty","_isVisibleBelowSurface","extentIntersection","viewChange","state","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","updateIsVisibleBelowSurface","_setDirty","ground","navigationConstraint","opaque","radius","min","max","elevationBounds","Math","updateExtentIntersection","frustum","isVisibleInFrustum"],"mappings":"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","file":"js/chunk-e9a1e1b6.32e56bed.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nclass e{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,s){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:s})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];s.objectStateId===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];0===s.type&&s.object===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];1===s.type&&s.renderGeometry===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}export{e as Object3DStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{Object3DStateSet as t}from\"../../webgl-engine/lib/Object3DStateSet.js\";class e{constructor(e,i){this.stateType=e,this.objectIdField=i,this.objectStateSet=new t,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}export{e as Graphics3DObjectStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../core/handleUtils.js\";import{Graphics3DObjectStateSet as e}from\"./Graphics3DObjectStateSet.js\";class s{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll())),this._stateSets=null}acquireSet(s,a){const i=new e(s,a);this._stateSets.push(i);const h=t((()=>this.releaseSet(i)));return{set:i,handle:h}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const s=this._graphicsCore.graphics3DGraphics.get(e);s&&this._addObjectStateSet(s,t)}setUids(t,e){e.forEach((e=>this.setUid(t,e)))}setObjectIds(t,e){e.forEach((e=>t.ids.add(e))),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach((e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}))}removeGraphic(t){this._stateSets.forEach((e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll()))}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach((e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})):t.ids.forEach((s=>{const a=e.get(s);a&&this._addObjectStateSet(a,t)}))}get test(){return{states:this._stateSets}}}export{s as Graphics3DObjectStates};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{clone as t}from\"../../../core/lang.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{JSONMap as i}from\"../../../core/jsonMap.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{writer as o}from\"../../../core/accessorSupport/decorators/writer.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{JSONSupport as n}from\"../../../core/JSONSupport.js\";import{fromJSON as a}from\"../../../geometry/support/jsonUtils.js\";import{geometryTypes as p}from\"../../../geometry.js\";import l from\"../../../TimeExtent.js\";import c from\"../../../tasks/support/Query.js\";var d;const m=new i({esriSpatialRelIntersects:\"intersects\",esriSpatialRelContains:\"contains\",esriSpatialRelCrosses:\"crosses\",esriSpatialRelDisjoint:\"disjoint\",esriSpatialRelEnvelopeIntersects:\"envelope-intersects\",esriSpatialRelIndexIntersects:\"index-intersects\",esriSpatialRelOverlaps:\"overlaps\",esriSpatialRelTouches:\"touches\",esriSpatialRelWithin:\"within\",esriSpatialRelRelation:\"relation\"}),u=new i({esriSRUnit_Meter:\"meters\",esriSRUnit_Kilometer:\"kilometers\",esriSRUnit_Foot:\"feet\",esriSRUnit_StatuteMile:\"miles\",esriSRUnit_NauticalMile:\"nautical-miles\",esriSRUnit_USNauticalMile:\"us-nautical-miles\"});let h=d=class extends n{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship=\"intersects\",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||\"1=1\"}enable(){this._set(\"enabled\",!0)}createQuery(e={}){const{where:r,geometry:i,spatialRelationship:s,timeExtent:o,objectIds:n,units:a,distance:p}=this;return new c({geometry:t(i),objectIds:t(n),spatialRelationship:s,timeExtent:t(o),where:r,units:a,distance:p,...e})}clone(){const{where:e,geometry:r,spatialRelationship:i,hiddenIds:s,timeExtent:o,objectIds:n,units:a,distance:p}=this,l=new Set;return s.forEach((e=>l.add(e))),new d({geometry:t(r),hiddenIds:l,objectIds:t(n),spatialRelationship:i,timeExtent:t(o),where:e,units:a,distance:p})}};e([r({type:String})],h.prototype,\"where\",void 0),e([o(\"where\")],h.prototype,\"writeWhere\",null),e([r({types:p,json:{read:a,write:!0}})],h.prototype,\"geometry\",void 0),e([r({type:String,json:{read:{source:\"spatialRel\",reader:m.read},write:{target:\"spatialRel\",writer:m.write}}})],h.prototype,\"spatialRelationship\",void 0),e([r({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],h.prototype,\"hiddenIds\",void 0),e([r({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],h.prototype,\"distance\",void 0),e([r({type:[Number],json:{write:!0}})],h.prototype,\"objectIds\",void 0),e([r({type:String,json:{read:u.read,write:{writer:u.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],h.prototype,\"units\",void 0),e([r({type:l,json:{write:!0}})],h.prototype,\"timeExtent\",void 0),e([r({readOnly:!0})],h.prototype,\"enabled\",void 0),h=d=e([s(\"esri.views.layers.support.FeatureFilter\")],h);var j=h;export default j;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import{isNone as t,isSome as i}from\"../../../../core/maybe.js\";import r from\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import{subclass as h}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import{isAbortError as o}from\"../../../../core/promiseUtils.js\";import l from\"../../../../core/Accessor.js\";import a from\"../../../../core/Handles.js\";import{on as n}from\"../../../../core/watchUtils.js\";import{Task as u}from\"../../../support/Scheduler.js\";import c from\"../../../layers/support/FeatureFilter.js\";import d from\"./QueryEngine.js\";import{getFloorFilterClause as p}from\"../support/floorFilterUtils.js\";const y=r.getLogger(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\");let _=class extends l{constructor(...e){super(...e),this.filter=null,this._dirty=!1,this._querying=!1,this._handles=new a}get updating(){return this._dirty||this._querying||null!=this._queryResult}setup(e,t){this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new d({layerView:this._layerView,task:u.FILTER_VISIBILITY});const i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(u.FILTER_VISIBILITY,(e=>this._update(e)),(()=>this._needsUpdate()))),this._handles.add(n(t.owner,\"loadedGraphics\",\"after-changes\",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(2))),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange(\"updating\")}_graphicsChanged(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}filterChanged(){const e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}get active(){return this.filter&&this._core.graphics3DGraphics.size>0}recomputeFilter(){const e=\"filter\"in this._layerView?this._layerView.filter:null,r=\"timeExtent\"in this._layerView?this._layerView.timeExtent:null,s=p(this._layerView);if(t(r)&&t(s))return e;const h=i(e)?e.clone():new c;if(i(r)&&(h.timeExtent=i(h.timeExtent)?h.timeExtent.intersection(r):r),i(s)){const e=null==h.where||\"\"===h.where;h.where=e?s:`(${h.where}) AND (${s})`}return h}_needsUpdate(){return this._dirty&&!this._querying||null!=this._queryResult}_update(e){this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{o(e)||(y.warn(\"FeatureFilter query failed: \"+e,{error:e}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach((e=>this._queryResult.add(this._getFeatureId(e.graphic)))),this._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((t=>{if(e.done)return!1;const i=this._queryResult.has(this._getFeatureId(t.graphic));return!!t.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange(\"updating\")):this.clear()}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty!==e&&(this._dirty=e,this.notifyChange(\"updating\"))}};e([s({readOnly:!0})],_.prototype,\"updating\",null),_=e([h(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\")],_);export{_ as Graphics3DFilterVisibility};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import{neverReached as e}from\"../../../../core/compilerUtils.js\";import\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import{logOnError as r}from\"../../../../core/promiseUtils.js\";import n from\"../../../../core/Accessor.js\";import{canProject as a,project as o}from\"../../../../geometry/support/webMercatorUtils.js\";import l from\"../../../../Graphic.js\";import p from\"../../../../core/Handles.js\";import{init as h}from\"../../../../core/watchUtils.js\";import{diff as d}from\"../../../../core/accessorSupport/diffUtils.js\";import c from\"../../../../tasks/support/Query.js\";import{WatchUpdatingTracking as u}from\"../../../support/WatchUpdatingTracking.js\";import{enlargeExtent as g}from\"./graphicUtils.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as m}from\"./constants.js\";import{Graphics3DCore as y}from\"./Graphics3DCore.js\";import f from\"./Graphics3DScaleVisibility.js\";import{attributeLookup as b}from\"../support/attributeUtils.js\";import w from\"./Graphics3DElevationAlignment.js\";import{Graphics3DFilterVisibility as x}from\"./Graphics3DFilterVisibility.js\";import E from\"./Graphics3DFrustumVisibility.js\";import{Graphics3DObjectStates as C}from\"./Graphics3DObjectStates.js\";let V=class extends n{constructor(t){super(t),this._handles=new p,this.watchUpdatingTracking=new u,this.suspendResumeExtentMode=\"computed\",this.dataExtent=null,this.suspendResumeExtent=null}get suspended(){var t;return null==(t=this.scaleVisibility)?void 0:t.suspended}get suspendInfo(){var t,e;const i={};return null!=(t=this.scaleVisibility)&&t.suspended&&(i.outsideScaleRange=!0),null!=(e=this.frustumVisibility)&&e.suspended&&(i.outsideOfView=!0),i}get updating(){var t,e,i;return!!(null!=(t=this.graphicsCore)&&t.updating||null!=(e=this.frustumVisibility)&&e.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}normalizeCtorArgs(t){const e=t.frustumVisibilityEnabled?new E:null,i=t.scaleVisibilityEnabled?new f:null,s=(t.filterVisibilityEnabled||t.timeExtentVisibilityEnabled)&&\"multipatch\"!==t.layer.geometryType?new x:null,r=t.elevationAlignmentEnabled?new w:null,n=new y({owner:t.owner,layer:t.layer,preferredUpdatePolicy:t.preferredUpdatePolicy,elevationFeatureExpressionEnabled:t.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.owner.hasZ,hasM:t.owner.hasM}),{updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}=t;return{graphicsCore:n,frustumVisibility:e,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}}initialize(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,\"filter\",(()=>this.filterVisibility.filterChanged())),this.watchUpdatingTracking.add(this.owner,\"timeExtent\",(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{d(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,\"labelsVisible\",(()=>this.graphicsCore.updateVisibilityInfo())),this.watchUpdatingTracking.add(this.layer,\"labelingInfo\",((t,e)=>{d(t,e)&&this.graphicsCore.updateLabelingInfo()}))}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const t=this.owner,e=this.owner.view.basemapTerrain,i=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,i,this.graphicsCore,e),this.filterVisibility&&(\"filter\"in t||\"timeExtent\"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){const e=t.view.elevationProvider;this.elevationAlignment.setup(t,i,this.graphicsCore,e)}this._set(\"objectStates\",new C(this.graphicsCore)),this._set(\"labeling\",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set(\"deconfliction\",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await r(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.watchUpdatingTracking.add(this.layer,\"renderer\",(t=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(t)))),this.watchUpdatingTracking.add(t,\"fullOpacity\",(()=>this.graphicsCore.opacityChange())),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,\"clippingArea\",(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await r(this.graphicsCore.updateLabelingInfo())}destroy(){this._handles&&(this._handles.destroy(),this._handles=null);const t=[\"watchUpdatingTracking\",\"frustumVisibility\",\"scaleVisibility\",\"filterVisibility\",\"elevationAlignment\",\"objectStates\",\"graphicsCore\"];for(const e of t){const t=this[e];t&&(t.destroy(),this._set(e,null))}this._set(\"layer\",null),this._set(\"owner\",null)}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t,e){if(t instanceof c){const{set:i,handle:s}=this.objectStates.acquireSet(0,e);return this.owner.queryObjectIds(t).then((t=>this.objectStates.setObjectIds(i,t))),s}if(\"number\"==typeof t||\"string\"==typeof t)return this.highlight([t],e);if(t instanceof l)return this.highlight([t],e);if(\"toArray\"in t&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof l){const i=t;if(null==b(this.layer.fieldsIndex,i[0].attributes,e)){const t=i.map((t=>t.uid)),{set:e,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(e,t),s}t=i.map((t=>b(this.layer.fieldsIndex,t.attributes,e)))}if(\"number\"==typeof t[0]||\"string\"==typeof t[0]){const i=t,{set:s,handle:r}=this.objectStates.acquireSet(0,e);return this.objectStates.setObjectIds(s,i),r}}return S}_updateClippingExtent(){const t=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.owner.view.spatialReference)&&(this.updateClippingExtent(t)||this.graphicsCore.recreateAllGraphics())}setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(h(this,\"suspendResumeExtentMode\",(()=>{switch(this._handles.remove(j),this.suspendResumeExtentMode){case\"computed\":this._handles.add([h(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],j);break;case\"data\":this._handles.add([h(this,\"dataExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.dataExtent)))],j);break;default:e(this.suspendResumeExtentMode)}})))}updateSuspendResumeExtent(t){t?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(t,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}extentToSuspendResumeRect(t,e){const i=this.owner.view.spatialReference;if(!t.spatialReference.equals(i)){if(!a(t,i))return;t=o(t,i)}return g(t,e,m,this.graphicsCore.extentPadding)}suspendResumeExtentChanged(t){this.frustumVisibility&&this.frustumVisibility.setExtent(t),this.scaleVisibility&&this.scaleVisibility.setExtent(t)}};t([i({aliasOf:\"graphicsCore.layer\"})],V.prototype,\"layer\",void 0),t([i({aliasOf:\"graphicsCore.owner\"})],V.prototype,\"owner\",void 0),t([i({constructOnly:!0})],V.prototype,\"updateClippingExtent\",void 0),t([i({constructOnly:!0})],V.prototype,\"graphicsCore\",void 0),t([i({constructOnly:!0})],V.prototype,\"scaleVisibility\",void 0),t([i({constructOnly:!0})],V.prototype,\"filterVisibility\",void 0),t([i({constructOnly:!0})],V.prototype,\"elevationAlignment\",void 0),t([i({constructOnly:!0})],V.prototype,\"frustumVisibility\",void 0),t([i({readOnly:!0})],V.prototype,\"deconfliction\",void 0),t([i({readOnly:!0})],V.prototype,\"labeling\",void 0),t([i({readOnly:!0})],V.prototype,\"objectStates\",void 0),t([i({readOnly:!0})],V.prototype,\"watchUpdatingTracking\",void 0),t([i()],V.prototype,\"suspendResumeExtentMode\",void 0),t([i()],V.prototype,\"dataExtent\",void 0),t([i({readOnly:!0})],V.prototype,\"suspended\",null),t([i({readOnly:!0})],V.prototype,\"suspendInfo\",null),t([i({readOnly:!0,dependsOn:[\"graphicsCore.updating\",\"frustumVisibility.updating\",\"watchUpdatingTracking.updating\"]})],V.prototype,\"updating\",null),V=t([s(\"esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView\")],V);var v=V;const j=\"suspendResumeExtentMode\",S={remove(){},pause(){},resume(){}};export default v;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nfunction o(o){const n=o.layer;if(\"floorInfo\"in n&&n.floorInfo){const r=o.view.floors;if(!r||!r.length)return null;const l=r.filter((o=>\"\"!==o)).map((o=>`'${o}'`));l.push(\"''\");const f=n.floorInfo.floorField;return`${f} IN (${l.join(\", \")}) OR ${f} IS NULL`}return null}export{o as getFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/PooledArray.js\";import{create as e,set as r,area as s,expand as n,contains as o,containsPoint as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{noBudget as h}from\"../../../support/Scheduler.js\";const a=.05;class c{constructor(){this.extents=new t({allocator:t=>t||e()}),this.tempExtent=e(),this.dirty=!1}get empty(){return 0===this.extents.length}clear(){this.extents.clear()}add(t){this.contains(t)||(this.removeContained(t),r(this.extents.pushNew(),t),this.dirty=!0)}pop(){return this.dirty&&this.mergeTight(),this.extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=h){const e=this.extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let i=0;i<e.length;++i){if(t.done)return;const h=e.getItemAt(i);for(let t=i+1;t<e.length;++t){const r=e.getItemAt(t);if(r[0]>=h[2])break;o.add(r)}o.forEach((i=>{if(h===i)return;if(i[2]<=h[0])return void o.delete(i);const c=s(h),m=s(i),d=this.tempExtent;n(h,i,d);const g=c+m;(s(d)-g)/g<a&&(r(h,d),o.delete(i),e.remove(i),t.madeProgress())})),o.add(h)}}this.dirty=!1}contains(t){return this.extents.some((e=>o(e,t)))}removeContained(t){this.extents.filterInPlace((e=>!o(t,e)))}get test(){const t=this;return{containsPoint:e=>t.extents.some((t=>i(t,e)))}}}export{c as ExtentSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import{isSome as t}from\"../../../../core/maybe.js\";import\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import r from\"../../../../core/Accessor.js\";import a from\"../../../../core/Evented.js\";import n from\"../../../../core/Handles.js\";import{Task as o}from\"../../../support/Scheduler.js\";import{ExtentSet as h}from\"./ExtentSet.js\";let p=class extends r{constructor(){super(...arguments),this.dirtyExtents=new h,this.globalDirty=!1,this.dirtyGraphicsSet=new Set,this.handles=new n,this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new a}get updating(){return this.needsUpdate()}setup(e,t,i,s){this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on(\"elevation-change\",(e=>this._elevationChanged(e))),this.layerView.watch(\"suspended\",(()=>this.suspendedChange())),r.registerTask(o.ELEVATION_ALIGNMENT,(e=>this.update(e)),(()=>this.needsUpdate()))])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange(\"updating\")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange(\"updating\"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange(\"updating\")}needsUpdate(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}update(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((()=>this.dirtyExtents.merge(e)));this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange(\"updating\")}_updateDirtyGraphics(e){const i=this.layerView.view.renderCoordsHelper,s=this.graphicsCore.asyncUpdates;for(const r of this.dirtyGraphicsSet.keys()){const a=this.graphicsCore.getGraphics3DGraphicById(r);if(this.dirtyGraphicsSet.delete(r),t(a)&&(a.alignWithElevation(this.elevationProvider,i,s),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const i=this.dirtyExtents.pop(),s=this.elevationProvider.spatialReference;this.events.emit(\"invalidate-elevation\",{extent:i,spatialReference:s}),this.queryGraphicUIDsInExtent(i,s,(e=>{const i=this.graphicsCore.getGraphics3DGraphicById(e);t(i)&&i.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)})),e.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this.dirtyGraphicsSet.add(t)))}_elevationChanged(e){if(\"scene\"===e.context&&(!this.graphicsCore.layer.elevationInfo||\"relative-to-scene\"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.layerView.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange(\"updating\")}};e([i({readOnly:!0})],p.prototype,\"updating\",null),p=e([s(\"esri.views.3d.layers.graphics.Graphics3DElevationAlignment\")],p);var d=p;export default d;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import{isNone as r}from\"../../../../core/maybe.js\";import\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import a from\"../../../../core/Accessor.js\";import o from\"../../../../geometry/Extent.js\";import{featureGeometryTypeKebabDictionary as n}from\"../../../../geometry/support/typeUtils.js\";import\"../../../../geometry.js\";import i from\"../../../../tasks/support/FeatureSet.js\";import u from\"../../../../tasks/support/Query.js\";import y from\"../../../../layers/graphics/data/QueryEngine.js\";const c=y;let l=class extends a{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case\"multipoint\":case\"point\":case\"polygon\":case\"polyline\":return this.layer.geometryType;case\"mesh\":return\"polygon\";default:return}}get defaultQueryJSON(){return new u({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:o.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return r(e)?this.defaultQueryJSON:(\"outSpatialReference\"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=\"timeInfo\"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=n.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,o=this.task,i=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:y,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:y,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:i,objectIdField:r,featureStore:u,scheduler:a,task:o}),this._dataQueryEngineInstance}};e([t({constructOnly:!0})],l.prototype,\"layerView\",void 0),e([t({constructOnly:!0})],l.prototype,\"task\",void 0),e([t({readOnly:!0,aliasOf:\"layerView.view.spatialReference\"})],l.prototype,\"spatialReference\",void 0),e([t({readOnly:!0,aliasOf:\"layerView.layer\"})],l.prototype,\"layer\",void 0),e([t({readOnly:!0})],l.prototype,\"queryGeometryType\",null),e([t({readOnly:!0})],l.prototype,\"defaultQueryJSON\",null),l=e([s(\"esri.views.3d.layers.graphics.QueryEngine\")],l);var p=l;export default p;export{l as QueryEngine};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nfunction n(n,t,e){if(!e||null==t)return null;if(!n)return r(t,e);const o=n.get(e);return o?t[o.name]:null}function r(n,r){const t=r.toLowerCase();for(const e in n)if(e.toLowerCase()===t)return n[e];return null}export{n as attributeLookup};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import i from\"../../../../core/Accessor.js\";import r from\"../../../../core/Handles.js\";import{init as n}from\"../../../../core/watchUtils.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{Task as a}from\"../../../support/Scheduler.js\";import{FrustumExtentIntersection as l}from\"../../support/FrustumExtentIntersection.js\";const p=1.2;let u=class extends i{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new r,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new l({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,i=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),i.registerTask(a.FRUSTUM_VISIBILITY,(()=>this.update()),(()=>this.updating)),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([n(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),n(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(p-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}update(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([t({readOnly:!0})],u.prototype,\"suspended\",void 0),e([t({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([s(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var h=u;export default h;\n"],"sourceRoot":""}
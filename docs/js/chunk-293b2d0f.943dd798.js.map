{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/3d/layers/WMSLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/layers/WMSLayerView.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","webpack:///./node_modules/@arcgis/core/layers/support/ExportWMSImageParameters.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","webpack:///./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js"],"names":["p","this","layer","supportsSpatialReference","view","spatialReference","addResolvingPromise","Promise","reject","updatingHandles","add","exportImageParameters","addPromise","refreshDebounced","e","r","findExtentInfoAt","t","extent","s","o","imageSize","a","width","height","n","x","Math","round","xmin","y","ymax","timeExtent","prototype","i","createSquareGeometry","min","max","h","u","l","c","m","g","w","Float64Array","d","Float32Array","f","Uint32Array","M","v","b","length","size","data","exclusive","getLogger","T","super","arguments","drapeSourceType","fullExtentInLocalViewSpatialReference","maximumDataResolution","_images","Array","_extents","_overlayExtents","updateWhenStationary","then","_set","_suspendedChangeHandler","handles","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","viewingMode","basemapTerrain","forEach","_updateImageExtent","clear","resolution","renderLocalOrigin","pixelRatio","_clippedExtent","H","imageMaxWidth","imageMaxHeight","floor","_imageSizeDiffers","suspended","_fetch","catch","error","_clearImage","push","canResume","minScale","maxScale","scale","some","loadingPromise","HTMLImageElement","HTMLCanvasElement","image","contains","_createStageObjects","TESTS_DISABLE_UPDATE_THRESHOLDS","abs","texture","material","rendergeometry","loadingAbortController","pixelData","renderExtent","abort","signal","_waitFetchReady","requestAsImageElement","getFetchOptions","timestamp","refreshTimestamp","fetchImage","warnOnce","processResult","_stage","overlayManager","renderer","removeGeometries","remove","preMultiplyAlpha","wrap","transparent","textureId","id","setParameterValues","console","origin","addGeometries","ready","refresh","readOnly","O","destroy","commitProperty","_get","popupEnabled","createFetchPopupFeaturesQuery","resolve","fetchFeatureInfo","shader","get","configuration","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","OITEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","rctx","generateSource","bindProjectionMatrix","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","bindView","bindUniformsWithOrigin","face","mode","blending","S","culling","cullFace","depthTest","func","depthWrite","writeDepth","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","enableOffset","_occludeePipelineState","setPipelineState","pipeline","count","supportsEdges","techniqueConfig","params","relativeElevation","updateParameters","updateTexture","technique","techniqueRep","acquireAndReleaseExisting","getTechniqueConfig","hasOccludees","_updateOccludeeState","bindProgram","bindTexture","bindTextureScale","bindPass","getPipelineState","initTextureTransparent","visible","sublayers","on","propertyName","visibleSublayers","filter","name","map","join","unshift","layers","imageFormat","imageTransparency","version","format","request","service","styles","type","Number","fullExtent","equals","clone","state","isLocal","portalItem","destroyed","include","linearDepth","vertex","uniforms","attributes","varyings","code","fragment","float","Object","freeze","__proto__"],"mappings":"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","file":"js/chunk-293b2d0f.943dd798.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import i from\"../../../geometry/Extent.js\";import{WMSLayerView as o}from\"../../layers/WMSLayerView.js\";import a from\"./DynamicLayerView3D.js\";let p=class extends(o(a)){initialize(){this.layer.supportsSpatialReference(this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new s(\"layerview:spatial-reference-incompatible\",\"The spatial references supported by this WMS layer are incompatible with the spatial reference of the view\"))),this.updatingHandles.add(this.exportImageParameters,\"version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())}))}createFetchPopupFeaturesQuery(e){const r=this.findExtentInfoAt(e),t=r.extent,s=new i(t[0],t[1],t[2],t[3],r.spatialReference),o=r.imageSize,a=o.width,p=o.height,n=s.width/a;return{extent:s,width:a,height:p,x:Math.round((e.x-s.xmin)/n),y:Math.round((s.ymax-e.y)/n)}}getFetchOptions(){return{timeExtent:this.timeExtent}}};e([r()],p.prototype,\"suspended\",void 0),p=e([t(\"esri.views.3d.layers.WMSLayerView3D\")],p);var n=p;export default n;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import o from\"../../webgl-engine/lib/GeometryUtil.js\";function r(n,i,o){const r=t(n)/e(n),a={width:o,height:o};return r>1.0001?a.height=o/r:r<.9999&&(a.width=o*r),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t,e){const n=[[t[0],t[1],e],[t[2],t[1],e],[t[2],t[3],e],[t[0],t[3],e]];return o.createSquareGeometry(n)}function h(t,e,o){if(!n(t,e))return a(e,o);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],h=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],u=e[2]-e[0],l=e[3]-e[1],c=h[0]>0&&h[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,g=(m+1)*(c+1),w=new Float64Array(3*g),d=new Float32Array(2*g),f=new Uint32Array(6*(m*c-1));let p=0,y=0,x=0,M=0,v=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=h[r];t<=0||(w[y++]=e[0]+i,w[y++]=e[1]+p,w[y++]=o,d[x++]=i/u,d[x++]=p/l,r<3&&n<3&&(1!==r||1!==n)&&(f[v++]=M,f[v++]=M+1,f[v++]=M+c+1,f[v++]=M+1,f[v++]=M+c+2,f[v++]=M+c+1),M++,i+=t)}p+=t}const b=new Uint32Array(f.length);return new i([[\"position\",{size:3,data:w,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:d,exclusive:!0}]],[[\"position\",f],[\"normal\",b],[\"uv0\",f]])}const s=[0,0,1];export{r as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as a,eachAlways as s,createAbortController as n,onAbort as o,isAborted as l,createAbortError as h,always as m,throwIfAborted as d}from\"../../../core/promiseUtils.js\";import c from\"../../../geometry/Extent.js\";import{forEach as g}from\"../../../core/asyncUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{create as p,equals as y,width as f,height as x,set as w,intersection as _}from\"../../../geometry/support/aaBoundingRect.js\";import{RefreshableLayerView as v}from\"../../layers/RefreshableLayerView.js\";import R from\"../support/debugFlags.js\";import{RenderGeometry as S}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as b}from\"../webgl-engine/lib/Texture.js\";import{LayerView3D as E}from\"./LayerView3D.js\";import j from\"../../layers/LayerView.js\";import{ImageMaterial as I}from\"../webgl-engine/materials/ImageMaterial.js\";import{computeImageExportSize as L,createGeometryForExtent as A,createOuterImageGeometry as C}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as D}from\"./support/projectExtentUtils.js\";const M=t.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let T=class extends(v(E(j))){constructor(){super(...arguments),this.drapeSourceType=0,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlayExtents=new Array,this.updateWhenStationary=!0}initialize(){this.addResolvingPromise(D(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\"))),\"local\"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,\"extent\",(()=>this._overlayExtents.forEach(((e,t)=>this._updateImageExtent(t)))))}destroy(){this.clear()}setDrapingExtent(e,t,i,r,a,s){this._overlayExtents[e]={extent:p(t),spatialReference:i,resolution:r,renderLocalOrigin:a,pixelRatio:s},this._updateImageExtent(e)}_updateImageExtent(e){const t=this._overlayExtents[e],i=this._clippedExtent(t.extent,H),r=L(t.extent,i,t.resolution);let s=t.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(r.width>e){const t=e/r.width;r.height=Math.floor(r.height*t),r.width=e,s*=t}if(r.height>t){const e=t/r.height;r.width=Math.floor(r.width*e),r.height=t,s*=e}}const n=this._extents[e];n&&y(n.extent,i)&&!this._imageSizeDiffers(i,n.imageSize,r)||(this._extents[e]={extent:p(i),spatialReference:t.spatialReference,imageSize:r,pixelRatio:s},this.suspended||this._fetch(e).catch((e=>{a(e)||M.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await s(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new c(i[0],i[1],i[2],i[3],t.spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,t){await g(this._images,(async(i,r)=>{i&&(await e(i,t),this._createStageObjects(r,i.image))}))}_imageSizeDiffers(e,t,i){if(!this.maximumDataResolution)return!0;if(R.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=f(e)/this.maximumDataResolution.x,a=x(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h>1.5||m>1.5}async _fetch(e,t){if(this.suspended)return;const i=this._overlayExtents[e],r=this._extents[e],s=r.extent,d=new c(s[0],s[1],s[2],s[3],r.spatialReference);this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:p(s)});const g=this._images[e];if(g.loadingAbortController&&(g.loadingAbortController.abort(),g.loadingAbortController=null),0===d.width||0===d.height)return void this._clearImage(e);const u=n();g.loadingAbortController=u,o(t,(()=>u.abort()));const y=u.signal,f=this._waitFetchReady(y).then((()=>{const e={requestAsImageElement:!0,pixelRatio:i.pixelRatio,...this.getFetchOptions(),signal:y},{height:t,width:a}=r.imageSize;return e.timestamp=this.refreshTimestamp,this.layer.fetchImage(d,a,t,e)})).then((e=>{if(l(y))throw M.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),h();return this.processResult(g,e)}));g.loadingPromise=f,m(f,(()=>{f===g.loadingPromise&&(g.loadingPromise=null,g.loadingAbortController=null)}));const x=f.then((()=>{w(g.renderExtent,s),this._createStageObjects(e,g.image),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!a(e)&&M.error(e),this.notifyChange(\"updating\"),e}));this.notifyChange(\"updating\"),await x}_clearImage(e){const t=this._images[e],i=this.view._stage;t&&(t.rendergeometry&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.rendergeometry],this,2),t.rendergeometry=null),t.texture&&(i.remove(t.texture),t.texture=null),t.material&&(i.remove(t.material),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)}_createStageObjects(e,t){const i=this.view._stage,r=this._images[e];r.texture&&(i.remove(r.texture),r.texture=null),t?(r.texture=new b(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),i.add(r.texture)):r.material&&(i.remove(r.material),r.material=null),!r.material&&r.texture?(r.material=new I({transparent:!0,textureId:r.texture.id}),i.add(r.material)):r.material&&t&&r.material.setParameterValues({textureId:r.texture.id});const a=this.view.basemapTerrain.overlayManager.renderer;if(r.material){const t=-1;let i;const s=this._overlayExtents[e].renderLocalOrigin;if(0===e)i=A(r.renderExtent,t);else{if(1!==e)return void console.error(\"DynamicLayerView3D._createStageObjects: Invalid extent idx\");{const e=this._extents[0].extent;if(!e)return;i=C(e,r.renderExtent,t)}}const n=new S(i,r.material);n.origin=s,a.addGeometries([n],this,2),r.rendergeometry&&a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=n}else r.rendergeometry&&(a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=null)}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return w(t,e);const i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?_(e,r,t):w(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refresh()}async _waitFetchReady(e){this.updateWhenStationary&&await u(this.view,\"stationary\",e),d(e)}};e([i()],T.prototype,\"layer\",void 0),e([i()],T.prototype,\"suspended\",void 0),e([i({readOnly:!0})],T.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([i()],T.prototype,\"updating\",void 0),T=e([r(\"esri.views.3d.layers.DynamicLayerView3D\")],T);const H=p();var O=T;export default O;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{combinedViewLayerTimeExtentProperty as s}from\"../../layers/support/commonProperties.js\";import{ExportWMSImageParameters as p}from\"../../layers/support/ExportWMSImageParameters.js\";const i=i=>{let a=class extends i{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}fetchPopupFeatures(e){const{layer:r}=this;if(!e)return Promise.reject(new o(\"wmslayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:r}));const{popupEnabled:t}=r;if(!t)return Promise.reject(new o(\"wmslayerview:fetchPopupFeatures\",\"popupEnabled should be true\",{popupEnabled:t}));const s=this.createFetchPopupFeaturesQuery(e);if(!s)return Promise.resolve([]);const{extent:p,width:i,height:a,x:m,y:n}=s;if(!(p&&i&&a))throw new o(\"wmslayerview:fetchPopupFeatures\",\"WMSLayer does not support fetching features.\",{extent:p,width:i,height:a});const u=r.fetchFeatureInfo(p,i,a,m,n);return Promise.resolve(u?[u]:[])}};return e([r()],a.prototype,\"exportImageParameters\",void 0),e([r({readOnly:!0})],a.prototype,\"exportImageVersion\",null),e([r()],a.prototype,\"layer\",void 0),e([r(s)],a.prototype,\"timeExtent\",void 0),a=e([t(\"esri.layers.mixins.WMSLayerView\")],a),a};export default i;export{i as WMSLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{ReloadableShaderModule as t}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as r}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as i,parameter as s}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as a}from\"../lib/DefaultVertexAttributeLocations.js\";import o from\"../../../webgl/Program.js\";import{makePipelineState as n,defaultDepthWriteParams as l,defaultColorWriteParams as p,simpleBlendingParams as c}from\"../../../webgl/renderState.js\";import{View as u}from\"../core/shaderLibrary/util/View.glsl.js\";import{Slice as d}from\"../core/shaderLibrary/Slice.glsl.js\";import{OITBlending as h,OITDepthTest as m,OITDepthWrite as f,getOITPolygonOffset as b}from\"../lib/OrderIndependentTransparency.js\";import{bindMultipassTerrainUniforms as g}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{stencilWriteMaskOn as y,stencilToolMaskBaseParams as P,stencilBaseAllZerosParams as T}from\"../lib/StencilUtils.js\";import{I as v}from\"../../../../chunks/ImageMaterial.glsl.js\";class j extends r{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new o(e.rctx,i.generateSource(\"vertex\"),i.generateSource(\"fragment\"),a)}bindPass(e,t,r){u.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",t.opacity),r.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",r.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",r.inverseViewport),g(this.program,e,r))}bindDraw(e){u.bindView(this.program,e),d.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e,a=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return n({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?S:h(e),culling:a(r.cullFace),depthTest:{func:m(e)},depthWrite:i?r.writeDepth&&l:f(e),colorWrite:p,stencilWrite:r.sceneHasOcludees?y:null,stencilTest:r.sceneHasOcludees?t?P:T:null,polygonOffset:i||s?null:b(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}j.shader=new t(v,(()=>import(\"./ImageMaterial.glsl.js\")));const S=c(1,771);class w extends i{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}e([s({count:8})],w.prototype,\"output\",void 0),e([s({count:3})],w.prototype,\"cullFace\",void 0),e([s()],w.prototype,\"slicePlaneEnabled\",void 0),e([s()],w.prototype,\"transparent\",void 0),e([s()],w.prototype,\"enableOffset\",void 0),e([s()],w.prototype,\"writeDepth\",void 0),e([s()],w.prototype,\"sceneHasOcludees\",void 0),e([s({count:4})],w.prototype,\"transparencyPassType\",void 0),e([s()],w.prototype,\"multipassTerrainEnabled\",void 0),e([s()],w.prototype,\"cullAboveGround\",void 0);export{j as ImageMaterialTechnique,w as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport e from\"../lib/GLMaterialTexture.js\";import{intersectTriangleGeometry as t}from\"./internal/MaterialUtil.js\";import{Material as i,materialParametersDefaults as a}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as r,PositionUVLayout as n}from\"./internal/DefaultBufferWriter.js\";import{ImageMaterialTechniqueConfiguration as u,ImageMaterialTechnique as h}from\"../shaders/ImageMaterialTechnique.js\";class c extends i{constructor(e){super(e,o),this.supportsEdges=!0,this.techniqueConfig=new u}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,i,a,s,r,n,u){t(e,i,s,r,n,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new r(n)}}class l extends e{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(h,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(4===this.output)return 3===e;return e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const o={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...a};export{c as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import t from\"../../core/Accessor.js\";import{HandleOwnerMixin as o}from\"../../core/HandleOwner.js\";const a={visible:\"visibleSublayers\"};let l=class extends(o(t)){constructor(e){super(e),this.scale=0}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.sublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"wms-sublayer-update\",(e=>this.notifyChange(a[e.propertyName])))],\"layer\"))}get layers(){const{visibleSublayers:e}=this;return e.filter((e=>e.name)).map((e=>e.name)).join(\",\")}get version(){this.commitProperty(\"layers\");const e=this.layer;return e&&e.commitProperty(\"imageTransparency\"),(this._get(\"version\")||0)+1}get visibleSublayers(){const{layer:e,scale:r}=this,s=null==e?void 0:e.sublayers,t=[],o=e=>{const{minScale:s,maxScale:a,sublayers:l,visible:i}=e;i&&(0===r||(0===s||r<=s)&&(0===a||r>=a))&&(l?l.forEach(o):t.unshift(e))};return null==s||s.forEach(o),t}toJSON(){const{layer:e,layers:r}=this,{imageFormat:s,imageTransparency:t,version:o}=e;return{format:s,request:\"GetMap\",service:\"WMS\",styles:\"\",transparent:t,version:o,layers:r}}};e([r()],l.prototype,\"layer\",null),e([r({readOnly:!0})],l.prototype,\"layers\",null),e([r({type:Number})],l.prototype,\"scale\",void 0),e([r({readOnly:!0})],l.prototype,\"version\",null),e([r({readOnly:!0})],l.prototype,\"visibleSublayers\",null),l=e([s(\"esri.layers.support.ExportWMSImageParameters\")],l);export{l as ExportWMSImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{canProject as e,project as r}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as o}from\"../../../../portal/support/geometryServiceUtils.js\";function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;return i?i.equals(l)?Promise.resolve(s.clone()):e(i,l)?Promise.resolve(r(s,l)):t.view.state.isLocal?o(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null):Promise.resolve(null)}export{t as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ShaderBuilder as a}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";import{ColorConversion as o}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{Slice as i}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{ReadLinearDepth as d}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{defaultMaskAlphaCutoff as t}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{multipassTerrainTest as l}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";function s(s){const n=new a;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(e`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(i,s),s.multipassTerrainEnabled&&(n.fragment.include(d),n.include(l,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(e`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${e.float(t)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(o),n.fragment.code.add(e`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${e.float(t)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n"],"sourceRoot":""}
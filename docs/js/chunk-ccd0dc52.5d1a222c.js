(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ccd0dc52"],{"19db":function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return k})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return C})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return h})),i.d(t,"i",(function(){return f}));var r=i("fa8a"),n=i("b2b2"),s=i("3e27"),a=i("9dee");const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const l=180/Math.PI,c=5,h=new r["a"]({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function u(e,t){return o.get(e)/o.get(t)||1}function d(e){return(450-e)%360}function f(e,t="geographic"){const[i,r]=e,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i)*l;return s=(360+s)%360,"geographic"===t&&(s=d(s)),[n,s]}function p(e,t="geographic"){let i=e[1];"geographic"===t&&(i=d(i)),i%=360;const r=e[0];return[r*Math.cos(i/l),r*Math.sin(i/l)]}function y(e,t,i="geographic",r=1){if(!Object(a["i"])(e))return e;const{pixels:n,width:o,height:l}=e,c=o*l,h=n[0],u=n[1],d=s["a"].createEmptyBand(e.pixelType,c),y=s["a"].createEmptyBand(e.pixelType,c);let m=0;for(let s=0;s<l;s++)for(let e=0;e<o;e++)"vector-uv"===t?([d[m],y[m]]=f([h[m],u[m]],i),d[m]*=r):([d[m],y[m]]=p([h[m],u[m]],i),d[m]*=r,y[m]*=r),m++;const b=new s["a"]({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[d,y]});return b.updateStatistics(),b}function m(e,t,i=1){if(1===i||!Object(a["i"])(e))return e;const r=e.clone(),{pixels:n,width:s,height:o}=r,l=n[0],c=n[1];let h=0;for(let a=0;a<o;a++)for(let e=0;e<s;e++)"vector-uv"===t?(l[h]*=i,c[h]*=i):l[h]*=i,h++;return r.updateStatistics(),r}function b(e,t,i,r,s){if(!Object(n["l"])(s)||!s.spatialReference.equals(e.spatialReference))return{extent:e,width:t,height:i,resolution:e.width/t};const a=s.xmin,o=s.ymax;r=Math.max(r||0,30);const l=Math.ceil(t*(1/r)),c=Math.ceil(i*(1/r)),h=((e.xmax-e.xmin)/l+(e.ymax-e.ymin)/c)/2;return e.xmin=a+Math.floor((e.xmin-a)/h)*h,e.xmax=a+Math.ceil((e.xmax-a)/h)*h,e.ymin=o+Math.floor((e.ymin-o)/h)*h,e.ymax=o+Math.ceil((e.ymax-o)/h)*h,{extent:e,width:Math.round(e.width/h),height:Math.round(e.height/h),resolution:h}}const g=x(0,0,0);function x(e=0,t=0,i=Math.PI,r=!0){r&&(i=(2*Math.PI-i)%(2*Math.PI));const n=r?-1:1,s=13*n,a=-7*n,o=-2*n,l=-16*n,c=29,[h,u]=w(0,t+s,i,c),[d,f]=w(e-5.5,t+a,i,c),[p,y]=w(e+5.5,t+a,i,c),[m,b]=w(e-1.5,t+o,i,c),[g,x]=w(e+1.5,t+o,i,c),[v,_]=w(e-1.5,t+l,i,c),[O,j]=w(e+1.5,t+l,i,c);return[h,u,d,f,m,b,g,x,p,y,v,_,O,j]}function v(e=0,t=Math.PI,i=!0){i&&(t=(2*Math.PI-t)%(2*Math.PI));const r=10,n=i?-1:1,s=5*n,a=20*n,o=25*n,l=45,h=0,u=0,d=2,f=0,p=d*n;let[y,m]=[h+r/2,u-a],[b,g]=[y+d,m],[x,v]=[b-f,g+p],[_,O]=[h-r/2,u-o],[j,R]=[_+f,O-p],P=Math.ceil(e/c),M=Math.floor(P/10);P-=8*M;const S=[],I=[];for(let c=0;c<P/2;c++,M--){M<=0&&P%2==1&&c===(P-1)/2&&(_=h,j=_+f,O=(O+m)/2,R=O-p);const[e,i]=w(_,O,t,l);if(M>0){const[r,n]=w(b,O,t,l),[s,a]=w(y,m,t,l);S.push(r),S.push(n),S.push(e),S.push(i),S.push(s),S.push(a)}else{const[r,n]=w(b,g,t,l),[s,a]=w(x,v,t,l),[o,c]=w(j,R,t,l);I.push(e),I.push(i),I.push(o),I.push(c),I.push(s),I.push(a),I.push(r),I.push(n)}O+=s,m+=s,g+=s,v+=s,R+=s}const[T,k]=w(h+r/2,u+a,t,l),C=r/2+d,[V,z]=w(h+C,u+a,t,l),[D,F]=w(h+r/2,u-o,t,l),[U,L]=w(h+C,u-o,t,l);return{pennants:S,barbs:I,shaft:[T,k,V,z,D,F,U,L]}}function w(e,t,i,r=1){const n=Math.sqrt(e*e+t*t)/r,s=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[n,(2*Math.PI+s-i)%(2*Math.PI)]}const _=[0,1,3,6,10,16,21,27,33,40,47,55,63],O=[0,.5,1,1.5,2],j=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function R(e,t,i,r){const n=u(r||"knots",i);let s;for(s=1;s<t.length;s++)if(s===t.length-1){if(e<t[s]*n)break}else if(e<=t[s]*n)break;return Math.min(s-1,t.length-2)}function P(e,t,i,r,n){let s=0;switch(t){case"beaufort_kn":s=R(e,_,"knots",i);break;case"beaufort_km":s=R(e,_,"kilometer-per-hour",i);break;case"beaufort_ft":s=R(e,_,"feet-per-second",i);break;case"beaufort_m":s=R(e,_,"meter-per-second",i);break;case"classified_arrow":s=R(e,n,r,i);break;case"ocean_current_m":s=R(e,O,"meter-per-second",i);break;case"ocean_current_kn":s=R(e,j,"knots",i)}return s}function M(e,t){const{style:i,inputUnit:r,outputUnit:n,breakValues:s}=t,a=h.fromJSON(r),o=h.fromJSON(n),l=42,c=15;let u=0,d=0;const{width:f,height:p,mask:y}=e,m=e.pixels[0],b=e.pixels[1],x=y?y.filter(e=>e>0).length:f*p,v=new Float32Array(x*l),w=new Uint32Array(c*x);for(let h=0;h<p;h++)for(let e=0;e<f;e++){const t=h*f+e;if(!y||y[h*f+e]){var _;const r=null!=(_=(b[t]+360)%360/180*Math.PI)?_:2*Math.PI*Math.random(),n=P(m[t],i,a,o,s);for(let i=0;i<g.length;i+=2)v[u++]=(e+.5)/f,v[u++]=(h+.5)/p,v[u++]=g[i],v[u++]=g[i+1]+r,v[u++]=n,v[u++]=m[t];const c=7*(u/l-1);w[d++]=c,w[d++]=c+1,w[d++]=c+2,w[d++]=c+0,w[d++]=c+4,w[d++]=c+3,w[d++]=c+0,w[d++]=c+2,w[d++]=c+3,w[d++]=c+2,w[d++]=c+5,w[d++]=c+3,w[d++]=c+5,w[d++]=c+6,w[d++]=c+3}}return{vertexData:v,indexData:w}}const S=[];function I(e,t){if(0===S.length)for(let c=0;c<30;c++)S.push(v(5*c,0));const i=u(h.fromJSON(t.inputUnit),"knots"),{width:r,height:n,mask:s}=e,a=e.pixels[0],o=e.pixels[1],l=6,d=[],f=[];let p=0,y=0;for(let h=0;h<n;h++)for(let e=0;e<r;e++){const t=h*r+e,u=a[t]*i;if((!s||s[h*r+e])&&u>=c){var m;const i=null!=(m=(o[t]+360)%360/180*Math.PI)?m:2*Math.PI*Math.random(),{pennants:s,barbs:a,shaft:c}=S[Math.min(Math.floor(u/5),29)];if(s.length+a.length===0)continue;let b=d.length/l;const g=(e+.5)/r,x=(h+.5)/n;for(let e=0;e<s.length;e+=2)d[p++]=g,d[p++]=x,d[p++]=s[e],d[p++]=s[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<a.length;e+=2)d[p++]=g,d[p++]=x,d[p++]=a[e],d[p++]=a[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<c.length;e+=2)d[p++]=g,d[p++]=x,d[p++]=c[e],d[p++]=c[e+1]+i,d[p++]=0,d[p++]=u;for(let e=0;e<s.length/6;e++)f[y++]=b,f[y++]=b+1,f[y++]=b+2,b+=3;for(let e=0;e<a.length/8;e++)f[y++]=b,f[y++]=b+1,f[y++]=b+2,f[y++]=b+1,f[y++]=b+2,f[y++]=b+3,b+=4;f[y++]=b+0,f[y++]=b+1,f[y++]=b+2,f[y++]=b+1,f[y++]=b+3,f[y++]=b+2,b+=4}}return{vertexData:new Float32Array(d),indexData:new Uint32Array(f)}}function T(e,t){const i=24;let r=0,n=0;const{width:s,height:a,mask:o}=e,l=e.pixels[0],h=[],u=[],d="wind_speed"===t.style?c:Number.MAX_VALUE;for(let c=0;c<a;c++)for(let e=0;e<s;e++){const t=c*s+e;if((!o||o[c*s+e])&&l[t]<d){for(let i=0;i<4;i++)h[r++]=(e+.5)/s,h[r++]=(c+.5)/a,h[r++]=i<2?-.5:.5,h[r++]=i%2==0?-.5:.5,h[r++]=0,h[r++]=l[t];const o=4*(r/i-1);u[n++]=o,u[n++]=o+1,u[n++]=o+2,u[n++]=o+1,u[n++]=o+2,u[n++]=o+3}}return{vertexData:new Float32Array(h),indexData:new Uint32Array(u)}}function k(e,t){return"simple_scalar"===t.style?T(e,t):"wind_speed"===t.style?I(e,t):M(e,t)}function C(e,t,i,r=[0,0],n=.5){const{width:a,height:o,mask:l}=e,[c,h]=e.pixels,[u,d]=r,y=Math.round((a-u)/i),m=Math.round((o-d)/i),b=y*m,g=new Float32Array(b),x=new Float32Array(b),v=new Uint8Array(b),w="vector-uv"===t;for(let s=0;s<m;s++)for(let e=0;e<y;e++){let t=0;const r=s*y+e,m=Math.max(0,s*i+d),b=Math.max(0,e*i+u),_=Math.min(o,m+i),O=Math.min(a,b+i);for(let e=m;e<_;e++)for(let i=b;i<O;i++){const n=e*a+i;if(!l||l[n]){t++;const e=w?[c[n],h[n]]:[c[n],(360+h[n])%360],[i,s]=w?e:p(e);g[r]+=i,x[r]+=s}}if(t>=(_-m)*(O-b)*(1-n)){v[r]=1;const[e,i]=f([g[r]/t,x[r]/t]);g[r]=e,x[r]=i}else v[r]=0,g[r]=0,x[r]=0}const _=new s["a"]({width:y,height:m,pixels:[g,x],mask:v});return _.updateStatistics(),_}},"218c":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return b}));i("e06a");var r=i("b2b2");class n{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.refCount--,e.refCount<=0&&(r.delete(i),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.ts=Date.now(),e.refCount++,r.delete(i),r.set(i,e),e.block}return null}putBlock(e,t,i,r=null){const n=this._cachedBlocks,s=e+"/"+t;if(n.has(s)){const e=n.get(s);e.ts=Date.now(),e.refCount++}else n.set(s,{block:i,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}deleteBlock(e,t){const i=this._cachedBlocks,r=e+"/"+t;i.has(r)&&i.delete(r)}updateMaxSize(e){this._size=e,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval(()=>{const t=Array.from(e),i=Date.now();for(let r=0;r<t.length&&t[r][1].ts<=i-this._duration;r++)e.delete(t[r][0]);0===e.size&&this.clearTimer()},this._interval)}trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let i=0;i<t.length-this._size;i++)e.delete(t[i][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}var s=i("b4e0"),a=i("4ae5");const o=new Map,l=new n;function c(e,t){return null==t?e:`${e}?sliceId=${t}`}function h(e,t){const i={extent:null,rasterInfo:t,cache:new Map};if(o.has(e)){const t=o.get(e);return t.push(i),t.length-1}return o.set(e,[i]),0}function u(e,t){if(o.has(e)){const i=o.get(e);i[t]=null,i.some(e=>null!=e)||o.delete(e)}}function d(e,t,i){if(!o.has(e))return null==t?l.decreaseRefCount(e,i):0;const r=o.get(e);if(null==r[t])return l.decreaseRefCount(e,i);const n=r[t].cache;if(n.has(i)){const e=n.get(i);if(e.refCount--,0===e.refCount){n.delete(i);for(let e=0;e<r.length;e++)r[e]&&r[e].cache.has(i)&&r[e].cache.delete(i);e.controller&&e.controller.abort()}return e.refCount}return 0}function f(e,t,i){if(!o.has(e))return null==t?l.getBlock(e,i):null;const r=o.get(e);if(null==r[t]){for(let e=0;e<r.length;e++)if(r[e]&&r[e].cache.has(i)){const t=r[e].cache.get(i);return t.refCount++,t.block}return l.getBlock(e,i)}const n=r[t].cache;if(n.has(i)){const e=n.get(i);return e.refCount++,e.block}for(let s=0;s<r.length;s++)if(s!==t&&r[s]&&r[s]&&r[s].cache.has(i)){const e=r[s].cache.get(i);return e.refCount++,n.set(i,e),e.block}return null}function p(e,t,i,r,n=null){if(!o.has(e))return void(null==t&&l.putBlock(e,i,r,n));const s=o.get(e);if(null==s[t])return void l.putBlock(e,i,r,n);const a={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:n};r.then(()=>a.isResolved=!0).catch(()=>a.isRejected=!0),s[t].cache.set(i,a)}function y(e,t,i){if(!o.has(e))return void(null==t&&l.deleteBlock(e,i));const r=o.get(e);null!=r[t]?r[t].cache.delete(i):l.deleteBlock(e,i)}function m(e,t){if(!o.has(e))return null;const i=o.get(e);return null==i[t]?null:i[t]}function b(e,t,i,n,o,l,c=null){const h=m(e,t),u=h.extent,{cache:d,rasterInfo:f}=h;if(u&&u.xmin===i.xmin&&u.xmax===i.xmax&&u.ymin===i.ymin&&u.ymax===i.ymax)return;const p=i.clone().normalize(),{spatialReference:y,transform:b}=f,g=new Set;for(let m=0;m<p.length;m++){const e=p[m];if(e.xmax-e.xmin<=n||e.ymax-e.ymin<=n)continue;let t=Object(s["h"])(e,y,c);Object(r["l"])(b)&&(t=b.inverseTransform(t));const i=new a["a"]({x:n,y:n,spatialReference:e.spatialReference});if(null==o&&!(o=Object(s["j"])(i,y,e,c)))return;const{pyramidLevel:h,pyramidResolution:u,excessiveReading:d}=Object(s["m"])(o,f,l||"closest");if(d)return;const{storageInfo:x}=f,{origin:v}=x,w={x:Math.max(0,Math.floor((t.xmin-v.x)/u.x)),y:Math.max(0,Math.floor((v.y-t.ymax)/u.y))},_=Math.ceil((t.xmax-t.xmin)/u.x-.1),O=Math.ceil((t.ymax-t.ymin)/u.y-.1),j=h>0?x.pyramidBlockWidth:x.blockWidth,R=h>0?x.pyramidBlockHeight:x.blockHeight,P=1,M=Math.max(0,Math.floor(w.x/j)-P),S=Math.max(0,Math.floor(w.y/R)-P),I=Math.floor((w.x+_-1)/j)+P,T=Math.floor((w.y+O-1)/R)+P;for(let r=S;r<=T;r++)for(let e=M;e<=I;e++)g.add(`${h}/${r}/${e}`)}d.forEach((e,t)=>{if(!g.has(t)){const e=d.get(t);(null==e||e.isResolved||e.isRejected)&&d.delete(t)}}),h.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}},2616:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return v}));i("e06a");var r=i("e92d"),n=i("38a4"),s=i("b2b2"),a=i("f4cc"),o=i("880d"),l=i("7f83"),c=i("3af1");const h=r["a"].getLogger("esri.views.2d.engine.flow.dataUtils"),u=8;async function d(e,t,i){const r=performance.now(),n=f(e,t),s=performance.now(),o=y(e,n,t.width,t.height),l=performance.now(),c=b(o,!0),u=performance.now(),d=g(c),p=performance.now();if(e.profile){const e={"_createFlowFieldFromData()":Math.round(s-r),"_getStreamlines()":Math.round(l-s),"createAnimatedLinesData()":Math.round(u-l),"createLinesMesh()":Math.round(p-u),"Total elapsed time":Math.round(p-r)};h.info("createStreamlinesMesh profile",e)}return await Promise.resolve(),Object(a["w"])(i),d}function f(e,t){const i=m(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,r)=>{const n=Math.floor(e),s=Math.floor(r);if(n<0||n>=t.width)return[0,0];if(s<0||s>=t.height)return[0,0];const a=e-n,o=r-s,l=n,c=s,h=n<t.width-1?n+1:n,u=s<t.height-1?s+1:s,d=i[2*(c*t.width+l)],f=i[2*(c*t.width+h)],p=i[2*(u*t.width+l)],y=i[2*(u*t.width+h)],m=i[2*(c*t.width+l)+1],b=i[2*(c*t.width+h)+1];return[(d*(1-o)+p*o)*(1-a)+(f*(1-o)+y*o)*a,(m*(1-o)+i[2*(u*t.width+l)+1]*o)*(1-a)+(b*(1-o)+i[2*(u*t.width+h)+1]*o)*a]}:(e,r)=>{const n=Math.round(e),s=Math.round(r);return n<0||n>=t.width||s<0||s>=t.height?[0,0]:[i[2*(s*t.width+n)+0],i[2*(s*t.width+n)+1]]}}function p(e,t,i,r,n,s,a,o,l){const c=[];let h,u,d=i,f=r,p=0;c.push({x:d,y:f,t:p});for(let y=0;y<e.verticesPerLine;y++){let[i,r]=t(d,f);i*=e.velocityScale,r*=e.velocityScale;const y=Math.sqrt(i*i+r*r);if(y<e.minSpeedThreshold)return c;const m=i/y,b=r/y;if(d+=m*e.segmentLength,f+=b*e.segmentLength,p+=e.segmentLength/y,Math.acos(m*h+b*u)>e.maxTurnAngle)return c;if(e.mergeLines){const e=Math.round(d*l),t=Math.round(f*l);if(e<0||e>a-1||t<0||t>o-1)return c;const i=s[t*a+e];if(-1!==i&&i!==n)return c;s[t*a+e]=n}c.push({x:d,y:f,t:p}),h=m,u=b}return c}function y(e,t,i,r){const n=[],s=new o["a"],a=1/Math.max(e.lineCollisionWidth,1),l=Math.round(i*a),c=Math.round(r*a),h=new Int32Array(l*c);for(let o=0;o<h.length;o++)h[o]=-1;const u=[];for(let o=0;o<r;o+=e.lineSpacing)for(let t=0;t<i;t+=e.lineSpacing)u.push({x:t,y:o,sort:s.getFloat()});u.sort((e,t)=>e.sort-t.sort);for(const{x:o,y:d}of u)if(s.getFloat()<e.density){const i=p(e,t,o,d,n.length,h,l,c,a);if(i.length<2)continue;n.push(i)}return n}function m(e,t,i,r){if(0===r)return e;const n=Math.round(3*r),s=new Array(2*n+1);let a=0;for(let c=-n;c<=n;c++){const e=Math.exp(-c*c/(r*r));s[c+n]=e,a+=e}for(let c=-n;c<=n;c++)s[c+n]/=a;const o=new Float32Array(e.length);for(let c=0;c<i;c++)for(let i=0;i<t;i++){let r=0,a=0;for(let o=-n;o<=n;o++){if(i+o<0||i+o>=t)continue;const l=s[o+n];r+=l*e[2*(c*t+(i+o))+0],a+=l*e[2*(c*t+(i+o))+1]}o[2*(c*t+i)+0]=r,o[2*(c*t+i)+1]=a}const l=new Float32Array(e.length);for(let c=0;c<t;c++)for(let e=0;e<i;e++){let r=0,a=0;for(let l=-n;l<=n;l++){if(e+l<0||e+l>=i)continue;const h=s[l+n];r+=h*o[2*((e+l)*t+c)+0],a+=h*o[2*((e+l)*t+c)+1]}l[2*(e*t+c)+0]=r,l[2*(e*t+c)+1]=a}return l}function b(e,t){const i=new o["a"],r=e.reduce((e,t)=>e+t.length,0),n=new Float32Array(3*r),s=new Array(e.length);let a=0,l=0;for(const o of e){const e=a;for(const t of o)n[3*a+0]=t.x,n[3*a+1]=t.y,n[3*a+2]=t.t,a++;s[l++]={startVertex:e,numberOfVertices:o.length,totalTime:o[o.length-1].t,timeSeed:t?i.getFloat():0}}return{lineVertices:n,lineDescriptors:s}}function g(e,t=10){const{lineVertices:i,lineDescriptors:r}=e;let n=0,s=0;for(const u of r)n+=2*u.numberOfVertices,s+=6*(u.numberOfVertices-1);const a=new Float32Array(n*u),o=new Uint32Array(s);let l=0,c=0;function h(){o[c++]=l-2,o[c++]=l,o[c++]=l-1,o[c++]=l,o[c++]=l+1,o[c++]=l-1}function d(e,t,i,r,n,s,o){const c=l*u;let h=0;a[c+h++]=e,a[c+h++]=t,a[c+h++]=1,a[c+h++]=i,a[c+h++]=s,a[c+h++]=o,a[c+h++]=r,a[c+h++]=n,l++,a[c+h++]=e,a[c+h++]=t,a[c+h++]=-1,a[c+h++]=i,a[c+h++]=s,a[c+h++]=o,a[c+h++]=-r,a[c+h++]=-n,l++}for(const u of r){const{totalTime:e,timeSeed:r}=u;let n=null,s=null,a=null,o=null,l=null;for(let c=0;c<u.numberOfVertices;c++){const f=i[3*(u.startVertex+c)+0],p=i[3*(u.startVertex+c)+1],y=i[3*(u.startVertex+c)+2];let m=null,b=null,g=null,x=null;if(c>0){m=f-n,b=p-s;const i=Math.sqrt(m*m+b*b);if(m/=i,b/=i,c>1){let e=m+o,i=b+l;const r=Math.sqrt(e*e+i*i);e/=r,i/=r;const n=Math.min(1/(e*m+i*b),t);e*=n,i*=n,g=-i,x=e}else g=-b,x=m;null!==g&&null!==x&&(d(n,s,a,g,x,e,r),h())}n=f,s=p,a=y,o=m,l=b}d(n,s,a,-l,o,e,r)}return{vertexData:a,indexData:o}}function x(e,t){const i=t.pixels,{width:r,height:s}=t,a=new Float32Array(r*s*2);if("vector-uv"===e)for(let n=0;n<r*s;n++)a[2*n+0]=i[0][n],a[2*n+1]=-i[1][n];else if("vector-magdir"===e)for(let o=0;o<r*s;o++){const e=i[0][o],t=Object(n["h"])(i[1][o]),r=Math.cos(t-Math.PI/2),s=Math.sin(t-Math.PI/2);a[2*o+0]=r*e,a[2*o+1]=s*e}return{data:a,width:r,height:s}}async function v(e,t,i,r,n){const s=Object(l["e"])(t.spatialReference);if(!s)return w(e,t,i,r,n);const[a,o]=s.valid,h=o-a,u=Math.ceil(t.width/h),d=t.width/u,f=Math.round(i/u);let p=t.xmin;const y=[];for(let l=0;l<u;l++){const i=new c["a"]({xmin:p,xmax:p+d,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference});y.push(w(e,i,f,r,n)),p+=d}const m=await Promise.all(y),b={data:new Float32Array(i*r*2),width:i,height:r};let g=0;for(const l of m){for(let e=0;e<l.height;e++)for(let t=0;t<l.width;t++)g+t>=i||(b.data[2*(e*i+g+t)+0]=l.data[2*(e*l.width+t)+0],b.data[2*(e*i+g+t)+1]=l.data[2*(e*l.width+t)+1]);g+=l.width}return b}async function w(e,t,i,r,n){if("imagery"===e.type){await e.load({signal:n});const a=e.rasterInfo.dataType,o=await e.fetchImage(t,i,r,{signal:n});return!o||Object(s["k"])(o.pixelData)||Object(s["k"])(o.pixelData.pixelBlock)?{data:new Float32Array(i*r*2),width:i,height:r}:x(a,o.pixelData.pixelBlock)}await e.load({signal:n});const a=e.rasterInfo.dataType,o=await e.fetchPixels(t,i,r,{signal:n});return!o||Object(s["k"])(o.pixelBlock)?{data:new Float32Array(i*r*2),width:i,height:r}:x(a,o.pixelBlock)}},"365a":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("a4ee"),n=i("fc29"),s=i("ce6d"),a=i("9096"),o=i("a5d8"),l=i("e92d"),c=i("b2b2"),h=i("fab3"),u=i("59b2"),d=(i("b50f"),i("c120"),i("cea0"),i("d386"));let f=class extends(Object(a["b"])(Object(o["a"])(Object(h["b"])(s["a"].EventedMixin(n["a"]))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw l["a"].getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){return Object(c["v"])(this.get("layer.opacity"),1)*Object(c["v"])(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return!0===(null==(e=this.layer)?void 0:e.visible)}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(r["a"])([Object(u["b"])()],f.prototype,"fullOpacity",null),Object(r["a"])([Object(u["b"])()],f.prototype,"layer",void 0),Object(r["a"])([Object(u["b"])()],f.prototype,"parent",void 0),Object(r["a"])([Object(u["b"])({readOnly:!0})],f.prototype,"suspended",null),Object(r["a"])([Object(u["b"])({readOnly:!0})],f.prototype,"suspendInfo",null),Object(r["a"])([Object(u["b"])({readOnly:!0})],f.prototype,"legendEnabled",null),Object(r["a"])([Object(u["b"])({type:Boolean,readOnly:!0})],f.prototype,"updating",null),Object(r["a"])([Object(u["b"])({readOnly:!0})],f.prototype,"updatingProgress",null),Object(r["a"])([Object(u["b"])()],f.prototype,"visible",null),f=Object(r["a"])([Object(d["a"])("esri.views.layers.LayerView")],f);const p=f},"45a5":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("fa8a");const n=new r["a"]({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function s(e){return n.toJSON(e)}function a(e){const{bandCount:t,attributeTable:i,colormap:r,pixelType:n}=e.rasterInfo;return 1===t&&(null!=i||null!=r||"u8"===n||"s8"===n)}},"566d":function(e,t,i){"use strict";i.d(t,"a",(function(){return M}));var r=i("a4ee"),n=i("2c4f"),s=i("7d7d"),a=i("3795"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),c=i("00c0"),h=i("6a0e");i("e92d"),i("2dd4");let u=class extends h["a"]{};u=Object(r["a"])([Object(l["a"])("esri.views.layers.support.ClipArea")],u);const d=u;var f;let p=f=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new f({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(r["a"])([Object(o["b"])({type:[Number,String],json:{write:!0}})],p.prototype,"left",void 0),Object(r["a"])([Object(o["b"])({type:[Number,String],json:{write:!0}})],p.prototype,"right",void 0),Object(r["a"])([Object(o["b"])({type:[Number,String],json:{write:!0}})],p.prototype,"top",void 0),Object(r["a"])([Object(o["b"])({type:[Number,String],json:{write:!0}})],p.prototype,"bottom",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],p.prototype,"version",null),p=f=Object(r["a"])([Object(l["a"])("esri.views.layers.support.ClipRect")],p);const y=p;i("e06a");var m,b=i("3760"),g=i("a9ab"),x=i("3af1"),v=i("1219");const w={base:b["a"],key:"type",typeMap:{extent:x["a"],polygon:v["a"]}};let _=m=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new m({geometry:this.geometry.clone()})}};Object(r["a"])([Object(o["b"])({types:w,json:{read:g["a"],write:!0}})],_.prototype,"geometry",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],_.prototype,"version",null),_=m=Object(r["a"])([Object(l["a"])("esri.views.layers.support.Geometry")],_);const O=_;let j=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(r["a"])([Object(o["b"])({type:[[[Number]]],json:{write:!0}})],j.prototype,"path",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],j.prototype,"version",null),j=Object(r["a"])([Object(l["a"])("esri.views.layers.support.Path")],j);const R=j,P=n["a"].ofType({key:"type",base:d,typeMap:{rect:y,path:R,geometry:O}}),M=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new P,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new c["a"]),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(a["a"])(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(a["a"])(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(a["a"])(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(a["a"])(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(!this.updatingHandles||!this.updatingHandles.updating)}isVisibleAtScale(e){let t=!0;const i=this.layer,r=i.minScale,n=i.maxScale;if(null!=r&&null!=n){let i=!r,s=!n;!i&&e<=r&&(i=!0),!s&&e>=n&&(s=!0),t=i&&s}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(r["a"])([Object(o["b"])({type:P,set(e){const t=Object(s["b"])(e,this._get("clips"),P);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"moving",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"attached",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"container",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"suspended",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"updateRequested",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"updating",null),Object(r["a"])([Object(o["b"])()],t.prototype,"view",void 0),t=Object(r["a"])([Object(l["a"])("esri.views.2d.layers.LayerView2D")],t),t}},"5ef2":function(e,t,i){"use strict";function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function a(e,t){return new Float32Array(e,t,4)}function o(){return r()}function l(){return s(1,1,1,1)}function c(){return s(1,0,0,0)}function h(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function d(){return s(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return s}));const f=o(),p=l(),y=c(),m=h(),b=u(),g=d();Object.freeze({__proto__:null,create:r,clone:n,fromValues:s,createView:a,zeros:o,ones:l,unitX:c,unitY:h,unitZ:u,unitW:d,ZEROS:f,ONES:p,UNIT_X:y,UNIT_Y:m,UNIT_Z:b,UNIT_W:g})},6722:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("c120"),n=i("c84e"),s=i("9a02"),a=i("6f75"),o=i("ec5e");const l=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class c extends s["a"]{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(l),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[o["a"]],drawPhase:n["c"].DEBUG|n["c"].MAP|n["c"].HIGHLIGHT,target:()=>this.getStencilTarget()})),Object(r["a"])("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[a["a"]],drawPhase:n["c"].DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(){let e=1;for(const t of this.children)t.stencilRef=e++}}},"6c7a":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("a4ee"),n=i("e92d"),s=i("f4cc"),a=i("3795"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386"));const c=e=>{let t=class extends e{initialize(){this.handles.add(Object(a["b"])(this,"layer","refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{Object(s["m"])(e)||n["a"].getLogger(this.declaredClass).error(e)})}),"RefreshableLayerView")}};return Object(r["a"])([Object(o["b"])()],t.prototype,"layer",void 0),t=Object(r["a"])([Object(l["a"])("esri.layers.mixins.RefreshableLayerView")],t),t}},"72d8":function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("a4ee"),n=i("8d60"),s=i("ce50"),a=i("b2b2"),o=i("59b2"),l=(i("b50f"),i("c120"),i("cea0"),i("d386")),c=i("22f4"),h=i("b4e0"),u=i("ad73");const d=e=>{let t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)return Promise.reject(new s["a"]("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:r}=i,o=Object(u["a"])(i,t);if(!r||!Object(a["l"])(o))throw new s["a"]("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:r,popupTemplate:o});const l=[],{value:c,magdirValue:h}=await i.identify(e,{timeExtent:this.timeExtent});let d="";if(c&&c.length){var f,p;d="imagery-tile"===i.type&&i.hasStandardTime()&&null!=c[0]?c.map(e=>i.getStandardTimeValue(e)).join(", "):c.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(d,t);const r=null==(f=i.rasterInfo)||null==(p=f.attributeTable)?void 0:p.features;if(r&&r.length>0){const t=r.filter(e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===d});if(t.length>0){const i=t[0];if(i)for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const r=this._rasterFieldPrefix+t;e[r]=this._formatAttributeValue(i.attributes[t],r)}}}const s=i.rasterInfo.dataType;"vector-magdir"!==s&&"vector-uv"!==s||(e["Raster.Magnitude"]=null==h?void 0:h[0],e["Raster.Direction"]=null==h?void 0:h[1]);const a=new n["a"](this.fullExtent.clone(),null,e);a.layer=i,a.sourceLayer=a.layer,l.push(a)}return l}updateFullExtent(){const e=this.layer.tileInfo;if(!e||!e.spatialReference)return Promise.reject(new s["a"]("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));if(Object(a["k"])(this.layer.fullExtent))return Promise.reject(new s["a"]("layerview:extent-missing","The layer doesn't provide a full extent.",{layer:this.layer}));const t=Object(h["b"])(this.layer.fullExtent,this.view.spatialReference,!1),i=Object(h["h"])(this.layer.fullExtent,this.view.spatialReference,t);return null==i?Promise.reject(new s["a"]("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})):(this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=Object(h["b"])(this.layer.fullExtent,this.view.spatialReference,!0)),Promise.resolve())}_formatAttributeValue(e,t){if("string"==typeof e){const i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,r=this._getFieldInfo(i,t),n=r&&r.format;if(n){let t,i;return e.trim().indexOf(",")>-1?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,n)):e.trim().indexOf(" ")>-1?(t=i=" ",this._formatDelimitedString(e,t,i,n)):this._formatNumberFromString(e,n)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(r=e,!0)),r}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(e=>this._formatNumberFromString(e,r)).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;const i=Number(e);return isNaN(i)?e:t.format(i)}};return Object(r["a"])([Object(o["b"])()],t.prototype,"layer",void 0),Object(r["a"])([Object(o["b"])(c["a"])],t.prototype,"timeExtent",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"view",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"fullExtent",void 0),Object(r["a"])([Object(o["b"])()],t.prototype,"tileInfo",void 0),Object(r["a"])([Object(o["b"])({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(r["a"])([Object(l["a"])("esri.views.layers.ImageryTileLayerView")],t),t}},9812:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r,n,s,a={exports:{}};r=a,n=function(){function e(e,i,n){n=n||2;var s,a,o,c,h,u,d,f=i&&i.length,p=f?i[0]*n:e.length,y=t(e,0,p,n,!0),m=[];if(!y||y.next===y.prev)return m;if(f&&(y=l(e,i,y,n)),e.length>80*n){s=o=e[0],a=c=e[1];for(var b=n;b<p;b+=n)(h=e[b])<s&&(s=h),(u=e[b+1])<a&&(a=u),h>o&&(o=h),u>c&&(c=u);d=0!==(d=Math.max(o-s,c-a))?1/d:0}return r(y,m,n,s,a,d),m}function t(e,t,i,r,n){var s,a;if(n===C(e,t,i,r)>0)for(s=t;s<i;s+=r)a=I(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=I(s,e[s],e[s+1],a);if(a&&w(a,a.next)){var o=a.next;T(a),a=o}return a}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!w(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{var n=r.prev;if(T(r),(r=t=n)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,l,c,h,u,d){if(e){!d&&u&&p(e,c,h,u);for(var f,y,m=e;e.prev!==e.next;)if(f=e.prev,y=e.next,u?s(e,c,h,u):n(e))t.push(f.i/l),t.push(e.i/l),t.push(y.i/l),T(e),e=y.next,m=y.next;else if((e=y)===m){d?1===d?r(e=a(i(e),t,l),t,l,c,h,u,2):2===d&&o(e,t,l,c,h,u):r(i(e),t,l,c,h,u,1);break}}}function n(e){var t=e.prev,i=e,r=e.next;if(v(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(g(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,i,r){var n=e.prev,s=e,a=e.next;if(v(n,s,a)>=0)return!1;for(var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,l=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,c=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,h=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,u=m(o,l,t,i,r),d=m(c,h,t,i,r),f=e.prevZ,p=e.nextZ;f&&f.z>=u&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&g(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&g(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&g(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function a(e,t,r){var n=e;do{var s=n.prev,a=n.next.next;!w(s,a)&&_(s,n,n.next,a)&&P(s,a)&&P(a,s)&&(t.push(s.i/r),t.push(n.i/r),t.push(a.i/r),T(n),T(n.next),n=e=a),n=n.next}while(n!==e);return i(n)}function o(e,t,n,s,a,o){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&x(l,c)){var h=S(l,c);return l=i(l,l.next),h=i(h,h.next),r(l,t,n,s,a,o),void r(h,t,n,s,a,o)}c=c.next}l=l.next}while(l!==e)}function l(e,r,n,s){var a,o,l,h=[];for(a=0,o=r.length;a<o;a++)(l=t(e,r[a]*s,a<o-1?r[a+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),h.push(b(l));for(h.sort(c),a=0;a<h.length;a++)n=i(n=u(h[a],n),n.next);return n}function c(e,t){return e.x-t.x}function h(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function u(e,t){var r=d(e,t);if(!r)return t;var n=S(r,e),s=i(r,r.next);let a=h(n);return i(a,a.next),s=h(s),h(t===r?s:t)}function d(e,t){var i,r=t,n=e.x,s=e.y,a=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var o=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>a){if(a=o,o===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===a)return i;var l,c=i,h=i.x,u=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&g(s<u?n:a,s,h,u,s<u?a:n,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(n-r.x),P(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&f(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}function f(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function p(e,t,i,r){var n=e;do{if(null===n.z&&(n.z=m(n.x,n.y,t,i,r)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,p(e,t,i,r);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,y(n)}function y(e){var t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ);t++);for(l=c;o>0||l>0&&r;)0!==o&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function m(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,r,n,s,a,o){return(n-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(r-o)-(i-a)*(t-o)>=0&&(i-a)*(s-o)-(n-a)*(r-o)>=0}function x(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!R(e,t)&&(P(e,t)&&P(t,e)&&M(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||w(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function w(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,i,r){var n=j(v(e,t,i)),s=j(v(e,t,r)),a=j(v(i,r,e)),o=j(v(i,r,t));return n!==s&&a!==o||!(0!==n||!O(e,i,t))||!(0!==s||!O(e,r,t))||!(0!==a||!O(i,e,r))||!(0!==o||!O(i,t,r))}function O(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function j(e){return e>0?1:e<0?-1:0}function R(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&_(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function P(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function M(e,t){var i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function S(e,t){var i=new k(e.i,e.x,e.y),r=new k(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function I(e,t,i,r){var n=new k(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function k(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,i,r){for(var n=0,s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}return e.deviation=function(e,t,i,r){var n=t&&t.length,s=n?t[0]*i:e.length,a=Math.abs(C(e,0,s,i));if(n)for(var o=0,l=t.length;o<l;o++){var c=t[o]*i,h=o<l-1?t[o+1]*i:e.length;a-=Math.abs(C(e,c,h,i))}var u=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,f=r[o+1]*i,p=r[o+2]*i;u+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var a=0;a<t;a++)i.vertices.push(e[n][s][a]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},e},void 0!==(s=n())&&(r.exports=s);const o=a.exports},"9a02":function(e,t,i){"use strict";i.d(t,"a",(function(){return M}));i("c120");var r=i("b2b2"),n=i("8c71"),s=i("3b1a"),a=i("00c0"),o=i("ce50"),l=i("e92d"),c=i("7c4b"),h=i("9812"),u=i("3349"),d=i("02f1"),f=i("6655"),p=i("8152"),y=i("d114"),m=i("7ce4");const b=l["a"].getLogger("esri.views.2d.engine.webgl.Mesh2D"),g=e=>{switch(e.BYTES_PER_ELEMENT){case 1:return 5121;case 2:return 5123;case 4:return 5125;default:throw new o["a"]("Cannot get DataType of array")}},x=(e,t,i,r)=>{let n=0;for(let s=1;s<i;s++){const i=e[2*(t+s-1)],r=e[2*(t+s-1)+1];n+=(e[2*(t+s)]-i)*(e[2*(t+s)+1]+r)}return r?n>0:n<0},v=({coords:e,lengths:t},i)=>{const r=[];for(let n=0,s=0;n<t.length;s+=t[n],n+=1){const a=s,o=[];for(;n<t.length-1&&x(e,s+t[n],t[n+1],i);n+=1,s+=t[n])o.push(s+t[n]-a);const l=e.slice(2*a,2*(s+t[n])),c=Object(h["a"])(l,o,2);for(const e of c)r.push(e+a)}return r};class w{constructor(e,t,i,r=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=i,this.isMapSpace=r}static fromRect({x:e,y:t,width:i,height:r}){const n=e,s=t,a=n+i,o=s+r;return w.fromScreenExtent({xmin:n,ymin:s,xmax:a,ymax:o})}static fromPath(e){const t=Object(f["f"])(new p["a"],e.path,!1,!1),i=t.coords,r=new Uint32Array(v(t,!0)),n=new Uint32Array(i.length/2);for(let s=0;s<n.length;s++)n[s]=Object(y["a"])(Math.floor(i[2*s]),Math.floor(i[2*s+1]));return new w({geometry:n},r,4)}static fromGeometry(e,t){const i=t.geometry.type;switch(i){case"polygon":return w.fromPolygon(e,t.geometry);case"extent":return w.fromMapExtent(e,t.geometry);default:return b.error(new o["a"]("mapview-bad-type","Unable to create a mesh from type "+i,t)),w.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const i=Object(f["g"])(new p["a"],t,!1,!1),r=i.coords,n=new Uint32Array(v(i,!1)),s=new Uint32Array(r.length/2),a=Object(d["b"])(),o=Object(d["b"])();for(let l=0;l<s.length;l++)Object(u["s"])(a,r[2*l],r[2*l+1]),e.toScreen(o,a),s[l]=Object(y["a"])(Math.floor(o[0]),Math.floor(o[1]));return new w({geometry:s},n,4,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:i,ymax:r}){const n={geometry:new Uint32Array([Object(y["a"])(e,i),Object(y["a"])(t,i),Object(y["a"])(e,r),Object(y["a"])(e,r),Object(y["a"])(t,i),Object(y["a"])(t,r)])},s=new Uint32Array([0,1,2,3,4,5]);return new w(n,s,4)}static fromMapExtent(e,t){const[i,r]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,s]=e.toScreen([0,0],[t.xmax,t.ymax]),a={geometry:new Uint32Array([Object(y["a"])(i,r),Object(y["a"])(n,r),Object(y["a"])(i,s),Object(y["a"])(i,s),Object(y["a"])(n,r),Object(y["a"])(n,s)])},o=new Uint32Array([0,1,2,3,4,5]);return new w(a,o,4)}destroy(){Object(r["l"])(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)Object(r["l"])(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return g(this.indices)}getIndexBuffer(e,t=35044){return this._cache.indexBuffer||(this._cache.indexBuffer=m["a"].createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=35044){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((i,r)=>({...i,[r]:m["a"].createVertex(e,t,this.vertices[r])}),{})),this._cache.vertexBuffers}}var _=i("0fa6");const O=l["a"].getLogger("esri.views.2d.engine.webgl.ClippingInfo"),j=e=>parseFloat(e)/100;class R extends c["a"]{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=t.watch("version",()=>this._invalidate()),this.ready()}static fromClipArea(e,t){return new R(e,t)}_destroyGL(){Object(r["l"])(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null),Object(r["l"])(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL(),this._handle.remove()}getVAO(e,t,i,n){const[s,a]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===s&&this._lastHeight===a||(this._lastWidth=s,this._lastHeight=a,this._destroyGL()),Object(r["k"])(this._cache.vao)){const r=this._createMesh(t,this._clip),s=r.getIndexBuffer(e),a=r.getVertexBuffers(e);this._cache.mesh=r,this._cache.vao=new _["a"](e,i,n,a,s)}return this._cache.vao}_createTransforms(){return{dvs:Object(n["b"])()}}_invalidate(){this._destroyGL(),this.requestRender()}_createScreenRect(e,t){const[i,r]=e.size,n="string"==typeof t.left?j(t.left)*i:t.left,s="string"==typeof t.right?j(t.right)*i:t.right,a="string"==typeof t.top?j(t.top)*r:t.top,o="string"==typeof t.bottom?j(t.bottom)*r:t.bottom,l=n,c=a;return{x:l,y:c,width:Math.max(i-s-l,0),height:Math.max(r-o-c,0)}}_createMesh(e,t){switch(t.type){case"rect":return w.fromRect(this._createScreenRect(e,t));case"path":return w.fromPath(t);case"geometry":return w.fromGeometry(e,t);default:return O.error(new o["a"]("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),w.fromRect({x:0,y:0,width:1,height:1})}}}var P=i("c84e");class M extends a["a"]{constructor(){super(...arguments),this.name=this.constructor.name}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e),this._updateClippingInfo()}_createTransforms(){return{dvs:Object(n["b"])()}}doRender(e){const t=this.createRenderParams(e),{painter:i,globalOpacity:r,profiler:n,drawPhase:s}=t,a=s===P["c"].LABEL||s===P["c"].HIGHLIGHT?1:r*this.computedOpacity;n.recordContainerStart(this.name),i.beforeRenderLayer(t,this._clippingInfos?255:0,a),this.updateTransforms(e.state),this.renderChildren(t),i.compositeLayer(t,a),n.recordContainerEnd()}renderChildren(e){Object(r["k"])(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const i of this.children)i.beforeRender(e);for(const i of this._renderPasses)try{i.render(e)}catch(t){}for(const i of this.children)i.afterRender(e)}createRenderParams(e){return e.requireFBO=this.requiresDedicatedFBO,e}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[s["a"].clip],target:()=>this._clippingInfos,drawPhase:P["c"].MAP|P["c"].LABEL|P["c"].LABEL_ALPHA|P["c"].DEBUG|P["c"].HIGHLIGHT})]}updateTransforms(e){for(const t of this.children)t.setTransform(e)}onAttach(){super.onAttach(),this._updateClippingInfo()}onDetach(){super.onDetach(),this._updateClippingInfo()}_updateClippingInfo(){if(Object(r["l"])(this._clippingInfos)&&(this._clippingInfos.forEach(e=>e.destroy()),this._clippingInfos=null),!this.stage)return;const e=this._clips;Object(r["l"])(e)&&e.length&&(this._clippingInfos=e.items.map(e=>R.fromClipArea(this.stage,e))),this.requestRender()}}},ad73:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("b2b2"),n=i("c1da");async function s(e,t=e.popupTemplate){if(!Object(r["l"])(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:c}=e;if(i.includes("*"))return["*"];const h=s?await Object(n["n"])(e):[],u=Object(n["j"])(e.fieldsIndex,[...i,...h]);return o&&u.push(o),u&&a&&e.fieldsIndex.has(a)&&-1===u.indexOf(a)&&u.push(a),u&&l&&e.fieldsIndex.has(l)&&-1===u.indexOf(l)&&u.push(l),c&&c.forEach(t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex.has(i)&&-1===u.indexOf(i)&&u.push(i)}),u}function a(e,t){return e.popupTemplate?e.popupTemplate:Object(r["l"])(t)&&t.defaultPopupTemplateEnabled&&Object(r["l"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},aebc:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return ne}));var r=i("a4ee"),n=i("8d60"),s=i("e92d"),a=i("f4cc"),o=i("3795"),l=i("59b2"),c=(i("b50f"),i("c120"),i("cea0"),i("d386")),h=i("d23c"),u=i("566d"),d=i("b2b2"),f=i("9180"),p=i("a98b"),y=i("3b1a"),m=i("8c71"),b=i("37c9"),g=i("e4b1");class x extends g["a"]{constructor(e,t,i,r,n,s=null){super(e,t,i,r,n),this.bitmap=new b["a"](s,null,null),this.bitmap.coordScale=[r,n],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:Object(m["b"])(),tileMat3:Object(m["b"])()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}var v=i("c84e"),w=i("6722");class _ extends w["a"]{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const t=this._getTileBounds(e),[i,r]=this._tileInfoView.tileInfo.size;return new x(e,t[0],t[3],i,r)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[y["a"].raster],target:()=>this.children.map(e=>e.bitmap),drawPhase:v["c"].MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===v["c"].MAP&&super.doRender(e)}_getTileBounds(e){const t=this._tileInfoView.getTileBounds(Object(f["m"])(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this._tileInfoView,r=Object(p["o"])(i.spatialReference);if(r){const{resolution:n}=i.lodAt(e.level),s=r/n%i.size[0],a=s?(i.size[0]-s)*n:0;t[0]-=a*e.world,t[2]-=a*e.world}}return t}}i("e06a");var O=i("9096"),j=i("4ae5"),R=i("3e27"),P=i("dff3"),M=i("218c"),S=i("9dee"),I=i("b4e0"),T=(i("3e7b"),i("018d")),k=(i("ae54"),i("07cd")),C=i("d302"),V=i("b2af"),z=i("3af1");const D=[0,0],F=s["a"].getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let U=class extends O["a"]{constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.container=null,this.layer=null,this.redrawOrRefetch=Object(a["i"])((e,t)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():e?this.doRefresh():this._redrawImage(t))}get useWebGLForProcessing(){var e;return null==(e=this._get("useWebGLForProcessing"))||e}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new C["a"]({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:r}=e.state,n=this._tileInfoView.getClosestInfoForScale(r);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[n.level],r=t.toJSON?t:z["a"].fromJSON(t);Object(M["h"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId,r,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this.previousLOD)?void 0:s.level)!==n.level&&(this.previousLOD=n,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()}));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue.length>0||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){Object(V["a"])().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new T["a"](this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new k["a"]({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new C["a"]({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",()=>{e.destroy(),this.layerView.requestUpdate()}),this.layerView.requestUpdate()}uninstall(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,this.notifyChange("updating"),Object(M["g"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&Object(d["l"])(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,r]=e,n=new R["a"]({width:i,height:r,pixels:[new Uint8Array(i*r)],mask:new Uint8Array(i*r),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=n),n}_fetchTile1(e,t){const i=!Object(d["k"])(t)&&t.signal,r=this.canUseWebGLForProcessing(),n={allowPartialFill:!0,datumTransformation:this.layerView.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:r,signal:Object(d["u"])(i),srcResolution:this._srcResolutions[e.level],timeExtent:this.layerView.timeExtent,tileInfo:this.layerView.tileInfo};return this.fetchTile(e,n)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.layerView.view.spatialReference,t=new j["a"]({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:r,isCustomTilingScheme:n}=Object(I["a"])(this.layer.rasterInfo,e),s=P["a"].create({spatialReference:e,size:512,scales:i});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=n,this.layerView.set("tileInfo",s),this._srcResolutions=null!=r?r:[]}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);this.notifyChange("updating");const{bandIds:r}=this.layer;let n=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){n=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(i){Object(a["m"])(i)&&F.error(i)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const s=this._tileInfoView.getTileCoords(D,e.key),o=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:n,bandIds:r,coords:s,resolution:o}),e.once("attach",()=>this.layerView.requestUpdate()),this.container.addChild(e)}catch(i){Object(a["m"])(i)||F.error(i)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map(async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams}));await Object(a["j"])(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!i||!i.pixelBlock)return;const r=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(S["h"])(i.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds});!this.canUseWebGLForProcessing()&&r&&"stretch"===r.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(r.factor=r.factor.map(e=>255*e),r.outMin=Math.round(255*r.outMin),r.outMax=Math.round(255*r.outMax)),this._globalSymbolizerParams=r}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:i,raster:r}=this.layer,{multidimensionalDefinition:n}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),s=null!=i&&i.multidimensionalInfo?r.getSliceIndex(n):null,a=Object(M["d"])(t,s);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(M["g"])(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(M["f"])(a,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),t=this._srcResolutions[e.level];Object(M["h"])(a,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this.notifyChange("updating");const e=[];this._tileStrategy.tiles.forEach(t=>e.push(this._enqueueTileFetch(t))),await Object(a["j"])(e)}};Object(r["a"])([Object(l["b"])()],U.prototype,"_globalUpdateRequested",void 0),Object(r["a"])([Object(l["b"])()],U.prototype,"container",void 0),Object(r["a"])([Object(l["b"])()],U.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],U.prototype,"layerView",void 0),Object(r["a"])([Object(l["b"])()],U.prototype,"type",void 0),Object(r["a"])([Object(l["b"])()],U.prototype,"useWebGLForProcessing",null),Object(r["a"])([Object(l["b"])()],U.prototype,"useProgressiveUpdate",null),Object(r["a"])([Object(l["b"])()],U.prototype,"updating",null),U=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],U);var L=i("45a5");let A=class extends U{constructor(){super(...arguments),this.container=null,this.layer=null,this.type="raster"}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&Object(L["a"])(this.layer))}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}async updateTileSource(e,t){const{bandIds:i}=this.layer,r=this._getLayerInterpolation(),n=this.canUseWebGLForProcessing(),{source:s,symbolizerParams:a,globalSymbolizerParams:o,suspended:l,coords:c,resolution:h}=t,{bitmap:u}=e;if([u.x,u.y]=c,u.resolution=h,s&&Object(d["l"])(s)&&Object(d["l"])(s.pixelBlock)){const e={extent:s.extent,pixelBlock:s.pixelBlock};if(u.rawPixelData=e,n)u.source=s.pixelBlock,u.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===(null==o?void 0:o.type)?o:null);u.source=t,u.isRendereredSource=!0}u.symbolizerParameters=n?a:null,n?u.transformGrid||(u.transformGrid=s.transformGrid):u.transformGrid=null}else{const e=this.createEmptyTilePixelBlock();u.source=e,u.symbolizerParameters=n?a:null,u.transformGrid=null}u.bandIds=n?i:null,u.width=this._tileInfoView.tileInfo.size[0],u.height=this._tileInfoView.tileInfo.size[1],u.interpolation=r,u.suspended=l,u.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:i,global:r}=t,{bandIds:n}=this.layer,s=this._getLayerInterpolation(),a=this.canUseWebGLForProcessing(),{bitmap:o}=e,{rawPixelData:l}=o;!a&&Object(d["l"])(l)?(o.source=await this.layer.applyRenderer(l,"stretch"===(null==r?void 0:r.type)?r:null),o.isRendereredSource=!0):(o.isRendereredSource&&Object(d["l"])(l)&&(o.source=l.pixelBlock),o.isRendereredSource=!1),o.symbolizerParameters=a?r||i:null,o.bandIds=a?n:null,o.interpolation=s,o.suspended=!1}install(e){this.container=new _(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,e.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this.container.remove(),super.uninstall()}_getLayerInterpolation(){const e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";const{interpolation:t}=this.layer,{renderer:i}=this.layer;return"raster-stretch"===i.type&&null!=i.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}};Object(r["a"])([Object(l["b"])()],A.prototype,"container",void 0),Object(r["a"])([Object(l["b"])()],A.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],A.prototype,"type",void 0),A=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.imagery.ImageryTileView2D")],A);const B=A;var E=i("19db"),G=i("1c92"),q=i("7ce4"),W=(i("d267"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"),i("0fa6")),N=i("7c4b"),Z=i("c8dd");class H extends N["a"]{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,t;Object(d["l"])(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&Object(d["l"])(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,Object(d["l"])(this.source)&&!Object(d["l"])(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=Object(E["c"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=Object(E["d"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=Object(E["c"])(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),r=Object(E["d"])(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(e.context,r);this.vaoData={magdir:i,scalar:n}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:Object(m["b"])()}}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:r}=t,n=q["a"].createVertex(e,35044,new Float32Array(i)),s=q["a"].createIndex(e,35044,new Uint32Array(r)),a=Object(Z["g"])("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new W["a"](e,a.attributes,a.bufferLayouts,{geometry:n},s),elementCount:r.length}}}class Q extends g["a"]{constructor(e,t,i,r,n,s=null){super(e,t,i,r,n),this.tileData=new H(s),this.tileData.coordScale=[r,n],this.tileData.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:Object(m["b"])(),tileMat3:Object(m["b"])()}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=this.tileData.offset,a=[this.x+n*t,this.y-s*t],[o,l]=e.toScreenNoRotation([0,0],a),{symbolTileSize:c}=this.tileData.symbolizerParameters,h=Math.round((this.width-this.tileData.offset[0])/c)*c,u=Math.round((this.height-this.tileData.offset[1])/c)*c,d=h/this.rangeX*i,f=u/this.rangeY*i;Object(G["n"])(r,d,0,0,0,f,0,o,l,1),Object(G["k"])(this.transforms.dvs,e.displayViewMat3,r),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}var J=i("c1ef");class X extends w["a"]{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const t=this._tileInfoView.getTileBounds(Object(f["m"])(),e),[i,r]=this._tileInfoView.tileInfo.size;return new Q(e,t[0],t[3],i,r)}destroyTile(){}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[J["a"]],target:()=>this.children.map(e=>e.tileData),drawPhase:v["c"].MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===v["c"].MAP&&this.symbolTypes.forEach(t=>{e.renderPass=t,super.doRender(e)})}}let $=class extends U{constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type="rasterVF"}canUseWebGLForProcessing(){return!1}async fetchTile(e,t){const i=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.rasterInfo.dataType&&null!=i&&i.pixelBlock&&(i.pixelBlock=await this.layer.convertVectorFieldData(i.pixelBlock,t)),i}updateTileSource(e,t){const i=t.symbolizerParams,{tileData:r}=e;r.key=e.key,r.width=this._tileInfoView.tileInfo.size[0],r.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:n}=i,{source:s}=t;if(r.offset=this._getTileSymbolOffset(r.key,n),Object(d["l"])(s)&&Object(d["l"])(s.pixelBlock)){const e={extent:s.extent,pixelBlock:s.pixelBlock};r.rawPixelData=e,r.source=this._sampleVectorFieldData(s.pixelBlock,i,r.offset),r.symbolizerParameters=i}else{const e=[Math.round((this._tileInfoView.tileInfo[0]-r.offset[0])/n),Math.round((this._tileInfoView.tileInfo[1]-r.offset[1])/n)],t=this.createEmptyTilePixelBlock(e);r.source=t,r.symbolizerParameters=i}return r.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(e,t){var i;const r=t.local,{symbolTileSize:n}=r,{tileData:s}=e;s.offset=this._getTileSymbolOffset(s.key,n);const a=s.symbolizerParameters.symbolTileSize;return s.symbolizerParameters=r,Object(d["l"])(null==(i=s.rawPixelData)?void 0:i.pixelBlock)&&a!==n&&(s.source=this._sampleVectorFieldData(s.rawPixelData.pixelBlock,s.symbolizerParameters,s.offset)),Promise.resolve(null)}install(e){this.container=new X(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",e=>this._updateSymbolType(e)),e.addChild(this.container)}uninstall(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove(),super.uninstall()}_getTileSymbolOffset(e,t){const i=e.col*this._tileInfoView.tileInfo.size[0]%t,r=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,r>t/2?t-r:-r]}_sampleVectorFieldData(e,t,i){const{symbolTileSize:r}=t;return Object(E["f"])(e,"vector-uv",r,i)}_updateSymbolType(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}};Object(r["a"])([Object(l["b"])()],$.prototype,"container",void 0),Object(r["a"])([Object(l["b"])()],$.prototype,"layer",void 0),Object(r["a"])([Object(l["b"])()],$.prototype,"type",void 0),$=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.imagery.VectorFieldTileView2D")],$);const Y=$;var K=i("72d8"),ee=i("365a"),te=i("6c7a");const ie=s["a"].getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let re=class extends(Object(K["a"])(Object(te["a"])(Object(u["a"])(ee["a"])))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}initialize(){const e=this.updateFullExtent();this.addResolvingPromise(e)}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}update(e){this.subview.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([Object(o["e"])(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(e,t,i)=>{const r="multidimensionalDefinition"===i,n="interpolation"===i&&("majority"===e||"majority"===t)&&Object(L["a"])(this.layer),s="renderer"===i&&t.type!==e.type;s&&this._updateSubview();const o=r||n||s;this.subview.redrawOrRefetch(o).catch(e=>{Object(a["m"])(e)||ie.error(e)}),this.notifyChange("updating")}),Object(o["a"])(this,["layer.blendMode"],e=>{this.subview&&(this.subview.container.blendMode=e)},!0),Object(o["a"])(this,["layer.effect"],e=>{this.subview&&(this.subview.container.effect=e)},!0),Object(o["a"])(this,"timeExtent",()=>{this.subview.redrawOrRefetch(!0).catch(e=>{Object(a["m"])(e)||ie.error(e)})})],"attach")}detach(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this.subview.uninstall()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}async hitTest(e,t){return[new n["a"]({attributes:{},geometry:e.clone()})]}doRefresh(){return this.subview.doRefresh()}_updateSubview(){const e="vector-field"===this.layer.renderer.type?"rasterVF":"animated-flow"===this.layer.renderer.type?"rasterAnimatedFlow":"raster";if(this.subview){if(this.subview.type===e)return;this.subview.uninstall()}const{layer:t}=this;let i;i="rasterVF"===e?new Y({layer:t,layerView:this}):"rasterAnimatedFlow"===e?new h["a"]({layer:t,layerView:this}):new B({layer:t,layerView:this}),"useWebGLForProcessing"in i&&(i.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in i&&(i.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in i&&(i.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),i.attach(),i.install(this.container),i.container.blendMode=t.blendMode,i.container.effect=t.effect,this.subview=i,this.requestUpdate()}};Object(r["a"])([Object(l["b"])()],re.prototype,"subview",void 0),Object(r["a"])([Object(l["b"])()],re.prototype,"useWebGLForProcessing",null),Object(r["a"])([Object(l["b"])()],re.prototype,"useProgressiveUpdate",null),re=Object(r["a"])([Object(c["a"])("esri.views.2d.layers.ImageryTileLayerView2D")],re);const ne=re},b4e0:function(e,t,i){"use strict";i.d(t,"a",(function(){return F})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return k})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return P})),i.d(t,"f",(function(){return I})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return j})),i.d(t,"i",(function(){return w})),i.d(t,"j",(function(){return x})),i.d(t,"k",(function(){return h})),i.d(t,"l",(function(){return z})),i.d(t,"m",(function(){return D}));i("e06a");var r=i("ce50"),n=i("b2b2"),s=i("8048"),a=i("8188"),o=i("3af1"),l=i("4ae5");const c=5e-4;function h(e,t,i){return!Object(a["b"])(e,t,i)}function u(e,t,i){const n=h(e,t,i);if(n&&!Object(a["h"])())throw new r["a"]("rasterprojectionhelper-project","projection engine is not loaded");return n}const d=function(e,t,i){const r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,n=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4,s=(e[4*t.cols]-e[0]+e[4*t.cols+4]-e[4])/i[0]*.5,a=(e[4*t.cols+1]-e[1]+e[4*t.cols+5]-e[5])/i[1]*.5;return[0===s||isNaN(s)?0:Math.abs(r-e[2*t.rows+2])/Math.abs(s),0===a||isNaN(a)?0:Math.abs(n-e[2*t.rows+3])/Math.abs(a)]},f={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},p=32,y=4,m=y;async function b(){if(Object(a["h"])())return null;await Object(a["i"])()}function g(e,t,i){return u(e.spatialReference,t)?i?Object(a["f"])(t,e.spatialReference,e):Object(a["f"])(e.spatialReference,t,e):null}function x(e,t,i,r=null){if(e.spatialReference.equals(t))return e;u(e.spatialReference,t,r);const s=i.center,l=new o["a"]({xmin:s.x-e.x/2,xmax:s.x+e.x/2,ymin:s.y-e.y/2,ymax:s.y+e.y/2,spatialReference:e.spatialReference}),c=Object(a["m"])(l,t,r);return Object(n["k"])(c)?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function v(e,t=.01){return Object(s["f"])(e)?t/Object(s["f"])(e):0}function w(e,t,i=null,r=!0){const n=e.spatialReference;if(n.equals(t))return e;u(n,t,i);const s=Object(a["m"])(e,t,i);if(r&&t.isGeographic){const[t,i]=M(n,!0),r=v(n);r&&null!=t&&null!=i&&(Math.abs(e.x-t)<r&&Math.abs(180-s.x)<c?s.x-=360:Math.abs(e.x-i)<r&&Math.abs(180+s.x)<c&&(s.x+=360))}return s}function _(e,t,i=null){const r=e[0].spatialReference;return r.equals(t)?e:(u(r,t,i),Object(a["m"])(e,t,i))}function O(e){const t=P(e[0].spatialReference);if(e.length<2||!Object(n["l"])(t))return e[0];let{xmin:i,xmax:r,ymin:s,ymax:a}=e[0];for(let n=1;n<e.length;n++){const i=e[n];r=i.xmax+t*n,s=Math.min(s,i.ymin),a=Math.max(a,i.ymax)}return new o["a"]({xmin:i,xmax:r,ymin:s,ymax:a,spatialReference:e[0].spatialReference})}function j(e,t,i=null,r=!0){if(e.spatialReference.equals(t))return e;const s=I(e),a=P(e.spatialReference,!0);return Object(n["l"])(a)&&0!==s?O(e.clone().normalize().map(e=>R(e,t,i,r))):R(e,t,i,r)}function R(e,t,i=null,r=!0){const n=e.spatialReference;if(n.equals(t))return e;u(n,t,i);const s=Object(a["m"])(e,t,i);let[o,h]=M(n,!0);if(s&&r&&n.isWebMercator&&t.isGeographic&&null!=o&&null!=h){const r=.001,a=1e3;if(Math.abs(e.xmin-o)<r&&Math.abs(h-e.xmax)>a&&Math.abs(180-s.xmax)<c){s.xmin=-180;const r=[];r.push(new l["a"](e.xmax,e.ymin,n)),r.push(new l["a"](e.xmax,(e.ymin+e.ymax)/2,n)),r.push(new l["a"](e.xmax,e.ymax,n));const a=r.map(e=>w(e,t,i)).filter(e=>!isNaN(null==e?void 0:e.x)).map(e=>e.x);s.xmax=Math.max.apply(null,a)}if(Math.abs(e.xmax-h)<r&&Math.abs(o-e.xmin)>a&&Math.abs(180+s.xmin)<c){s.xmax=180;const r=[];r.push(new l["a"](e.xmin,e.ymin,n)),r.push(new l["a"](e.xmin,(e.ymin+e.ymax)/2,n)),r.push(new l["a"](e.xmin,e.ymax,n));const a=r.map(e=>w(e,t,i)).filter(e=>!isNaN(null==e?void 0:e.x)).map(e=>e.x);s.xmin=Math.min.apply(null,a)}}[o,h]=M(t,!0);const d=v(t);return d&&null!=o&&null!=h&&s&&(Math.abs(s.xmin-o)<d&&(s.xmin=o),Math.abs(s.xmax-h)<d&&(s.xmax=h)),s}function P(e,t=!1){const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*f[e.wkid]||null}function M(e,t=!1){const i=[],r=P(e,t);return Object(n["l"])(r)&&(i.push(-r/2),i.push(r/2)),i}function S(e,t,i,r){let n=(e-t)/i;return n-Math.floor(n)!=0?n=Math.floor(n):r&&(n-=1),n}function I(e,t=!1){const i=P(e.spatialReference);if(!Object(n["l"])(i))return 0;const r=t?0:-i/2;return S(e.xmax,r,i,!0)-S(e.xmin,r,i,!1)}function T(e){const t=e.storageInfo.origin.x,i=P(e.spatialReference,!0);if(!Object(n["l"])(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=i/2,{nativePixelSize:s,storageInfo:a,extent:o}=e,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:h}=a;let u=s.x;const d=[],f=Object(n["l"])(e.transform)&&"gcs-shift"===e.transform.type,p=t+(f?0:r),y=f?i-t:r-t;for(let n=0;n<=l;n++){const e=(o.xmax-t)/u/c,i=e-Math.floor(e)==0?e:Math.ceil(e),r=y/u/c,n=r-Math.floor(r)==0?r:Math.ceil(r),s=Math.floor(p/u/c),a=Math.round(p/u)%c,l=(c-Math.round(y/u)%c)%c;d.push({resolutionX:u,blockWidth:c,datsetColumnCount:i,worldColumnCountFromOrigin:n,leftMargin:a,rightPadding:l,originColumnOffset:s}),u*=h}return{originX:t,halfWorldWidth:r,pyramidsInfo:d,hasGCSSShiftTransform:f}}function k(e){const t=e.isAdaptive&&null==e.spacing,i=e.spacing||[p,p];let r=C(e),n={cols:r.size[0]+1,rows:r.size[1]+1},s=d(r.offsets,n,i);const a=(s[0]+s[1])/2,o=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;return t&&(o||a>m)&&(r=C({...e,spacing:[y,y]}),n={cols:r.size[0]+1,rows:r.size[1]+1},s=d(r.offsets,n,i)),r.error=s,r.coefficients=V(r.offsets,n,o),r}function C(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:r,datumTransformation:s,rasterTransform:a}=e,o=t.spatialReference,c=i.spatialReference;u(o,c);const{xmin:h,ymin:d,xmax:f,ymax:y}=t,m=P(c),b=e.hasWrapAround||"gcs-shift"===(null==a?void 0:a.type),g=e.spacing||[p,p],x={x:g[0]*r.x,y:g[1]*r.y},v={cols:Math.ceil((f-h)/x.x-.1/g[0])+1,rows:Math.ceil((y-d)/x.y-.1/g[1])+1},w=x.x,O=x.y,j=[];let R,M=0;const S=[];for(let n=0;n<v.cols;n++)for(let e=0;e<v.rows;e++)S.push(new l["a"]({x:h+w*n,y:y-O*e,spatialReference:o}));const I=_(S,c,s);for(let l=0;l<v.cols;l++){const e=[];for(let t=0;t<v.rows;t++){let r=I[l*v.rows+t];a&&(r=a.inverseTransform(r)),e.push(r),l>0&&b&&r&&R[t]&&Object(n["l"])(m)&&r.x<R[t].x&&(r.x+=m),r?(j.push((r.x-i.xmin)/(i.xmax-i.xmin)),j.push((i.ymax-r.y)/(i.ymax-i.ymin))):(j.push(NaN),j.push(NaN),M++)}R=e}return{offsets:j,error:null,coefficients:null,outofBoundPointCount:M,spacing:g,size:[v.cols-1,v.rows-1]}}function V(e,t,i){const{cols:r,rows:n}=t,s=new Float32Array((r-1)*(n-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<r-1;l++){for(let t=0;t<n-1;t++){let i=l*n*2+2*t;const c=e[i],h=e[i+1],u=e[i+2],d=e[i+3];i+=2*n;const f=e[i],p=e[i+1],y=e[i+2],m=e[i+3];let b=0,g=12*(t*(r-1)+l);for(let e=0;e<3;e++)s[g++]=a[b++]*c+a[b++]*u+a[b++]*y;b=0;for(let e=0;e<3;e++)s[g++]=a[b++]*h+a[b++]*d+a[b++]*m;b=0;for(let e=0;e<3;e++)s[g++]=o[b++]*c+o[b++]*f+o[b++]*y;b=0;for(let e=0;e<3;e++)s[g++]=o[b++]*h+o[b++]*p+o[b++]*m}if(i)for(let e=0;e<s.length;e++)isNaN(s[e])&&(s[e]=-1)}return s}function z(e){const t=e.clone().normalize();return 1===t.length?t[0]:O(t)}function D(e,t,i){const{storageInfo:r,pixelSize:s}=t;let a,o=!1;const{pyramidResolutions:c}=r;if(Object(n["l"])(c)&&c.length){const r=(e.x+e.y)/2,n=c[c.length-1],h=(n.x+n.y)/2,u=(s.x+s.y)/2;if(r<=u)a=0;else if(r>=h)a=c.length,o=r/h>8;else{let e,t=u;for(let n=1;n<=c.length;n++){if(e=(c[n-1].x+c[n-1].y)/2,r<=e){r===e?a=n:"down"===i?(a=n-1,o=r/t>8):a="up"===i||r-t>e-r||r/t>2?n:n-1;break}t=e}}const d=0===a?s:c[a-1];return{pyramidLevel:a,pyramidResolution:new l["a"]({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:o}}const h=Math.log(e.x/s.x)/Math.LN2,u=Math.log(e.y/s.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;a="down"===i?Math.floor(Math.min(h,u)):"up"===i?Math.ceil(Math.max(h,u)):Math.round((h+u)/2),a<0?a=0:a>d&&(o=a>d+3,a=d);const f=2**a;return{pyramidLevel:a,pyramidResolution:new l["a"]({x:f*t.nativePixelSize.x,y:f*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function F(e,t,i=512,r=!0){const{extent:n,spatialReference:a,pixelSize:o}=e,c=x(new l["a"]({x:o.x,y:o.y,spatialReference:a}),t,n);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const h=(c.x+c.y)/2,u=Object(s["f"])(t),d=h*u*96*39.37,f=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let p="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const y=j(n,t);p||r&&(t.isGeographic||t.isWebMercator)&&(p=y.xmin*y.xmax<0);let m,b=d;const g=1.001;if(p){b=f;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*u*39.37),r=t.isGeographic?4326:3857;m=x(new l["a"]({x:e,y:e,spatialReference:{wkid:r}}),a,y),m.x*=b/i,m.y*=b/i}else{m={x:o.x,y:o.y};const t=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let i=0;for(;b<f*(g/2)&&i<t;)i++,b*=2,m.x*=2,m.y*=2;Math.max(b,f)/Math.min(b,f)<=g&&(b=f)}const v=[b],w=[{x:m.x,y:m.y}],_=70.5310735,O=Math.min(_,d)/g;for(;b>=O;)b/=2,m.x/=2,m.y/=2,v.push(b),w.push({x:m.x,y:m.y});return{projectedPixelSize:c,scales:v,srcResolutions:w,isCustomTilingScheme:!p}}},beba:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return h})),i.d(t,"i",(function(){return d})),i.d(t,"j",(function(){return p})),i.d(t,"k",(function(){return f}));i("d267");var r=i("a1ff");function n(e,t,i="nearest",n=!1){var s;const a=!(n&&"u8"===t.pixelType),o=a?5126:5121,l=null==t.pixels||0===t.pixels.length?null:a?t.getAsRGBAFloat():t.getAsRGBA(),c=null==(s=e.capabilities.textureFloat)?void 0:s.textureFloatLinear,h={width:t.width,height:t.height,target:3553,pixelFormat:6408,internalFormat:"webgl2"===e.webglVersion&&a?34836:6408,samplingMode:!c||"bilinear"!==i&&"cubic"!==i?9728:9729,dataType:o,wrapMode:33071,flipped:!1};return new r["a"](e,h,l)}function s(e,t){const i=4*t.size[0],n=t.size[1],s={width:i,height:n,target:3553,pixelFormat:6408,internalFormat:"webgl2"===e.webglVersion?34836:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1},a=new Float32Array(i*n*4);let o=0;for(let r=0;r<t.coefficients.length;r++)a[o++]=t.coefficients[r],r%3==2&&(a[o++]=1);return new r["a"](e,s,a)}function a(e,t){const i={width:t.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1};return new r["a"](e,i,t)}function o(e,t,i,r=1,n=!0,s=!1){return{u_flipY:n,u_isFloatTexture:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:i}}function l(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}}function c(e,t){return{u_scale:e,u_offset:t}}function h(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function u(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function d(e,t){const i=e.gl,r=t.glName,n=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),s=new Map;let a;for(let o=0;o<n;o++)a=i.getActiveUniform(r,o),a&&s.set(a.name,{location:i.getUniformLocation(r,a.name),info:a});return s}function f(e,t,i){Object.keys(i).forEach(r=>{const n=t.get(r)||t.get(r+"[0]");n&&y(e,r,i[r],n)})}function p(e,t,i,r){i.length===r.length&&(r.some(e=>null==e)||i.some(e=>null==e)||i.forEach((i,n)=>{t.setUniform1i(i,n),e.bindTexture(r[n],n)}))}function y(e,t,i,r){if(null===r||null==i)return!1;const{info:n}=r;switch(n.type){case 5126:n.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case 35664:e.setUniform2fv(t,i);break;case 35665:e.setUniform3fv(t,i);break;case 35666:e.setUniform4fv(t,i);break;case 35675:e.setUniformMatrix3fv(t,i);break;case 35676:e.setUniformMatrix4fv(t,i);break;case 5124:n.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case 35670:e.setUniform1i(t,i?1:0);break;case 35667:case 35671:e.setUniform2iv(t,i);break;case 35668:case 35672:e.setUniform3iv(t,i);break;case 35669:case 35673:e.setUniform4iv(t,i);break;default:return!1}return!0}},d23c:function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var r=i("a4ee"),n=i("fc29"),s=i("59b2"),a=(i("b50f"),i("c120"),i("cea0"),i("d386")),o=i("2616"),l=i("c9ee"),c=i("c84e"),h=i("9a02");class u extends h["a"]{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"flow",brushes:[l["a"]],target:()=>this.children,drawPhase:c["c"].MAP});return[...super.prepareRenderPasses(e),t]}}i("e06a");var d=i("e92d"),f=i("38a4"),p=i("b2b2"),y=i("f4cc"),m=i("4ae5");const b=d["a"].getLogger("esri.views.2d.engine.flow.FlowDisplayData");class g{constructor(e,t,i,r){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=r}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:"loaded",resources:t}}prepareForRendering(e,t,i){if("loaded"!==this.state.name)return void b.error("Only loaded resources can be attached.");const r=this.state.resources;r.prepareForRendering(e,t,i),this.state={name:"attached",resources:r}}destroy(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&(!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0))}}var x=i("1c92"),v=i("8c71"),w=i("7c4b");class _ extends w["a"]{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){Object(p["l"])(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:t}=this;if(Object(p["k"])(t))return;const i=t.extent.xmin,r=t.extent.ymax,n=[0,0];e.toScreen(n,[i,r]);const s=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,a=Object(f["h"])(e.rotation),{dvs:o}=this.transforms;Object(x["b"])(o),Object(x["c"])(o,o,[-1,1,0]),Object(x["d"])(o,o,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),Object(x["c"])(o,o,[n[0],n[1],0]),Object(x["m"])(o,o,a),Object(x["d"])(o,o,[s*e.pixelRatio,s*e.pixelRatio,1])}_createTransforms(){return{dvs:Object(v["b"])()}}}var O=i("3af1");const j=1.15,R=d["a"].getLogger("esri.views.2d.engine.flow.FlowStrategy");let P=class extends n["a"]{constructor(e){super(e),this._flowDisplayObject=new _,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if(Object(p["k"])(t))return void this._clear();const{extent:i,rotation:r,resolution:n,pixelRatio:s}=e.state,a=S(i,r);a.expand(j);const o=[Math.round((a.xmax-a.xmin)/n),Math.round((a.ymax-a.ymin)/n)],l=new g(t,a,o,s);if(Object(p["l"])(this._loading)){if(this._loading.update(l))return;this._loading.destroy(),this._loading=null}!Object(p["k"])(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},e=>{Object(y["m"])(e)||(R.error("A resource failed to load.",e),this._loading=null)}),this._loading=l)}_clear(){this._flowDisplayObject.clear(),Object(p["l"])(this._loading)&&(this._loading.destroy(),this._loading=null)}};Object(r["a"])([Object(s["b"])()],P.prototype,"_loading",void 0),Object(r["a"])([Object(s["b"])()],P.prototype,"flowContainer",void 0),Object(r["a"])([Object(s["b"])()],P.prototype,"updating",null),P=Object(r["a"])([Object(a["a"])("esri.views.2d.engine.flow.FlowStrategy")],P);const M=P;function S(e,t){const i=new m["a"]({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),r=e.xmax-e.xmin,n=e.ymax-e.ymin,s=Math.abs(Math.cos(Object(f["h"])(t))),a=Math.abs(Math.sin(Object(f["h"])(t))),o=s*r+a*n,l=a*r+s*n,c=new O["a"]({xmin:i.x-o/2,ymin:i.y-l/2,xmax:i.x+o/2,ymax:i.y+l/2,spatialReference:e.spatialReference});return c.centerAt(i),c}var I=i("a915");function T(e){const t=Object(I["h"])(e.lineWidth),i=2*t,r=Math.round(Object(I["h"])(e.lineLength)/i)+1,n=t,s=10,a=e.lineColor.toRgba(),o=[a[0]/255,a[1]/255,a[2]/255,a[3]],{lineSpeed:l,fadeDuration:c,density:h}=e;return{lineRenderWidth:t,segmentLength:i,verticesPerLine:r,lineCollisionWidth:n,lineSpacing:s,lineColor:o,lineSpeed:l,fadeDuration:c,density:h,smoothing:Object(I["h"])(e.smoothing),velocityScale:1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}var k=i("7ce4"),C=(i("d267"),i("1956"),i("d17d"),i("9f8b"),i("a1ff"),i("0fa6"));class V{constructor(e,t){this._vertexData=e,this._indexData=t}prepareForRendering(e,t,i){const r=k["a"].createVertex(e,35044,this._vertexData),n=k["a"].createIndex(e,35044,this._indexData),s=new C["a"](e,t,i,{geometry:r},n);this.vertexBuffer=r,this.indexBuffer=n,this.vertexArray=s,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}}class z{constructor(e,t,i){this._loadImagery=e,this._createStreamlinesMesh=t,this._rendererSettings=T(i)}get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(e){let t=!0;return t=t&&e._loadImagery===this._loadImagery,t=t&&e._createStreamlinesMesh===this._createStreamlinesMesh,t=t&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,t=t&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength,t=t&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,t=t&&e._rendererSettings.density===this._rendererSettings.density,t=t&&e._rendererSettings.smoothing===this._rendererSettings.smoothing,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,t=t&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,t=t&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines,t=t&&e._rendererSettings.interpolate===this._rendererSettings.interpolate,t&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),!!t}async loadResources(e,t){const{extent:i,size:r}=e;Object(y["w"])(t);const n=await this._loadImagery(i,r[0],r[1],t),{vertexData:s,indexData:a}=await this._createStreamlinesMesh(this._rendererSettings,n,t);return new V(s,a)}}let D=class extends n["a"]{constructor(){super(...arguments),this._loadImagery=(e,t,i,r)=>Object(o["b"])(this.layer,e,t,i,r),this._createStreamlinesMesh=(e,t,i)=>this.layer.createStreamlinesMesh({flowData:t,rendererSettings:e},{signal:i}),this.container=null,this.layer=null,this.type="rasterAnimatedFlow",this.redrawOrRefetch=async()=>{this._rendererChanged()}}get updating(){return!this._strategy||this._strategy.updating}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}install(e){this.container=new u,e.addChild(this.container),this._strategy=new M({flowContainer:this.container}),this._rendererChanged()}uninstall(){this._strategy.destroy(),this.container.removeAllChildren(),this.container.remove()}moveEnd(){}async doRefresh(){}attach(){}_rendererChanged(){if("animated-flow"!==this.layer.renderer.type)return;const e=new z(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer);this.container.flowStyle=e,this.layerView.requestUpdate()}};Object(r["a"])([Object(s["b"])()],D.prototype,"_strategy",void 0),Object(r["a"])([Object(s["b"])()],D.prototype,"container",void 0),Object(r["a"])([Object(s["b"])()],D.prototype,"layer",void 0),Object(r["a"])([Object(s["b"])()],D.prototype,"layerView",void 0),Object(r["a"])([Object(s["b"])()],D.prototype,"type",void 0),Object(r["a"])([Object(s["b"])()],D.prototype,"updating",null),D=Object(r["a"])([Object(a["a"])("esri.views.2d.engine.flow.AnimatedFlowView2D")],D);const F=D},db21:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return r})),i.d(t,"d",(function(){return a}));const r=!0,n=32,s=1.5,a=200},e4b1:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("1c92"),n=i("7c4b"),s=i("ae54");class a extends n["a"]{constructor(e,t,i,r,n,a=r,o=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new s["a"](e),this.x=t,this.y=i,this.width=r,this.height=n,this.rangeX=a,this.rangeY=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,[s,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,l=this.height/this.rangeY*i;Object(r["n"])(n,o,0,0,0,l,0,s,a,1),Object(r["k"])(this.transforms.dvs,e.displayViewMat3,n)}}}}]);
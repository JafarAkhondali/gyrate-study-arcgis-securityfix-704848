{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/layers/support/popupUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","webpack:///./node_modules/@arcgis/core/views/layers/ImageryLayerView.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","webpack:///./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js"],"names":["o","super","arguments","this","updateWhenStationary","redrawDebounced","async","redraw","e","t","redrawImage","signal","handles","add","view","basemapTerrain","initializeMaximumDataResolution","layer","on","updatingHandles","addPromise","refreshDebounced","spatialReference","fullExtent","equals","maximumDataResolution","x","pixelSizeX","y","pixelSizeY","timeExtent","a","imageElement","image","document","createElement","pixelData","HTMLCanvasElement","Promise","reject","i","getContext","r","applyRenderer","s","applyFilter","pixelBlock","width","height","n","createImageData","data","set","getAsRGBA","putImageData","Math","round","createSquareGeometry","min","max","h","u","l","c","m","g","w","Float64Array","d","Float32Array","f","Uint32Array","p","M","v","b","length","size","exclusive","getLogger","T","drapeSourceType","fullExtentInLocalViewSpatialReference","_images","Array","_extents","_overlayExtents","addResolvingPromise","then","_set","_suspendedChangeHandler","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","viewingMode","forEach","_updateImageExtent","clear","extent","resolution","renderLocalOrigin","pixelRatio","_clippedExtent","H","imageMaxWidth","imageMaxHeight","floor","_imageSizeDiffers","imageSize","suspended","_fetch","catch","error","_clearImage","push","canResume","minScale","maxScale","scale","some","loadingPromise","HTMLImageElement","contains","_createStageObjects","TESTS_DISABLE_UPDATE_THRESHOLDS","abs","texture","material","rendergeometry","loadingAbortController","renderExtent","abort","_waitFetchReady","requestAsImageElement","getFetchOptions","timestamp","refreshTimestamp","fetchImage","warnOnce","processResult","_stage","overlayManager","renderer","removeGeometries","remove","preMultiplyAlpha","wrap","transparent","textureId","id","setParameterValues","console","origin","addGeometries","ready","refresh","prototype","readOnly","O","popupTemplate","getRequiredFields","fields","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","indexOf","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate","shader","get","configuration","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","OITEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","rctx","generateSource","bindProjectionMatrix","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","bindView","bindUniformsWithOrigin","face","mode","blending","S","culling","cullFace","depthTest","func","depthWrite","writeDepth","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","enableOffset","_occludeePipelineState","setPipelineState","pipeline","count","supportsEdges","techniqueConfig","params","relativeElevation","updateParameters","updateTexture","technique","techniqueRep","acquireAndReleaseExisting","getTechniqueConfig","hasOccludees","_updateOccludeeState","bindProgram","bindTexture","bindTextureScale","bindPass","getPipelineState","initTextureTransparent","popupEnabled","geometry","outFields","outSpatialReference","type","returnTopmostRaster","showNoDataRecords","layerOptions","returnDomainValues","pixelSize","queryVisibleRasters","isEmpty","resolve","clone","state","isLocal","portalItem","destroyed","include","linearDepth","vertex","uniforms","attributes","varyings","code","fragment","float","Object","freeze","__proto__"],"mappings":"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","file":"js/chunk-33c596ba.d41e60d0.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{whenOnce as i}from\"../../../core/watchUtils.js\";import{ImageryLayerView as r}from\"../../layers/ImageryLayerView.js\";import s from\"./DynamicLayerView3D.js\";let o=class extends(r(s)){constructor(){super(...arguments),this.updateWhenStationary=!0,this.redrawDebounced=a((async e=>{this.redraw(((e,t)=>this.redrawImage(e,{signal:t})),e)}),2e3)}initialize(){this.handles.add([i(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this.redrawImage(e,{signal:a}))}async redrawImage(e,t){if(!(e.image instanceof HTMLCanvasElement&&e.pixelData))return Promise.reject();const a=e.image,i=a.getContext(\"2d\"),r=await this.layer.applyRenderer(e.pixelData,t),s=this.layer.applyFilter(r),o=s.pixelBlock;a.width=o.width,a.height=o.height;const n=i.createImageData(o.width,o.height);n.data.set(s.pixelBlock.getAsRGBA()),i.putImageData(n,0,0)}};o=e([t(\"esri.views.3d.layers.ImageryLayerView3D\")],o);var n=o;export default n;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import o from\"../../webgl-engine/lib/GeometryUtil.js\";function r(n,i,o){const r=t(n)/e(n),a={width:o,height:o};return r>1.0001?a.height=o/r:r<.9999&&(a.width=o*r),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t,e){const n=[[t[0],t[1],e],[t[2],t[1],e],[t[2],t[3],e],[t[0],t[3],e]];return o.createSquareGeometry(n)}function h(t,e,o){if(!n(t,e))return a(e,o);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],h=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],u=e[2]-e[0],l=e[3]-e[1],c=h[0]>0&&h[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,g=(m+1)*(c+1),w=new Float64Array(3*g),d=new Float32Array(2*g),f=new Uint32Array(6*(m*c-1));let p=0,y=0,x=0,M=0,v=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=h[r];t<=0||(w[y++]=e[0]+i,w[y++]=e[1]+p,w[y++]=o,d[x++]=i/u,d[x++]=p/l,r<3&&n<3&&(1!==r||1!==n)&&(f[v++]=M,f[v++]=M+1,f[v++]=M+c+1,f[v++]=M+1,f[v++]=M+c+2,f[v++]=M+c+1),M++,i+=t)}p+=t}const b=new Uint32Array(f.length);return new i([[\"position\",{size:3,data:w,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:d,exclusive:!0}]],[[\"position\",f],[\"normal\",b],[\"uv0\",f]])}const s=[0,0,1];export{r as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as a,eachAlways as s,createAbortController as n,onAbort as o,isAborted as l,createAbortError as h,always as m,throwIfAborted as d}from\"../../../core/promiseUtils.js\";import c from\"../../../geometry/Extent.js\";import{forEach as g}from\"../../../core/asyncUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{create as p,equals as y,width as f,height as x,set as w,intersection as _}from\"../../../geometry/support/aaBoundingRect.js\";import{RefreshableLayerView as v}from\"../../layers/RefreshableLayerView.js\";import R from\"../support/debugFlags.js\";import{RenderGeometry as S}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as b}from\"../webgl-engine/lib/Texture.js\";import{LayerView3D as E}from\"./LayerView3D.js\";import j from\"../../layers/LayerView.js\";import{ImageMaterial as I}from\"../webgl-engine/materials/ImageMaterial.js\";import{computeImageExportSize as L,createGeometryForExtent as A,createOuterImageGeometry as C}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as D}from\"./support/projectExtentUtils.js\";const M=t.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let T=class extends(v(E(j))){constructor(){super(...arguments),this.drapeSourceType=0,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlayExtents=new Array,this.updateWhenStationary=!0}initialize(){this.addResolvingPromise(D(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\"))),\"local\"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,\"extent\",(()=>this._overlayExtents.forEach(((e,t)=>this._updateImageExtent(t)))))}destroy(){this.clear()}setDrapingExtent(e,t,i,r,a,s){this._overlayExtents[e]={extent:p(t),spatialReference:i,resolution:r,renderLocalOrigin:a,pixelRatio:s},this._updateImageExtent(e)}_updateImageExtent(e){const t=this._overlayExtents[e],i=this._clippedExtent(t.extent,H),r=L(t.extent,i,t.resolution);let s=t.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(r.width>e){const t=e/r.width;r.height=Math.floor(r.height*t),r.width=e,s*=t}if(r.height>t){const e=t/r.height;r.width=Math.floor(r.width*e),r.height=t,s*=e}}const n=this._extents[e];n&&y(n.extent,i)&&!this._imageSizeDiffers(i,n.imageSize,r)||(this._extents[e]={extent:p(i),spatialReference:t.spatialReference,imageSize:r,pixelRatio:s},this.suspended||this._fetch(e).catch((e=>{a(e)||M.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await s(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new c(i[0],i[1],i[2],i[3],t.spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,t){await g(this._images,(async(i,r)=>{i&&(await e(i,t),this._createStageObjects(r,i.image))}))}_imageSizeDiffers(e,t,i){if(!this.maximumDataResolution)return!0;if(R.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=f(e)/this.maximumDataResolution.x,a=x(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h>1.5||m>1.5}async _fetch(e,t){if(this.suspended)return;const i=this._overlayExtents[e],r=this._extents[e],s=r.extent,d=new c(s[0],s[1],s[2],s[3],r.spatialReference);this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:p(s)});const g=this._images[e];if(g.loadingAbortController&&(g.loadingAbortController.abort(),g.loadingAbortController=null),0===d.width||0===d.height)return void this._clearImage(e);const u=n();g.loadingAbortController=u,o(t,(()=>u.abort()));const y=u.signal,f=this._waitFetchReady(y).then((()=>{const e={requestAsImageElement:!0,pixelRatio:i.pixelRatio,...this.getFetchOptions(),signal:y},{height:t,width:a}=r.imageSize;return e.timestamp=this.refreshTimestamp,this.layer.fetchImage(d,a,t,e)})).then((e=>{if(l(y))throw M.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),h();return this.processResult(g,e)}));g.loadingPromise=f,m(f,(()=>{f===g.loadingPromise&&(g.loadingPromise=null,g.loadingAbortController=null)}));const x=f.then((()=>{w(g.renderExtent,s),this._createStageObjects(e,g.image),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!a(e)&&M.error(e),this.notifyChange(\"updating\"),e}));this.notifyChange(\"updating\"),await x}_clearImage(e){const t=this._images[e],i=this.view._stage;t&&(t.rendergeometry&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.rendergeometry],this,2),t.rendergeometry=null),t.texture&&(i.remove(t.texture),t.texture=null),t.material&&(i.remove(t.material),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)}_createStageObjects(e,t){const i=this.view._stage,r=this._images[e];r.texture&&(i.remove(r.texture),r.texture=null),t?(r.texture=new b(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),i.add(r.texture)):r.material&&(i.remove(r.material),r.material=null),!r.material&&r.texture?(r.material=new I({transparent:!0,textureId:r.texture.id}),i.add(r.material)):r.material&&t&&r.material.setParameterValues({textureId:r.texture.id});const a=this.view.basemapTerrain.overlayManager.renderer;if(r.material){const t=-1;let i;const s=this._overlayExtents[e].renderLocalOrigin;if(0===e)i=A(r.renderExtent,t);else{if(1!==e)return void console.error(\"DynamicLayerView3D._createStageObjects: Invalid extent idx\");{const e=this._extents[0].extent;if(!e)return;i=C(e,r.renderExtent,t)}}const n=new S(i,r.material);n.origin=s,a.addGeometries([n],this,2),r.rendergeometry&&a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=n}else r.rendergeometry&&(a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=null)}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return w(t,e);const i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?_(e,r,t):w(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refresh()}async _waitFetchReady(e){this.updateWhenStationary&&await u(this.view,\"stationary\",e),d(e)}};e([i()],T.prototype,\"layer\",void 0),e([i()],T.prototype,\"suspended\",void 0),e([i({readOnly:!0})],T.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([i()],T.prototype,\"updating\",void 0),T=e([r(\"esri.views.3d.layers.DynamicLayerView3D\")],T);const H=p();var O=T;export default O;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{ReloadableShaderModule as t}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as r}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as i,parameter as s}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as a}from\"../lib/DefaultVertexAttributeLocations.js\";import o from\"../../../webgl/Program.js\";import{makePipelineState as n,defaultDepthWriteParams as l,defaultColorWriteParams as p,simpleBlendingParams as c}from\"../../../webgl/renderState.js\";import{View as u}from\"../core/shaderLibrary/util/View.glsl.js\";import{Slice as d}from\"../core/shaderLibrary/Slice.glsl.js\";import{OITBlending as h,OITDepthTest as m,OITDepthWrite as f,getOITPolygonOffset as b}from\"../lib/OrderIndependentTransparency.js\";import{bindMultipassTerrainUniforms as g}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{stencilWriteMaskOn as y,stencilToolMaskBaseParams as P,stencilBaseAllZerosParams as T}from\"../lib/StencilUtils.js\";import{I as v}from\"../../../../chunks/ImageMaterial.glsl.js\";class j extends r{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new o(e.rctx,i.generateSource(\"vertex\"),i.generateSource(\"fragment\"),a)}bindPass(e,t,r){u.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",t.opacity),r.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",r.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",r.inverseViewport),g(this.program,e,r))}bindDraw(e){u.bindView(this.program,e),d.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e,a=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return n({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?S:h(e),culling:a(r.cullFace),depthTest:{func:m(e)},depthWrite:i?r.writeDepth&&l:f(e),colorWrite:p,stencilWrite:r.sceneHasOcludees?y:null,stencilTest:r.sceneHasOcludees?t?P:T:null,polygonOffset:i||s?null:b(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}j.shader=new t(v,(()=>import(\"./ImageMaterial.glsl.js\")));const S=c(1,771);class w extends i{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}e([s({count:8})],w.prototype,\"output\",void 0),e([s({count:3})],w.prototype,\"cullFace\",void 0),e([s()],w.prototype,\"slicePlaneEnabled\",void 0),e([s()],w.prototype,\"transparent\",void 0),e([s()],w.prototype,\"enableOffset\",void 0),e([s()],w.prototype,\"writeDepth\",void 0),e([s()],w.prototype,\"sceneHasOcludees\",void 0),e([s({count:4})],w.prototype,\"transparencyPassType\",void 0),e([s()],w.prototype,\"multipassTerrainEnabled\",void 0),e([s()],w.prototype,\"cullAboveGround\",void 0);export{j as ImageMaterialTechnique,w as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport e from\"../lib/GLMaterialTexture.js\";import{intersectTriangleGeometry as t}from\"./internal/MaterialUtil.js\";import{Material as i,materialParametersDefaults as a}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as r,PositionUVLayout as n}from\"./internal/DefaultBufferWriter.js\";import{ImageMaterialTechniqueConfiguration as u,ImageMaterialTechnique as h}from\"../shaders/ImageMaterialTechnique.js\";class c extends i{constructor(e){super(e,o),this.supportsEdges=!0,this.techniqueConfig=new u}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,i,a,s,r,n,u){t(e,i,s,r,n,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new r(n)}}class l extends e{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(h,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(4===this.output)return 3===e;return e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const o={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...a};export{c as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../tasks/support/Query.js\";import{getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const n=n=>{let c=class extends n{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:t}=this;if(!e)throw new s(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:t});const{popupEnabled:i}=t,n=u(t,o);if(!i||!r(n))throw new s(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:n});const c=await n.getRequiredFields(),m=new a;m.geometry=e,m.outFields=c,m.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:d,showNoDataRecords:w}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},h={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:y,showNoDataRecords:w};return t.queryVisibleRasters(m,h).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],c.prototype,\"layer\",void 0),e([o()],c.prototype,\"suspended\",void 0),e([o(i)],c.prototype,\"timeExtent\",void 0),e([o()],c.prototype,\"view\",void 0),c=e([t(\"esri.views.layers.ImageryLayerView\")],c),c};export default n;export{n as ImageryLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{canProject as e,project as r}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as o}from\"../../../../portal/support/geometryServiceUtils.js\";function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;return i?i.equals(l)?Promise.resolve(s.clone()):e(i,l)?Promise.resolve(r(s,l)):t.view.state.isLocal?o(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null):Promise.resolve(null)}export{t as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ShaderBuilder as a}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";import{ColorConversion as o}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{Slice as i}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{ReadLinearDepth as d}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{defaultMaskAlphaCutoff as t}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{multipassTerrainTest as l}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";function s(s){const n=new a;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(e`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(i,s),s.multipassTerrainEnabled&&(n.fragment.include(d),n.include(l,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(e`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${e.float(t)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(o),n.fragment.code.add(e`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${e.float(t)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n"],"sourceRoot":""}
{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/views/3d/layers/BaseDynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","webpack:///./node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","webpack:///./node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","webpack:///./node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js"],"names":["e","t","n","i","o","r","a","width","height","Math","round","createSquareGeometry","min","max","h","u","l","c","m","g","w","Float64Array","d","Float32Array","f","Uint32Array","p","y","x","M","v","b","length","size","data","exclusive","getLogger","T","super","arguments","this","drapeSourceType","fullExtentInLocalViewSpatialReference","maximumDataResolution","_images","Array","_extents","_overlayExtents","updateWhenStationary","addResolvingPromise","then","_set","updatingHandles","add","_suspendedChangeHandler","handles","view","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","layer","viewingMode","basemapTerrain","forEach","_updateImageExtent","clear","s","extent","spatialReference","resolution","renderLocalOrigin","pixelRatio","_clippedExtent","H","imageMaxWidth","imageMaxHeight","floor","_imageSizeDiffers","imageSize","suspended","_fetch","catch","error","_clearImage","push","canResume","minScale","maxScale","scale","some","loadingPromise","HTMLImageElement","HTMLCanvasElement","image","contains","_createStageObjects","TESTS_DISABLE_UPDATE_THRESHOLDS","abs","texture","material","rendergeometry","loadingAbortController","pixelData","renderExtent","abort","signal","_waitFetchReady","requestAsImageElement","getFetchOptions","timestamp","refreshTimestamp","fetchImage","warnOnce","processResult","_stage","overlayManager","renderer","removeGeometries","remove","preMultiplyAlpha","wrap","transparent","textureId","id","setParameterValues","console","origin","addGeometries","ready","refresh","prototype","readOnly","O","shader","get","configuration","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","OITEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","rctx","generateSource","bindProjectionMatrix","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","bindView","bindUniformsWithOrigin","face","mode","blending","S","culling","cullFace","depthTest","func","depthWrite","writeDepth","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","polygonOffset","enableOffset","_occludeePipelineState","setPipelineState","pipeline","count","supportsEdges","techniqueConfig","params","relativeElevation","updateParameters","updateTexture","technique","techniqueRep","acquireAndReleaseExisting","getTechniqueConfig","hasOccludees","_updateOccludeeState","bindProgram","bindTexture","bindTextureScale","bindPass","getPipelineState","initTextureTransparent","fullExtent","equals","Promise","resolve","clone","state","isLocal","portalItem","destroyed","include","linearDepth","vertex","uniforms","attributes","varyings","code","fragment","float","Object","freeze","__proto__"],"mappings":"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","file":"js/chunk-0ad75820.6e1fcb47.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import o from\"./DynamicLayerView3D.js\";let e=class extends o{};e=r([s(\"esri.views.3d.layers.BaseDynamicLayerView3D\")],e);var t=e;export default t;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import o from\"../../webgl-engine/lib/GeometryUtil.js\";function r(n,i,o){const r=t(n)/e(n),a={width:o,height:o};return r>1.0001?a.height=o/r:r<.9999&&(a.width=o*r),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t,e){const n=[[t[0],t[1],e],[t[2],t[1],e],[t[2],t[3],e],[t[0],t[3],e]];return o.createSquareGeometry(n)}function h(t,e,o){if(!n(t,e))return a(e,o);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],h=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],u=e[2]-e[0],l=e[3]-e[1],c=h[0]>0&&h[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,g=(m+1)*(c+1),w=new Float64Array(3*g),d=new Float32Array(2*g),f=new Uint32Array(6*(m*c-1));let p=0,y=0,x=0,M=0,v=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=h[r];t<=0||(w[y++]=e[0]+i,w[y++]=e[1]+p,w[y++]=o,d[x++]=i/u,d[x++]=p/l,r<3&&n<3&&(1!==r||1!==n)&&(f[v++]=M,f[v++]=M+1,f[v++]=M+c+1,f[v++]=M+1,f[v++]=M+c+2,f[v++]=M+c+1),M++,i+=t)}p+=t}const b=new Uint32Array(f.length);return new i([[\"position\",{size:3,data:w,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:d,exclusive:!0}]],[[\"position\",f],[\"normal\",b],[\"uv0\",f]])}const s=[0,0,1];export{r as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as a,eachAlways as s,createAbortController as n,onAbort as o,isAborted as l,createAbortError as h,always as m,throwIfAborted as d}from\"../../../core/promiseUtils.js\";import c from\"../../../geometry/Extent.js\";import{forEach as g}from\"../../../core/asyncUtils.js\";import{whenOnce as u}from\"../../../core/watchUtils.js\";import{create as p,equals as y,width as f,height as x,set as w,intersection as _}from\"../../../geometry/support/aaBoundingRect.js\";import{RefreshableLayerView as v}from\"../../layers/RefreshableLayerView.js\";import R from\"../support/debugFlags.js\";import{RenderGeometry as S}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as b}from\"../webgl-engine/lib/Texture.js\";import{LayerView3D as E}from\"./LayerView3D.js\";import j from\"../../layers/LayerView.js\";import{ImageMaterial as I}from\"../webgl-engine/materials/ImageMaterial.js\";import{computeImageExportSize as L,createGeometryForExtent as A,createOuterImageGeometry as C}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as D}from\"./support/projectExtentUtils.js\";const M=t.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let T=class extends(v(E(j))){constructor(){super(...arguments),this.drapeSourceType=0,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlayExtents=new Array,this.updateWhenStationary=!0}initialize(){this.addResolvingPromise(D(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\"))),\"local\"===this.view.viewingMode&&this.updatingHandles.add(this.view.basemapTerrain,\"extent\",(()=>this._overlayExtents.forEach(((e,t)=>this._updateImageExtent(t)))))}destroy(){this.clear()}setDrapingExtent(e,t,i,r,a,s){this._overlayExtents[e]={extent:p(t),spatialReference:i,resolution:r,renderLocalOrigin:a,pixelRatio:s},this._updateImageExtent(e)}_updateImageExtent(e){const t=this._overlayExtents[e],i=this._clippedExtent(t.extent,H),r=L(t.extent,i,t.resolution);let s=t.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(r.width>e){const t=e/r.width;r.height=Math.floor(r.height*t),r.width=e,s*=t}if(r.height>t){const e=t/r.height;r.width=Math.floor(r.width*e),r.height=t,s*=e}}const n=this._extents[e];n&&y(n.extent,i)&&!this._imageSizeDiffers(i,n.imageSize,r)||(this._extents[e]={extent:p(i),spatialReference:t.spatialReference,imageSize:r,pixelRatio:s},this.suspended||this._fetch(e).catch((e=>{a(e)||M.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await s(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new c(i[0],i[1],i[2],i[3],t.spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,t){await g(this._images,(async(i,r)=>{i&&(await e(i,t),this._createStageObjects(r,i.image))}))}_imageSizeDiffers(e,t,i){if(!this.maximumDataResolution)return!0;if(R.TESTS_DISABLE_UPDATE_THRESHOLDS)return!0;const r=f(e)/this.maximumDataResolution.x,a=x(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h>1.5||m>1.5}async _fetch(e,t){if(this.suspended)return;const i=this._overlayExtents[e],r=this._extents[e],s=r.extent,d=new c(s[0],s[1],s[2],s[3],r.spatialReference);this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:p(s)});const g=this._images[e];if(g.loadingAbortController&&(g.loadingAbortController.abort(),g.loadingAbortController=null),0===d.width||0===d.height)return void this._clearImage(e);const u=n();g.loadingAbortController=u,o(t,(()=>u.abort()));const y=u.signal,f=this._waitFetchReady(y).then((()=>{const e={requestAsImageElement:!0,pixelRatio:i.pixelRatio,...this.getFetchOptions(),signal:y},{height:t,width:a}=r.imageSize;return e.timestamp=this.refreshTimestamp,this.layer.fetchImage(d,a,t,e)})).then((e=>{if(l(y))throw M.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),h();return this.processResult(g,e)}));g.loadingPromise=f,m(f,(()=>{f===g.loadingPromise&&(g.loadingPromise=null,g.loadingAbortController=null)}));const x=f.then((()=>{w(g.renderExtent,s),this._createStageObjects(e,g.image),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!a(e)&&M.error(e),this.notifyChange(\"updating\"),e}));this.notifyChange(\"updating\"),await x}_clearImage(e){const t=this._images[e],i=this.view._stage;t&&(t.rendergeometry&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.rendergeometry],this,2),t.rendergeometry=null),t.texture&&(i.remove(t.texture),t.texture=null),t.material&&(i.remove(t.material),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)}_createStageObjects(e,t){const i=this.view._stage,r=this._images[e];r.texture&&(i.remove(r.texture),r.texture=null),t?(r.texture=new b(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}}),i.add(r.texture)):r.material&&(i.remove(r.material),r.material=null),!r.material&&r.texture?(r.material=new I({transparent:!0,textureId:r.texture.id}),i.add(r.material)):r.material&&t&&r.material.setParameterValues({textureId:r.texture.id});const a=this.view.basemapTerrain.overlayManager.renderer;if(r.material){const t=-1;let i;const s=this._overlayExtents[e].renderLocalOrigin;if(0===e)i=A(r.renderExtent,t);else{if(1!==e)return void console.error(\"DynamicLayerView3D._createStageObjects: Invalid extent idx\");{const e=this._extents[0].extent;if(!e)return;i=C(e,r.renderExtent,t)}}const n=new S(i,r.material);n.origin=s,a.addGeometries([n],this,2),r.rendergeometry&&a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=n}else r.rendergeometry&&(a.removeGeometries([r.rendergeometry],this,2),r.rendergeometry=null)}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return w(t,e);const i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?_(e,r,t):w(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refresh()}async _waitFetchReady(e){this.updateWhenStationary&&await u(this.view,\"stationary\",e),d(e)}};e([i()],T.prototype,\"layer\",void 0),e([i()],T.prototype,\"suspended\",void 0),e([i({readOnly:!0})],T.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([i()],T.prototype,\"updating\",void 0),T=e([r(\"esri.views.3d.layers.DynamicLayerView3D\")],T);const H=p();var O=T;export default O;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{ReloadableShaderModule as t}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as r}from\"../core/shaderTechnique/ShaderTechnique.js\";import{ShaderTechniqueConfiguration as i,parameter as s}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as a}from\"../lib/DefaultVertexAttributeLocations.js\";import o from\"../../../webgl/Program.js\";import{makePipelineState as n,defaultDepthWriteParams as l,defaultColorWriteParams as p,simpleBlendingParams as c}from\"../../../webgl/renderState.js\";import{View as u}from\"../core/shaderLibrary/util/View.glsl.js\";import{Slice as d}from\"../core/shaderLibrary/Slice.glsl.js\";import{OITBlending as h,OITDepthTest as m,OITDepthWrite as f,getOITPolygonOffset as b}from\"../lib/OrderIndependentTransparency.js\";import{bindMultipassTerrainUniforms as g}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{stencilWriteMaskOn as y,stencilToolMaskBaseParams as P,stencilBaseAllZerosParams as T}from\"../lib/StencilUtils.js\";import{I as v}from\"../../../../chunks/ImageMaterial.glsl.js\";class j extends r{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new o(e.rctx,i.generateSource(\"vertex\"),i.generateSource(\"fragment\"),a)}bindPass(e,t,r){u.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",t.opacity),r.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",r.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",r.inverseViewport),g(this.program,e,r))}bindDraw(e){u.bindView(this.program,e),d.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e,a=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return n({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?S:h(e),culling:a(r.cullFace),depthTest:{func:m(e)},depthWrite:i?r.writeDepth&&l:f(e),colorWrite:p,stencilWrite:r.sceneHasOcludees?y:null,stencilTest:r.sceneHasOcludees?t?P:T:null,polygonOffset:i||s?null:b(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}j.shader=new t(v,(()=>import(\"./ImageMaterial.glsl.js\")));const S=c(1,771);class w extends i{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}e([s({count:8})],w.prototype,\"output\",void 0),e([s({count:3})],w.prototype,\"cullFace\",void 0),e([s()],w.prototype,\"slicePlaneEnabled\",void 0),e([s()],w.prototype,\"transparent\",void 0),e([s()],w.prototype,\"enableOffset\",void 0),e([s()],w.prototype,\"writeDepth\",void 0),e([s()],w.prototype,\"sceneHasOcludees\",void 0),e([s({count:4})],w.prototype,\"transparencyPassType\",void 0),e([s()],w.prototype,\"multipassTerrainEnabled\",void 0),e([s()],w.prototype,\"cullAboveGround\",void 0);export{j as ImageMaterialTechnique,w as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport e from\"../lib/GLMaterialTexture.js\";import{intersectTriangleGeometry as t}from\"./internal/MaterialUtil.js\";import{Material as i,materialParametersDefaults as a}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as r,PositionUVLayout as n}from\"./internal/DefaultBufferWriter.js\";import{ImageMaterialTechniqueConfiguration as u,ImageMaterialTechnique as h}from\"../shaders/ImageMaterialTechnique.js\";class c extends i{constructor(e){super(e,o),this.supportsEdges=!0,this.techniqueConfig=new u}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,i,a,s,r,n,u){t(e,i,s,r,n,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new r(n)}}class l extends e{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(h,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(4===this.output)return 3===e;return e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const o={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...a};export{c as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{canProject as e,project as r}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as o}from\"../../../../portal/support/geometryServiceUtils.js\";function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;return i?i.equals(l)?Promise.resolve(s.clone()):e(i,l)?Promise.resolve(r(s,l)):t.view.state.isLocal?o(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null):Promise.resolve(null)}export{t as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{glsl as e}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ShaderBuilder as a}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";import{ColorConversion as o}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{Slice as i}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{ReadLinearDepth as d}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{defaultMaskAlphaCutoff as t}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{multipassTerrainTest as l}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";function s(s){const n=new a;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(e`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(i,s),s.multipassTerrainEnabled&&(n.fragment.include(d),n.include(l,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(e`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${e.float(t)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(o),n.fragment.code.add(e`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${e.float(t)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n"],"sourceRoot":""}
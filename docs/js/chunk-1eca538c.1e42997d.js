(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1eca538c"],{"0e0b":function(e,t,r){"use strict";var i=r("a4ee"),n=(r("c120"),r("e92d"),r("cea0"),r("59b2")),s=r("d386"),a=(r("e041"),r("8eed"),r("f402"),r("fc29")),o=r("ce6d"),c=r("9180"),l=r("8188"),u=r("0fc4"),d=r("4261");let b=class extends a["a"]{constructor(e){super(e),this.events=new o["a"]}destroy(){}forEach(e){this.forAllFeatures(t=>(e(t),1))}forEachBounds(e,t,r){const i=this.getFeatureExtent;for(const n of e)t(i(n,r))}forEachInBounds(e,t){this.forAllFeatures(r=>{const i=this.getFeatureExtent(r,h);return Object(c["w"])(e,Object(d["G"])(i,f))&&t(r),1},t=>{if(Object(l["p"])(t.node.mbs,this.sourceSpatialReference,p,this.viewSpatialReference),p[0]>=e[0]&&p[2]<=e[2]&&p[1]>=e[1]&&p[3]<=e[3])return 1;const r=Math.max(e[0],Math.min(p[0],e[2])),i=Math.max(e[1],Math.min(p[1],e[3])),n=p[0]-r,s=p[1]-i;return n*n+s*s<=p[3]*p[3]?1:2})}};Object(i["a"])([Object(n["b"])({constructOnly:!0})],b.prototype,"featureAdapter",void 0),Object(i["a"])([Object(n["b"])({constructOnly:!0})],b.prototype,"forAllFeatures",void 0),Object(i["a"])([Object(n["b"])({constructOnly:!0})],b.prototype,"getFeatureExtent",void 0),Object(i["a"])([Object(n["b"])({constructOnly:!0})],b.prototype,"sourceSpatialReference",void 0),Object(i["a"])([Object(n["b"])({constructOnly:!0})],b.prototype,"viewSpatialReference",void 0),b=Object(i["a"])([Object(s["a"])("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],b);const p=Object(u["c"])(),h=Object(d["h"])(),f=Object(c["l"])();var y=b;t["a"]=y},"16d0":function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r("a4ee"),n=(r("c120"),r("e92d")),s=(r("cea0"),r("59b2")),a=r("d386"),o=(r("e041"),r("8eed"),r("f402"),r("66a2")),c=r("ee9c");const l=n["a"].getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),u=e=>{let t=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&l.error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&l.error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const e=o["WhereClause"].create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return l.error("definitionExpression is using non standard function"),null;const t=[],r=e.fieldNames;return Object(c["l"])(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(l.error("definitionExpression references unknown fields: "+t.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return l.error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}_evaluateClause(e,t){try{return e.testFeature(t)}catch(r){return this.logError(r),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;const t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where=`(${t}) AND (${r.where})`:r.where=t,r}};return Object(i["a"])([Object(s["b"])()],t.prototype,"i3slayer",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),Object(i["a"])([Object(s["b"])({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=Object(i["a"])([Object(a["a"])("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},"18cc":function(e,t,r){"use strict";var i=r("a4ee"),n=(r("c120"),r("b2b2")),s=(r("e92d"),r("cea0"),r("59b2")),a=r("d386"),o=r("ce50"),c=(r("e041"),r("8eed"),r("f402"),r("fc29")),l=r("3af1"),u=r("af40"),d=r("f29a"),b=r("c64f"),p=r("6411");const h=p["a"];let f=class extends c["a"]{constructor(e){super(e),this._dataQueryEngineInstance=null,this._handles=new u["a"]}get defaultQueryJSON(){return new b["a"]({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}initialize(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null),this._handles&&(this._handles.destroy(),this._handles=null),this._set("layerView",null)}async executeQueryForCount(e,t){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:r,extent:i}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:r,extent:l["a"].fromJSON(i)}}async executeQueryForIds(e,t){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQuery(e,t){const r=this._ensureQueryJSON(e);if(r.returnGeometry)throw new o["a"]("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(r.returnCentroid)throw new o["a"]("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const i=await this.dataQueryEngine.executeQuery(r,t),n=d["default"].fromJSON(i);return n.features.forEach(e=>{e.geometry=null}),n}_ensureQueryJSON(e){if(Object(n["j"])(e))return this.defaultQueryJSON;const t=e.toJSON();return t.outSpatialReference||(e.outSpatialReference=this.spatialReference),t}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=this.layer.objectIdField||"OBJECTID",t="esriGeometryPolygon",r=this.layer.fields.map(e=>e.toJSON()),i=this.layerView.view.resourceController.scheduler,n=this.spatialReference.toJSON(),s=this.task,a=this.spatialIndex;return this._dataQueryEngineInstance=new h({hasZ:!0,hasM:!1,geometryType:t,fields:r,timeInfo:null,spatialReference:n,objectIdField:e,featureStore:a,scheduler:i,task:s}),this._dataQueryEngineInstance}};Object(i["a"])([Object(s["b"])({constructOnly:!0})],f.prototype,"layerView",void 0),Object(i["a"])([Object(s["b"])({constructOnly:!0})],f.prototype,"task",void 0),Object(i["a"])([Object(s["b"])({constructOnly:!0})],f.prototype,"spatialIndex",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],f.prototype,"spatialReference",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0,aliasOf:"layerView.i3slayer"})],f.prototype,"layer",void 0),Object(i["a"])([Object(s["b"])({readOnly:!0})],f.prototype,"defaultQueryJSON",null),f=Object(i["a"])([Object(a["a"])("esri.views.3d.layers.i3s.I3SQueryEngine")],f);var y=f;t["a"]=y},"1e7c":function(e,t,r){"use strict";r.r(t);var i=r("a4ee"),n=(r("c120"),r("b2b2")),s=r("e92d"),a=(r("cea0"),r("59b2")),o=r("d386"),c=(r("e041"),r("8eed"),r("f402"),r("8d60")),l=r("9305"),u=r("66a2"),d=r("c64f"),b=r("66af"),p=r("9ee2"),h=r("33c9"),f=r("e315"),y=r("ee9c"),j=r("9a0d"),O=r("4c7e"),g=r("4bb0"),w=r("18cc"),m=r("8ea5"),v=r("0e0b"),F=r("16d0"),E=r("72e1"),x=r("f7f0"),S=r("dd25"),I=r("f426"),_=r("bb87");const R=s["a"].getLogger("esri.views.3d.layers.SceneLayerView3D"),Q=Object(I["a"])();let k=class extends(Object(O["a"])(Object(F["a"])(Object(x["a"])(Object(b["a"])(f["a"]))))){constructor(){super(...arguments),this.lodFactor=1,this.progressiveLoadFactor=1,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!0,this._interactiveEditingSessions=new Map,this._queryEngine=null}get filter(){return Object(n["k"])(this.viewFilter)?this.viewFilter.filter:null}set filter(e){!Object(n["j"])(e)&&g["a"].checkSupport(e)?Object(n["k"])(this.viewFilter)?this.viewFilter.filter=e:this.viewFilter=new g["a"]({filter:e,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(e,t)=>this.addSqlFilter(e,t,this.logError)}):this.viewFilter=null}get requiredFields(){var e,t;return null!=(e=null==(t=this.fieldsHelper)?void 0:t.requiredFields)?e:[]}get floorFilterClause(){const e=Object(E["a"])(this);return Object(n["k"])(e)?u["WhereClause"].create(e,this.layer.fieldsIndex):null}get lodCrossfadeinDuration(){var e,t;return null!=(e=null==(t=this.view)?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?e:0}get lodCrossfadeoutDuration(){var e,t;return null!=(e=null==(t=this.view)?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?e:0}get lodCrossfadeUncoveredDuration(){var e,t;return null!=(e=null==(t=this.view)?void 0:t.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?e:0}initialize(){this.fieldsHelper=new _["a"]({layerView:this}),this.updatingHandles.add(this.layer,"rangeInfos",e=>this._rangeInfosChanged(e),2),this.updatingHandles.add(this.layer,"renderer",e=>this.updatingHandles.addPromise(this._rendererChange(e)),2);for(const e of["parsedDefinitionExpression","filter","viewFilter.parsedWhereClause","viewFilter.parsedGeometry","viewFilter.sortedObjectIds","floorFilterClause"])this.updatingHandles.add(this,e,()=>this._filterChange());for(const e of["filter","viewFilter.parsedGeometry"])this.updatingHandles.add(this,e,()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",e=>this.updatingHandles.addPromise(e.result))),this.handles.add(this.layer.on("edits",e=>this._handleEdits(e)))}destroy(){this.fieldsHelper=Object(n["e"])(this.fieldsHelper)}_rangeInfosChanged(e){null!=e&&e.length>0&&R.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return Object(n["k"])(this.filter)?this.filter.createQuery(e):new d["a"](e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null==t?void 0:t.signal).then(e=>{if(null==e||!e.features)return e;const t=this.layer;for(const r of e.features)r.layer=t,r.sourceLayer=t;return e})}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQueryEngine(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=Object(j["c"])(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new w["a"]({layerView:this,task:l["b"].FEATURE_QUERY_ENGINE,spatialIndex:new v["a"]({featureAdapter:new m["a"]({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:e}),forAllFeatures:(e,t)=>this._forAllFeatures((t,r,i)=>e({id:t,index:r,meta:i}),t,2),getFeatureExtent:e,sourceSpatialReference:Object(y["q"])(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(e){const t=this._highlights;if(e instanceof d["a"]){const{set:r,handle:i}=t.acquireSet();return this.queryObjectIds(e).then(e=>t.setFeatureIds(r,e)),i}return super.highlight(e)}createInteractiveEditSession(e){return Object(S["a"])(this.attributeEditingContext,e)}_createLayerGraphic(e){const t=new c["a"](null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}getFilters(){const e=super.getFilters();return this.floorFilterClause&&this.addSqlFilter(e,this.floorFilterClause,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),Object(n["k"])(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}_ensureQuery(e){return this._addDefinitionExpressionToQuery(Object(n["j"])(e)?this.createQuery():d["a"].from(e))}get attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:e=>this._forAllNodes(t=>Object(n["k"])(t)?e(t.node,t.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:e=>this.getAttributeData(e),setAttributeData:(e,t)=>this.setAttributeData(e,t),clearMemCache:()=>this.clearMemCache()}}_handleEdits(e){Object(S["b"])(this.attributeEditingContext,e)}get hasGeometryFilter(){const e=this.viewFilter;return Object(n["k"])(e)&&Object(n["k"])(e.parsedGeometry)}computeNodeFiltering(e){const t=this.viewFilter,r=Object(n["j"])(t)||t.isMBSGeoemtryVisible(e.mbs,this.view.spatialReference,this._controller.crsIndex);e.filterImpact=r?0:1}};Object(i["a"])([Object(a["b"])({aliasOf:"layer"})],k.prototype,"i3slayer",void 0),Object(i["a"])([Object(a["b"])()],k.prototype,"suspended",void 0),Object(i["a"])([Object(a["b"])(p["a"])],k.prototype,"updatingProgress",void 0),Object(i["a"])([Object(a["b"])({type:h["a"]})],k.prototype,"filter",null),Object(i["a"])([Object(a["b"])()],k.prototype,"viewFilter",void 0),Object(i["a"])([Object(a["b"])(Q.requiredFields)],k.prototype,"requiredFields",null),Object(i["a"])([Object(a["b"])(Q.availableFields)],k.prototype,"availableFields",void 0),Object(i["a"])([Object(a["b"])()],k.prototype,"fieldsHelper",void 0),Object(i["a"])([Object(a["b"])()],k.prototype,"floorFilterClause",null),Object(i["a"])([Object(a["b"])({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],k.prototype,"lodFactor",void 0),Object(i["a"])([Object(a["b"])({readOnly:!0,aliasOf:"_controller.updatingProgress"})],k.prototype,"updatingProgressValue",void 0),k=Object(i["a"])([Object(o["a"])("esri.views.3d.layers.SceneLayerView3D")],k);var A=k;t["default"]=A},"33c9":function(e,t,r){"use strict";var i,n=r("a4ee"),s=(r("c120"),r("7ffa")),a=(r("e92d"),r("cea0"),r("59b2")),o=r("fa8a"),c=r("d386"),l=r("09db"),u=(r("e041"),r("8eed"),r("f402"),r("6a0e")),d=r("a9ab"),b=r("e06a"),p=r("658b"),h=r("c64f");const f=new o["a"]({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y=new o["a"]({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let j=i=class extends u["a"]{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||"1=1"}enable(){this._set("enabled",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:a,units:o,distance:c}=this;return new h["a"]({geometry:Object(s["a"])(r),objectIds:Object(s["a"])(a),spatialRelationship:i,timeExtent:Object(s["a"])(n),where:t,units:o,distance:c,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:n,timeExtent:a,objectIds:o,units:c,distance:l}=this,u=new Set;return n.forEach(e=>u.add(e)),new i({geometry:Object(s["a"])(t),hiddenIds:u,objectIds:Object(s["a"])(o),spatialRelationship:r,timeExtent:Object(s["a"])(a),where:e,units:c,distance:l})}};Object(n["a"])([Object(a["b"])({type:String})],j.prototype,"where",void 0),Object(n["a"])([Object(l["a"])("where")],j.prototype,"writeWhere",null),Object(n["a"])([Object(a["b"])({types:b["a"],json:{read:d["a"],write:!0}})],j.prototype,"geometry",void 0),Object(n["a"])([Object(a["b"])({type:String,json:{read:{source:"spatialRel",reader:f.read},write:{target:"spatialRel",writer:f.write}}})],j.prototype,"spatialRelationship",void 0),Object(n["a"])([Object(a["b"])({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],j.prototype,"hiddenIds",void 0),Object(n["a"])([Object(a["b"])({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],j.prototype,"distance",void 0),Object(n["a"])([Object(a["b"])({type:[Number],json:{write:!0}})],j.prototype,"objectIds",void 0),Object(n["a"])([Object(a["b"])({type:String,json:{read:y.read,write:{writer:y.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],j.prototype,"units",void 0),Object(n["a"])([Object(a["b"])({type:p["a"],json:{write:!0}})],j.prototype,"timeExtent",void 0),Object(n["a"])([Object(a["b"])({readOnly:!0})],j.prototype,"enabled",void 0),j=i=Object(n["a"])([Object(c["a"])("esri.views.layers.support.FeatureFilter")],j);var O=j;t["a"]=O},"4bb0":function(e,t,r){"use strict";r.d(t,"a",(function(){return F}));var i=r("a4ee"),n=(r("c120"),r("b2b2")),s=r("e92d"),a=(r("cea0"),r("59b2")),o=r("d386"),c=(r("e041"),r("8eed"),r("f402"),r("b50f")),l=r("fc29"),u=r("5996"),d=r("9786"),b=(r("e06a"),r("e431")),p=r("3795"),h=r("8048"),f=r("9180"),y=r("8188"),j=r("66a2"),O=r("4261"),g=r("33c9"),w=r("ee9c");const m=s["a"].getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");let v,F=class extends l["a"]{constructor(e){super(e),this._projectionEngineLoaded=!1}initialize(){Object(p["k"])(this,"filter.geometry").then(()=>this.loadAsyncModule(x().then(e=>{this.destroyed||(this._geometryEngine=e,this.applyFilters())})))}get sortedObjectIds(){if(Object(n["j"])(this.filter.objectIds))return null;const e=new Float64Array(this.filter.objectIds);return e.sort(),e}get parsedWhereClause(){const e=Object(n["k"])(this.filter)?this.filter.where:null;if(Object(n["j"])(e)||!e)return null;try{return j["WhereClause"].create(e,this.layerFieldsIndex)}catch(t){m.error("Failed to parse filter where clause: "+t)}return null}addFilters(e,t,r,i){const s=this.sortedObjectIds;Object(n["k"])(s)&&e.push(e=>Object(w["v"])(s,!0,e)),this.addSqlFilter(e,this.parsedWhereClause);const a=this.parsedGeometry;if(Object(n["k"])(a)){const n=this.spatialRelationship;e.push((e,s)=>Q(e,s,i,t,r,a,n))}}isMBSGeoemtryVisible(e,t,r){const i=this.parsedGeometry;if(Object(n["k"])(i)){const n=this.spatialRelationship,s=i[0].spatialReference||t;return Object(y["p"])(e,r,k,s)?R(k,i,s,n):(m.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){if(Object(n["j"])(this.filter))return null;if(!this._geometryEngine)return null;const{geometry:e}=this.filter;if(Object(n["j"])(e))return null;const{distance:t,units:r}=this.filter,i=this.spatialRelationship,s="mesh"===e.type?e.extent:e;if(Object(n["j"])(t)||0===t)return _(s,i);const a=r||Object(h["g"])(s.spatialReference);if(s.spatialReference.isWGS84)return _(this._geometryEngine.geodesicBuffer(s,t,a),i);if(Object(d["a"])(s,u["a"].WGS84))return _(Object(d["d"])(this._geometryEngine.geodesicBuffer(Object(d["d"])(s,u["a"].WGS84),t,a),s.spatialReference),i);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(Object(y["j"])().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let o=null;try{o=Object(y["n"])(s,u["a"].WGS84)}catch(c){}if(o)try{o=Object(y["n"])(this._geometryEngine.geodesicBuffer(o,t,a),s.spatialReference)}catch(c){o=null}return o||m.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${s.spatialReference.wkid}) to WGS84.`),_(o,i)}get spatialRelationship(){return Object(n["k"])(this.filter)?this.filter.spatialRelationship:"intersects"}static checkSupport(e){return e.timeExtent?(m.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1):!!I(e.spatialRelationship)||(m.warn(`Filters with spatialRelationship other than ${S.join(", ")} are not supported for mesh scene layers`),!1)}};function E(){return!!v}async function x(){return E()||(v=await Promise.all([r.e("chunk-2d22cf8c"),r.e("chunk-1900908c")]).then(r.bind(null,"ea51"))),v}Object(i["a"])([Object(a["b"])({type:g["a"]})],F.prototype,"filter",void 0),Object(i["a"])([Object(a["b"])()],F.prototype,"layerFieldsIndex",void 0),Object(i["a"])([Object(a["b"])()],F.prototype,"loadAsyncModule",void 0),Object(i["a"])([Object(a["b"])()],F.prototype,"applyFilters",void 0),Object(i["a"])([Object(a["b"])()],F.prototype,"addSqlFilter",void 0),Object(i["a"])([Object(a["b"])({readOnly:!0})],F.prototype,"sortedObjectIds",null),Object(i["a"])([Object(a["b"])({readOnly:!0})],F.prototype,"parsedWhereClause",null),Object(i["a"])([Object(a["b"])({readOnly:!0})],F.prototype,"parsedGeometry",null),Object(i["a"])([Object(a["b"])({readOnly:!0})],F.prototype,"spatialRelationship",null),Object(i["a"])([Object(a["b"])()],F.prototype,"_projectionEngineLoaded",void 0),Object(i["a"])([Object(a["b"])()],F.prototype,"_geometryEngine",void 0),F=Object(i["a"])([Object(o["a"])("esri.views.3d.layers.i3s.I3SMeshViewFilter")],F);const S=(e=>e)(["contains","intersects","disjoint"]);function I(e){return null!=e&&S.indexOf(e)>=0}function _(e,t){if(!e)return null;if("disjoint"===t&&"polygon"===e.type){const t=new Array(e.rings.length);for(let n=0;n<e.rings.length;++n){const r=Object(f["t"])(1/0,1/0,-1/0,-1/0);Object(f["r"])(r,e.rings[n]),t[n]={type:"polygon",rings:[e.rings[n]],spatialReference:e.spatialReference,aabr:r}}t.sort((e,t)=>e.aabr[0]-t.aabr[0]);const r=new Set,i=new c["a"];for(let e=0;e<t.length;++e){const n=t[e];for(let i=e+1;i<t.length;++i){const e=t[i];if(e.aabr[0]>=n.aabr[2])break;r.add(e)}r.forEach(e=>{if(n!==e)if(e.aabr[2]<=n.aabr[0])r.delete(e);else if(v.intersects(n,e)){n.rings=n.rings.concat(e.rings),Object(f["p"])(n.aabr,e.aabr),delete n._geVersion,r.delete(e);const s=Object(c["g"])(t,e,t.length,i);t.splice(s,1)}}),r.add(n)}for(const e of t)delete e.aabr;return t}return[e]}function R(e,t,r,i){const n=C(e,r);return t.every(e=>1!==N(e,n,i))}function Q(e,t,r,i,n,s,a){const o=s[0].spatialReference||i.spatialReference;if(!Object(y["p"])(t.node.mbs,n,k,o))return void m.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const c=C(k,o),l=A(a,i,o,r,t.objectHandle);for(const u of s){if(0===e.length)return;switch(N(u,c,a)){case 1:return void(e.length=0);case 0:continue}Object(w["k"])(e,t.featureIds,e=>V(u,e,l))}}const k=[0,0,0,0];function A(e,t,r,i,n){const s=t.renderSpatialReference,a=new Map,o={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:r};o.rings[0][3]=o.rings[0][0];const c={indices:null,data:null,stride:0,startIndex:0,endIndex:0};let l,u;switch(e){case"intersects":l=(e,t)=>v.intersects(e,t)?0:2,u=q;break;case"contains":l=(e,t)=>v.contains(e,t)?2:1,u=q;break;case"disjoint":default:l=(e,t)=>v.disjoint(e,t)?2:1,u=M}return{collection:i,object:n,type:e,maskSR:r,renderSR:s,aabbCache:a,triangle:o,positions:c,triangleTest:l,geometryTest:u}}function C(e,t){const r={x:e[0],y:e[1],hasZ:!1,hasM:!1,type:"point",spatialReference:t},i=t.isWGS84||t.isWebMercator?v.geodesicBuffer(r,e[3],1):v.buffer(r,e[3],1);return i.type="polygon",i}function N(e,t,r){switch(r){case"intersects":case"contains":return q(e,t);case"disjoint":return M(e,t)}}function q(e,t){return v.intersects(e,t)?v.contains(e,t)?0:2:1}function M(e,t){return v.intersects(e,t)?v.contains(e,t)?1:2:0}const D=2**-32;function V(e,t,r){const{collection:i,object:n,renderSR:s,maskSR:a,geometryTest:o,aabbCache:c}=r;let l=c.get(t);if(!l){const e=i.getObjectTransform(n);i.getComponentAabb(n,t,U);const r=[[U[0],U[1],0],[U[0],U[4],0],[U[3],U[4],0],[U[3],U[1],0]];for(let t=0;t<4;++t)Object(b["y"])(r[t],r[t],e.rotationScale),Object(b["g"])(r[t],r[t],e.position),Object(y["y"])(r[t],s,r[t],a);l={rings:[r],hasZ:!1,hasM:!1,type:"polygon",spatialReference:a},l.rings[0][4]=l.rings[0][0],c.set(t,l)}switch(o(e,l)){case 1:return!1;case 0:return!0}const{triangle:u,triangleTest:d,positions:p}=r,h=u.rings[0][0],f=u.rings[0][1],j=u.rings[0][2],O=i.getObjectTransform(n);i.getComponentPositions(n,t,p);const{indices:g,data:w,stride:m,startIndex:v,endIndex:F}=p;for(let E=v;E<F;E+=3){const t=m*g[E+0],r=m*g[E+1],i=m*g[E+2];Object(b["x"])(h,w[t+0],w[t+1],w[t+2]),Object(b["x"])(f,w[r+0],w[r+1],w[r+2]),Object(b["x"])(j,w[i+0],w[i+1],w[i+2]),Object(b["y"])(h,h,O.rotationScale),Object(b["y"])(f,f,O.rotationScale),Object(b["y"])(j,j,O.rotationScale),Object(b["g"])(h,h,O.position),Object(b["g"])(f,f,O.position),Object(b["g"])(j,j,O.position),Object(y["y"])(h,s,h,a),Object(y["y"])(f,s,f,a),Object(y["y"])(j,s,j,a);const n=f[0]-h[0],o=f[1]-h[1],c=j[0]-h[0],l=j[1]-h[1];if(!(Math.abs(n*l-o*c)<D))switch(delete u._geVersion,d(e,u)){case 1:return!1;case 0:return!0}}switch(r.type){case"intersects":return!1;case"contains":case"disjoint":default:return!0}}const U=Object(O["h"])()},"72e1":function(e,t,r){"use strict";function i(e){const t=e.layer;if("floorInfo"in t&&t.floorInfo){const r=e.view.floors;if(!r||!r.length)return null;const i=r.filter(e=>""!==e).map(e=>`'${e}'`);i.push("''");const n=t.floorInfo.floorField;return`${n} IN (${i.join(", ")}) OR ${n} IS NULL`}return null}r.d(t,"a",(function(){return i}))},"8ea5":function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i=r("b2b2"),n=r("8152"),s=r("d97e"),a=r("4261"),o=r("ee9c");class c{constructor(e){this.objectIdField=e.objectIdField,this.getFeatureExtent=e.getFeatureExtent}getObjectId(e){return e.id}getAttributes(e){const{meta:t,index:r}=e,n={};this.objectIdField&&(n[this.objectIdField]=e.id);const s=Object(i["k"])(t.attributeInfo)&&t.attributeInfo.attributeData;if(Object(i["k"])(s))for(const i of Object.keys(s))n[i]=Object(o["o"])(s[i],r);return n}getAttribute(e,t){if(t===this.objectIdField)return e.id;const{meta:r,index:n}=e,s=Object(i["k"])(r.attributeInfo)&&r.attributeInfo.attributeData;return Object(i["k"])(s)?Object(o["o"])(s[t],n):null}getGeometry(e){if(e.geometry)return e.geometry;const[t,r,i,s,a]=this.getFeatureExtent(e,l);return new n["a"]([5],[t,r,i,s,r,i,s,a,i,t,a,i,t,r,i])}getCentroid(e,t){if(e.geometry)return Object(s["a"])(new n["a"],e.geometry,t.hasZ,t.hasM);const[r,i,a,o,c,u]=this.getFeatureExtent(e,l);return new n["a"]([0],[(r+o)/2,(i+c)/2,(a+u)/2])}cloneWithGeometry(e,t){const{id:r,index:i,meta:n}=e;return{id:r,index:i,meta:n,geometry:t}}}const l=Object(a["h"])()},ad73:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var i=r("b2b2"),n=r("c1da");async function s(e,t=e.popupTemplate){if(!Object(i["k"])(t))return[];const r=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:s}=t,{objectIdField:a,typeIdField:o,globalIdField:c,relationships:l}=e;if(r.includes("*"))return["*"];const u=s?await Object(n["m"])(e):[],d=Object(n["i"])(e.fields,[...r,...u]);return o&&d.push(o),d&&a&&Object(n["p"])(e.fields,a)&&-1===d.indexOf(a)&&d.push(a),d&&c&&Object(n["p"])(e.fields,c)&&-1===d.indexOf(c)&&d.push(c),l&&l.forEach(t=>{const{keyField:r}=t;d&&r&&Object(n["p"])(e.fields,r)&&-1===d.indexOf(r)&&d.push(r)}),d}function a(e,t){return e.popupTemplate?e.popupTemplate:Object(i["k"])(t)&&t.defaultPopupTemplateEnabled&&Object(i["k"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},bb87:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var i=r("a4ee"),n=(r("c120"),r("b2b2")),s=r("e92d"),a=(r("cea0"),r("59b2")),o=r("d386"),c=(r("e041"),r("8eed"),r("f402"),r("c1da")),l=r("c0d3"),u=r("cb26"),d=r("fc29");const b=e=>{let t=class extends e{constructor(){super(...arguments),this.asyncUpdateState=new Map}autoUpdateAsync(e,t){return p(t=>this.updateAsync(e,t),t)}async updateAsync(t,r){if(!this.startAsyncUpdate(t)){try{const e=await r();this._set(t,e)}catch(e){s["a"].getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(t)&&this.updateAsync(t,r)}}startAsyncUpdate(e){var t;const r=null!=(t=this.asyncUpdateState.get(e))?t:0;return 1&r?(this.asyncUpdateState.set(e,2|r),!0):(this.asyncUpdateState.set(e,1|r),!1)}endAsyncUpdate(e){var t;const r=-2&(null!=(t=this.asyncUpdateState.get(e))?t:0);return 2&r?(this.asyncUpdateState.set(e,-3&r),!0):(this.asyncUpdateState.set(e,r),!1)}};return t=Object(i["a"])([Object(o["a"])("esri.core.AsyncUpdate")],t),t};function p(e,t){const r=()=>{s&&!a&&e(i)},i=()=>{if(!s||a)return t();s.clear(),a=!0;const e=Object(l["b"])(s,t);return a=!1,e},n=()=>{s&&(s.destroy(),s=null)};let s=new u["a"](r),a=!1;return e(i),{remove:n}}let h=class extends(b(d["a"])){};h=Object(i["a"])([Object(o["a"])("esri.core.AsyncUpdate")],h);var f=r("9096");const y=s["a"].getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");let j=class extends(b(f["a"])){constructor(e){super(e)}get requiredFields(){const{layerView:{layer:{fields:e},definitionExpressionFields:t},rendererFields:r,labelingFields:i,viewFilterFields:s}=this;return Object(c["i"])(e,[...Object(n["u"])(t,[]),...Object(n["u"])(r,[]),...Object(n["u"])(i,[]),...Object(n["u"])(s,[])])}initialize(){const e=this.layerView.layer;this.layer=e,this.handles.add([this.autoUpdateAsync("rendererFields",()=>{const{fields:e,renderer:t}=this.layer;return t?O(r=>t.collectRequiredFields(r,e)):null}),this.autoUpdateAsync("labelingFields",()=>{const{layer:e}=this;return e.labelsVisible?O(t=>Object(c["g"])(t,e)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const{layer:e,filter:t}=this.layerView;return O(r=>Object(c["f"])(r,e,t))})])}};async function O(e){const t=new Set;try{return await e(t),Array.from(t).sort()}catch(r){return y.error(r),null}}Object(i["a"])([Object(a["b"])()],j.prototype,"layerView",void 0),Object(i["a"])([Object(a["b"])()],j.prototype,"layer",void 0),Object(i["a"])([Object(a["b"])()],j.prototype,"requiredFields",null),Object(i["a"])([Object(a["b"])()],j.prototype,"rendererFields",void 0),Object(i["a"])([Object(a["b"])()],j.prototype,"labelingFields",void 0),Object(i["a"])([Object(a["b"])()],j.prototype,"viewFilterFields",void 0),j=Object(i["a"])([Object(o["a"])("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],j)},dd25:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return c}));var i=r("7ffa"),n=r("b2b2"),s=r("d36d");const a={setAttribute(){},rollback(){},commit(){}};function o(e,t){const r=t.attributes[e.objectIdField],s=e.sessions.get(r);if(s)return s;const o=Object(i["a"])(t.attributes),c=new Set;if(null==r)return a;const l=e.attributeOverrides.createInteractiveEditSession(r),u=new Map,d=(e,t)=>{const i=u.get(e);if(null==i){const i=t.indexOf(r);return u.set(e,i),i}return i};let b=0;const p={setAttribute(r,i){if(0!==b)return;const s=e.fieldsIndex.get(r);if(Object(n["j"])(s))return;const a=e.attributeStorageInfo.findIndex(e=>e.name===s.name);if(a<0)return;l.set(a,i);const o=e.attributeStorageInfo[a];let u=!1;c.add(r),e.forEachNode((r,n)=>{const s=d(r,n);if(-1===s)return;const a=e.getAttributeData(r.index);if(a){const n=a[o.name];n&&(n[s]=i,e.setAttributeData(r.index,a,t),u=!0)}}),u&&e.clearMemCache()},rollback(){if(0===b){for(const e of c)this.setAttribute(e,o[e]);l.rollback(),b=1,e.sessions.delete(r)}},commit(){0===b&&(l.commit(),b=2,e.sessions.delete(r))}};return e.sessions.set(r,p),p}function c(e,t){const r=l(e,t);if(0===r.size)return;const i=new Map;for(let n=0;n<e.attributeStorageInfo.length;n++)i.set(e.attributeStorageInfo[n].name,n);let s=!1;r.forEach((t,r)=>{const a=e.getAttributeData(r);let o=!1;t.forEach((t,r)=>{const c=Object(n["k"])(a)?a[r]:null,l=i.get(r);for(const{featureIndex:i,value:n,featureId:a}of t)c&&(c[i]=n,o=!0,s=!0),e.attributeOverrides.updateValue(a,l,n)}),o&&e.setAttributeData(r,a,null)}),s&&e.clearMemCache()}function l(e,t){const r=t.edits.updateFeatures;if(!r||0===r.length)return new h;const i=b(t),n=new h,a=new Map;for(let s=0;s<e.attributeStorageInfo.length;s++)a.set(e.attributeStorageInfo[s].name,s);const o=e.fieldsIndex,c=e.objectIdField,l=r.filter(e=>{const t=Object(s["a"])(o,e.attributes,c);return i.has(t)});return e.forEachNode((t,r)=>{const i=new Set(r);for(const a of l){const l=Object(s["a"])(o,a.attributes,c);if(!i.has(l))continue;const d=r.indexOf(l);for(const r in a.attributes){const i=e.fieldsIndex.normalizeFieldName(r),s=u(n,t.index,i),o=a.attributes[r];s.push({featureIndex:d,featureId:l,value:o})}}}),n}function u(e,t,r){const i=d(e,t),n=i.get(r);if(n)return n;const s=new Array;return i.set(r,s),s}function d(e,t){const r=e.get(t);if(r)return r;const i=new p;return e.set(t,i),i}function b(e){const t=new Set;if(!e.updatedFeatures)return t;for(const r of e.updatedFeatures)null!=r.objectId&&null==r.error&&t.add(r.objectId);return t}const p=Map,h=Map},e315:function(e,t,r){"use strict";var i=r("a4ee"),n=(r("c120"),r("e92d"),r("cea0"),r("59b2")),s=(r("0b86"),r("e041"),r("8eed"),r("f402"),r("365a"));class a extends s["a"]{constructor(){super(...arguments),this.layer=null,this.filter=null}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){throw new Error("Not implemented")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}}Object(i["a"])([Object(n["b"])()],a.prototype,"layer",void 0),Object(i["a"])([Object(n["b"])()],a.prototype,"availableFields",null),Object(i["a"])([Object(n["b"])()],a.prototype,"maximumNumberOfFeatures",null),Object(i["a"])([Object(n["b"])({readOnly:!0})],a.prototype,"maximumNumberOfFeaturesExceeded",null),Object(i["a"])([Object(n["b"])()],a.prototype,"filter",void 0),t["a"]=a},f426:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("c1da");function n(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const{layer:e,layer:{fields:t},requiredFields:r}=this;return e.outFields?Object(i["i"])(t,[...Object(i["v"])(t,e.outFields),...r]):Object(i["i"])(t,r)}}}}},f7f0:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("a4ee"),n=(r("c120"),r("b2b2")),s=(r("e92d"),r("cea0"),r("59b2"),r("d386")),a=r("ce50"),o=(r("e041"),r("8eed"),r("f402"),r("c1da")),c=r("ad73");const l=e=>{let t=class extends e{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;return r?Object(c["a"])(t,e)?void 0:new a["a"]("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new a["a"]("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,t){const r=this._validateFetchPopupFeatures(t);if(r)return Promise.reject(r);const i=Object(n["k"])(t)?t.clientGraphics:null;if(!i||0===i.length)return Promise.resolve([]);const s=[],a=[],l="scene"===this.layer.type&&Object(n["k"])(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,u=Object(o["v"])(this.layer.fields,await Object(c["b"])(l,Object(c["a"])(this.layer,t)));await this.prepareFetchPopupFeatures(u);const d=new Set;for(const n of i)Object(o["t"])(u,n,d)?a.push(n):s.push(n);return 0===a.length?Promise.resolve(s):this.whenGraphicAttributes(a,[...d]).catch(()=>a).then(e=>s.concat(e))}};return t=Object(i["a"])([Object(s["a"])("esri.views.3d.layers.support.PopupSceneLayerView")],t),t}}}]);
//# sourceMappingURL=chunk-1eca538c.1e42997d.js.map
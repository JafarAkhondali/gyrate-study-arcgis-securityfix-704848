(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4dd9ad5a"],{"0f94":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return r})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return p}));var o=i("38a4"),n=i("3349"),a=i("02f1");function s(e,t){return e[0]*t[1]-e[1]*t[0]}function r(e,t,i){const o=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(o)/Object(n["b"])(t,i)}function c(e,t,i){const o=Object(n["k"])(i,t)/Object(n["u"])(i);return Object(n["g"])(e,i,o)}function l(e,t,i,o,a=i){return Object(n["f"])(y,o,i),Object(n["f"])(O,t,a),c(m,O,y),Object(n["m"])(e,a,m)}function p(e,t,i,o){Object(n["f"])(y,o,i),Object(n["f"])(O,t,i);const a=Object(n["k"])(y,O)/Object(n["u"])(y);return a>0?Object(n["v"])(e,i,y,a):Object(n["c"])(e,i)}function d(e,t,i,o){Object(n["f"])(y,t,i);const a=o/Object(n["l"])(y);return Object(n["v"])(e,i,y,a)}function h(e,t){return l(O,t,e.start,e.end),Object(o["i"])(O[0],t[0])&&Object(o["i"])(O[1],t[1])?[Object(a["c"])(t)]:[]}function u(e,t,i){return d(O,i,e,t),Object(o["i"])(O[0],i[0])&&Object(o["i"])(O[1],i[1])?[Object(a["c"])(i)]:[]}function b(e,t){const i=e.start,o=e.end,a=t.start,r=t.end,c=Object(n["f"])(y,o,i),l=Object(n["f"])(f,r,a),p=s(c,l);if(Math.abs(p)<=v)return[];const d=Object(n["f"])(O,i,a),h=s(l,d)/p,u=s(c,d)/p;if(h>=0){if(u>=0||1===t.type)return[Object(n["v"])(m,i,c,h)]}else if(1===e.type&&(u>=0||1===t.type))return[Object(n["v"])(m,i,c,h)];return[]}function g(e,t,i){const o=[],a=Object(n["f"])(y,e.end,e.start),s=Object(n["f"])(f,e.start,t),r=Object(n["u"])(a),c=2*Object(n["k"])(a,s),l=c*c-4*r*(Object(n["u"])(s)-i*i);if(0===l){const t=-c/(2*r);(1===e.type||t>=0)&&o.push(Object(n["v"])(m,e.start,a,t))}else if(l>0){const t=Math.sqrt(l),i=(-c+t)/(2*r);(1===e.type||i>=0)&&o.push(Object(n["v"])(m,e.start,a,i));const s=(-c-t)/(2*r);(1===e.type||s>=0)&&o.push(Object(n["v"])(O,e.start,a,s))}return o}const v=1e-6,y=Object(a["b"])(),f=Object(a["b"])(),O=Object(a["b"])(),m=Object(a["b"])()},"240c":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s}));var o=i("b2b2"),n=i("b48e"),a=i("f408");function s(e){return c(e).result}function r(e){return c(e).geometry}function c(e){var t;return"graphics"!==(null==(t=e.layer)?void 0:t.type)?{result:1,geometry:null}:Object(o["k"])(e.geometry)?{result:2,geometry:null}:"on-the-ground"!==Object(a["f"])(e)&&Object(a["h"])(e)?{result:4,geometry:null}:"point"!==e.geometry.type&&"polyline"!==e.geometry.type&&("polygon"!==e.geometry.type||e.geometry instanceof n["a"])?{result:3,geometry:null}:{result:0,geometry:e.geometry}}},"243f":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));i("c120");var o=i("b2b2"),n=i("f408");function a(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if(Object(o["k"])(e.geometry))return 2;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return"on-the-ground"!==Object(n["f"])(e)&&Object(n["h"])(e)?4:0}},"40b6":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return d}));i("e06a");var o=i("ce50"),n=i("8048"),a=i("d636"),s=(i("521c"),i("1219"),i("4ae5"),i("5996"));function r(e){if(!e)return null;if(e.isGeographic&&e.wkid){const t=a["c"][e.wkid];if(t)return t}if(e.wkt){const t=c(e.wkt);if(t)return t}return null}function c(e){const t=a["a"].exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const o=parseFloat(i[1]),n=parseFloat(i[2]);return isNaN(o)||isNaN(n)?null:{a:o,f:0===n?0:1/n}}function l(e){const t=r(e||s["a"].WGS84);if(p(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function p(e){return"b"in e&&"eSq"in e&&"radius"in e}function d(e){return null!==r(e)}function h(e,t="meters"){if(!e)throw new o["a"]("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(e=>!d(e.spatialReference)))throw new o["a"]("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let o=0;o<e.length;o++){const a=e[o],{spatialReference:s}=a,r="polyline"===a.type?a.paths:a.rings;let c=0;for(let e=0;e<r.length;e++){const t=r[e];let i=0;for(let e=1;e<t.length;e++){const o=t[e-1][0],n=t[e][0],a=t[e-1][1],r=t[e][1];if(a!==r||o!==n){const e={distance:null};b(e,[o,a],[n,r],s),i+=e.distance}}c+=i}c=Object(n["c"])(c,"meters",t),i.push(c)}return i}function u(e,t,i,o,n){const s=t[0],r=t[1],c=s*a["d"],p=r*a["d"],d=i*a["d"],{a:h,b:u,f:b}=l(n),g=Math.sin(d),v=Math.cos(d),y=(1-b)*Math.tan(p),f=1/Math.sqrt(1+y*y),O=y*f,m=Math.atan2(y,v),j=f*g,w=j*j,_=1-w,T=_*(h*h-u*u)/(u*u),S=1+T/16384*(4096+T*(T*(320-175*T)-768)),E=T/1024*(256+T*(T*(74-47*T)-128));let C,k,x,M,G=o/(u*S),P=2*Math.PI;for(;Math.abs(G-P)>1e-12;)x=Math.cos(2*m+G),C=Math.sin(G),k=Math.cos(G),M=E*C*(x+E/4*(k*(2*x*x-1)-E/6*x*(4*C*C-3)*(4*x*x-3))),P=G,G=o/(u*S)+M;const H=O*C-f*k*v,I=Math.atan2(O*k+f*C*v,(1-b)*Math.sqrt(w+H*H)),A=Math.atan2(C*g,f*k-O*C*v),V=b/16*_*(4+b*(4-3*_)),L=I/a["d"],R=(c+(A-(1-V)*b*j*(G+V*C*(x+V*k*(2*x*x-1)))))/a["d"];return e[0]=R,e[1]=L,e}function b(e,t,i,o){const n=t[0]*a["d"],s=t[1]*a["d"],r=i[0]*a["d"],c=i[1]*a["d"],{a:p,b:d,f:h,radius:u}=l(o),b=r-n,g=Math.atan((1-h)*Math.tan(s)),v=Math.atan((1-h)*Math.tan(c)),y=Math.sin(g),f=Math.cos(g),O=Math.sin(v),m=Math.cos(v);let j,w,_,T,S,E,C,k,x,M,G=1e3,P=b;do{if(C=Math.sin(P),k=Math.cos(P),_=Math.sqrt(m*C*(m*C)+(f*O-y*m*k)*(f*O-y*m*k)),0===_)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;S=y*O+f*m*k,E=Math.atan2(_,S),x=f*m*C/_,w=1-x*x,T=S-2*y*O/w,isNaN(T)&&(T=0),M=h/16*w*(4+h*(4-3*w)),j=P,P=b+(1-M)*h*x*(E+M*_*(T+M*S*(2*T*T-1)))}while(Math.abs(P-j)>1e-12&&--G>0);if(0===G){const t=u,i=Math.acos(Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos(r-n))*t,o=r-n,l=Math.sin(o)*Math.cos(c),p=Math.cos(s)*Math.sin(c)-Math.sin(s)*Math.cos(c)*Math.cos(o),d=Math.atan2(l,p);return e.azimuth=d/a["d"],e.distance=i,e.reverseAzimuth=void 0,e}const H=w*(p*p-d*d)/(d*d),I=H/1024*(256+H*(H*(74-47*H)-128)),A=d*(1+H/16384*(4096+H*(H*(320-175*H)-768)))*(E-I*_*(T+I/4*(S*(2*T*T-1)-I/6*T*(4*_*_-3)*(4*T*T-3)))),V=Math.atan2(m*Math.sin(P),f*O-y*m*Math.cos(P)),L=Math.atan2(f*Math.sin(P),f*O*Math.cos(P)-y*m);return e.azimuth=V/a["d"],e.distance=A,e.reverseAzimuth=L/a["d"],e}},"43e0":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return d}));var o=i("3349"),n=i("02f1"),a=i("c9fb"),s=i("6706"),r=i("0f94");class c{constructor(e){this.coordinateHelper=e}}class l extends c{constructor(e,t){super(e),this.point=t}objectEqual(e){return e instanceof l&&Object(s["d"])(this.point,e.point)}check(e){return Object(o["a"])(e,this.point)<a["a"].pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(e){const t=[];return e instanceof p?t.push(...Object(r["b"])({start:e.start,end:e.end,type:e instanceof h?1:0},this.point)):e instanceof b&&t.push(...Object(r["a"])(e.center,e.radius,this.point)),t.map(t=>new u(this.coordinateHelper,t,this,e))}}class p extends c{constructor(e,t,i){super(e),this.start=t,this.end=i}objectEqual(e){return e instanceof p&&Object(s["d"])(this.start,e.start)&&Object(s["d"])(this.end,e.end)}intersect(e){const t=[];return e instanceof l?t.push(...Object(r["b"])({start:this.start,end:this.end,type:this instanceof h?1:0},e.point)):e instanceof p?t.push(...Object(r["c"])({start:this.start,end:this.end,type:this instanceof h?1:0},{start:e.start,end:e.end,type:e instanceof h?1:0})):e instanceof b&&t.push(...Object(r["d"])({start:this.start,end:this.end,type:this instanceof h?1:0},e.center,e.radius)),t.map(t=>new u(this.coordinateHelper,t,this,e))}}class d extends p{constructor(e,t,i){super(e,t,i),this.dir=Object(n["b"])(),this.p=Object(n["b"])()}objectEqual(e){return e instanceof d&&super.objectEqual(e)}check(e){return Object(o["f"])(this.dir,this.end,this.start),Object(o["f"])(this.p,e,this.start),Object(o["k"])(this.dir,this.p)>=0&&Object(r["e"])(e,this.start,this.end)<a["a"].pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(r["h"])(t,e,this.start,this.end),t}}class h extends p{constructor(e,t,i){super(e,t,i)}objectEqual(e){return e instanceof h&&super.objectEqual(e)}check(e){return Object(r["e"])(e,this.start,this.end)<a["a"].pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(r["g"])(t,e,this.start,this.end),t}}class u extends c{constructor(e,t,i,o){super(e),this.intersection=t,this.first=i,this.second=o}objectEqual(e){return e instanceof u&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(o["c"])(t,this.intersection),t}intersect(){return[]}}class b extends c{constructor(e,t,i){super(e),this.center=t,this.radius=i}objectEqual(e){return e instanceof b&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return Object(r["f"])(t,e,this.center,this.radius),t}intersect(e){const t=[];return e instanceof p?t.push(...Object(r["d"])({start:e.start,end:e.end,type:e instanceof h?1:0},this.center,this.radius)):e instanceof l&&t.push(...Object(r["a"])(this.center,this.radius,e.point)),t.map(t=>new u(this.coordinateHelper,t,this,e))}}},5715:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("c120");var o=i("e92d"),n=i("6706"),a=i("7dcb");o["a"].getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class s extends a["a"]{constructor(e,t,i){super(),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof s&&Object(n["d"])(this.previousVertex,e.previousVertex)&&Object(n["d"])(this.centerVertex,e.centerVertex)&&Object(n["d"])(this.nextVertex,e.nextVertex)}}},6706:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return c}));var o=i("a915"),n=i("3349"),a=i("0b2d"),s=i("4ae5"),r=i("f408");function c(e,t){const i=e.x-t.x,o=e.y-t.y;return i*i+o*o}function l(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function p(e,t,i,n){return"2d"===n.type?n.toScreen(t.vectorToPoint(e,v)):(d(e,t,i,n,b),n.state.camera.projectToScreen(b,g),Object(o["f"])(g[0],g[1]))}function d(e,t,i,o,n=Object(a["f"])()){const s=t.toXYZ(e);return s[2]=Object(r["b"])(o,s,t.spatialReference,i)||0,o.renderCoordsHelper.toRenderCoords(s,t.spatialReference,n),n}function h(e,t,i,o,n,a,s){const c=i.toXYZ(e),l=i.toXYZ(t),p=Object(r["b"])(n,c,i.spatialReference,o),d=Object(r["b"])(n,l,i.spatialReference,o),h=(null==p?d:null==d?p:Math.min(p,d))||0;c[2]=h,l[2]=h,n.renderCoordsHelper.toRenderCoords(c,i.spatialReference,a),n.renderCoordsHelper.toRenderCoords(l,i.spatialReference,s)}function u(e,t){t.sort((t,i)=>Object(n["a"])(t.targetPoint,e)-Object(n["a"])(i.targetPoint,e))}const b=Object(a["f"])(),g=Object(o["g"])(),v=new s["a"]},"7d9d":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));const o={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "}},"7dcb":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));class o{}},8418:function(e,t,i){"use strict";var o=i("c04e"),n=i("9bf2"),a=i("5c6c");e.exports=function(e,t,i){var s=o(t);s in e?n.f(e,s,a(0,i)):e[s]=i}},"92af":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("df3b");class n extends o["a"]{constructor({coordinateHelper:e,targetPoint:t,objectId:i,constraint:o}){super(e,t,o),this.objectId=i}}},"955e":function(e,t,i){"use strict";i.d(t,"a",(function(){return Tt}));var o=i("a4ee"),n=(i("1b8f"),i("2c4f")),a=i("c649"),s=i("b2b2"),r=i("4adc"),c=(i("b50f"),i("c120"),i("1a3e")),l=i("59b2"),p=i("d386"),d=i("fc29");i("cea0");let h=class extends d["a"]{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};Object(o["a"])([Object(l["b"])({constructOnly:!0})],h.prototype,"layer",void 0),Object(o["a"])([Object(l["b"])()],h.prototype,"enabled",void 0),Object(o["a"])([Object(l["b"])()],h.prototype,"updating",void 0),Object(o["a"])([Object(l["b"])()],h.prototype,"availability",void 0),h=Object(o["a"])([Object(p["a"])("esri.views.interactive.snapping.SnappingLayerSource")],h);const u=h;var b=i("c9fb");let g=class extends d["a"]{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new n["a"],this.distance=b["a"].distance,this.touchSensitivityMultiplier=b["a"].touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};Object(o["a"])([Object(l["b"])()],g.prototype,"enabled",void 0),Object(o["a"])([Object(l["b"])()],g.prototype,"enabledToggled",void 0),Object(o["a"])([Object(l["b"])()],g.prototype,"selfEnabled",void 0),Object(o["a"])([Object(l["b"])()],g.prototype,"featureEnabled",void 0),Object(o["a"])([Object(l["b"])({type:n["a"].ofType(u)})],g.prototype,"featureSources",void 0),Object(o["a"])([Object(l["b"])()],g.prototype,"distance",void 0),Object(o["a"])([Object(l["b"])()],g.prototype,"touchSensitivityMultiplier",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],g.prototype,"effectiveEnabled",null),Object(o["a"])([Object(l["b"])({readOnly:!0})],g.prototype,"effectiveSelfEnabled",null),Object(o["a"])([Object(l["b"])({readOnly:!0})],g.prototype,"effectiveFeatureEnabled",null),g=Object(o["a"])([Object(p["a"])("esri.views.interactive.snapping.SnappingOptions")],g);const v=g;var y=i("121a"),f=i("1fd7"),O=i("ce50"),m=i("ce6d"),j=i("af40"),w=i("e92d"),_=i("f4cc"),T=i("477c"),S=i("3795"),E=i("f694"),C=i("32ed"),k=i("ce0b"),x=i("7aa6");function M(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported"}return""}var G=i("243f"),P=i("240c"),H=i("f408");function I(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if(Object(s["k"])(e.geometry))return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const i=Object(s["l"])(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return i&&i.length>0&&i.some(e=>"object"===e.type)?"on-the-ground"!==Object(H["f"])(e)&&Object(H["h"])(e)?4:0:5}var A=i("b65e"),V=i("2589"),L=i("7d9d"),R=i("9096"),D=i("3349"),U=i("5996"),F=i("28eb"),N=i("0b2d"),q=i("43e0"),z=i("6706"),B=i("dac3"),W=i("92af"),Z=i("df3b"),K=i("e6b5"),Y=i("5715");class X extends Z["a"]{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:o,otherVertex:n,otherVertexType:a,objectId:s}){super(e,t,i),this.previousVertex=o,this.otherVertex=n,this.otherVertexType=a,this.objectId=s}get hints(){const e=this.previousVertex,t=1===this.otherVertexType?this.otherVertex:this.targetPoint,i=1===this.otherVertexType?this.targetPoint:this.otherVertex;return[new K["a"](0,t,i),new K["a"](1,e,t),new Y["a"](this.previousVertex,t,i)]}}let $=class extends R["a"]{constructor(e){super(e),this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return Object(F["c"])(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){var e;const t=this._get("snappingSources")||new Map,i=new Map;if(null!=(e=this.options)&&e.featureSources)for(const o of this.options.featureSources.items){const e=o.layer.uid,n=t.get(e);if(n){t.delete(e),i.set(e,n);continue}if(!o.layer.loaded){this.updatingHandles.addPromise(o.layer.load());continue}const a=this.createSourceInfo(o);Object(s["l"])(a)&&i.set(e,a)}for(const[,o]of t)o.destroy();return i}initialize(){this.updatingHandles.add(this,"snappingSources",()=>{this.notifyChange("updating")},1),Object(s["l"])(this.view)&&this.handles.add([this.view.on("layerview-create",e=>this.updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this.updateLayerView(e.layer,null))])}updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if(!this.options.effectiveFeatureEnabled)return[];const o=[],n=this.computeScreeenSizeDistanceParameters(e,t),a={distance:n,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:c,layerView:l}]of this.snappingSources)!c.layerSource.enabled||Object(s["l"])(l)&&l.suspended||o.push(c.fetchCandidates(a,i).then(e=>e.filter(e=>!this.candidateIsExcluded(c,e,t.excludeFeature))));const r=(await Object(_["k"])(o)).flat();return this.addRightAngleCandidates(r,e,n,t),Object(_["w"])(i),Object(z["e"])(e,r),r}addRightAngleCandidates(e,t,i,o){var n,a,r,c,l,p,d,h;const u=Object(s["l"])(o.vertexHandle)?null==(n=o.vertexHandle.rightEdge)||null==(a=n.rightVertex)?void 0:a.pos:Object(s["l"])(o.editGeometryOperations)&&"polygon"===o.editGeometryOperations.data.type?null==(r=Object(s["u"])(null==(c=o.editGeometryOperations.data.components[0])?void 0:c.getFirstVertex()))?void 0:r.pos:null,b=Object(s["l"])(o.vertexHandle)?null==(l=o.vertexHandle.leftEdge)||null==(p=l.leftVertex)?void 0:p.pos:Object(s["l"])(o.editGeometryOperations)?null==(d=Object(s["u"])(null==(h=o.editGeometryOperations.data.components[0])?void 0:h.getLastVertex()))?void 0:d.pos:null,g=e.length;for(let s=0;s<g;s++)this.addRightAngleCandidate(e[s],b,t,i,o,e),this.addRightAngleCandidate(e[s],u,t,i,o,e)}addRightAngleCandidate(e,t,i,o,n,a){if(Object(s["k"])(t)||!(e instanceof B["a"]))return;const r=e.constraint.closestTo(t),c=(r[0]-i[0])/o.x,l=(r[1]-i[1])/o.y;if(c*c+l*l<=1){const i=n.coordinateHelper;a.push(new X({coordinateHelper:i,targetPoint:r,otherVertex:t,otherVertexType:0,previousVertex:e.constraint.start,constraint:new q["e"](i,t,r),objectId:e.objectId}))}}computeScreeenSizeDistanceParameters(e,t){const i=this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1);return Object(s["k"])(this.view)?{x:i,y:i}:"2d"===this.view.type?{x:i*this.view.resolution,y:i*this.view.resolution}:this.computeScreeenSizeDistanceParameters3D(e,i,this.view,t)}computeScreeenSizeDistanceParameters3D(e,t,i,o){const{coordinateHelper:n,elevationInfo:a}=o,s=i.state.camera.computeScreenPixelSizeAt(Object(z["a"])(e,n,a,i,Q))*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,r=t*s;return{x:r/this.computeScreenMagnitudeOfMapOffset(e,s,0,i,o),y:r/this.computeScreenMagnitudeOfMapOffset(e,0,s,i,o)}}computeScreenMagnitudeOfMapOffset(e,t,i,o,{coordinateHelper:n,elevationInfo:a}){const s=n.clone(e);s[0]+=t,s[1]+=i;const r=Object(z["b"])(e,n,a,o),c=Object(z["b"])(s,n,a,o),l=c.x-r.x,p=c.y-r.y;return Math.sqrt(l*l+p*p)}get types(){return 3}candidateIsExcluded(e,t,i){if(Object(s["k"])(i))return!1;const o=this.getCandidateObjectId(t);if(Object(s["k"])(o))return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===o:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===o}getCandidateObjectId(e){return e instanceof W["a"]?e.objectId:null}createSourceInfo(e){const t=this.createFeatureSnappingSourceType(e);if(Object(s["k"])(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const i=Object(s["l"])(this.view)?this.view.allLayerViews.find(t=>t.layer===e.layer):null;return new J(t.source,i)}createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this.createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this.createFeatureSnappingSourceGraphicsLayer(e)}return null}createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this.getSourceModule("featureService");return Object(s["l"])(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this.getSourceModule("featureCollection");return Object(s["l"])(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}createFeatureSnappingSourceGraphicsLayer(e){const t=this.getSourceModule("graphics");return Object(s["l"])(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}getSourceModule(e){const t=this.sourceModules[e];if(Object(s["k"])(t.loader)){const i=this.loadSourceModule(e).then(e=>{t.module=e});return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(i.e("chunk-096a9bfe").then(i.bind(null,"ba80")));case"featureCollection":return this.updatingHandles.addPromise(i.e("chunk-703d78b0").then(i.bind(null,"2dca")));case"graphics":return this.updatingHandles.addPromise(Promise.all([i.e("chunk-2d0d03a7"),i.e("chunk-d96c05b6"),i.e("chunk-69a4522f")]).then(i.bind(null,"b234")))}return null}};Object(o["a"])([Object(l["b"])({constructOnly:!0})],$.prototype,"spatialReference",void 0),Object(o["a"])([Object(l["b"])({constructOnly:!0})],$.prototype,"view",void 0),Object(o["a"])([Object(l["b"])()],$.prototype,"options",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],$.prototype,"updating",null),Object(o["a"])([Object(l["b"])({readOnly:!0})],$.prototype,"snappingSources",null),$=Object(o["a"])([Object(p["a"])("esri.views.interactive.snapping.FeatureSnappingEngine")],$);class J{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new j["a"];const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",()=>e.refresh()))}this.handles.add([Object(S["a"])(e,"updating",t=>e.layerSource.updating=t,!0),Object(S["a"])(e,"availability",t=>e.layerSource.availability=t,!0)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const Q=Object(N["f"])();var ee=i("02f1");class te{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=b["a"].shortLineThreshold*b["a"].shortLineThreshold}snap(e,t){return Object(s["l"])(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,editGeometryOperations:o}){const n=o.data.coordinateHelper;return 0===this.squaredShortLineThreshold||Object(z["f"])(Object(z["b"])(t,n,i,this.view),Object(z["b"])(e,n,i,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class ie extends Z["a"]{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:o}){super(e,o,new q["b"](e,t,i)),this.referenceLineHint=new K["a"](2,t,i)}get hints(){return[this.referenceLineHint,new K["a"](0,this.lineEndClosestToTarget(),this.targetPoint)]}lineEndClosestToTarget(){const e=this.constraint.start,t=this.constraint.end;return Math.sign(Object(D["k"])(Object(D["f"])(ne,t,e),Object(D["f"])(oe,this.targetPoint,e)))>0?t:e}}const oe=Object(ee["b"])(),ne=Object(ee["b"])();var ae=i("0f94");class se extends te{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.edges.length,n=[];if(o<1)return n;const a=t.coordinateHelper,s=Object(z["b"])(e,a,t.elevationInfo,this.view),r=i.edges[o-1];let c=r;do{this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,e,s,t,n),c=c.leftVertex.leftEdge}while(c&&c!==r);return n}snapExistingVertex(e,t){const i=[],o=Object(s["u"])(t.vertexHandle),n=o.component;if(n.edges.length<2)return i;const a=t.coordinateHelper,r=Object(z["b"])(e,a,t.elevationInfo,this.view),c=o.leftEdge,l=o.rightEdge;c&&l&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal(c.leftVertex.pos,l.rightVertex.pos,e,r,t,i);const p=n.edges[0];let d=p;do{d!==o.leftEdge&&d!==o.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal(d.leftVertex.pos,d.rightVertex.pos,e,r,t,i),d=d.rightVertex.rightEdge}while(d&&d!==p);return i}_processCandidateProposal(e,t,i,o,n,a){const s=Object(ae["g"])(Object(ee["b"])(),i,e,t),r=n.coordinateHelper,c=r.fromXYZ(s,r.getZ(i,0));Object(z["f"])(o,Object(z["b"])(c,r,n.elevationInfo,this.view))<this.squaredProximityTreshold(n.pointer)&&a.push(new ie({coordinateHelper:n.coordinateHelper,lineStart:e,lineEnd:t,targetPoint:c}))}}var re=i("d232");class ce extends Z["a"]{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:o}){const n=e.clone(i);Object(D["f"])(n,Object(D["m"])(n,n,t.rightVertex.pos),t.leftVertex.pos),super(e,o,new q["b"](e,i,n)),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new K["a"](0,this.constraint.start,this.targetPoint),new re["a"](this.constraint.start,this.targetPoint),...this._referenceLines.map(e=>new K["a"](1,e.edge.leftVertex.pos,e.edge.rightVertex.pos,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{e.rightVertex.rightEdge===i.edge&&(i.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===i.edge&&(i.fadeRight=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}}class le extends te{constructor(){super(...arguments),this._tmpProjection=Object(ee["b"])()}snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.edges.length,n=i.vertices.length,a=[];if(o<2)return a;const s=Object(z["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),r=i.vertices[n-1],c=i.vertices[0],l=i.edges[o-1];let p=l;do{this.edgeExceedsShortLineThreshold(p,t)&&(this._checkEdgeForParalleLines(p,r.pos,e,s,t,a),this._checkEdgeForParalleLines(p,c.pos,e,s,t,a)),p=p.leftVertex.leftEdge}while(p&&p!==l);return a}snapExistingVertex(e,t){const i=[],o=Object(s["u"])(t.vertexHandle),n=o.component;if(n.edges.length<3)return i;const a=Object(z["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),r=o.leftEdge,c=o.rightEdge,l=n.vertices[0],p=n.vertices.length,d=n.vertices[p-1],h=n.edges[0];let u=h;do{u!==r&&u!==c&&this.edgeExceedsShortLineThreshold(u,t)&&(r&&this._checkEdgeForParalleLines(u,r.leftVertex.pos,e,a,t,i),c&&this._checkEdgeForParalleLines(u,c.rightVertex.pos,e,a,t,i),o===l?this._checkEdgeForParalleLines(u,d.pos,e,a,t,i):o===d&&this._checkEdgeForParalleLines(u,l.pos,e,a,t,i)),u=u.rightVertex.rightEdge}while(u&&u!==h);return i}_checkEdgeForParalleLines(e,t,i,o,n,a){const s=e.leftVertex.pos,r=e.rightVertex.pos;if(Object(ae["g"])(this._tmpProjection,t,s,r),Object(D["a"])(this._tmpProjection,t)<b["a"].parallelLineThreshold)return;Object(ae["g"])(this._tmpProjection,i,s,r,t);const c=n.coordinateHelper,l=c.fromXYZ(this._tmpProjection,c.getZ(i,0));if(Object(z["f"])(o,Object(z["b"])(l,c,n.elevationInfo,this.view))<this.squaredProximityTreshold(n.pointer)){if(this.parallelToPreviousCandidate(e,a))return;a.push(new ce({coordinateHelper:c,referenceLine:e,lineStart:t,targetPoint:l}))}}parallelToPreviousCandidate(e,t){const i=e.leftVertex.pos,o=e.rightVertex.pos;for(const n of t)if(Object(ae["g"])(this._tmpProjection,o,n.constraint.start,n.constraint.end,i),Object(D["a"])(this._tmpProjection,o)<b["a"].parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}class pe extends te{constructor(){super(...arguments),this._tmp=Object(ee["b"])()}snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=i.vertices.length,n=[];if(o<2)return n;const a=Object(z["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),s=i.vertices[o-1];this._checkForSnappingCandidate(n,s.leftEdge,s.pos,e,s.leftEdge.leftVertex.pos,s.pos,t,e,a);const r=i.vertices[0];return this._checkForSnappingCandidate(n,r.rightEdge,r.pos,e,r.rightEdge.rightVertex.pos,r.pos,t,e,a),n}snapExistingVertex(e,t){const i=[],o=Object(s["u"])(t.vertexHandle),n=o.component,a=n.vertices.length;if(a<3)return i;const r=Object(z["b"])(e,t.coordinateHelper,t.elevationInfo,this.view),c=o.leftEdge,l=o.rightEdge,p=n.vertices[0],d=n.vertices[a-1];if(!c)return this._checkForSnappingCandidate(i,p.rightEdge.rightVertex.rightEdge,p.rightEdge.rightVertex.pos,e,p.rightEdge.rightVertex.rightEdge.rightVertex.pos,p.rightEdge.rightVertex.pos,t,e,r),i;if(!l)return this._checkForSnappingCandidate(i,d.leftEdge.leftVertex.leftEdge,d.leftEdge.leftVertex.pos,e,d.leftEdge.leftVertex.leftEdge.leftVertex.pos,d.leftEdge.leftVertex.pos,t,e,r),i;if(c&&c.leftVertex.leftEdge){const o=c.leftVertex.leftEdge;this._checkForSnappingCandidate(i,o,c.leftVertex.pos,e,o.leftVertex.pos,c.leftVertex.pos,t,e,r)}if(l&&l.rightVertex.rightEdge){const o=l.rightVertex.rightEdge;this._checkForSnappingCandidate(i,o,l.rightVertex.pos,e,o.rightVertex.pos,l.rightVertex.pos,t,e,r)}return i}_checkForSnappingCandidate(e,t,i,o,n,a,s,r,c){if(!this.edgeExceedsShortLineThreshold(t,s))return;Object(D["f"])(this._tmp,t.rightVertex.pos,t.leftVertex.pos);const l=Object(ee["f"])(this._tmp[1],-this._tmp[0]),p=Object(D["k"])(l,Object(D["f"])(this._tmp,o,i))/Object(D["u"])(l),d=s.coordinateHelper,h=d.fromXYZ(Object(D["v"])(Object(ee["b"])(),a,l,p),d.getZ(r,0));Object(z["f"])(c,Object(z["b"])(h,d,s.elevationInfo,this.view))<this.squaredProximityTreshold(s.pointer)&&e.push(new X({coordinateHelper:d,targetPoint:h,constraint:new q["e"](d,a,Object(D["v"])(d.createVector(),a,l,Math.sign(p))),previousVertex:n,otherVertex:a,otherVertexType:1}))}}class de extends Z["a"]{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:o}){super(e,t,new q["c"](e,Object(D["o"])(he,i,o,.5),.5*Object(D["b"])(i,o))),this.p1=i,this.p2=o}get hints(){return[new K["a"](1,this.targetPoint,this.p1),new K["a"](1,this.targetPoint,this.p2),new Y["a"](this.p1,this.targetPoint,this.p2)]}}const he=Object(ee["b"])();class ue extends te{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],o=[],n=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return o;const a=i.vertices[0],s=i.vertices[n-1];return this._processCandidateProposal(a.pos,s.pos,e,t,o),o}snapExistingVertex(e,t){const i=[],o=Object(s["u"])(t.vertexHandle),n=o.component;return n.edges.length<2?i:"polyline"!==t.editGeometryOperations.data.type||0!==o.index&&o.index!==n.vertices.length-1?(this._processCandidateProposal(o.leftEdge.leftVertex.pos,o.rightEdge.rightVertex.pos,e,t,i),i):i}_processCandidateProposal(e,t,i,o,n){if(!this.exceedsShortLineThreshold(e,t,o))return;const a=Object(D["o"])(Object(ee["b"])(),e,t,.5),s=.5*Object(D["b"])(e,t),r=Object(ae["f"])(Object(ee["b"])(),i,a,s),c=o.coordinateHelper,l=c.fromXYZ(r,c.getZ(i,0)),p=Object(z["b"])(i,c,o.elevationInfo,this.view);Object(z["f"])(p,Object(z["b"])(l,c,o.elevationInfo,this.view))<this.squaredProximityTreshold(o.pointer)&&n.push(new de({coordinateHelper:c,targetPoint:l,point1:e,point2:t}))}}let be=class extends d["a"]{constructor(e){super(e),this.updating=!1,this._snappers=new n["a"]}initialize(){this._snappers.push(new le(this.view,this.options),new se(this.view,this.options),new pe(this.view,this.options),new ue(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const o of this._snappers.items)i.push(...o.snap(e,t));return Object(z["e"])(e,i),i}};Object(o["a"])([Object(l["b"])({readOnly:!0})],be.prototype,"updating",void 0),Object(o["a"])([Object(l["b"])({constructOnly:!0})],be.prototype,"view",void 0),Object(o["a"])([Object(l["b"])()],be.prototype,"options",null),be=Object(o["a"])([Object(p["a"])("esri.views.interactive.snapping.SelfSnappingEngine")],be);var ge=i("e753");class ve extends Z["a"]{constructor(e,t,i,o){super(e,t,new q["a"](e,t,i.constraint,o.constraint)),this.first=i,this.second=o}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ge["a"](this.targetPoint)]}}let ye=class extends(m["a"].EventedMixin(R["a"])){constructor(e){super(e),this.options=new v,this.engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([Object(T["b"])(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:o}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:o}},()=>{this.doneSnapping(),this.emit("changed")},T["d"]),Object(T["b"])(()=>this.options,e=>{for(const t of this.engines)t.options=e},T["d"]),Object(T["b"])(()=>this.view.ready,e=>this.onViewReady(e),T["e"])])}destroy(){this.destroyEngines()}get updating(){return this.engines.some(e=>e.updating)}onViewReady(e){var t,i;this.destroyEngines(),e&&(this.engines=[new be({view:this.view,options:this.options}),new $({view:this.view,spatialReference:null!=(t=null==(i=this.view)?void 0:i.spatialReference)?t:U["a"].WGS84,options:this.options})])}destroyEngines(){for(const e of this.engines)e.destroy();this.engines.length=0}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const o=t.coordinateHelper.pointToVector(e),n=await this.fetchCandidates(o,t,i);return{get valid(){return!Object(_["n"])(i)},apply:()=>{const{snappedPoint:e,hints:i}=this.processCandidates(o,n,t);return this.removeVisualization(),Object(s["l"])(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),fe),e}}}update(e,t){this.removeVisualization();let i=e;const o=[];if(Object(s["l"])(this._currentMainCandidate)){const n=t.coordinateHelper,a=n.pointToVector(e),s=this._currentMainCandidate.constraint.closestTo(a);if(Object(z["f"])(Object(z["b"])(a,n,t.elevationInfo,this.view),Object(z["b"])(s,n,t.elevationInfo,this.view))<this.squaredPointProximityThreshold(t.pointer)){i=n.vectorToDehydratedPoint(s),this._currentMainCandidate.targetPoint=s,o.push(...this._currentMainCandidate.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=s,o.push(...e.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return Object(s["l"])(t.visualizer)&&this.handles.add(t.visualizer.draw(o,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),fe),i}doneSnapping(){this.removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}removeVisualization(){this.handles.remove(fe)}async fetchCandidates(e,t,i){return(await Promise.all(this.engines.map(o=>o.fetchCandidates(e,t,i)))).flat()}processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};Object(z["e"])(e,t);const o=this._currentMainCandidate;if(Object(s["l"])(o)){const n=this.findOldConstraintInNewCandidates(o,t);if(n>=0){if(!(t[n]instanceof ve))return this.intersectWithOtherCandidates(n,t,e,i);if(Object(D["a"])(e,o.targetPoint)<this.squaredPointProximityThreshold(i.pointer))return this.updateSnappingCandidate(o,t,i)}}return this.intersectWithOtherCandidates(0,t,e,i)}findOldConstraintInNewCandidates(e,t){return e instanceof ve?this.findOldCandidateIndex(t,e.first)>=0&&this.findOldCandidateIndex(t,e.second)>=0?0:-1:this.findOldCandidateIndex(t,e)}intersectWithOtherCandidates(e,t,i,o){const n=t[e],a=[],s=o.coordinateHelper;for(let r=0;r<t.length;++r){if(r===e)continue;const c=t[r];for(const e of n.constraint.intersect(c.constraint)){const t=s.fromXYZ(e.intersection,n.targetPoint[2]);a.push([new ve(s,t,n,c),Object(z["f"])(Object(z["b"])(i,o.coordinateHelper,o.elevationInfo,this.view),Object(z["b"])(t,o.coordinateHelper,o.elevationInfo,this.view))])}}return a.length>0&&(a.sort((e,t)=>e[1]-t[1]),a[0][1]<this.squaredPointProximityThreshold(o.pointer))?this.updateSnappingCandidate(a[0][0],t,o):this.updateSnappingCandidate(n,t,o)}updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const o=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const a of t){if(e instanceof ve){if(a.constraint.objectEqual(e.first.constraint)||a.constraint.objectEqual(e.second.constraint))continue}else if(a.constraint.objectEqual(e.constraint))continue;a.constraint.check(o)&&(a.targetPoint=o,this._currentOtherActiveCandidates.push(a),n.push(...a.hints))}return{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(o),hints:n}}squaredPointProximityThreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}findOldCandidateIndex(e,t){let i=-1;for(let o=0;o<e.length;++o)if(t.constraint.objectEqual(e[o].constraint)){i=o;break}return i}get test(){return{visualizationsActive:this.handles.has(fe),engines:this.engines}}};Object(o["a"])([Object(l["b"])({constructOnly:!0})],ye.prototype,"view",void 0),Object(o["a"])([Object(l["b"])()],ye.prototype,"options",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],ye.prototype,"updating",null),Object(o["a"])([Object(l["b"])()],ye.prototype,"engines",void 0),Object(o["a"])([Object(l["b"])()],ye.prototype,"squaredMouseProximityTreshold",null),Object(o["a"])([Object(l["b"])()],ye.prototype,"squaredTouchProximityThreshold",null),ye=Object(o["a"])([Object(p["a"])("esri.views.interactive.snapping.SnappingManager")],ye);const fe="visualization-handle";var Oe=i("412f"),me=i("6c97");let je=class extends m["a"].EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:Object(me["a"])(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this.reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};Object(o["a"])([Object(l["b"])()],je.prototype,"activeComponent",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"cancelled",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"history",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"tool",null),Object(o["a"])([Object(l["b"])()],je.prototype,"type",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"canUndo",null),Object(o["a"])([Object(l["b"])()],je.prototype,"canRedo",null),Object(o["a"])([Object(l["b"])()],je.prototype,"onEnd",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"undo",null),Object(o["a"])([Object(l["b"])()],je.prototype,"redo",null),Object(o["a"])([Object(l["b"])()],je.prototype,"toggleTool",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"addToSelection",void 0),Object(o["a"])([Object(l["b"])()],je.prototype,"removeFromSelection",void 0),je=Object(o["a"])([Object(p["a"])("esri.widgets.Sketch.support.OperationHandle")],je);let we=class extends je{};Object(o["a"])([Object(l["b"])()],we.prototype,"activeComponent",void 0),we=Object(o["a"])([Object(p["a"])("esri.widgets.Sketch.support.CreateOperationHandle")],we);let _e=class extends je{constructor(e){super(e)}};Object(o["a"])([Object(l["b"])()],_e.prototype,"activeComponent",void 0),_e=Object(o["a"])([Object(p["a"])("esri.widgets.Sketch.support.UpdateOperationHandle")],_e);var Te=i("4dc9"),Se=i("0d76"),Ee=i("db52");const Ce="esri.widgets.Sketch.SketchViewModel",ke=w["a"].getLogger(Ce),xe={defaultZ:0},Me={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let Ge=class extends m["a"].EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new j["a"],this._internalGraphicsLayer=new k["a"]({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new j["a"],this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Te["a"]({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Se["a"]({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Ee["a"]({color:[130,130,130,1],width:2}),this._snappingManager=null,this.updateGraphics=new n["a"],this.updateOnGraphicClick=!0,this.updatePointSymbol=new Te["a"]({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new Se["a"]({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new Ee["a"]({color:[12,207,255],width:2}),this.vertexSymbol=new Te["a"]({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=xe,this.defaultUpdateOptions=Me,this.snappingOptions=new v}initialize(){this._handles.add([Object(S["e"])(this,"layer",()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=Object(s["l"])(this.layer)?this.layer.elevationInfo:null}),Object(S["b"])(this,"view.map.layers","change",e=>{e.removed.includes(this.layer)&&this.cancel()}),Object(S["b"])(this,"layer.graphics","change",e=>{if(Object(s["l"])(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),Object(S["a"])(this,"layer.elevationInfo",()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=Object(s["l"])(this.layer)?this.layer.elevationInfo:null},!0),Object(S["a"])(this,"view",e=>{Object(s["e"])(this._snappingManager),e&&(this._snappingManager=new ye({view:e,options:this.snappingOptions}),"2d"===e.type?Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-033f5960")]).then(i.bind(null,"1803")):"3d"===e.type&&(Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-3a9abef0"),i.e("chunk-cf45132c")]).then(i.bind(null,"438e")),Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-66a552f7"),i.e("chunk-3a9abef0"),i.e("chunk-b92058b4")]).then(i.bind(null,"bb49"))))},!0)])}destroy(){this.cancel(),this._handles=Object(s["e"])(this._handles),this._viewHandles=Object(s["e"])(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=Object(s["e"])(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!Object(s["l"])(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):Object(s["u"])(this.activeComponent.graphic)}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...xe,...e})}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Me,...e,reshapeOptions:{...Me.reshapeOptions,...null==e?void 0:e.reshapeOptions}})}set snappingOptions(e){Object(s["l"])(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){var e;const t=!(null==(e=this.view)||!e.ready||!this.layer),i=this._operationHandle;return t&&i?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const i="view-ready";this._handles.remove(i),e&&this._handles.add(Object(S["f"])(e,"ready",t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))},!0),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Object(s["a"])(this._moduleLoaderAbortController),this._viewReadyAbortController=Object(s["a"])(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,o=t.toArray();i.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:e})}}async create(e,t){if(this.cancel(),await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),Object(_["e"])();if(Object(s["l"])(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Object(A["a"])(this.view,this._internalGraphicsLayer);const i=await this._setupCreateOperation(e,t);if(Object(s["k"])(i)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);const o=()=>{if(i===this._operationHandle){const t=this.createGraphic,o=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:o?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}};i.on("complete",o),this._operationHandle=i,this.view.ready&&Object(x["b"])(this.view)&&this.view.focus()}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:o,state:n}=this;if("disabled"===n)throw o||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),Object(_["e"])();Object(s["l"])(this.view.activeTool)&&(this.view.activeTool=null);const a=Array.isArray(e)?e:[e];if(null==e||!a||!a.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(a.some(e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):Object(s["k"])(e.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"===o.type&&!o.spatialReference.equals(e.geometry.spatialReference)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0)))return;const r=await this._setupUpdateOperation(a,t);this.destroyed||Object(s["k"])(r)||Le(r)||(Object(A["a"])(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(r,t),this.emit("update",{graphics:a,state:"start",aborted:!1,tool:r.tool,toolEventInfo:null,type:"update"}))}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=[];switch(this.view.type){case"2d":{const i=[];this.view.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||i.push(e)});const o=await this.view.hitTest(e,{exclude:i});if(o.results.length>0){const e=o.results[0];e.graphic&&t.push(e)}}break;case"3d":{const i=[this.view.map.ground];this.view.map.allLayers.forEach(e=>{"integrated-mesh"===e.type&&i.push(e)});const o=await this.view.hitTest(e,{exclude:i});if(o.results.length>0){const e=o.results[0];(!o.ground.mapPoint||this.view.map.ground.opacity<1||o.ground.distance-Object(s["v"])(e.distance,0)>-Math.min(3*o.ground.distance,"global"===this.view.viewingMode?Object(E["e"])(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&t.push(e)}}}return{screenPoint:e,results:t}}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i="active"===this.state&&"create"===this._operationHandle.type;if("disabled"===this.state||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const o=(await t.async(()=>this._getFirstHit(Object(Oe["a"])(t)))).results;let n=null;if(o.length){for(const a of o)if(a.graphic){const i=a.graphic;if(this.updateGraphics.includes(i)||i.layer===this.layer){t.stopPropagation(),n=i;break}"2d"!==e.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}}else"active"===this.state&&this.cancel();Object(s["l"])(n)&&!this.updateGraphics.includes(n)&&await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()},V["b"].WIDGET)]}async _setupCreateOperation(e,t){const i={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,this.view,i);return Object(s["k"])(o)?null:(this.view.tools.add(o),this.view.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView"),null;const o="rectangle"!==e,n="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const a={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...i,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:n,centered:o};return"2d"===this.view.type?this._makeDrawGraphicTool2D(a):this._makeDrawGraphicTool3D(a)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-033f5960")]).then(i.bind(null,"1803")));return Le(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Pe(e.geometryType)?this.activeFillSymbol:null})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-3a9abef0"),i.e("chunk-cf45132c")]).then(i.bind(null,"438e")));return Le(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:this.layer.elevationInfo,snapToScene:!Object(s["l"])(this.layer.elevationInfo)||"absolute-height"===this.layer.elevationInfo.mode})}_setupCreateOperationHandle(e){let t=null;const i=e.forceUniformSize,o=e.centered,n=[this.view.on("key-down",t=>{if(t.key===L["a"].pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===L["a"].complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==L["a"].vertexAdd||t.repeat)t.key===L["a"].undo?(t.stopPropagation(),a.undo()):t.key===L["a"].redo?(t.stopPropagation(),a.redo()):t.key!==L["a"].snappingToggle||"rectangle"===e.geometryType||"circle"===e.geometryType||t.repeat?t.key!==L["a"].constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===L["a"].center&&(t.repeat||(e.centered=!o,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation());else{const i=e.drawOperation.geometryType;"polyline"!==i&&"polygon"!==i&&"multipoint"!==i||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},V["b"].WIDGET),this.view.on("key-up",t=>{t.key===L["a"].pan?e.enabled=!0:t.key===L["a"].snappingToggle&&"rectangle"!==e.geometryType&&"circle"!==e.geometryType?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==L["a"].constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===L["a"].center&&(e.centered=o,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())},V["b"].WIDGET),e.on("vertex-add",i=>{switch(t=Object(s["k"])(t)?"start":"active",i.operation){case"apply":this.emit("create",{graphic:Object(s["u"])(e.graphic),state:t,tool:this.activeTool,toolEventInfo:i,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[Object(s["u"])(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[Object(s["u"])(e.graphic)],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:Object(s["u"])(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:Object(s["u"])(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[Object(s["u"])(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[Object(s["u"])(e.graphic)],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",Object(s["u"])(e.graphic)),t="complete",e.aborted?a&&a.cancel():a&&a.complete()}),Object(T["b"])(()=>this._getGraphicSymbolFromTool(e.geometryType),t=>{e.graphicSymbol=t})],a=new je({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{var t;n.forEach(e=>e.remove()),n.length=0,null==(t=this.view.tools)||t.remove(e),e.destroy()},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:i,view:o}=this,n={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null==t?void 0:t.reshapeOptions}};let a=n.tool;for(const s of e)i.remove(s),i.add(s);if("3d"===o.type){if(0===e.length)return null;switch(a){case"move":return this._setupMove3DOperation(e,n,o,a);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=Object(P["b"])(e[0]);return 0===t?this._setupReshape3DOperation(e[0],n,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${M(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,n,o)}}switch(a){case"move":return this._setupMoveOperation(e,n,o);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=Object(P["b"])(e[0]);return 0===t?this._setupTransformOrReshapeOperation(e,a,n,o):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${M(t)}).`),null)}case"transform":if(1===e.length){const t=Object(s["j"])(e[0].geometry,"type");"point"!==t&&"multipoint"!==t||(a="reshape")}return this._setupTransformOrReshapeOperation(e,a,n,o)}}async _setupMove3DOperation(e,t,o,n,a=!1){for(const i of e){const e=Object(G["a"])(i);if(0!==e)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${M(e)}).`),null}const s=await this._requireModule(Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-3a9abef0"),i.e("chunk-cf45132c")]).then(i.bind(null,"438e")));if(Le(s))return s;const r=new s.module.GraphicMoveTool({view:o,enableZ:t.enableZ,snappingManager:this._snappingManager});this.view.tools.add(r),r.graphics.addMany(e),a||this.updateGraphics.addMany(e);const c=[],l=new _e({activeComponent:r,tool:n,type:"update",onEnd:()=>{var e;c.forEach(e=>e.remove()),c.length=0,null==(e=this.view.tools)||e.remove(r),r.destroyed||r.destroy()},undo:()=>{He(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Ie(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:e=>{this.updateGraphics.push(e),r.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);l.history.undo.forEach(e=>e.updates.splice(t,1)),l.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?r.graphics.remove(e):l.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==n)return;const e=this.updateGraphics.getItemAt(0);if(0!==Object(P["b"])(e))return;const i=await this._setupReshape3DOperation(e,t,o,!0);Le(i)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(i,t))}});return c.push(...this._getHandlesForComponent(l,t),this.view.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(l,e,t),V["b"].WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===L["a"].snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())},V["b"].WIDGET),o.on("key-up",e=>{e.key===L["a"].snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())},V["b"].WIDGET)),l}_setupGraphicTransform3DOperation(e,t,i,o=!1){if(1===e.length&&0===I(e[0])){const n=e[0],a=n.geometry;if(Object(s["l"])(a)&&("point"===a.type||"mesh"===a.type))return this._setupPointTransform3DOperation(n,t,i);if(Object(s["l"])(a)&&("polygon"===a.type||"polyline"===a.type))return this._setupPolyTransform3DOperation(n,t,i,o)}return this._setupMove3DOperation(e,t,i,"transform",o)}async _setupPointTransform3DOperation(e,t,o){const n="transform",{enableRotation:a,enableScaling:s,enableZ:r}=t,c=await this._requireModule(Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-3a9abef0"),i.e("chunk-cf45132c")]).then(i.bind(null,"438e")));if(Le(c))return c;const l=new c.module.GraphicTransformTool({graphic:e,view:o,enableRotation:a,enableScaling:s,enableZ:r,snappingManager:this._snappingManager});this.view.tools.add(l),this.updateGraphics.add(e);const p=[],d=new _e({activeComponent:l,tool:n,type:"update",onEnd:()=>{var e;p.forEach(e=>e.remove()),p.length=0,null==(e=this.view.tools)||e.remove(l),l.destroyed||l.destroy()},undo:()=>{He(d,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Ie(d,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);Le(i)||(d.onEnd(),d.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),d.complete()},toggleTool:()=>{}});return p.push(...this._getHandlesForComponent(d,t),this.view.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(d,e,t),V["b"].WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(d,e),e.key===L["a"].snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())},V["b"].WIDGET),o.on("key-up",e=>{e.key===L["a"].snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())},V["b"].WIDGET)),d}async _setupPolyTransform3DOperation(e,t,o,n=!1){const a="transform",{enableRotation:s,enableScaling:r,enableZ:c,preserveAspectRatio:l}=t,p=await this._requireModule(Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-3a9abef0"),i.e("chunk-cf45132c")]).then(i.bind(null,"438e")));if(Le(p))return p;const d=new p.module.ExtentTransformTool({graphic:e,view:o,enableRotation:s,enableScaling:r,enableZ:c,preserveAspectRatio:l});this.view.tools.add(d),n||this.updateGraphics.add(e);const h=[],u=new _e({activeComponent:d,tool:a,type:"update",onEnd:()=>{var e;h.forEach(e=>e.remove()),h.length=0,null==(e=this.view.tools)||e.remove(d),d.destroyed||d.destroy()},canUndo:()=>d.canUndo,undo:()=>{d.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},canRedo:()=>d.canRedo,redo:()=>{d.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);Le(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),u.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if(0!==Object(P["b"])(e))return;const i=await this._setupReshape3DOperation(e,t,o,!0);Le(i)||(u.onEnd(),u.destroy(),this._setUpdateOperationHandle(i,t))}});return h.push(...this._getHandlesForComponent(u,t),this.view.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(u,e,t),V["b"].WIDGET),this.view.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(u,e),V["b"].WIDGET),this.view.on("key-down",e=>{e.key!==L["a"].constraint||e.repeat||(d.preserveAspectRatio=!d.preserveAspectRatio,e.stopPropagation())},V["b"].WIDGET),this.view.on("key-up",e=>{e.key===L["a"].constraint&&(d.preserveAspectRatio=!d.preserveAspectRatio,e.stopPropagation())},V["b"].WIDGET)),u}async _setupMoveOperation(e,t,i){const o="move";this.updateGraphics.addMany(e);const n=await this._getGraphicMover(e,t,i);if(Le(n))return n;const a=new _e({activeComponent:n,tool:o,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),c.forEach(e=>e.remove()),r.forEach(e=>e.remove()),c=[],r=[],n.destroy(),null==(e=this._internalGraphicsLayer)||e.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();He(a,e),a.refreshComponent(),this._emitUndoEvent({graphics:e,tool:o})},redo:()=>{const e=this.updateGraphics.toArray();Ie(a,e),a.refreshComponent(),this._emitRedoEvent({graphics:e,tool:o})},addToSelection:e=>{this.updateGraphics.push(e),n.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);a.history.undo.forEach(e=>e.updates.splice(t,1)),a.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?n.graphics=i:a.complete()}});let s=!1,r=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(a,e,t),V["b"].WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(a,e),e.key!==L["a"].constraint||e.repeat||(s=!0,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)},V["b"].WIDGET),i.on("key-up",e=>{e.key===L["a"].constraint&&s&&(s=!1,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)},V["b"].WIDGET)],c=this._getHandlesForComponent(a,t);return a}async _setupReshape3DOperation(e,t,o,n=!1){const a="reshape",s=await this._requireModule(Promise.all([i.e("chunk-68ddeb1e"),i.e("chunk-2d22cf8c"),i.e("chunk-b402834e"),i.e("chunk-3a9abef0"),i.e("chunk-cf45132c")]).then(i.bind(null,"438e")));if(Le(s))return s;this.snappingOptions.enabledToggled=!1;const r=new s.module.GraphicReshapeTool({view:o,graphic:e,enableZVertex:t.enableZ&&"move"===t.reshapeOptions.vertexOperation,enableZShape:t.enableZ&&"move"===t.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===t.reshapeOptions.shapeOperation||"move-xy"===t.reshapeOptions.shapeOperation,enableMidpoints:"split"===t.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===t.reshapeOptions.edgeOperation,snappingManager:this._snappingManager});o.tools.add(r),n||this.updateGraphics.add(e);const c=[],l=new _e({activeComponent:r,tool:a,type:"update",onEnd:()=>{var e;c.forEach(e=>e.remove()),c.length=0,null==(e=this.view.tools)||e.remove(r),r.destroyed||r.destroy()},canUndo:()=>r.canUndo,undo:()=>{r.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},canRedo:()=>r.canRedo,redo:()=>{r.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);Le(i)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(i,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),l.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);Le(e)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(e,t))}});return c.push(...this._getHandlesForComponent(l,t),o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(l,e,t),V["b"].WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===L["a"].snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())},V["b"].WIDGET),o.on("key-up",e=>{e.key===L["a"].snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())},V["b"].WIDGET)),l}async _setupTransformOrReshapeOperation(e,t,i,o){const{multipleSelectionEnabled:n}=i;this.updateGraphics.addMany(e);const a="transform"===t?await this._getBox(e,i,o):await this._getReshape(e,i,o);if(Le(a))return a;const r=new _e({activeComponent:a,type:"update",onEnd:()=>{l.forEach(e=>e.remove()),c.forEach(e=>e.remove()),l=[],c=[],r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{He(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{Ie(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async e=>{let t=r.activeComponent;if("reshape"===t.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll();const n=await this._setupMoveOperation(t,i,o);if(Le(n))return;r.onEnd(),r.destroy(),this._setUpdateOperationHandle(n,i)}else this.updateGraphics.add(e),t=t,t.graphics=this.updateGraphics.toArray(),t.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach(e=>e.updates.splice(t,1)),r.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();if(0===i.length)r.complete();else{const e=i[0].geometry;1!==i.length||!Object(s["l"])(e)||"point"!==e.type&&"multipoint"!==e.type?r.activeComponent.graphics=i:r.toggleTool()}this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.getItemAt(0),t=e.geometry;if(Object(s["l"])(t)&&("reshape"===r.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===r.tool&&"extent"===t.type))return;let n=null;"transform"===r.tool?n=await this._getReshape([e],i,o):"reshape"===r.tool&&(n=await this._getBox([e],i,o)),Le(n)||(r.activeComponent.destroy(),r.activeComponent=n,r.activeComponent&&(l.forEach(e=>e.remove()),l=this._getHandlesForComponent(r,i)))}});let c=[o.on("immediate-click",async e=>{var t;const i=await e.async(()=>this._getFirstHit(Object(Oe["a"])(e)));null!=(t=i.results)&&t.length?i.results.some(t=>{if(t.graphic){var i;const o=t.graphic;if(null!=(i=e.native)&&i.shiftKey&&n)return e.stopPropagation(),r.addToSelection(o),!0;if(o.layer===this.layer)return r.complete(),!0}return!1}):r.complete()},V["b"].WIDGET),o.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==L["a"].snappingToggle||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===L["a"].constraint&&!e.repeat&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},V["b"].WIDGET),o.on("key-up",e=>{var t;if(e.key===L["a"].snappingToggle&&"reshape"===(null==r||null==(t=r.activeComponent)?void 0:t.type)&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===L["a"].constraint&&r){const e=r.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},V["b"].WIDGET)],l=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:n}=t,a=await this._requireModule(i.e("chunk-3f48965f").then(i.bind(null,"24be")));return Le(a)?a:new a.module.default({enableMoveAllGraphics:n,graphics:e,view:o,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:n,enableScaling:a,preserveAspectRatio:s}=t,r=await this._requireModule(i.e("chunk-c08e8064").then(i.bind(null,"4c3c")));return Le(r)?r:new r.module.default({graphics:e,enableRotation:n,enableScaling:a,preserveAspectRatio:s,layer:this._internalGraphicsLayer,view:o,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,o){var n,a;const s="split"===(null==(n=t.reshapeOptions)?void 0:n.edgeOperation),r="move"===(null==(a=t.reshapeOptions)?void 0:a.shapeOperation),c=await this._requireModule(Promise.all([i.e("chunk-b402834e"),i.e("chunk-949aa0d4")]).then(i.bind(null,"053b")));return Le(c)?c:new c.module.default({enableMidpoints:s,enableMovement:r,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:o,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:o},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const o=e.map(e=>Object(C["b"])(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:o,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const o=e.map(e=>Object(C["b"])(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:o,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:t,viewEvent:i})=>{var o;null!=(o=i.native)&&o.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))}),i.on("graphic-move-start",t=>e.addToHistory(Ve(t.allGraphics)))];case"box":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(Ve(t.graphics))),i.on("rotate-start",t=>e.addToHistory(Ve(t.graphics))),i.on("scale-start",t=>e.addToHistory(Ve(t.graphics)))];case"reshape":return[i.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(e,t,i)),i.on("move-start",t=>e.addToHistory(Ve([t.mover]))),i.on("reshape-start",t=>e.addToHistory(Ve([t.graphic]))),i.on("vertex-add",t=>e.addToHistory(Ve([t.oldGraphic]))),i.on("vertex-remove",t=>e.addToHistory(Ve([t.oldGraphic])))];case"move-3d":return[i.on("graphic-move-start",t=>{e.addToHistory(Ve(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})}),i.on("graphic-move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})}),i.on("graphic-move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})}),i.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.on("record-undo",({record:t})=>{e.addToHistory({updates:[t]})}),i.on("graphic-translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),i.on("graphic-translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),i.on("graphic-rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),i.on("graphic-rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),i.on("graphic-scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),i.on("graphic-scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),i.on("graphic-translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),i.on("graphic-rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})}),i.on("graphic-scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),i.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),i.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()})];default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){var o;const{graphic:n,viewEvent:a}=i;return null!=(o=a.native)&&o.shiftKey&&n.layer===this.layer?(a.stopPropagation(),e.removeFromSelection(n)):t.toggleToolOnClick?(a.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);const o=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),n=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:n,toolEventInfo:null,type:"update"})}};e.on("complete",o)}async _getCommonUpdateOperationClickHandlers(e,t,i){const o=Object(Oe["a"])(t),n=(await t.async(()=>this._getFirstHit(o))).results;n.length&&(t.native.shiftKey&&this._toggleSelection(n.map(e=>e.graphic),e,i)||n.some(e=>e.graphic&&this.updateGraphics.includes(e.graphic)))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const o=!!i.multipleSelectionEnabled;return e.some(e=>null!=e&&!(!o||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===L["a"].undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===L["a"].redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===L["a"].cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&L["a"].delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();Object(s["k"])(t)||"reshape-3d"===t.type||("reshape"!==t.type||1===i.length&&"point"===Object(s["j"])(i[0].geometry,"type"))&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Object(s["e"])(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||Object(s["k"])(t))&&(e.attributes&&e.attributes.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){ke.error(new O["a"](e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Me}}wait(){return Object(S["j"])(this,"updating")}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t;return"3d"!==(null==(t=this.view)?void 0:t.type)||this.updateOnGraphicClick||Object(s["l"])(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&Object(s["k"])(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&Object(s["l"])(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){this.view&&(Object(s["a"])(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Object(_["A"])(Object(S["k"])(this.view,"ready"),this._viewReadyAbortController.signal))}};function Pe(e){return"polygon"===e||"rectangle"===e||"circle"===e}function He(e,t){Ae("undo",e.history.undo,e.history.redo,t)}function Ie(e,t){Ae("redo",e.history.redo,e.history.undo,t)}function Ae(e,t,i,o){const n=t.pop().updates,a=[];o.forEach((t,i)=>{const o=n[i];null!=o&&("geometry"in o&&Object(s["l"])(o.geometry)&&(a.push({geometry:t.geometry}),t.geometry=o.geometry),"symbol"in o&&Object(s["l"])(o.symbol)&&(a.push({symbol:t.symbol}),t.symbol=o.symbol),"undo"in o&&(a.push(o),o[e](t)))}),i.push({updates:a})}function Ve(e){return{updates:e.map(e=>({geometry:e.geometry}))}}function Le(e){return"requireError"in e&&"aborted"===e.requireError}Object(o["a"])([Object(l["b"])()],Ge.prototype,"updating",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"_operationHandle",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Ge.prototype,"activeTool",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"activeFillSymbol",void 0),Object(o["a"])([Object(l["b"])()],Ge.prototype,"activeLineSymbol",void 0),Object(o["a"])([Object(l["b"])()],Ge.prototype,"activeVertexSymbol",void 0),Object(o["a"])([Object(l["b"])()],Ge.prototype,"allowDeleteKey",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Ge.prototype,"createGraphic",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"defaultCreateOptions",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"defaultUpdateOptions",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"layer",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"pointSymbol",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"polygonSymbol",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"polylineSymbol",void 0),Object(o["a"])([Object(l["b"])({type:v,nonNullable:!0})],Ge.prototype,"snappingOptions",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"_snappingManager",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Ge.prototype,"state",null),Object(o["a"])([Object(l["b"])({readOnly:!0})],Ge.prototype,"updateGraphics",void 0),Object(o["a"])([Object(l["b"])()],Ge.prototype,"updateOnGraphicClick",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"updatePointSymbol",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"updatePolygonSymbol",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"updatePolylineSymbol",void 0),Object(o["a"])([Object(l["b"])({types:f["e"]})],Ge.prototype,"vertexSymbol",void 0),Object(o["a"])([Object(l["b"])({value:null})],Ge.prototype,"view",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"cancel",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"complete",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"delete",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"create",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"update",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"undo",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"redo",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"canUndo",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"canRedo",null),Object(o["a"])([Object(l["b"])()],Ge.prototype,"toggleUpdateTool",null),Ge=Object(o["a"])([Object(p["a"])(Ce)],Ge);const Re=Ge;var De=i("702a"),Ue=i("755e"),Fe=i("d822");async function Ne(){return Promise.all([i.e("chunk-2d22cf8c"),i.e("chunk-252f2cfc")]).then(i.bind(null,"00ac"))}async function qe(){return Ne().then(({contains:e,intersects:t,overlaps:i,simplify:o})=>({contains:e,intersects:t,overlaps:i,simplify:o}))}async function ze(e){const{selector:t,candidates:i,currentSelection:o,options:n,view:a}=e;if(!(i&&i.length&&o&&a))return{added:[],removed:[]};const{overlaps:s,intersects:r,contains:c}=n,{spatialReference:l}=a;if(!t)return{added:[],removed:o.removeAll()};const p=t,d=await qe(),h=[],u=[];return i.forEach(e=>{const t=e.geometry,i=s&&!!d.overlaps(l,p,t),n=r&&!!d.intersects(l,p,t),a=c&&!!d.contains(l,p,t),b=o.includes(e);i||n||a?!b&&h.push(e):b&&u.push(e)}),o.removeMany(u),o.addMany(h),{added:h,removed:u}}let Be=class extends m["a"].EventedAccessor{constructor({candidates:e,options:t,view:i}){super(),this._activeOptions=null,this._dashedFillSymbol=new Se["a"]({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new Ee["a"]({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={createTool:"rectangle",createOptions:null,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._completed=!1,this._handles=new j["a"],this._sketchViewModel=new Re,this._sketchGraphicsLayer=new k["a"]({listMode:"hide",internal:!0}),this._transparentPointSymbol=new Te["a"]({color:[0,0,0,0],outline:{style:"none",width:0}}),this.candidates=null,this.geometry=null,this.options=null,this.selection=new n["a"],this.view=null,this.candidates=e,this.options=t,this.view=i;const{_dashedFillSymbol:o,_dashedLineSymbol:a,_sketchViewModel:s,_sketchGraphicsLayer:r,_transparentPointSymbol:c}=this;s.set({layer:r,view:this.view,activePointSymbol:c,activeLineSymbol:a,activeVertexSymbol:c,activeFillSymbol:o,pointSymbol:c,polygonSymbol:o,polylineSymbol:a,vertexSymbol:c}),this._handles.add([s.on("create",e=>this._onSketchEvent(e)),s.on(["undo","redo"],e=>this._onSketchEvent(e))])}initialize(){this._load()}destroy(){this._handles.destroy(),this._handles=null}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}cancel(){this._sketchViewModel.cancel()}async _load(){await this.view.whenReady();const{options:e}=this,{createTool:t,createOptions:i}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,i)}_onSketchEvent(e){const t="create"===e.type?e.graphic:e.graphics[0],i=(null==t?void 0:t.geometry)||null,o="create"===e.type&&"cancel"===e.state,n="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(i,n,o)}_processSelectionGeometry(e,t,i){if(this._set("geometry",e),(t||i)&&(this._completed=!0),i)return void this._onComplete([],!0);const{_activeOptions:o,candidates:n,selection:a,view:s}=this;ze({selector:e,candidates:n,currentSelection:a,options:o.selectionOptions,view:s}).then(({added:e,removed:i})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||i.length)&&this.emit("selection-change",{added:e,removed:i,type:"selection-change"})})}_onComplete(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};Object(o["a"])([Object(l["b"])()],Be.prototype,"_completed",void 0),Object(o["a"])([Object(l["b"])()],Be.prototype,"candidates",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Be.prototype,"geometry",void 0),Object(o["a"])([Object(l["b"])()],Be.prototype,"options",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Be.prototype,"selection",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Be.prototype,"state",null),Object(o["a"])([Object(l["b"])({value:null})],Be.prototype,"view",void 0),Be=Object(o["a"])([Object(p["a"])("esri.widgets.support.Selector2D.SelectionOperation2D")],Be);const We=Be;let Ze=class extends(Object(R["b"])(d["a"])){constructor(e){super(e),this._defaultSelectionOptions={intersects:!0,overlaps:!0,contains:!0},this.candidates=null,this.options=null,this.view=null}draw(e){const{_defaultSelectionOptions:t,candidates:i,options:o,view:n}=this,a={...t,...o,...null==e?void 0:e.selectionOptions};return new We({candidates:i,options:{...e,selectionOptions:a},view:n})}async selectionFrom(e,t){const{_defaultSelectionOptions:i,candidates:o,options:a,view:s}=this,r=new n["a"],c={...i,...a,...t};return await ze({selector:e,candidates:o,currentSelection:r,options:c,view:s}),r.toArray()}};Object(o["a"])([Object(l["b"])()],Ze.prototype,"candidates",void 0),Object(o["a"])([Object(l["b"])()],Ze.prototype,"options",void 0),Object(o["a"])([Object(l["b"])({value:null})],Ze.prototype,"view",void 0),Ze=Object(o["a"])([Object(p["a"])("esri.widgets.support.Selector2D")],Ze);const Ke=Ze;let Ye=class extends m["a"].EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layers=null,this.selector=new Ke}destroy(){this._operationHandlesGroup=Object(s["t"])(this._operationHandlesGroup),this.selector.destroy()}get state(){var e,t;return this.activeOperation?"active":null!=(e=this.view)&&e.ready&&null!=(t=this.layers)&&t.length?"ready":"disabled"}set view(e){this.selector.view=e,this._set("view",e)}cancel(){"active"===this.state&&(this.activeOperation.cancel(),this.activeOperation=null),this.selector.candidates=null}activate(e){const{state:t}=this;if("disabled"===t)return;"active"===t&&this.cancel(),this.selector.candidates=this._getCandidates();const i=this.selector.draw(e);return this._operationHandlesGroup=Object(a["b"])([i.once("complete",e=>this._onOperationComplete(e)),i.on("selection-change",e=>this._onOperationSelectionChange(e))]),this.activeOperation=i,i}_getCandidates(){let e=[];return this.layers.forEach(t=>{e=e.concat(...t.graphics.toArray())}),e}_onOperationSelectionChange(e){this.emit("selection-change",e)}_onOperationComplete(e){this._operationHandlesGroup=Object(s["t"])(this._operationHandlesGroup),this.activeOperation=null,this.emit("complete",e)}};Object(o["a"])([Object(l["b"])()],Ye.prototype,"activeOperation",void 0),Object(o["a"])([Object(l["b"])()],Ye.prototype,"layers",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Ye.prototype,"selector",void 0),Object(o["a"])([Object(l["b"])({readOnly:!0})],Ye.prototype,"state",null),Object(o["a"])([Object(l["b"])()],Ye.prototype,"view",null),Ye=Object(o["a"])([Object(p["a"])("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],Ye);const Xe=Ye,$e={lassoTool:!0,rectangleTool:!0},Je={createTool:"polygon",createOptions:{mode:"freehand"}},Qe={createTool:"rectangle"},et={base:"esri-selection-toolbar",container:"esri-selection-toolbar__container",toolButton:"esri-selection-toolbar__tool-button",disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let tt=class extends y["a"]{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.label=void 0,this.layers=[],this.messages=null,this.toolConfigs=[],this.view=null,this.viewModel=new Xe,this.visibleElements={...$e},this._viewModelHandlesGroup=Object(a["b"])([this.viewModel.on("selection-change",e=>this.emit("selection-change",e)),this.viewModel.on("complete",e=>{this._set("activeToolInfo",null),this.emit("complete",e)})])}destroy(){this._viewModelHandlesGroup=Object(s["t"])(this._viewModelHandlesGroup)}loadDependencies(){return Promise.all([i.e("chunk-589b7919"),i.e("chunk-2d222978")]).then(i.bind(null,"ceee"))}castVisibleElements(e){return{...$e,...e}}activate(e){switch(this.cancel(),e){case"lasso":this._activateTool("lasso");case"rectangle":this._activateTool("rectangle");default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return Object(Fe["a"])("div",{"aria-label":this.label,class:this.classes(et.base,et.esriWidget)},Object(Fe["a"])("div",{class:et.container},this.renderDefaultTools(),this.renderCustomTools()))}renderDefaultTools(){var e;if("2d"===(null==(e=this.view)?void 0:e.type))return[this.renderRectangleTool(),this.renderLassoTool()]}renderCustomTools(){if(this.toolConfigs&&this.toolConfigs.length)return this.toolConfigs.map(e=>{var t;return Object(Fe["a"])("calcite-action",{active:(null==(t=this.activeToolInfo)?void 0:t.toolName)===e.toolName,bind:this,class:et.toolButton,icon:e.icon||"selection",label:e.toolName,onclick:()=>this._onCustomToolClick(e.toolName),scale:"s",text:e.toolName,title:e.toolName})})}renderLassoTool(){const{activeToolInfo:e,messages:t,visibleElements:i}=this;if(i.lassoTool)return Object(Fe["a"])("calcite-action",{active:"lasso"===(null==e?void 0:e.toolName),bind:this,icon:"lasso",label:t.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:t.selectByLasso,title:t.selectByLasso})}renderRectangleTool(){const{activeToolInfo:e,messages:t,visibleElements:i}=this;if(i.rectangleTool)return Object(Fe["a"])("calcite-action",{active:"rectangle"===(null==e?void 0:e.toolName),bind:this,icon:"cursor-marquee",label:t.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:t.selectByRectangle,title:t.selectByRectangle})}_onCustomToolClick(e){this._toggleTool(e)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const i=this.viewModel.activate(t);this._set("activeToolInfo",{toolName:e,operation:i})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){if("lasso"===e)return Je;if("rectangle"===e)return Qe;const t=this.toolConfigs.find(t=>t.toolName===e);if(!t)return;const{createTool:i,createOptions:o,selectionOptions:n}=t;return{createTool:i,createOptions:o,selectionOptions:n}}};Object(o["a"])([Object(l["b"])({readOnly:!0})],tt.prototype,"activeToolInfo",void 0),Object(o["a"])([Object(l["b"])({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],tt.prototype,"label",void 0),Object(o["a"])([Object(r["a"])("viewModel.layers")],tt.prototype,"layers",void 0),Object(o["a"])([Object(l["b"])(),Object(Ue["a"])("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],tt.prototype,"messages",void 0),Object(o["a"])([Object(l["b"])()],tt.prototype,"toolConfigs",void 0),Object(o["a"])([Object(r["a"])("viewModel.view")],tt.prototype,"view",void 0),Object(o["a"])([Object(l["b"])()],tt.prototype,"viewModel",void 0),Object(o["a"])([Object(l["b"])()],tt.prototype,"visibleElements",void 0),Object(o["a"])([Object(c["a"])("visibleElements")],tt.prototype,"castVisibleElements",null),tt=Object(o["a"])([Object(p["a"])("esri.widgets.support.SelectionToolbar")],tt);const it=tt;var ot=i("1e36"),nt=i("e996");const at=e=>st(e)||rt(e),st=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":return!0;default:return!1}},rt=e=>{const t=Object(ot["g"])(e);if(e.hasOwnProperty(t)&&Object(s["l"])(e[t]))for(const i of e[t])if(at(i))return!0;return!1};var ct,lt=i("e96d");let pt=ct=class extends lt["a"]{constructor(){super(...arguments),this.featureSource=null}get enabled(){return!!Object(s["l"])(this.featureSource)&&this.featureSource.enabled}_initializeChildLayers(e){const t=e.filter(at);super._initializeChildLayers(t)}_makeChildren(e){return e.map(e=>Object(ot["a"])(e)?new ct({layer:e,parent:this,view:this.view}):null).reverse()}};Object(o["a"])([Object(l["b"])()],pt.prototype,"children",void 0),Object(o["a"])([Object(l["b"])()],pt.prototype,"enabled",null),Object(o["a"])([Object(l["b"])()],pt.prototype,"featureSource",void 0),Object(o["a"])([Object(l["b"])()],pt.prototype,"parent",void 0),pt=ct=Object(o["a"])([Object(p["a"])("esri.widgets.support.SnappingControls.SnappingListItem")],pt);let dt=class extends nt["a"]{constructor(){super(...arguments),this.featureSnappingSources=new n["a"]}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}_compileList(){const e=this.get("view.map.layers");if(!e)return;const t=e.filter(at);this._watchLayersListMode(t);const i=this._getViewableLayers(t);i&&i.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i),this._beforeCallListItemsCreated()):this._removeAllItems()}_createListItem(e){const{view:t}=this,i=ht(this.featureSnappingSources,e),o=new pt({layer:e,view:t,featureSource:i});for(const n of o.children)n.featureSource=ht(this.featureSnappingSources,n.layer);return this._watchItemProperties(o),o}};Object(o["a"])([Object(l["b"])()],dt.prototype,"featureSnappingSources",void 0),Object(o["a"])([Object(l["b"])()],dt.prototype,"operationalItems",void 0),dt=Object(o["a"])([Object(p["a"])("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],dt);const ht=(e,t)=>{if(!st(t))return null;let i=e.find(e=>e.layer===t);return i||(i=new u({layer:t,enabled:!1}),e.add(i)),i};let ut=class extends(Object(R["b"])(d["a"])){constructor(e){super(e),this.layerListViewModel=new dt,this.snappingOptions=null,this.view=null}initialize(){this.handles.add([Object(S["a"])(this,"view",e=>{this.layerListViewModel.view=e}),Object(S["a"])(this,"snappingOptions.featureSources",()=>{this.layerListViewModel.featureSnappingSources=this.snappingOptions.featureSources})])}get state(){return this.get("snappingOptions")?"ready":"disabled"}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)Object(ot["a"])(t.layer)&&(t.enabled=e.includes(t.layer.id))}};Object(o["a"])([Object(l["b"])({constructOnly:!0})],ut.prototype,"layerListViewModel",void 0),Object(o["a"])([Object(l["b"])({constructOnly:!0})],ut.prototype,"snappingOptions",void 0),Object(o["a"])([Object(l["b"])()],ut.prototype,"state",null),Object(o["a"])([Object(l["b"])({constructOnly:!0})],ut.prototype,"view",void 0),ut=Object(o["a"])([Object(p["a"])("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],ut);const bt=ut,gt={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},vt={base:"esri-snapping-controls",container:"esri-snapping-controls__container",panel:"esri-snapping-controls__panel",item:"esri-snapping-controls__item",toggleBlock:"esri-snapping-controls__toggle-block",nestedContainer:"esri-snapping-controls__nested-container",disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let yt=class extends y["a"]{constructor(e,t){super((()=>{const{view:t,viewModel:i,snappingOptions:o,...n}=e;return n})(),t),this.label=void 0,this.messages=null,this.messagesCommon=null,this.snappingOptions=null,this.view=null,this.visibleElements={...gt},this._defaultViewModel=null,null!=e&&e.viewModel?this.viewModel=e.viewModel:(this._defaultViewModel=new bt({snappingOptions:e.snappingOptions,view:e.view}),this.viewModel=this._defaultViewModel)}destroy(){this._defaultViewModel=Object(s["e"])(this._defaultViewModel)}loadDependencies(){return Promise.all([Promise.all([i.e("chunk-589b7919"),i.e("chunk-2d222978")]).then(i.bind(null,"ceee")),Promise.all([i.e("chunk-589b7919"),i.e("chunk-198e34ef"),i.e("chunk-2d0c190b")]).then(i.bind(null,"471c")),i.e("chunk-0101643a").then(i.bind(null,"4528")),i.e("chunk-1513dd4f").then(i.bind(null,"3097")),Promise.all([i.e("chunk-589b7919"),i.e("chunk-198e34ef"),i.e("chunk-2d21a92e")]).then(i.bind(null,"bba9")),i.e("chunk-5ce2c278").then(i.bind(null,"8457")),Promise.all([i.e("chunk-589b7919"),i.e("chunk-bd18e6a2")]).then(i.bind(null,"f5f2")),i.e("chunk-a1f41d14").then(i.bind(null,"f484"))])}set viewModel(e){e!==this._get("viewModel")&&((Object(s["k"])(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=Object(s["e"])(this._defaultViewModel)),this._set("viewModel",e))}castVisibleElements(e){return{...gt,...e}}render(){const{label:e,visibleElements:{header:t}}=this;return Object(Fe["a"])("div",{"aria-label":e,class:this.classes(vt.base,vt.esriWidget)},Object(Fe["a"])("div",{class:vt.container},t?this.renderHeaderView():this.renderContent()))}renderHeaderView(){return Object(Fe["a"])("calcite-panel",{heading:this.label,class:vt.panel},this.renderContent())}renderContent(){return[this.renderToggles(),this.renderLayerList()]}renderToggles(){return Object(Fe["a"])("calcite-block",{class:vt.toggleBlock,heading:"",open:!0},this.renderEnabledToggle(),Object(Fe["a"])("div",{class:vt.nestedContainer},this.renderSelfEnabledToggle(),this.renderFeatureEnabledToggle()))}renderEnabledToggle(){if(!this.visibleElements.enabledToggle)return;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:i}}}=this;return Object(Fe["a"])("calcite-label",{layout:"inline-space-between"},e,Object(Fe["a"])("calcite-switch",{checked:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))}renderSelfEnabledToggle(){if(!this.visibleElements.selfEnabledToggle)return;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:i,enabledToggled:o}}}=this;return Object(Fe["a"])("calcite-label",{layout:"inline-space-between"},e,Object(Fe["a"])("calcite-switch",{checked:i,disabled:o||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))}renderFeatureEnabledToggle(){if(!this.visibleElements.featureEnabledToggle)return;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:i,enabledToggled:o}}}=this;return Object(Fe["a"])("calcite-label",{layout:"inline-space-between"},e,Object(Fe["a"])("calcite-switch",{checked:i,disabled:o||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))}renderLayerList(){if(!this.visibleElements.layerList)return;const{messages:{snappingLayers:e,searchLayers:t}}=this;return Object(Fe["a"])("calcite-block",{heading:e,open:!0,collapsible:!0},Object(Fe["a"])("calcite-pick-list",{multiple:!0,bind:this,onCalciteListChange:this._layerListChange,filterEnabled:this.viewModel.layerListViewModel.operationalItems.length>=10,"filter-placeholder":t},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems)))}renderLayerListItemCollection(e){return e.map(e=>e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e)).toArray()}renderLayerListItem(e){var t;const{messages:{untitledLayer:i}}=this,o=e.title||i,n=(null==(t=e.children)?void 0:t.length)>0,a=e.enabled;return Object(Fe["a"])("calcite-pick-list-item",{slot:n?"parent-item":null,key:`${this.id}-pick-list-item-${e.uid}`,label:o,value:e.layer.id,selected:a})}renderLayerListItemGroup(e){const t=e.title||this.messages.untitledLayer;return Object(Fe["a"])("calcite-pick-list-group",{"group-title":t},[...this.renderLayerListItemCollection(e.children)])}_enableSnappingSwitchChange(e){this.snappingOptions.enabled=e.target.checked}_featureEnabledSwitchChange(e){this.snappingOptions.featureEnabled=e.target.checked}_selfEnabledSwitchChange(e){this.snappingOptions.selfEnabled=e.target.checked}async _layerListChange(e){const t=await e.target.getSelectedItems();this.viewModel.updateEnabledFeatureSources([...t.keys()])}};Object(o["a"])([Object(l["b"])({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],yt.prototype,"label",void 0),Object(o["a"])([Object(l["b"])(),Object(Ue["a"])("esri/widgets/support/SnappingControls/t9n/SnappingControls")],yt.prototype,"messages",void 0),Object(o["a"])([Object(l["b"])(),Object(Ue["a"])("esri/t9n/common")],yt.prototype,"messagesCommon",void 0),Object(o["a"])([Object(r["a"])("viewModel.snappingOptions")],yt.prototype,"snappingOptions",void 0),Object(o["a"])([Object(r["a"])("viewModel.view")],yt.prototype,"view",void 0),Object(o["a"])([Object(l["b"])()],yt.prototype,"viewModel",null),Object(o["a"])([Object(l["b"])()],yt.prototype,"visibleElements",void 0),Object(o["a"])([Object(c["a"])("visibleElements")],yt.prototype,"castVisibleElements",null),yt=Object(o["a"])([Object(p["a"])("esri.widgets.support.SnappingControls")],yt);const ft=yt;var Ot=i("feab"),mt=i("255d");const jt={base:"esri-sketch",verticalLayout:"esri-sketch--vertical",panel:"esri-sketch__panel",infoPanel:"esri-sketch__info-panel",section:"esri-sketch__section",toolSection:"esri-sketch__tool-section",infoSection:"esri-sketch__info-section",infoCountSection:"esri-sketch__info-count-section",menuContainer:"esri-sketch__menu-container",menuHeader:"esri-sketch__menu-header",menuTitle:"esri-sketch__menu-title",featureCountBadge:"esri-sketch__feature-count-badge",featureCountText:"esri-sketch__feature-count-text",featureCountNumber:"esri-sketch__feature-count-number",actionToggle:"esri-sketch__action-toggle",actionToggleOn:"esri-sketch__action-toggle--on",actionTitle:"esri-sketch__item-action-title",actionIcon:"esri-sketch__item-action-icon",disabled:"esri-disabled",esriWidget:"esri-widget",rotating:"esri-rotating",widgetIcon:"esri-icon-edit"},wt={createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{"rectangle-selection":!0,"lasso-selection":!0},undoRedoMenu:!0,settingsMenu:!0};let _t=class extends y["a"]{constructor(e,t){super(e,t),this._activeCreateOptions=null,this._defaultViewModel=null,this._menuOpen=!1,this._selectionToolbar=null,this._selectionHandlesGroup=null,this._snappingControls=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.createGraphic=null,this.creationMode="continuous",this.defaultCreateOptions=null,this.defaultUpdateOptions=null,this.iconClass=jt.widgetIcon,this.label=void 0,this.layer=null,this.layout="horizontal",this.messages=null,this.snappingOptions=new v,this.updateGraphics=new n["a"],this.view=null,this.visibleElements={...wt},this._activateCreateTool=this._activateCreateTool.bind(this),null!=e&&e.viewModel||(this._defaultViewModel=new Re,this.viewModel=this._defaultViewModel)}initialize(){const{layer:e,view:t}=this,i=new it({view:"2d"===(null==t?void 0:t.type)?t:null,layers:e?[e]:null});this._selectionHandlesGroup=Object(a["b"])([i.watch("activeToolInfo",e=>{e&&this.viewModel.cancel()}),i.on("complete",e=>this._onSelectionOperationComplete(e))]),this._selectionToolbar=i,this._setUpSnappingControls()}loadDependencies(){return Promise.all([i.e("chunk-589b7919"),i.e("chunk-2d222978")]).then(i.bind(null,"ceee"))}destroy(){this._selectionToolbar.destroy(),this._cleanupViewModel(),this._selectionHandlesGroup=Object(s["t"])(this._selectionHandlesGroup),this._snappingControls=Object(s["e"])(this._snappingControls)}get activeTool(){const e=this._selectionToolbar.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}return this.viewModel.activeTool}get state(){return this._selectionToolbar.activeToolInfo?"active":this.viewModel.state}set viewModel(e){e!==this._get("viewModel")&&((Object(s["k"])(this._defaultViewModel)||this._defaultViewModel!==e)&&this._cleanupViewModel(),this._set("viewModel",e),this.viewModel&&(this._viewModelHandlesGroup=Object(a["b"])([this.viewModel.on("create",e=>{this.scheduleRender(),this._onCreateOperation(e)}),this.viewModel.on("update",()=>this.scheduleRender()),this.viewModel.on("delete",e=>this.emit("delete",e)),this.viewModel.on("undo",()=>this.scheduleRender()),this.viewModel.on("redo",()=>this.scheduleRender()),this.viewModel.watch("layer",e=>{this._selectionToolbar.layers=e?[e]:null}),this.viewModel.watch("view",e=>{this._selectionToolbar.view="2d"===(null==e?void 0:e.type)?e:null,this._setUpSnappingControls()}),this.viewModel.watch("state",()=>this.notifyChange("state"))])))}castVisibleElements(e){return{...wt,...e,createTools:{...wt.createTools,...null==e?void 0:e.createTools},selectionTools:{...wt.selectionTools,...null==e?void 0:e.selectionTools}}}create(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)}update(e,t){return this.viewModel.update(e,t)}complete(){}cancel(){this._selectionToolbar.cancel(),this.viewModel.cancel()}undo(){var e;this.viewModel.undo(),null==(e=this.view)||e.focus()}redo(){var e;this.viewModel.redo(),null==(e=this.view)||e.focus()}delete(){}render(){const{label:e,layout:t,viewModel:{state:i}}=this;return Object(Fe["a"])("div",{"aria-label":e,class:this.classes(jt.base,jt.esriWidget,{[jt.disabled]:"disabled"===i,[jt.verticalLayout]:"vertical"===t})},Object(Fe["a"])("div",{role:"toolbar",class:jt.panel},this.renderTopPanelContents()),Object(Fe["a"])("div",{class:this.classes(jt.panel,jt.infoPanel)},this.renderInfoPanelContents()))}renderTopPanelContents(){const e=this.classes(jt.section,jt.toolSection),{availableCreateTools:t,visibleElements:i}=this;return[Object(Fe["a"])("div",{role:"menu",key:"selection-button-container",class:e},this.renderDefaultSelectionButton(),this.renderSelectionToolbar()),t&&t.length?Object(Fe["a"])("div",{role:"menu",class:e},this.renderDrawButtons()):null,i.undoRedoMenu?Object(Fe["a"])("div",{role:"menu",key:"undo-redo-menu-button-container",class:e},this.renderUndoRedoMenuButtons()):null,i.settingsMenu?Object(Fe["a"])("div",{key:"settings-menu-button-container",class:jt.section},this.renderSettingsMenuButton()):null]}renderInfoPanelContents(){return this._menuOpen?this.renderSettingsMenu():this.updateGraphics.length?[Object(Fe["a"])("div",{class:this.classes(jt.section,jt.infoSection,jt.infoCountSection),key:"feature-count-container"},this.renderFeatureCount()),Object(Fe["a"])("div",{class:this.classes(jt.section,jt.infoSection),key:"delete-button-container"},this.renderDeleteButton())]:void 0}renderSettingsMenu(){const{settings:e}=this.messages;return[Object(Fe["a"])("div",{role:"menu",class:jt.menuContainer,key:"settings-menu-container"},Object(Fe["a"])("header",{class:jt.menuHeader,key:"settings-menu-header"},Object(Fe["a"])("span",{class:jt.menuTitle},e)),this.renderSnappingControls())]}renderSnappingControls(){if(Object(s["l"])(this._snappingControls))return this._snappingControls.render()}renderFeatureCount(){const{layout:e,messages:t,updateGraphics:{length:i}}=this,o=Object(mt["a"])(1===i?t.featureCount:t.featuresCount,{count:i});return Object(Fe["a"])("div",{class:jt.featureCountBadge,"aria-label":o},Object(Fe["a"])("span",{class:jt.featureCountNumber},"vertical"===e?i:o))}renderDeleteButton(){const e=this.messages.deleteFeature;return Object(Fe["a"])("calcite-action",{bind:this,icon:"trash",label:e,onclick:this.delete,scale:"s",text:e,title:e})}renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return Object(Fe["a"])("calcite-action",{active:"ready"===this.state,bind:this,icon:"cursor",label:e,onclick:this._activateDefaultSelectTool,scale:"s",text:e,title:e})}renderSelectionToolbar(){var e;if("2d"!==(null==(e=this.view)?void 0:e.type))return;const t=this.visibleElements.selectionTools;return this._selectionToolbar.visibleElements={lassoTool:!!t["lasso-selection"],rectangleTool:!!t["rectangle-selection"]},this._selectionToolbar.render()}renderDrawButtons(){const e=this.visibleElements.createTools;return this.availableCreateTools.map(t=>"point"===t&&e.point?this.renderPointButton():"polyline"===t&&e.polyline?this.renderPolylineButton():"polygon"===t&&e.polygon?this.renderPolygonButton():"rectangle"===t&&e.rectangle?this.renderRectangleButton():"circle"===t&&e.circle?this.renderCircleButton():void 0)}renderPointButton(){const e="point",t=this.messages.drawPoint;return Object(Fe["a"])("calcite-action",{active:this.activeTool===e,bind:this,icon:"pin",label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t})}renderPolygonButton(){const e="polygon",t=this.messages.drawPolygon;return Object(Fe["a"])("calcite-action",{active:this.activeTool===e,bind:this,icon:"polygon",label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t})}renderPolylineButton(){const e="polyline",t=this.messages.drawPolyline;return Object(Fe["a"])("calcite-action",{active:this.activeTool===e,bind:this,icon:"line",label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t})}renderCircleButton(){const e="circle",t=this.messages.drawCircle;return Object(Fe["a"])("calcite-action",{active:this.activeTool===e,bind:this,icon:"circle",label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t})}renderRectangleButton(){const e="rectangle",t=this.messages.drawRectangle;return Object(Fe["a"])("calcite-action",{active:this.activeTool===e,bind:this,icon:"rectangle",label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t})}renderUndoRedoMenuButtons(){return[this.renderUndoButton(),this.renderRedoButton()]}renderUndoButton(){const e=this.messages.undo;return Object(Fe["a"])("calcite-action",{disabled:!this.viewModel.canUndo(),bind:this,icon:Object(De["h"])(this.container)?"redo":"undo",label:e,onclick:this.undo,scale:"s",text:e,title:e})}renderRedoButton(){const e=this.messages.redo;return Object(Fe["a"])("calcite-action",{disabled:!this.viewModel.canRedo(),bind:this,icon:Object(De["h"])(this.container)?"undo":"redo",label:e,onclick:this.redo,scale:"s",text:e,title:e})}renderSettingsMenuButton(){const e=this.messages.settings;return Object(Fe["a"])("calcite-action",{active:this._menuOpen,bind:this,icon:"gear",label:e,onclick:this._toggleMenu,scale:"s",text:e,title:e})}_activateCreateTool(e){this.activeTool!==e?(this._selectionToolbar.cancel(),this.create(e)):this.cancel()}_onCreateOperation(e){if("complete"!==e.state)return;const{creationMode:t}=this,{type:i}=e;if("create"===i){const{tool:i,graphic:o}=e,n=this._activeCreateOptions;this._activeCreateOptions=null,"continuous"===t?this.create(i,n):"update"===t&&this.update([o])}}_toggleMenu(){this._menuOpen=!this._menuOpen,this.scheduleRender()}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:i}=e;if(!e.aborted&&i.length){const e=t.tool,o=i.length>1&&"reshape"===e?"transform":e;this.update(i,{...t,tool:o})}this.notifyChange("state")}_activateDefaultSelectTool(){var e;this.cancel(),null==(e=this.view)||e.focus()}_cleanupViewModel(){this._defaultViewModel=Object(s["e"])(this._defaultViewModel),this._viewModelHandlesGroup=Object(s["t"])(this._viewModelHandlesGroup)}_setUpSnappingControls(){const{snappingOptions:e,view:t}=this;if(this._snappingControls=Object(s["e"])(this._snappingControls),!e||!t)return;const i=new ft({snappingOptions:e,view:t,visibleElements:{header:!1}});this._snappingControls=i}};Object(o["a"])([Object(l["b"])()],_t.prototype,"activeTool",null),Object(o["a"])([Object(l["b"])({cast:e=>{if(!e||!e.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter(e=>t.has(e))}})],_t.prototype,"availableCreateTools",void 0),Object(o["a"])([Object(r["a"])("viewModel.createGraphic")],_t.prototype,"createGraphic",void 0),Object(o["a"])([Object(l["b"])()],_t.prototype,"creationMode",void 0),Object(o["a"])([Object(r["a"])("viewModel.defaultCreateOptions")],_t.prototype,"defaultCreateOptions",void 0),Object(o["a"])([Object(r["a"])("viewModel.defaultUpdateOptions")],_t.prototype,"defaultUpdateOptions",void 0),Object(o["a"])([Object(l["b"])()],_t.prototype,"iconClass",void 0),Object(o["a"])([Object(l["b"])({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_t.prototype,"label",void 0),Object(o["a"])([Object(r["a"])("viewModel.layer")],_t.prototype,"layer",void 0),Object(o["a"])([Object(l["b"])({type:["horizontal","vertical"]})],_t.prototype,"layout",void 0),Object(o["a"])([Object(l["b"])(),Object(Ue["a"])("esri/widgets/Sketch/t9n/Sketch")],_t.prototype,"messages",void 0),Object(o["a"])([Object(r["a"])("viewModel.snappingOptions")],_t.prototype,"snappingOptions",void 0),Object(o["a"])([Object(l["b"])()],_t.prototype,"state",null),Object(o["a"])([Object(r["a"])("viewModel.updateGraphics")],_t.prototype,"updateGraphics",void 0),Object(o["a"])([Object(r["a"])("viewModel.view")],_t.prototype,"view",void 0),Object(o["a"])([Object(l["b"])(),Object(Ot["a"])(["create","update","undo","redo"])],_t.prototype,"viewModel",null),Object(o["a"])([Object(l["b"])()],_t.prototype,"visibleElements",void 0),Object(o["a"])([Object(c["a"])("visibleElements")],_t.prototype,"castVisibleElements",null),Object(o["a"])([Object(r["a"])("viewModel.complete")],_t.prototype,"complete",null),Object(o["a"])([Object(r["a"])("viewModel.delete")],_t.prototype,"delete",null),_t=Object(o["a"])([Object(p["a"])("esri.widgets.Sketch")],_t);const Tt=_t},b48e:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var o,n=i("a4ee"),a=i("8048"),s=i("59b2"),r=(i("b50f"),i("c120"),i("cea0"),i("d386")),c=i("4ae5"),l=i("1219"),p=i("f694"),d=i("40b6"),h=i("9786"),u=i("2c81");let b=o=class extends l["a"]{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return{...super.normalizeCtorArgs(),...i,...t}}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=Object(a["c"])(this.radius,this.radiusUnit,"meters"),o=e.spatialReference;let n,s="geographic";if(o.isWebMercator?s="webMercator":(null!=u["a"][o.wkid]||o.wkt&&0===o.wkt.indexOf("PROJCS"))&&(s="projected"),this.geodesic){let o;switch(s){case"webMercator":o=Object(h["e"])(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=e}n=this._createGeodesicCircle(o,i,t),"webMercator"===s&&(n=Object(h["b"])(n))}else{let o;"webMercator"===s||"projected"===s?o=i/this._convert2Meters(1,e.spatialReference):"geographic"===s&&(o=Object(a["l"])(i,"meters",Object(p["e"])(e.spatialReference).radius)),n=this._createPlanarCircle(e,o,t)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:a}=this;return new o({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:a})}_createGeodesicCircle(e,t,i){let o=0;const n=[];for(;o<360;){const a=[0,0],s=[e.x,e.y];Object(d["a"])(a,s,o,t),this.hasZ&&a.push(e.z),n.push(a),o+=360/i}return n.push(n[0]),new l["a"](n)}_createPlanarCircle(e,t,i){const o=[],n=2*Math.PI/i;for(let a=0;a<i;++a){const i=n*a,s=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&s.push(e.z),o.push(s)}return o.push(o[0]),new l["a"]({spatialReference:e.spatialReference,rings:[o]})}_convert2Meters(e,t){let i;if(null!=u["a"][t.wkid])i=u["a"].values[u["a"][t.wkid]];else{const e=t.wkt,o=e.lastIndexOf(",")+1,n=e.lastIndexOf("]]");i=parseFloat(e.substring(o,n))}return e*i}};Object(n["a"])([Object(s["b"])({type:c["a"]})],b.prototype,"center",void 0),Object(n["a"])([Object(s["b"])()],b.prototype,"geodesic",void 0),Object(n["a"])([Object(s["b"])()],b.prototype,"numberOfPoints",void 0),Object(n["a"])([Object(s["b"])()],b.prototype,"radius",void 0),Object(n["a"])([Object(s["b"])()],b.prototype,"radiusUnit",void 0),b=o=Object(n["a"])([Object(r["a"])("esri.geometry.Circle")],b);const g=b},b65e:function(e,t,i){"use strict";function o(e,t,i){if(!t||!e||!e.map)return;const{map:o}=e,n=o.layers.find(e=>e===t);n||o.add(t,i),null!=i&&o.layers.reorder(n,i)}i.d(t,"a",(function(){return o}))},c9fb:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var o=i("a4ee"),n=i("9ef0"),a=i("6a0e"),s=i("59b2"),r=i("d386");let c=class extends a["a"]{constructor(){super(...arguments),this.enabled=!0}};Object(o["a"])([Object(s["b"])({type:Boolean})],c.prototype,"enabled",void 0),c=Object(o["a"])([Object(r["a"])("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],c);let l=class extends a["a"]{constructor(e){super(e),this.lineSnapper=new c,this.parallelLineSnapper=new c,this.rightAngleSnapper=new c,this.rightAngleTriangleSnapper=new c,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new n["a"]([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};Object(o["a"])([Object(s["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"lineSnapper",void 0),Object(o["a"])([Object(s["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"parallelLineSnapper",void 0),Object(o["a"])([Object(s["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"rightAngleSnapper",void 0),Object(o["a"])([Object(s["b"])({type:c,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l.prototype,"rightAngleTriangleSnapper",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l.prototype,"shortLineThreshold",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l.prototype,"distance",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"pointThreshold",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"intersectionParallelLineThreshold",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"parallelLineThreshold",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"touchSensitivityMultiplier",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l.prototype,"pointOnLineThreshold",void 0),Object(o["a"])([Object(s["b"])({type:n["a"],nonNullable:!0})],l.prototype,"orange",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"lineHintWidthReference",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"lineHintWidthTarget",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"lineHintFadedExtensions",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l.prototype,"parallelLineHintWidth",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],l.prototype,"parallelLineHintLength",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],l.prototype,"parallelLineHintOffset",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],l.prototype,"rightAngleHintSize",void 0),Object(o["a"])([Object(s["b"])({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],l.prototype,"rightAngleHintOutlineSize",void 0),l=Object(o["a"])([Object(r["a"])("esri.views.interactive.snapping.Settings.Defaults")],l);const p=new l},ce0b:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var o=i("a4ee"),n=i("59b2"),a=(i("b50f"),i("c120"),i("cea0"),i("d386")),s=i("44e6"),r=i("a6a3"),c=i("997b"),l=i("5a62"),p=i("f626"),d=i("fd14");let h=class extends(Object(c["a"])(Object(l["a"])(r["a"]))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new p["a"],this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};Object(o["a"])([Object(n["b"])({type:d["a"]})],h.prototype,"elevationInfo",void 0),Object(o["a"])([Object(n["b"])(Object(s["b"])(p["a"],"graphics"))],h.prototype,"graphics",void 0),Object(o["a"])([Object(n["b"])({type:["show","hide"]})],h.prototype,"listMode",void 0),Object(o["a"])([Object(n["b"])()],h.prototype,"screenSizePerspectiveEnabled",void 0),Object(o["a"])([Object(n["b"])({readOnly:!0})],h.prototype,"type",void 0),Object(o["a"])([Object(n["b"])({constructOnly:!0})],h.prototype,"internal",void 0),h=Object(o["a"])([Object(a["a"])("esri.layers.GraphicsLayer")],h);const u=h},d232:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("c120");var o=i("e92d"),n=i("6706"),a=i("7dcb");o["a"].getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class s extends a["a"]{constructor(e,t){super(),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof s&&Object(n["d"])(this.lineStart,e.lineStart)&&Object(n["d"])(this.lineEnd,e.lineEnd)}}},dac3:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var o=i("43e0"),n=i("92af"),a=i("e6b5");class s extends n["a"]{constructor(e){super({...e,constraint:new o["b"](e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new a["a"](1,this.constraint.start,this.constraint.end)]}}},df3b:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));class o{constructor(e,t,i){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i}}},e6b5:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("c120");var o=i("e92d"),n=i("6706"),a=i("7dcb");o["a"].getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class s extends a["a"]{constructor(e,t,i,o=!0,n=!0){super(),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=n}equals(e){return e instanceof s&&this.type===e.type&&Object(n["d"])(this.lineStart,e.lineStart)&&Object(n["d"])(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}},e753:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i("6706"),n=i("7dcb");class a extends n["a"]{constructor(e){super(),this.intersectionPoint=e}equals(e){return e instanceof a&&Object(o["d"])(this.intersectionPoint,e.intersectionPoint)}}},f408:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return r})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return l}));var o=i("b2b2"),n=i("8076");function a(e,t){return Object(o["k"])(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}function s(e,t){return a(!!Object(o["l"])(e)&&e.hasZ,t)}function r(e){const t=p(e);return s(e.geometry,t)}function c(e){const t=p(e),i=s(e.geometry,t);return{mode:i,offset:Object(o["l"])(t)&&"on-the-ground"!==i?Object(o["v"])(t.offset,0)*Object(n["a"])(Object(o["v"])(t.unit,"meters")):0}}function l(e){if("on-the-ground"===r(e))return!1;const t=p(e),i=Object(o["l"])(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!i||"0"===i)}function p(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function d(e,t,i){if(Object(o["k"])(i)||!i.mode)return;const n=e.hasZ?e.z:0,a=Object(o["l"])(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return n-a;case"on-the-ground":return 0;case"relative-to-ground":return n-(Object(o["v"])(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"ground"),0)+a);case"relative-to-scene":return n-(Object(o["v"])(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"scene"),0)+a)}}function h(e,t,i,o=null){return b(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,o)}function u(e,t,i,o,n=null){return b(e,t[0],t[1],t.length>2?t[2]:0,i,o,n)}function b(e,t,i,n,a,s,r=null){if(Object(o["k"])(s))return;const c=Object(o["l"])(r)?r.mode:"absolute-height";return"on-the-ground"===c?0:v(g(t,i,n,a,e,s),t,i,n,a,e,r,c)}function g(e,t,i,n,a,s){const r=Object(o["l"])(s.offset)?s.offset:0;switch(s.mode){case"absolute-height":return i+r;case"on-the-ground":return Object(o["v"])(a.elevationProvider.getElevation(e,t,0,n,"ground"),0);case"relative-to-ground":return i+Object(o["v"])(a.elevationProvider.getElevation(e,t,i,n,"ground"),0)+r;case"relative-to-scene":return i+Object(o["v"])(a.elevationProvider.getElevation(e,t,i,n,"scene"),0)+r}}function v(e,t,i,n,a,s,r,c){const l=Object(o["l"])(r)&&Object(o["l"])(r.offset)?r.offset:0;switch(c){case"absolute-height":return e-l;case"relative-to-ground":return e-(Object(o["v"])(s.elevationProvider.getElevation(t,i,n,a,"ground"),0)+l);case"relative-to-scene":return e-(Object(o["v"])(s.elevationProvider.getElevation(t,i,n,a,"scene"),0)+l)}}}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5fc30fdb","chunk-3529a025","chunk-1900908c","chunk-2d0d6f6b"],{"040b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e,t){1===t.viewingMode?e.vertex.code.add(r["a"]`
      vec3 getLocalUp(in vec3 pos, in vec3 origin) {
          return normalize(pos + origin);
      }
    `):e.vertex.code.add(r["a"]`
      vec3 getLocalUp(in vec3 pos, in vec3 origin) {
          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code
      }
    `),1===t.viewingMode?e.vertex.code.add(r["a"]`
        mat3 getTBNMatrix(in vec3 n) {
            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
            vec3 b = normalize(cross(n, t));
            return mat3(t, b, n);
        }
    `):e.vertex.code.add(r["a"]`
        mat3 getTBNMatrix(in vec3 n) {
            vec3 t = vec3(1.0, 0.0, 0.0);
            vec3 b = normalize(cross(n, t));
            return mat3(t, b, n);
        }
    `)}},"0e88":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("b2b2");class a{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class n{constructor(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(e=>e.forEach(e=>e.technique.dispose())),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));let n=r.get(i);return void 0===n&&(n=new a(new e(this._context,t)),r.set(i,n)),++n.refCount,n.technique}acquireAndReleaseExisting(e,t,i){return Object(r["j"])(i)?this.acquire(e,t):t.key===i.key&&i instanceof e?i:(this.release(i),this.acquire(e,t))}release(e){if(Object(r["j"])(e))return;const t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}frameUpdate(){this._frameCounter++,this._perConstructorInstances.forEach((e,t)=>{e.forEach((t,i)=>{0===t.refCount&&t.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(t.technique.dispose(),e.delete(i))}),0===e.size&&this._perConstructorInstances.delete(t)})}getProgramsUsingUniform(e){return this._context.commonUniformStore.getPrograms(e)}async hotReload(){const e=new Array;this._perConstructorInstances.forEach((t,i)=>{const r=async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach(e=>{e.technique.reload(this._context)}))};e.push(r(t,i))}),await Promise.all(e)}}},1666:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("32ed");i("fb2c"),i("8c4b");function a(e,t,i){const r=e.length,a=new Array(r),o=new Array(r),c=new Array(r);let l=0,h=0,d=0,u=0;for(let n=0;n<r;++n)u+=e[n].length;const p=new Float64Array(3*u);let g=0;for(let f=r-1;f>=0;f--){const u=e[f],b=1===i&&s(u);if(b&&1!==r)a[l++]=u;else{let e=u.length;for(let t=0;t<l;++t)e+=a[t].length;const i={index:g,pathLengths:new Array(l+1),count:e,holeIndices:new Array(l)};i.pathLengths[0]=u.length,u.length>0&&(c[d++]={index:g,count:u.length}),g=b?n(u,u.length-1,-1,p,g,u.length,t):n(u,0,1,p,g,u.length,t);for(let r=0;r<l;++r){const e=a[r];i.holeIndices[r]=g,i.pathLengths[r+1]=e.length,e.length>0&&(c[d++]={index:g,count:e.length}),g=n(e,0,1,p,g,e.length,t)}l=0,i.count>0&&(o[h++]=i)}}for(let s=0;s<l;++s){const e=a[s];e.length>0&&(c[d++]={index:g,count:e.length}),g=n(e,0,1,p,g,e.length,t)}return h<r&&(o.length=h),d<r&&(c.length=d),{position:p,polygons:o,outlines:c}}function n(e,t,i,r,a,n,s){a*=3;for(let o=0;o<n;++o){const n=e[t];r[a++]=n[0],r[a++]=n[1],r[a++]=s?n[2]:0,t+=i}return a/3}function s(e){return!Object(r["g"])(e,!1,!1)}},"171c":function(e,t,i){"use strict";var r=i("b2b2"),a=i("38a4"),n=i("a915"),s=i("0b2d"),o=i("e431"),c=i("680b"),l=i("d791"),h=i("afe1"),d=i("02f1"),u=i("0fc4"),p=i("3349"),g=i("7577"),f=i("2047"),b=i("d0ac"),m=i("1153");class v{constructor(e=null,t=null,i=null){this._viewUp=Object(s["e"])(),this._viewForward=Object(s["e"])(),this._viewRight=Object(s["e"])(),this._ray=b["g"].createWrapper(),this._viewport=Object(u["d"])(0,0,1,1),this._padding=Object(u["d"])(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(d["f"])(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(h["b"])(),this._projectionDirty=!0,this._projectionMatrix=Object(h["b"])(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(h["b"])(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(h["b"])(),this._frustumDirty=!0,this._frustum=b["d"].create(),this._fullViewport=Object(u["c"])(),this.pixelRatio=1,this.relativeElevation=0,this._eye=Object(r["k"])(e)?Object(s["d"])(e):Object(s["e"])(),this._center=Object(r["k"])(t)?Object(s["d"])(t):Object(s["e"])(),this._up=Object(r["k"])(i)?Object(s["d"])(i):Object(s["g"])(0,0,1)}get eye(){return this._eye}set eye(e){this._compareAndSetView(e,this._eye)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=Object(s["e"])()),Object(o["k"])(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(l["c"])(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(g["c"])(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(l["m"])(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(l["h"])(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(l["c"])(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(m["b"])(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(m["d"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(m["c"])(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(m["e"])(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(o["p"])(this._center,this._eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(l["a"])(this._viewInverseTransposeMatrix,this.viewMatrix),Object(l["b"])(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){const t=e;return Object(o["l"])(this._eye,t._eye),Object(o["l"])(this._center,t._center),Object(o["l"])(this._up,t._up),Object(g["c"])(this._viewport,t._viewport),Object(g["c"])(this._padding,t._padding),Object(p["c"])(this._nearFar,t._nearFar),this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(Object(l["c"])(this._viewMatrix,t._viewMatrix),Object(o["l"])(this._viewRight,t._viewRight),Object(o["l"])(this._viewUp,t._viewUp),Object(o["l"])(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(l["c"])(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(b["d"].copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(l["c"])(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(g["c"])(this._fullViewport,t._fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new v).copyFrom(this)}equals(e){return Object(o["r"])(this._eye,e._eye)&&Object(o["r"])(this._center,e._center)&&Object(o["r"])(this._up,e._up)&&Object(g["g"])(this._viewport,e._viewport)&&Object(g["g"])(this._padding,e._padding)&&Object(p["k"])(this._nearFar,e._nearFar)&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4,i=1-1e-10;Object(o["w"])(_,e.eye,e.center),Object(o["w"])(j,this._eye,this._center);const r=Object(o["i"])(_,j),a=Object(o["z"])(_),n=Object(o["z"])(j);return r*r>=i*a*n&&Object(o["A"])(e.eye,this._eye)<Math.max(a,n)*t*t&&Object(g["i"])(e.padding,this._padding)<.5&&Object(g["i"])(e.viewport,this._viewport)<.5}markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(f["c"])(this.viewForward,Object(o["k"])(_,e,this._eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(n["g"])()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e||(e=Object(n["e"])()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e.length>2&&(e[2]=.5),e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t,i=!1){e!==y&&Object(o["l"])(y,e),y[3]=1,i&&(t[2]=-y[2]),Object(g["m"])(y,y,this.projectionMatrix),Object(o["f"])(y,y,1/Math.abs(y[3]));const r=this.fullViewport;return t[0]=Object(a["l"])(0,r[0]+r[2],.5+.5*y[0]),t[1]=Object(a["l"])(0,r[1]+r[3],.5+.5*y[1]),i||(t[2]=.5*(y[2]+1)),t}projectToScreen(e,t){return this.projectToRenderScreen(e,w),this.renderToScreen(w,t)}projectToRenderScreen(e,t){if(y[0]=e[0],y[1]=e[1],y[2]=e[2],y[3]=1,Object(g["m"])(y,y,this.viewProjectionMatrix),0===y[3])return null;Object(o["f"])(y,y,1/Math.abs(y[3]));const i=this.fullViewport;return"x"in t?(t.x=Object(a["l"])(0,i[0]+i[2],.5+.5*y[0]),t.y=Object(a["l"])(0,i[1]+i[3],.5+.5*y[1])):(t[0]=Object(a["l"])(0,i[0]+i[2],.5+.5*y[0]),t[1]=Object(a["l"])(0,i[1]+i[3],.5+.5*y[1]),t.length>2&&(t[2]=.5*(y[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,w),t)}unprojectFromRenderScreen(e,t){if(Object(l["m"])(O,this.projectionMatrix,this.viewMatrix),!Object(l["a"])(O,O))return null;const i=this.fullViewport;return y[0]=2*(e[0]-i[0])/i[2]-1,y[1]=2*(e[1]-i[1])/i[3]-1,y[2]=2*e[2]-1,y[3]=1,Object(g["m"])(y,y,O),0===y[3]?null:(t[0]=y[0]/y[3],t[1]=y[1]/y[3],t[2]=y[2]/y[3],t)}constrainWindowSize(e,t,i,r=1){const a=e*this.pixelRatio,n=t*this.pixelRatio,s=Math.max(a-i*r/2,0),o=Math.max(this.fullHeight-n-i/2,0),c=-Math.min(a-i*r/2,0),l=-Math.min(this.fullHeight-n-i/2,0);return[s,o,i*r-c- -Math.min(this.fullWidth-a-i*r/2,0),i-l- -Math.min(n-i/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=i,t[1]=r,t}computeUpGlobal(){Object(o["k"])(_,this.center,this.eye);const e=Object(o["q"])(this.center);e<1?(Object(o["x"])(this.up,0,0,1),this.markViewDirty()):Math.abs(Object(o["i"])(_,this.center))>.9999*Object(o["q"])(_)*e||(Object(o["h"])(this.up,_,this.center),Object(o["h"])(this.up,this.up,_),Object(o["s"])(this.up,this.up),this.markViewDirty())}computeUpLocal(){Object(c["h"])(_,this.eye,this.center),Math.abs(_[2])<=.9999&&(Object(o["f"])(_,_,_[2]),Object(o["x"])(this.up,-_[0],-_[1],1-_[2]),Object(o["s"])(this.up,this.up),this.markViewDirty())}_compareAndSetView(e,t){Object(o["r"])(e,t)||(Object(o["l"])(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)}_recomputeFrustum(){this._frustumDirty&&(b["d"].fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(l["l"])(this._viewMatrix,this._eye,this._center,this._up),Object(o["x"])(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(o["x"])(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(o["x"])(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const y=Object(u["c"])(),O=Object(h["b"])(),_=Object(s["e"])(),j=Object(s["e"])(),w=Object(n["e"])();t["a"]=v},"191a":function(e,t,i){"use strict";var r=i("b2b2"),a=i("d791"),n=i("28eb"),s=i("afe1"),o=i("2ebb"),c=i("1153"),l=i("7ce4"),h=i("8539"),d=i("0fa6"),u=i("b623"),p=i("38a4");class g{constructor(e){null==e?e=16:e<65536&&(e=Object(p["o"])(e)),this._array=new Float32Array(e),this._size=0}resize(e,t){if(this._size=e,this._size>this._array.length){let e=this._array.length||1;for(;e<this._size;)e*=2;const i=new Float32Array(e);return t&&i.set(this._array),this._array=i,!0}const i=2*this._size;if(i<=this._array.length){let e=this._array.length;for(;e>=i;)e=Math.floor(e/2);const r=new Float32Array(e);return t&&r.set(this._array.subarray(0,e)),this._array=r,!0}return!1}append(e){const t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}erase(e,t){for(let i=e;i<t;++i)this._array[i]=0}get array(){return this._array}get size(){return this._size}}var f=i("a445");class b{constructor(e,t,i,r,n,o){this.from=e,this.to=t,this.isVisible=i,this.hasHighlights=r,this.hasOccludees=n,this.transformation=o,null!=o&&(this.transformationNormal=Object(s["c"])(o),Object(a["a"])(this.transformationNormal,this.transformationNormal),Object(a["b"])(this.transformationNormal,this.transformationNormal))}}function m(e){return e.sort((e,t)=>e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0)}function v(e,t){return e.first+e.count>=t.from}function y(e,t){const i=e=>({first:e.from,count:e.to-e.from});if(0===e.length)return void e.push(i(t));const r=e[e.length-1];if(v(r,t)){const e=t.from-r.first+t.to-t.from;r.count=e}else e.push(i(t))}var O=i("b852");class _{constructor(e,t,i){this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._material=i,this._materialRep=t,this._glMaterials=Object(u["a"])(this._material,this._materialRep),this._bufferWriter=i.createBufferWriter()}dispose(){Object(u["f"])(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach(e=>{e.vao.dispose(!0),e.vao=null}),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach(e=>{e&&e.dispose()}),this._glMaterials.clear(),this._glMaterials=null)}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&Object(n["b"])(this._glMaterials,e=>e instanceof f["a"])}get rendersOccluded(){return!this.isEmpty&&1!==this._material.renderOccluded}modify(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout,a=r.stride/4,n=this._dataByOrigin,s=j(n,i,e,t);s.forEach((e,t)=>{s.delete(t);const i=e.optimalCount,o=e.sparseCount;let l=n.get(t);if(null==l)Object(c["a"])(i>0),l=this.createData(r,i,e.origin),n.set(t,l);else if(0===i)return l.vao.dispose(!0),l.vao=null,void n.delete(t);const h=i<e.sparseCount/2,d=h?i:o,u=x,p=l.buffer.size,g=l.buffer.array,f=l.buffer.resize(d,!1);h||f?this.removeAndRebuild(l,e.toRemove,a,g,u):e.toRemove.length>0?(this.removeByErasing(l,e.toRemove,a,u),e.toAdd.length>0&&(u.end=p)):(u.begin=p,u.end=p);const b=M;Object(c["m"])(b,-e.origin[0],-e.origin[1],-e.origin[2]),this.append(l,e.toAdd,a,b,u);const m=l.vao.vertexBuffers.geometry;if(m.byteSize!==l.buffer.array.buffer.byteLength)m.setData(l.buffer.array);else{const{begin:e,end:t}=u;if(e<t){const i=l.buffer.array,r=4,a=e*r,n=t*r;m.setSubData(i,a,a,n)}}l.drawCommandsDirty=!0})}updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.updateType,a=r.renderGeometry,n=this._dataByOrigin.get(a.origin.id),s=n&&n.instances.get(a.id);if(!s)return;if(1&e&&(s.isVisible=a.instanceParameters.visible),9&e){const e=a.instanceParameters.visible;s.hasHighlights=!!a.instanceParameters.highlights&&e}if(16&e&&(s.hasOccludees=!!a.instanceParameters.occludees),6&e){const e=n.buffer.array,r=n.vao;Object(u["c"])(a,S,R),t.write({transformation:S,invTranspTransformation:R},a.data,t.vertexBufferLayout.createView(e.buffer),s.from),Object(c["a"])(s.from+t.elementCount(a.data)===s.to,"material VBO layout has changed"),r.vertexBuffers.geometry.setSubData(e,s.from*i*4,s.from*i*4,s.to*i*4)}n.drawCommandsDirty=!0}}updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(n["b"])(e.instances,t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))});const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0===e.instances.size)return;if(!w(e)){const t=4*e.buffer.size/Object(h["d"])(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}const t=m([...e.instances.values()]);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?y(e.drawCommandsOccludees,r):y(e.drawCommandsDefault,r),r.hasHighlights?y(e.drawCommandsHighlight,r):y(e.drawCommandsShadowHighlightRest,r));const i=e=>{let t=0;for(const i of e)t+=i.count;return t/3};e.stats={default:i(e.drawCommandsDefault),highlight:i(e.drawCommandsHighlight),occludees:i(e.drawCommandsOccludees),shadowHighlightRest:i(e.drawCommandsShadowHighlightRest)}};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)})}updateLogic(e){return this._material.update(e)}render(e,t,i,a){const n=this._rctx,s=this._glMaterials.get(t.pass),o=5===t.pass||7===t.pass,c=6===t.pass,l=!(o||c);let h=e;if(3===t.pass&&null===h&&(h=22),!s||2!==s.ensureResources(n)||null!=h&&!s.beginSlot(h)||o&&!this._hasHighlights)return!1;s.ensureParameters(i);const d=s.getTechnique(),u=s.getPipelineState(h,!1);n.setPipelineState(u),s.bind(n,i);let p=!1;return this._dataByOrigin.forEach(e=>{if(Object(r["j"])(e.drawCommandsDefault)&&Object(r["j"])(e.drawCommandsHighlight)&&Object(r["j"])(e.drawCommandsOccludees)&&Object(r["j"])(e.drawCommandsShadowHighlightRest))return;if(o&&!e.hasHighlights)return;i.origin=e.origin,d.bindDraw(i),d.ensureAttributeLocations(e.vao),n.bindVAO(e.vao);const t=d.primitiveType;let g=o?e.drawCommandsHighlight:c&&w(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault;const f=o?e.stats.highlight:c&&w(e)?e.stats.shadowHighlightRest:e.stats.default;if(Object(r["k"])(g)&&(this.renderCommands(n,t,g),Object(O["b"])(g.length,f,a),p=!0),l&&(g=e.drawCommandsOccludees,Object(r["k"])(g))){const i=s.getPipelineState(h,!0);n.setPipelineState(i),this.renderCommands(n,t,g),n.setPipelineState(u),Object(O["b"])(g.length,e.stats.occludees,a),p=!0}}),p}renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}createData(e,t,i){return{instances:new Map,vao:new d["a"](this._rctx,this._material.vertexAttributeLocations,{geometry:Object(o["a"])(e)},{geometry:l["a"].createVertex(this._rctx,35044)}),buffer:new g(t),optimalCount:0,origin:i,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}removeAndRebuild(e,t,i,r,a){for(const h of t){const t=h.id,r=e.instances.get(t);e.optimalCount-=(r.to-r.from)*i,e.instances.delete(t)}let n=0;const s=e.buffer.array;a.begin=0,a.end=0;let o=-1,c=-1,l=0;e.instances.forEach(e=>{const t=e.from*i,a=e.to*i,h=a-t;o!==c&&c!==t?(s.set(r.subarray(o,c),l),l+=c-o,o=t):-1===o&&(o=t),c=a,e.from=n/i,n+=h,e.to=n/i}),o!==c&&s.set(r.subarray(o,c),l),a.end=n}removeByErasing(e,t,i,r){r.begin=1/0,r.end=-1/0;let a=-1,n=-1;for(const s of t){const t=s.id,o=e.instances.get(t),c=o.from*i,l=o.to*i;a!==n&&n!==c?(e.buffer.erase(a,n),a=c):-1===a&&(a=c),n=l,e.instances.delete(t),e.optimalCount-=l-c,c<r.begin&&(r.begin=c),l>r.end&&(r.end=l)}a!==n&&e.buffer.erase(a,n)}append(e,t,i,n,s){const o=this._bufferWriter;for(const l of t){const t=Object(r["k"])(l.transformation)?Object(a["m"])(S,n,l.transformation):n;Object(a["a"])(R,t),Object(a["b"])(R,R);const h=s.end;o.write({transformation:t,invTranspTransformation:R},l.data,o.vertexBufferLayout.createView(e.buffer.array.buffer),s.end/i);const d=o.elementCount(l.data)*i,u=h+d;Object(c["a"])(null==e.instances.get(l.id));const p=l.instanceParameters.visible,g=!!l.instanceParameters.highlights&&p,f=!!l.instanceParameters.occludees,m=new b(h/i,u/i,p,g,f);e.instances.set(l.id,m),e.optimalCount+=d,s.end+=d}}get test(){return{material:this._material,glMaterials:this._glMaterials}}}function j(e,t,i,r){const a=new Map,n=t.vertexBufferLayout.stride/4,s=(i,r)=>{const s=i.origin,o=e.get(s.id);let c=a.get(s.id);null==c&&(c={optimalCount:null==o?0:o.optimalCount,sparseCount:null==o?0:o.buffer.size,toAdd:[],toRemove:[],origin:s.vec3},a.set(s.id,c));const l=t.elementCount(i.data)*n;r?(c.optimalCount+=l,c.sparseCount+=l,c.toAdd.push(i)):(c.optimalCount-=l,c.toRemove.push(i))};for(const o of i)s(o,!0);for(const o of r)s(o,!1);return a}function w(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}const x={begin:0,end:0},M=Object(s["b"])(),S=Object(s["b"])(),R=Object(s["b"])();t["a"]=_},2245:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var r=i("0b2d"),a=i("e431"),n=i("38a4"),s=i("2bc9");function o(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function c(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function l(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function h(e){return(e+1)*(e+1)}function d(e){return Object(n["d"])(Math.floor(Math.sqrt(e)-1),0,2)}function u(e,t,i){const r=e[0],a=e[1],n=e[2],s=i||[];return s.length=h(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*n,s[3]=.4886025119*a),t>=2&&(s[4]=1.09254843059*r*a,s[5]=1.09254843059*a*n,s[6]=.31539156525*(3*n*n-1),s[7]=1.09254843059*r*n,s[8]=.54627421529*(r*r-a*a)),s}function p(e,t){const i=h(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let a=0;a<i;a++)r.r[a]=r.g[a]=r.b[a]=0;return r}function g(e,t){const i=d(t.r.length);for(const r of e)Object(a["u"])(j,r.direction),u(j,i,O),o(O,w),c(O,r.intensity[0],_),l(t.r,_),c(O,r.intensity[1],_),l(t.g,_),c(O,r.intensity[2],_),l(t.b,_);return t}function f(e,t){u(j,0,O);for(const i of e)t.r[0]+=O[0]*w[0]*i.intensity[0]*4*Math.PI,t.g[0]+=O[0]*w[0]*i.intensity[1]*4*Math.PI,t.b[0]+=O[0]*w[0]*i.intensity[2]*4*Math.PI;return t}function b(e,t,i){p(t,i.sphericalHarmonics.sh),Object(a["x"])(i.main.intensity,0,0,0);let r=!1;const n=m,o=v,c=y;n.length=0,o.length=0,c.length=0;for(const l of e)l instanceof s["c"]&&!r?(Object(a["l"])(i.main.direction,l.direction),i.main.intensity[0]=l.intensity[0],i.main.intensity[1]=l.intensity[1],i.main.intensity[2]=l.intensity[2],i.main.castShadows=l.castShadows,r=!0):l instanceof s["c"]||l instanceof s["b"]?n.push(l):l instanceof s["a"]?o.push(l):l instanceof s["d"]&&c.push(l);g(n,i.sphericalHarmonics.sh),f(o,i.sphericalHarmonics.sh);for(const a of c)l(i.sphericalHarmonics.sh.r,a.sh.r),l(i.sphericalHarmonics.sh.g,a.sh.g),l(i.sphericalHarmonics.sh.b,a.sh.b)}const m=[],v=[],y=[],O=[0],_=[0],j=Object(r["e"])(),w=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],x=Object(r["e"])(),M=.4;class S{constructor(){this._renderLighting={main:{intensity:Object(r["e"])(),direction:Object(r["g"])(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldSunlight={direction:Object(r["e"])(),ambient:{color:Object(r["e"])(),intensity:0},diffuse:{color:Object(r["e"])(),intensity:0}}}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)}setUniforms(e,t=!1){if(t){const t=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",t)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",M);const i=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}set(e){this._info=e,b(e.lights,this._shOrder,this._renderLighting),Object(a["u"])(this._oldSunlight.direction,this._renderLighting.main.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldSunlight.ambient.intensity=1,this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*t,this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*t,this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*t,this._oldSunlight.diffuse.intensity=1;const i=Object(a["l"])(x,this._oldSunlight.diffuse.color);Object(a["f"])(i,i,M*this._info.globalFactor),Object(a["g"])(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,i)}get globalFactor(){return this._info.globalFactor}get old(){return this._oldSunlight}}},2252:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var r,a=i("3886");!function(e){function t(e,t){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(a["a"]`
    float computeRenderPixelSizeAt( vec3 pWorld ){
      vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
      float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
      return viewDirectionDistance*perScreenPixelRatio;
    }

    vec3 screenSizeScaling(vec3 position, vec3 anchor){
      return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
    }
  `)}function i(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}e.builder=t,e.bindPassUniforms=i}(r||(r={}))},2698:function(e,t,i){"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return r}))},"2bc9":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return o}));var r=i("0b2d");class a{constructor(e=Object(r["e"])(),t=Object(r["g"])(.57735,.57735,.57735),i=!0){this.intensity=e,this.direction=t,this.castShadows=i}}class n{constructor(e=Object(r["e"])(),t=Object(r["g"])(.57735,.57735,.57735)){this.intensity=Object(r["e"])(),this.direction=Object(r["e"])(),this.intensity=e,this.direction=t}}class s{constructor(e=Object(r["e"])()){this.intensity=e}}class o{constructor(){this.sh={r:[0],g:[0],b:[0]}}}},"33e2":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886"),a=i("d981");function n(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(a["b"]),e.fragment.code.add(r["a"]`
      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);

      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
        return 2.0 * texture2D(_tex, _uv).rg - 1.0;
      }

      float sampleNoiseTexture(vec2 _uv) {
        return texture2D(texWavePerturbation, _uv).b;
      }

      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
      }

      float computeProgress(vec2 uv, float time) {
        return fract(time);
      }

      float computeWeight(vec2 uv, float time) {
        float progress = computeProgress(uv, time);
        return 1.0 - abs(1.0 - 2.0 * progress);
      }

      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
        float flowStrength = waveParams[2];
        float flowOffset = waveParams[3];

        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;

        float progress = computeProgress(uv, time + phaseOffset);
        float weight = computeWeight(uv, time + phaseOffset);

        vec2 result = uv;
        result -= flowVector * (progress + flowOffset);
        result += phaseOffset;
        result += (time - progress) * FLOW_JUMP;

        return vec3(result, weight);
      }

      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
      const float TIME_NOISE_STRENGTH = 7.77;

      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
        float waveStrength = waveParams[0];

        // overall directional shift in uv's for directional wave movement for
        // now we do a hard coded scale for wave speed such that a unit length
        // direction is not too fast.
        vec2 waveMovement = time * -_waveDir;

        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;

        // compute two perturbed uvs and blend weights
        // then sample the wave normals at the two positions and blend
        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);

        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;

        // logic to flatten the wave pattern
        // scale xy components of the normal, then adjust z (up) component
        vec3 mixNormal = normalize(normal_A + normal_B);
        mixNormal.xy *= waveStrength;
        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));

        return mixNormal;
      }

      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
        float waveTextureRepeat = waveParams[1];
        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
        float foam  = normals2FoamIntensity(normal, waveParams[0]);
        return vec4(normal, foam);
      }
    `)}!function(e){function t(e,t){e.setUniform1i("texWaveNormal",0),e.setUniform1i("texWavePerturbation",1),e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}e.bindUniforms=t}(n||(n={}))},3544:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o}));i("c120");var r=i("b2b2"),a=(i("9f8b"),i("1956"),i("a1ff"));i("d267");class n{constructor(){this.cache=new Map}dispose(){this.cache.forEach(e=>{Object(r["k"])(e.texture)&&(e.texture.dispose(),e.texture=null)}),this.cache.clear()}acquire(e){if(Object(r["j"])(e))return null;const t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const n=2,s=this.patternToTextureData(e,2),o=s.length/n,c={refCount:1,texture:null,bind:(e,t)=>(Object(r["j"])(c.texture)&&(c.texture=new a["a"](e,{width:s.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},s)),e.bindTexture(c.texture,t),o)};return this.cache.set(t,c),c.bind}release(e){if(Object(r["j"])(e))return;const t=this.patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(r["k"])(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this.acquire(t);return this.release(e),i}patternId(e){return e.join(",")}patternToTextureData(e,t){const i=e.reduce((e,t)=>e+t)*t,r=new Uint8Array(i);let a=!0,n=0;for(const s of e){for(let e=0;e<s*t;e++)r[n++]=a?255:0;a=!a}return r}}function s(e){return Object(r["j"])(e)?e:e.slice()}function o(e){return[e,e]}},3748:function(e,t,i){"use strict";i.d(t,"a",(function(){return I}));var r=i("b2b2"),a=i("e92d"),n=i("a915"),s=i("0b2d"),o=i("e431"),c=i("3349"),l=i("55e6"),h=i("d0ac"),d=i("1153"),u=i("1038"),p=i("b623"),g=i("d7f7"),f=i("7c51"),b=i("35b3"),m=i("5957"),v=i("8675"),y=i("a4ee"),O=i("c3a4"),_=i("ca98"),j=i("da35"),w=i("fa1e"),x=i("8e37"),M=i("189c"),S=i("8e97"),R=i("d272"),E=i("6a07"),P=i("87b7"),T=i("713b");class D extends _["a"]{constructor(e,t){super(e,t),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=D.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new x["a"](e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),w["a"])}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t,i){if(S["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e}if(this.configuration.stippleEnabled){const t=Object(r["k"])(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/t),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const e=Object(r["t"])(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",e[0],e[1],e[2],e.length>3?e[3]:1)}4===this.configuration.output&&E["a"].bindOutputHighlight(e,this.program,i)}bindDraw(e){S["a"].bindView(this.program,e),R["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}initializePipeline(){const e=this.configuration,t=Object(M["f"])(770,1,771,771),i=(t,i=null,r=null)=>Object(M["e"])({blending:i,depthTest:P["b"],depthWrite:r,colorWrite:M["c"],stencilWrite:e.sceneHasOcludees?P["j"]:null,stencilTest:e.sceneHasOcludees?t?P["f"]:P["e"]:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,M["d"]),i(!1,e.transparent||e.stippleEnabled?t:null,M["d"])):i(!1)}get primitiveType(){return 1}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}D.shader=new O["a"](T["a"],()=>i.e("chunk-2d20f1b1").then(i.bind(null,"b1e1")));class C extends j["a"]{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.sceneHasOcludees=!1}}Object(y["a"])([Object(j["b"])({count:8})],C.prototype,"output",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"slicePlaneEnabled",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"vertexColors",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"transparent",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"stippleEnabled",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"stippleOffColorEnabled",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(y["a"])([Object(j["b"])()],C.prototype,"sceneHasOcludees",void 0);const A=a["a"].getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class I extends b["a"]{constructor(e){super(e,z),this.techniqueConfig=new C}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;const t=Object(r["k"])(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(r["k"])(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,r,a,n,s,o,c){c?Object(f["h"])(e,r,n,1,s):this.intersectLineGeometry(e,t,i,r,s)}intersectLineGeometry(e,t,i,r,a){if(!r.options.selectionMode||Object(p["e"])(t))return;if(!Object(d["g"])(i))return void A.error("intersection assumes a translation-only matrix");const n=e.vertexAttributes.get("position").data,s=r.camera,l=Y;Object(c["c"])(l,r.point);const u=2;Object(o["x"])(X[0],l[0]-u,l[1]+u,0),Object(o["x"])(X[1],l[0]+u,l[1]+u,0),Object(o["x"])(X[2],l[0]+u,l[1]-u,0),Object(o["x"])(X[3],l[0]-u,l[1]-u,0);for(let o=0;o<4;o++)if(!s.unprojectFromRenderScreen(X[o],Q[o]))return;h["f"].fromPoints(s.eye,Q[0],Q[1],J),h["f"].fromPoints(s.eye,Q[1],Q[2],K),h["f"].fromPoints(s.eye,Q[2],Q[3],$),h["f"].fromPoints(s.eye,Q[3],Q[0],ee);let g=Number.MAX_VALUE;for(let c=0;c<n.length-5;c+=3){if(L[0]=n[c]+i[12],L[1]=n[c+1]+i[13],L[2]=n[c+2]+i[14],V[0]=n[c+3]+i[12],V[1]=n[c+4]+i[13],V[2]=n[c+5]+i[14],h["f"].signedDistance(J,L)<0&&h["f"].signedDistance(J,V)<0||h["f"].signedDistance(K,L)<0&&h["f"].signedDistance(K,V)<0||h["f"].signedDistance($,L)<0&&h["f"].signedDistance($,V)<0||h["f"].signedDistance(ee,L)<0&&h["f"].signedDistance(ee,V)<0)continue;if(s.projectToRenderScreen(L,U),s.projectToRenderScreen(V,N),U[2]<0&&N[2]>0){Object(o["k"])(H,L,V);const e=s.frustum,t=-h["f"].signedDistance(e[4],L)/Object(o["i"])(H,h["f"].normal(e[4]));Object(o["f"])(H,H,t),Object(o["g"])(L,L,H),s.projectToRenderScreen(L,U)}else if(U[2]>0&&N[2]<0){Object(o["k"])(H,V,L);const e=s.frustum,t=-h["f"].signedDistance(e[4],V)/Object(o["i"])(H,h["f"].normal(e[4]));Object(o["f"])(H,H,t),Object(o["g"])(V,V,H),s.projectToRenderScreen(V,N)}else if(U[2]<0&&N[2]<0)continue;U[2]=0,N[2]=0;const e=h["e"].distance2(h["e"].fromPoints(U,N,W),l);e<g&&(g=e,Object(o["l"])(B,L),Object(o["l"])(q,V))}const f=r.rayBeginPoint,b=r.rayEndPoint;if(g<u*u){let e=Number.MAX_VALUE;if(h["e"].closestLineSegmentPoint(h["e"].fromPoints(B,q,W),h["e"].fromPoints(f,b,Z),F)){Object(o["k"])(F,F,f);const t=Object(o["q"])(F);Object(o["f"])(F,F,1/t),e=t/Object(o["p"])(f,b)}a(e,F)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get("position");return Object(u["a"])(r,null,!1,t)}createBufferWriter(){const e=this.params.vertexColors?v["b"]:v["c"];return Object(r["j"])(this.params.stipplePattern)?new v["a"](e):new G(e.clone().vec3f("auxpos1"))}getGLMaterial(e){return 0===e.output||4===e.output?new k(e):void 0}}class k extends g["a"]{constructor(e){super(e),this.updateParameters()}updateParameters(){this.technique=this.techniqueRep.acquireAndReleaseExisting(D,this.material.getTechniqueConfig(this.output),this.technique)}beginSlot(e){return 3===e}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this.output&&this._updateOccludeeState(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}class G{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){Object(m["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.writeAuxpos1(e,t,i,r)}writeAuxpos1(e,t,i,r){const a=i.getField("auxpos1",l["u"]),n=t.indices.get("position"),s=t.vertexAttributes.get("position").data,o=e.transformation,c=a.typedBufferStride,h=a.typedBuffer;r*=c;for(let l=0;l<n.length;l+=2){const e=3*n[l],t=s[e],i=s[e+1],a=s[e+2],d=o[0]*t+o[4]*i+o[8]*a+o[12],u=o[1]*t+o[5]*i+o[9]*a+o[13],p=o[2]*t+o[6]*i+o[10]*a+o[14];for(let n=0;n<2;++n)h[r]=d,h[r+1]=u,h[r+2]=p,r+=c}}}const z={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...b["b"]},L=Object(s["e"])(),V=Object(s["e"])(),H=Object(s["e"])(),F=Object(s["e"])(),U=Object(n["e"])(),N=Object(n["e"])(),B=Object(s["e"])(),q=Object(s["e"])(),W=h["e"].create(),Z=h["e"].create(),Y=Object(s["e"])(),X=[Object(n["e"])(),Object(n["e"])(),Object(n["e"])(),Object(n["e"])()],Q=[Object(s["e"])(),Object(s["e"])(),Object(s["e"])(),Object(s["e"])()],J=h["f"].create(),K=h["f"].create(),$=h["f"].create(),ee=h["f"].create()},"3cde":function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var r=i("a4ee"),a=(i("c120"),i("b2b2")),n=i("e92d"),s=(i("cea0"),i("59b2")),o=i("d386"),c=(i("e041"),i("8eed"),i("f402"),i("fc29")),l=i("ce6d"),h=i("a915"),d=i("0b2d"),u=i("e431"),p=i("8188"),g=i("fd14"),f=i("a6c1"),b=i("3349"),m=i("f408"),v=i("e94b");const y=n["a"].getLogger("esri.views.interactive.GraphicManipulator");let O=class extends c["a"]{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new l["a"].EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){"mesh"!==Object(a["i"])(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):y.error("Mesh geometries are not supported")}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(m["e"])(this.graphic),i=e?e.offset:0;return new g["a"]({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(Object(a["j"])(i))return null;const r=this._get("focusedSymbol"),n=Object(a["k"])(r)?r:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(a["k"])(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(a["k"])(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",e=>{Object(a["k"])(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(a["k"])(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))},!0)}detachSymbolChanged(){Object(a["k"])(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(a["k"])(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,r){if(r=r||Object(f["h"])(i),Object(a["j"])(r))return null;const n=1;let s=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==r.type)return Object(v["b"])(t,i,e)?n:null;if(Object(a["j"])(s)||!s.originalPoint.equals(i)){const t=i,a=e.spatialReference;if(Object(p["b"])(t.spatialReference,a)){const e=Object(p["n"])(t,a);s={originalPoint:t.clone(),mapPoint:e,radiusPx:Object(h["h"])(r.size)},this._circleCollisionCache=s}}if(Object(a["k"])(s)){const i=Object(h["j"])(t,j),a=e.toScreen(s.mapPoint),o=s.radiusPx,c=a.x+Object(h["h"])(r.xoffset),l=a.y-Object(h["h"])(r.yoffset);return Object(b["j"])(i,[c,l])<o*o?n:null}return null}_intersectDistance3D(e,t,i){const r=e.toMap(t,{include:[i]});return r&&Object(p["t"])(r,_,e.renderSpatialReference)?Object(u["p"])(_,e.state.camera.eye):null}};Object(r["a"])([Object(s["b"])({constructOnly:!0,nonNullable:!0})],O.prototype,"graphic",null),Object(r["a"])([Object(s["b"])({readOnly:!0})],O.prototype,"elevationInfo",null),Object(r["a"])([Object(s["b"])({constructOnly:!0,nonNullable:!0})],O.prototype,"view",void 0),Object(r["a"])([Object(s["b"])({value:null})],O.prototype,"focusedSymbol",null),Object(r["a"])([Object(s["b"])({constructOnly:!0})],O.prototype,"layer",void 0),Object(r["a"])([Object(s["b"])()],O.prototype,"interactive",void 0),Object(r["a"])([Object(s["b"])()],O.prototype,"selectable",void 0),Object(r["a"])([Object(s["b"])()],O.prototype,"grabbable",void 0),Object(r["a"])([Object(s["b"])({value:!1})],O.prototype,"grabbing",null),Object(r["a"])([Object(s["b"])()],O.prototype,"dragging",void 0),Object(r["a"])([Object(s["b"])()],O.prototype,"hovering",null),Object(r["a"])([Object(s["b"])({value:!1})],O.prototype,"selected",null),Object(r["a"])([Object(s["b"])()],O.prototype,"cursor",void 0),O=Object(r["a"])([Object(o["a"])("esri.views.interactive.GraphicManipulator")],O);const _=Object(d["e"])(),j=Object(h["g"])()},"3e44":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i("3886"),a=i("690a"),n=i("2aad");function s(){const e=new a["a"];return e.include(n["a"]),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(r["a"]`
    void main() {
      vec4 texColor = texture2D(tex, uv);
      gl_FragColor = texColor * color;
    }
  `),e}var o=Object.freeze({__proto__:null,build:s})},"438e":function(e,t,i){"use strict";i.r(t),i.d(t,"DrawOperation",(function(){return r["a"]})),i.d(t,"DrawGraphicTool",(function(){return We})),i.d(t,"GraphicMoveTool",(function(){return _r})),i.d(t,"GraphicReshapeTool",(function(){return Cr})),i.d(t,"GraphicTransformTool",(function(){return Wr})),i.d(t,"ExtentTransformTool",(function(){return _n}));var r=i("6469"),a=i("a4ee"),n=i("c120"),s=i("b2b2"),o=i("e92d"),c=i("cea0"),l=i("59b2"),h=i("d386"),d=(i("e041"),i("8eed"),i("f402"),i("ce6d")),u=i("8d60"),p=i("3795"),g=i("9096"),f=i("ce0b"),b=i("f408"),m=i("025c"),v=i("4772"),y=i("a545"),O=i("9ef0"),_=i("d329"),j=i("0fc4"),w=i("3544");const x={main:new O["a"]([255,127,0]),selected:new O["a"]([255,255,255]),staged:new O["a"]([12,207,255]),outline:new O["a"]([0,0,0,.5]),selectedOutline:new O["a"]([255,255,255])},M=.3;function S(e,t){const i=e.clone();return i.a*=t,i}function R(e,t){const i=e.clone(),r=Object(_["b"])(i);r.s*=t;const a=Object(_["e"])(r);return i.r=a.r,i.g=a.g,i.b=a.b,i}function E(e,t){if(t)for(const i in t)e[i]=t[i]}class P{constructor(e){this.color=x.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,E(this,e)}}class T{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=x.main,this.outlineColor=x.outline,this.renderOccluded=16,this.hoverOutlineColor=x.selectedOutline,E(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:H(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class D{constructor(e){this.vertex=new T({color:x.main,outlineColor:x.outline}),this.edge=new T({color:R(S(x.main,2/3),.5),outlineColor:S(x.outline,.5),size:8,collisionPadding:8}),this.selected=new T({color:x.selected,outlineColor:x.outline}),E(this,e)}}class C{constructor(e){this.color=x.selected,this.width=1.5,this.stipplePattern=Object(w["b"])([5,5]),this.stippleOffColor=x.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=x.selected,this.renderOccluded=4,E(this,e)}apply(e){e.color=H(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=H(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=H(this.innerColor),e.renderOccluded=this.renderOccluded}}class A{constructor(e){this.color=x.selected,this.size=4,this.outlineSize=1,this.outlineColor=x.outline,this.shape="square",E(this,e)}apply(e){e.color=H(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=H(this.outlineColor),e.primitive=this.shape}}class I{constructor(e){this.innerColor=x.selected,this.innerWidth=1,this.glowColor=x.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=M,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=x.main,E(this,e)}apply(e,t=1){const i={glowColor:O["a"].toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:O["a"].toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class k{constructor(e){this.outline=new C({color:x.outline,renderOccluded:8,stippleOffColor:x.selected,stipplePattern:Object(w["b"])([5,5]),width:1.5,innerWidth:0}),this.staged=new C({color:x.selected,renderOccluded:8,innerColor:x.staged,stippleOffColor:x.outline,stipplePattern:Object(w["b"])([5,5]),width:1.5}),this.shadowStyle=new I({globalAlpha:M,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:1}),E(this,e)}}class G{constructor(e){this.outline=new A({color:x.selected,outlineColor:x.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new I({globalAlpha:M,glowColor:x.main,glowFalloff:1.5,glowWidth:6,innerColor:x.selected,innerWidth:1,radius:2}),E(this,e)}}class z extends C{constructor(e){super(),this.extensionType=2,E(this,e)}}class L{constructor(e){this.lineGraphics=new k,this.pointGraphics=new G,this.heightPlane=new I({globalAlpha:M,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:1}),this.heightBox=new I({globalAlpha:M,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:0,heightFillColor:x.main}),this.zVerticalLine=new z({color:S(x.main,5*M/3),falloff:2,innerColor:S(x.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,E(this,e)}}class V{constructor(e){this.visualElements=new L,this.reshapeManipulators=new D,this.zManipulator=new P,E(this,e)}colorToVec4(e){return H(e)}}function H(e){return Object(j["g"])(O["a"].toUnitRGBA(e))}const F=new V;var U=i("0b2d"),N=i("e431"),B=i("8188"),q=i("7577"),W=i("4261"),Z=i("5ef2"),Y=i("1a54"),X=i("1038"),Q=i("0eb9"),J=i("86ba"),K=i("6061"),$=i("d408"),ee=i("647b"),te=i("dd63"),ie=i("fc29"),re=i("a5d8");class ae{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(s["k"])(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(s["j"])(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(s["j"])(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new ne({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(Object(s["j"])(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!Object(s["j"])(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){Object(s["j"])(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let ne=class extends(Object(re["a"])(ie["a"])){constructor(e){super(e),this.drapeSourceType=1}};Object(a["a"])([Object(l["b"])({constructOnly:!0})],ne.prototype,"view",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],ne.prototype,"drapeSourceType",void 0),ne=Object(a["a"])([Object(h["a"])("DrapedVisualElementLayerView")],ne);class se{constructor(e){this.view=null,this._attachmentOrigin=Object(Y["k"])(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new d["a"],this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(Z["c"])(1,0,1,1),this._innerWidth=0,this._innerColor=Object(Z["c"])(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new te["a"]({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new ae({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new ee["a"]({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(s["k"])(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(q["g"])(e,this._innerColor)||(Object(q["c"])(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(s["k"])(e)!==Object(s["k"])(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(q["g"])(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(Z["a"])(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(s["k"])(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(s["k"])(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(N["x"])(le,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get("position"),r=i.indices.get("position"),a=Object(s["t"])(this.resources.resources).material.isClosed(e.data,r);Object(X["a"])(e,r,a,ce)&&(Object(N["g"])(le,le,ce),t++)}return 0===t?null:(Object(N["f"])(le,le,1/t),this.view.renderCoordsHelper.fromRenderCoords(le,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){Object(s["k"])(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(s["k"])(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return Object(s["k"])(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const r=this.createRenderGeometries();for(const a of r)e.addGeometry(a,t),i.push(a);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new J["a"](this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){const e=new J["a"](this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if(Object(s["j"])(t))return[];const i=Object($["c"])(t,this.view.basemapTerrain.spatialReference),r=[];for(const{position:a}of i.lines){const t={attributeData:{position:a},removeDuplicateStartEnd:this.isClosed?1:0},i=new K["a"](Object($["a"])(t),e),n=Object(W["k"])(oe);Object(W["n"])(n,a),Object(q["l"])(i.boundingSphere,.5*(n[0]+n[3]),.5*(n[1]+n[4]),0,.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]))),r.push(i)}return r}calculateMapBounds(e){if(Object(s["j"])(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const r=i.vertexAttributes.get("position"),a=new Float64Array(r.data.length);Object(B["q"])(r.data,t.spatialReference,0,a,this.view.spatialReference,0,r.data.length/3),Object(W["n"])(e,a)}return!0}createRenderGeometries(){const e=this.geometry;if(Object(s["j"])(e))return[];const t=Object($["b"])(e,this.view.elevationProvider,this.view.renderCoordsHelper,Q["a"].fromElevationInfo(this.elevationInfo)),i=[],r=[];for(const{position:a,mapPosition:n}of t.lines){const e={attributeData:{position:a,mapPosition:n},removeDuplicateStartEnd:this.isClosed?1:0};i.push(Object($["a"])(e)),r.push(a)}return this._laserline.pathVerticalPlane=r,i}}const oe=Object(W["h"])(),ce=Object(U["e"])(),le=Object(U["e"])();var he=i("caf7"),de=i("5241"),ue=i("5fae"),pe=i("55e6"),ge=i("fc00"),fe=i("1153"),be=i("d7f7"),me=i("7c51"),ve=i("35b3"),ye=i("5957"),Oe=i("c3a4"),_e=i("ca98"),je=i("da35"),we=i("8e37"),xe=i("189c"),Me=i("8e97"),Se=i("d272"),Re=i("7438"),Ee=i("c6d7"),Pe=i("2252"),Te=i("692f");class De extends _e["a"]{initializeProgram(e){const t=De.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new we["a"](e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),Ae)}bindPass(e,t,i){const{screenSizeEnabled:r,shadingEnabled:a}=this.configuration,{color:n,shadingTint:s,shadingDirection:o}=t;Me["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",n),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(Ee["a"])(this.program,e,i)),a&&(this.program.setUniform4fv("shadedColor",this.blendColor(Ie,s,n)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),r&&Pe["a"].bindPassUniforms(this.program,t,i)}blendColor(e,t,i){const r=1-t[3],a=t[3]+i[3]*r;return 0===a?(e[3]=a,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*r)/a,e[1]=(t[1]*t[3]+i[1]*i[3]*r)/a,e[2]=(t[2]*t[3]+i[2]*i[3]*r)/a,e[3]=i[3],e)}bindDraw(e){Me["a"].bindView(this.program,e),Me["a"].bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Se["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e,a=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return Object(xe["e"])({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?Re["f"]:Object(Re["a"])(e),culling:a(t.cullFace),depthTest:{func:r?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&xe["d"]:Object(Re["c"])(e),colorWrite:xe["c"],polygonOffset:i||r?null:Re["d"]})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}De.shader=new Oe["a"](Te["a"],()=>i.e("chunk-2d2219c9").then(i.bind(null,"caa6")));class Ce extends je["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(a["a"])([Object(je["b"])({count:8})],Ce.prototype,"output",void 0),Object(a["a"])([Object(je["b"])({count:3})],Ce.prototype,"cullFace",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"slicePlaneEnabled",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"transparent",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"writeDepth",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"screenSizeEnabled",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"shadingEnabled",void 0),Object(a["a"])([Object(je["b"])({count:4})],Ce.prototype,"transparencyPassType",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"multipassTerrainEnabled",void 0),Object(a["a"])([Object(je["b"])()],Ce.prototype,"cullAboveGround",void 0);const Ae={position:0,normal:1,offset:2},Ie=Object(j["c"])();class ke extends ve["a"]{constructor(e){super(e,ze),this.supportsEdges=!0,this.techniqueConfig=new Ce,this._vertexAttributeLocations=Ae}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,r,a,n,s){if(this.params.screenSizeEnabled){const i=e.vertexAttributes.get("offset"),o={applyToVertex:(e,t,a,n)=>{const s=Object(N["x"])(Ve,i.data[3*n+0],i.data[3*n+1],i.data[3*n+2]),o=Object(N["x"])(He,e,t,a);return Object(N["f"])(s,s,this.params.screenSize*r.camera.computeRenderPixelSizeAt(s)),Object(N["g"])(o,o,s),[o[0],o[1],o[2]]},applyToAabb:e=>{const t=Object(W["e"])(e,Ve);return Object(W["B"])(e,this.params.screenSize*r.camera.computeRenderPixelSizeAt(t))}};Object(me["i"])(e,t,r,a,n,o,s)}else Object(me["i"])(e,t,r,a,n,void 0,s)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new Ge(e):void 0}createBufferWriter(){return new Le(this.params.screenSizeEnabled)}}class Ge extends be["a"]{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(De,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(4===this.output)return 3===e;let t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}const ze={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(N["s"])(Object(U["e"])(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...ve["b"]};class Le{constructor(e){this.screenSizeEnabled=e;const t=Object(ge["a"])().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){if(Object(ye["c"])(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const a=t.vertexAttributes.get("offset"),n=t.indices.get("offset");Object(fe["a"])(3===a.size);const s=i.getField("offset",pe["u"]);if(!s)throw new Error("unable to acquire view for offset");Object(ye["e"])(n,a.data,e.invTranspTransformation,s,r)}}}}const Ve=Object(U["e"])(),He=Object(U["e"])();class Fe extends ue["a"]{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=F.colorToVec4(F.reshapeManipulators.vertex.color),this._size=F.reshapeManipulators.vertex.size,this._outlineColor=F.colorToVec4(F.reshapeManipulators.vertex.outlineColor),this._outlineSize=F.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(q["g"])(e,this._color)||(Object(q["c"])(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(q["g"])(e,this._outlineColor)||(Object(q["c"])(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(Object(s["j"])(e)||0===e.length)return[];const t=.5,i=.5,r=Object(de["c"])(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Q["a"].fromElevationInfo(this.elevationInfo)),a=[],n=r.numVertices,o=r.position;for(let s=0;s<n;++s){const e=Object(N["x"])(Ue,o[3*s+0],o[3*s+1],o[3*s+2]),r=Ne(t,e),n=Ne(i,e);a.push({vertexGeometry:r,vertexOutlineGeometry:n})}return a}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:r}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(r,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new ke({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new ke({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const Ue=Object(U["e"])();function Ne(e,t){return he["a"].createSphereGeometry(e,16,16,{offset:t})}let Be=class extends d["a"].EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(a["a"])([Object(l["b"])({constructOnly:!0})],Be.prototype,"graphic",void 0),Object(a["a"])([Object(l["b"])()],Be.prototype,"tracking",void 0),Object(a["a"])([Object(l["b"])()],Be.prototype,"displaying",void 0),Object(a["a"])([Object(l["b"])()],Be.prototype,"isDraped",void 0),Be=Object(a["a"])([Object(h["a"])("esri.views.3d.layers.graphics.GraphicState")],Be);var qe=i("dfd4");let We=class extends(Object(g["b"])(d["a"].EventedMixin(v["a"]))){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._stagedVerticesVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingManager=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){const e=Object(s["u"])(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new f["a"]({elevationInfo:e,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new r["a"]({view:this.view,manipulators:this.manipulators,geometryType:Ze(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new m["b"](this.view,e,[this._internalGraphicsLayer]),elevationDrawSurface:new m["a"](e,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:e,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",e=>this.onVertexAdd(e)),this.drawOperation.on("vertex-remove",e=>this.onVertexRemove(e)),this.drawOperation.on("vertex-update",e=>this.onVertexUpdate(e)),this.drawOperation.on("cursor-update",e=>this.onCursorUpdate(e)),this.drawOperation.on("complete",e=>this.onComplete(e))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e,t=!1){if(null==this.drawOperation)return null;const i=Object(s["k"])(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,r=this.drawOperation.vertices;if(0===r.length)return null;const a=this.drawOperation.spatialReference,n=r,o=n.slice(),c=[];Object(s["k"])(i)&&(o.splice(i,1),c.push(n[i]));const l={regularVertices:null,stagedVertices:null,full:null,outline:null},h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":l.regularVertices=o,l.stagedVertices=c,l.full=this.drawOperation.coordinateHelper.createPointFromArray(r[0]);break;case"polyline":l.regularVertices=o,l.stagedVertices=c,n.length>0&&(l.full=Object(qe["createPolyline"])([n],a,h));break;case"polygon":l.regularVertices=o,l.stagedVertices=c,n.length>0&&(l.full=Object(qe["createPolygon"])([n],a,h,!0));break;case"circle":if(n.length>0){const e=Object(y["a"])(this.view,r[0]);if(1===n.length&&t){const t=n[0],i=e.makeMapPoint(t[0]+Ye*this.view.resolution,t[1]);l.full=Object(qe["createCircle"])([t,i],e,!0)}else 2===n.length&&(l.full=this.forceUniformSize?Object(qe["createCircle"])(r,e,this.centered):Object(qe["createEllipse"])(r,e,this.centered))}break;case"rectangle":if(n.length>0){const e=Object(y["a"])(this.view,r[0]);if(1===n.length&&t){const t=n[0],i=e.makeMapPoint(t[0]+Ye*this.view.resolution,t[1]);l.full=Object(qe["createSquare"])([t,i],e,!0)}else 2===n.length&&(l.full=this.forceUniformSize?Object(qe["createSquare"])(r,e,this.centered):Object(qe["createRectangle"])(r,e,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":n.length>1&&(l.outline=Object(qe["createPolyline"])([n],a,h));break;case"polygon":n.length>1&&(l.outline=Object(qe["createPolygon"])([n],a,h));break;case"circle":case"rectangle":Object(s["k"])(l.full)&&"polygon"===l.full.type&&(l.outline=Object(qe["createPolygon"])(l.full.rings,a,h))}return l}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){Object(s["k"])(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null),this._createGraphicState=null,this.handles.remove(Xe)}_destroyOutlineVisualElement(){Object(s["k"])(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}_destroyVerticesVisualElement(){Object(s["k"])(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}_destroyStagedVerticesVisualElement(){Object(s["k"])(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}_updateCreateGraphic(e=null){const t=this._getCreateGeometry(e);if(Object(s["j"])(t))return void this._destroyAllVisualisations();const i=this._internalGraphicsLayer.elevationInfo;Object(s["k"])(t.outline)?Object(s["j"])(this._outlineVisualElement)?(this._outlineVisualElement=new se({view:this.view,geometry:t.outline,elevationInfo:Object(s["t"])(i),isDraped:Object(s["k"])(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(b["c"])(this.hasZ,i),attached:!1}),F.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),F.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),Object(s["k"])(t.regularVertices)?Object(s["j"])(this._verticesVisualElement)?(this._verticesVisualElement=new Fe({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:Object(s["t"])(this._internalGraphicsLayer.elevationInfo),renderOccluded:F.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),Object(s["k"])(t.stagedVertices)?Object(s["j"])(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new Fe({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:Object(s["t"])(this._internalGraphicsLayer.elevationInfo),renderOccluded:F.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=F.colorToVec4(F.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),Object(s["k"])(t.full)?Object(s["j"])(this._createGraphic)?(this._createGraphic=new u["a"]({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new Be({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(p["a"])(this._createGraphicState,"isDraped",e=>{Object(s["k"])(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)})],Xe),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateGeometry(null,!0);Object(s["k"])(e)&&(t=new u["a"]({geometry:e.full,symbol:this.createGraphicSymbol}))}this.emit("complete",{graphic:t,...e})}};function Ze(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],We.prototype,"view",void 0),Object(a["a"])([Object(l["b"])()],We.prototype,"createGraphicSymbol",void 0),Object(a["a"])([Object(l["b"])()],We.prototype,"createGraphic",null),Object(a["a"])([Object(l["b"])({value:!0})],We.prototype,"enabled",null),Object(a["a"])([Object(l["b"])({value:!0})],We.prototype,"centered",null),Object(a["a"])([Object(l["b"])({value:!0})],We.prototype,"forceUniformSize",null),Object(a["a"])([Object(l["b"])({constructOnly:!0})],We.prototype,"hasZ",void 0),Object(a["a"])([Object(l["b"])({nonNullable:!0})],We.prototype,"defaultZ",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],We.prototype,"elevationInfo",void 0),Object(a["a"])([Object(l["b"])()],We.prototype,"snapToScene",void 0),Object(a["a"])([Object(l["b"])()],We.prototype,"snappingManager",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],We.prototype,"mode",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],We.prototype,"geometryType",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],We.prototype,"type",void 0),We=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],We);const Ye=48,Xe="create-graphic";var Qe=i("c649"),Je=i("2c4f"),Ke=i("af40"),$e=i("6ae9"),et=i("27df"),tt=i("1f1c"),it=i("c20d"),rt=i("3510"),at=i("feba"),nt=i("d791"),st=i("f091"),ot=i("d3cf"),ct=i("ba58"),lt=i("d36e"),ht=i("6c97"),dt=i("4c37"),ut=i("4ae5"),pt=(i("e06a"),i("38a4")),gt=i("a915"),ft=i("f694"),bt=i("9180"),mt=i("dae5"),vt=i("afe1"),yt=i("1c92"),Ot=i("3349"),_t=i("0cb9"),jt=i("d0ac"),wt=i("5a22"),xt=i("171c"),Mt=i("748f");class St{constructor(e){this.idHint=0,this.camera=new xt["a"],this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(vt["b"])(),this._worldFrame=null,this._renderLocation=Object(U["e"])(),this._renderLocationDirty=!0,this._location=new ut["a"]({x:0,y:0,z:0}),this._elevationAlignedLocation=new ut["a"],this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new d["a"].EventEmitter,this._screenLocation={screenPointArray:Object(gt["g"])(),renderScreenPointArray:Object(gt["e"])(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(dt["d"])(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){Rt(e)&&(this._screenLocationDirty=!0),Object(nt["c"])(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(vt["b"])()),Et(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(ot["a"])(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(ot["a"])(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=Object(s["k"])(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,Rt(this._modelTransform)){const t=this._calculateModelTransformOffset(Ft);e=Object(N["g"])(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=Object(gt["j"])(e,Pt),r=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(Ot["j"])(this.screenLocation.screenPointArray,i)<r*r)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,It),o=r*this.screenLocation.pixelSize,c=jt["g"].fromScreen(this.camera,i,Dt);if(Object(s["j"])(c))return null;for(const i of e){if(0===i.length)continue;const e=Object(N["n"])(Gt,i[0],n);for(let t=1;t<i.length;t++){const r=Object(N["n"])(zt,i[t],n),s=jt["e"].closestRayDistance2(jt["e"].fromPoints(e,r,Tt),c);if(null!=s&&s<o*o){const t=Object(N["g"])(st["d"].get(),e,r);Object(N["f"])(t,t,.5);const i=Object(gt["a"])(st["d"].get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(N["l"])(e,r)}}break}case"disc":{var n;const e=this.collisionType.direction,t=null!=(n=this.collisionType.offset)?n:U["b"],o=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(o,It),l=r*this.screenLocation.pixelSize,h=jt["g"].fromScreen(this.camera,i,Dt);if(Object(s["j"])(h))return null;const d=Object(yt["f"])(Ct,c),u=Object(N["y"])(Vt,e,d),p=Object(N["n"])(Ht,t,c);jt["f"].fromPositionAndNormal(p,u,kt);const g=Lt;if(jt["f"].intersectRay(kt,h,g)&&Object(N["m"])(g,p)<l*l)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,n=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(n,It),c=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=jt["g"].fromScreen(this.camera,i,Dt);if(Object(s["j"])(l))return null;const h=Object(yt["f"])(Ct,o),d=Object(N["y"])(Vt,t,h),u=this._calculateModelTransformPosition(Ht);jt["f"].fromPositionAndNormal(u,d,kt);const p=Lt;if(!jt["f"].intersectRay(kt,l,p))break;for(const i of e){if(0===i.length)continue;const e=Object(N["n"])(Gt,i[0],o);for(let t=1;t<i.length;t++){const r=Object(N["n"])(zt,i[t],o),n=jt["e"].distance2(jt["e"].fromPoints(e,r,Tt),p);if(null!=n&&n<c*c){const t=Object(N["g"])(st["d"].get(),e,r);Object(N["f"])(t,t,.5);const i=Object(gt["a"])(st["d"].get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(N["l"])(e,r)}}break}default:Object(ht["a"])(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(Object(s["j"])(i.engineLayerId)){const e=new Mt["a"]({isPickable:!1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(s["j"])(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(B["b"])(this._location.spatialReference,this.view.spatialReference)||(this.location=new ut["a"]({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(B["s"])(this.location,Ut,e.spatialReference),Object(bt["i"])(e.extent,Ut)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(s["j"])(this.elevationInfo))return!1;let t=null,i=0;const r=Object(s["u"])(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(s["u"])(Object(_t["b"])(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(s["u"])(Object(_t["b"])(this.view.elevationProvider,e,"ground"),0)+r;break;case"relative-to-scene":i=Object(s["u"])(Object(_t["b"])(this.view.elevationProvider,e,"scene"),0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=It;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?2:1)|(this.selected?8:4),a=this._noDisplayCount>0;for(const{stateMask:n,objects:s}of i){if(a){for(const e of s)e.setVisible(!1);continue}const e=!(0!=(15&n))||(r&n)==(15&n),i=!(0!=(65520&n))||(this.state&n)==(65520&n);if(e&&i)for(const r of s)r.setVisible(!0),r.transformation=t;else for(const t of s)t.setVisible(!1)}Object(s["k"])(this._engineLayer)&&this._engineLayer.commit()}_ensureEngineResources(){if(Object(s["j"])(this._engineResources)){const e=Object(s["t"])(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach(({material:e})=>{i.has(e)||(t.push(e),i.add(e))});const r=(e,t)=>{const{geometry:i,material:r,transform:a}=t;Array.isArray(i)?i.forEach(t=>e.addGeometry(t,r,a)):e.addGeometry(i,r,a)},a=new Map;this._renderObjects.forEach(e=>{const t=new wt["a"]({castShadow:!1});r(t,e);const i=e.stateMask||0,n=a.get(i)||[];n.push(t),a.set(i,n)});const n=[];a.forEach((e,t)=>n.push({stateMask:t,objects:e})),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(s["j"])(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach(e=>{const t=Object(s["t"])(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)}),e.forEach(({objects:e})=>e.forEach(e=>{t.add(e),this.view._stage.add(e)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||Object(s["j"])(this._engineResources))return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;t.forEach(({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)}),r.forEach(e=>{const t=Object(s["t"])(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)}),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,At);return Object(N["x"])(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Object(N["k"])(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(nt["d"])(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(nt["m"])(t,t,this._worldFrame),Object(nt["m"])(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(s["k"])(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(Object(s["k"])(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function Rt(e){return 0!==e[12]||0!==e[13]||0!==e[14]}function Et(e,t,i){switch(e.viewingMode){case"local":return Object(nt["i"])(i),!0;case"global":{const r=Object(ft["e"])(e.renderCoordsHelper.spatialReference);return Object(B["A"])(t,0,Gt,0,r.radius),Object(B["c"])(Object(pt["f"])(Gt[1]),Object(pt["f"])(Gt[0]),i),!0}}}const Pt=Object(gt["g"])(),Tt=jt["e"].create(),Dt=jt["g"].create(),Ct=Object(mt["a"])(),At=Object(vt["b"])(),It=Object(vt["b"])(),kt=jt["f"].create(),Gt=Object(U["e"])(),zt=Object(U["e"])(),Lt=Object(U["e"])(),Vt=Object(U["e"])(),Ht=Object(U["e"])(),Ft=Object(U["e"])(),Ut=new ut["a"]({x:0,y:0,z:0,spatialReference:null});function Nt(e,t=4){const i=Object(j["d"])(e[0],e[1],e[2],e.length>3?e[3]:1),r=e[3]<1;return new ke({color:i,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t})}function Bt(e,t=4){const i=Object(j["d"])(e[0],e[1],e[2],4===e.length?e[3]:1);return new lt["a"]({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function qt(e,t,i,r){const a=Object(N["k"])(st["d"].get(),e,i),n=Wt(a,Object(N["h"])(st["d"].get(),r,a),i,st["a"].get());Object(nt["a"])(n,n);const s=Object(N["n"])(st["d"].get(),t,n);return Math.atan2(s[1],s[0])}function Wt(e,t,i,r){const a=Object(N["s"])(st["d"].get(),e),n=Object(N["s"])(st["d"].get(),t),s=Object(N["h"])(st["d"].get(),a,n);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=0,r[4]=n[0],r[5]=n[1],r[6]=n[2],r[7]=0,r[8]=s[0],r[9]=s[1],r[10]=s[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function Zt(e,t){const i=e.getViewForGraphic(t);return Object(s["k"])(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function Yt(e,t,i){const r=Zt(e,i);Object(s["k"])(r)?t.elevationAlignedLocation=r:Xt(t,i.geometry)}function Xt(e,t){if(Object(s["j"])(t))return;const i=Object(ct["a"])(t);Object(s["j"])(i)||(e.location=Object(ot["b"])(i))}var Qt=i("243f");function Jt(e,t=Object(b["d"])(e)){return"on-the-ground"!==t.mode&&!(Object(s["j"])(e.geometry)||!e.geometry.hasZ)}var Kt=i("8f1c");class $t{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof St&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(s["j"])(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}})}}function ei(e){const{view:t,graphic:i}=e,r=new Be({graphic:i}),a=ti(e,r),n=[a,ii(e,a.visualElement,r),t.maskOccludee(i),t.trackGraphicState(r)];return{visualElement:a.visualElement,remove:()=>Object(Qe["b"])(n).remove()}}function ti(e,t){const{view:i,graphic:r}=e,a=new se({view:i,geometry:ni(r)?r.geometry:null,elevationInfo:Object(b["d"])(r),attached:!1});F.visualElements.lineGraphics.shadowStyle.apply(a);const n=()=>{a.attached=t.displaying};F.visualElements.lineGraphics.outline.apply(a);const s=[t.watch("displaying",n),t.watch("isDraped",e=>a.isDraped=e),t.on("changed",()=>a.geometry=ni(r)?r.geometry:null),Object(Qe["a"])(a)];return n(),{visualElement:a,remove:()=>Object(Qe["b"])(s).remove()}}function ii(e,t,i){const{graphic:r,view:a}=e,n=[],s=Object(b["d"])(r),o="on-the-ground"===s.mode||!s.offset&&"absolute-height"!==s.mode,c=new $t,l=new Kt["a"]({view:a,extensionType:F.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});F.visualElements.pointGraphics.shadowStyle.apply(l);const h=Object(pt["f"])(F.visualElements.heightPlaneAngleCutoff),d=new ee["a"]({view:a,attached:!1,angleCutoff:h});F.visualElements.heightPlane.apply(d);let u=1,p=1;const g=()=>{if(c.update(e),!i.displaying||o&&(i.isDraped||!ni(r)||!r.geometry.hasZ))return t.laserlineEnabled=!1,l.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;{const e=4&c.grabbingState?F.visualElements.laserlineAlphaMultiplier:1;e!==u&&(u=e,F.visualElements.lineGraphics.shadowStyle.apply(t,e),F.visualElements.pointGraphics.shadowStyle.apply(l,e))}{const e=2&c.grabbingState?F.visualElements.laserlineAlphaMultiplier:1;e!==p&&(p=e,F.visualElements.heightPlane.apply(d,e))}ri(l,c),ai(e,t,d,c)};F.visualElements.zVerticalLine.apply(l),n.push(i.on("changed",g),i.watch("displaying",g),t.events.on("attachment-origin-changed",g),Object(Qe["a"])(l),Object(Qe["a"])(d));const f=[],m=()=>{Object(Qe["b"])(f).remove(),f.length=0,e.forEachManipulator(e=>f.push(e.events.on("grab-changed",g))),e.forEachManipulator(e=>f.push(e.events.on("select-changed",g))),g()};return m(),n.push(e.onManipulatorsChanged(m),Object(Qe["d"])(()=>Object(Qe["b"])(f))),Object(Qe["b"])(n)}function ri(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(s["k"])(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(s["k"])(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}function ai(e,t,i,r){if(r.numSelected>0){Object(N["x"])(si,0,0,0);let t=0;e.forEachManipulator((e,i)=>{1===i&&e.selected&&e instanceof St&&(Object(N["g"])(si,si,e.renderLocation),t++)}),t>0?(i.heightManifoldTarget=Object(N["f"])(si,si,1/t),i.attached=!0):i.attached=!1}else{const r=t.attachmentOrigin;Object(s["k"])(r)&&e.view.renderCoordsHelper.toRenderCoords(r,si)?(i.heightManifoldTarget=si,i.attached=!0):i.attached=!1}}function ni(e){return Object(s["k"])(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const si=Object(U["e"])();var oi=i("2e0f"),ci=i("002c");function li(e){const{view:t,graphic:i}=e,r=new Be({graphic:i}),a=[],n=di(e,r,a);return hi(e,r,a,n),a.push(t.trackGraphicState(r)),{visualElement:n,remove(){Object(Qe["b"])(a).remove()}}}function hi(e,t,i,r){const{view:a,graphic:n}=e,s=new Kt["a"]({view:a,extensionType:F.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});F.visualElements.zVerticalLine.apply(s);const o=new ee["a"]({view:a,intersectsLineInfinite:!0,attached:!1});F.visualElements.pointGraphics.shadowStyle.apply(o);const c=Object(pt["f"])(F.visualElements.heightPlaneAngleCutoff),l=new ee["a"]({view:a,attached:!1,angleCutoff:c});F.visualElements.heightPlane.apply(l);const h=Object(b["d"])(e.graphic),d=Q["a"].fromElevationInfo(h),u="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,p=new $t;let g=1,f=1;const m=()=>{p.update(e);const i=u&&(t.isDraped||!fi(n)||!n.geometry.hasZ);let c=!0;if(!i&&fi(n)){const e=n.geometry,t=Object(oi["e"])(n.geometry,a.elevationProvider,d,a.renderCoordsHelper);Object(N["x"])(bi,e.x,e.y,t),Object(B["y"])(bi,e.spatialReference,bi,a.renderCoordsHelper.spatialReference),s.setStartEndFromWorldDownAtLocation(bi),o.intersectsWorldUpAtLocation=bi}else c=!1;const h=2&p.grabbingState?F.visualElements.laserlineAlphaMultiplier:1;h!==g&&(g=h,F.visualElements.heightPlane.apply(l,h));const b=Object(W["k"])(mi);!i&&t.displaying&&r.calculateMapBounds(b)&&Object(B["y"])(Object(W["u"])(b,bi),a.spatialReference,bi,a.renderCoordsHelper.spatialReference)?(l.heightManifoldTarget=bi,l.attached=!0):l.attached=!1;const m=4&p.grabbingState?F.visualElements.laserlineAlphaMultiplier:1;m!==f&&(f=m,F.visualElements.pointGraphics.shadowStyle.apply(o,m));const v=c&&t.displaying&&!i;o.attached=v,s.attached=v};i.push(t.watch(["displaying","isDraped"],m),t.on("changed",m)),e.forEachManipulator(e=>{i.push(e.events.on("grab-changed",m))}),i.push(Object(Qe["a"])(o)),i.push(Object(Qe["a"])(s)),i.push(Object(Qe["a"])(l)),m()}function di(e,t,i){const{view:r,graphic:a}=e,n=new ci["a"]({view:r,geometry:fi(a)?a.geometry:null,elevationInfo:Object(b["d"])(a),attached:!1});return ui(e,n,t,i),i.push(Object(Qe["a"])(n)),n}function ui(e,t,i,r){const a=()=>t.attached=i.displaying;pi(e,t,i,r),F.visualElements.pointGraphics.outline.apply(t),r.push(Object(p["a"])(i,"displaying",a))}function pi(e,t,i,r){const{view:a,graphic:n}=e;let o=null;const c=()=>{Object(s["k"])(o)&&(o.remove(),o=null),i.isDraped&&fi(n)&&(o=gi(a,n.geometry,()=>{t.geometry=n.geometry}))},l=()=>{c(),t.geometry=fi(n)?n.geometry:null};r.push(i.on("changed",l),Object(Qe["d"])(()=>o)),l()}function gi(e,t,i){const r=e.elevationProvider.spatialReference;Object(B["t"])(t,bi,r);const a=bi[0],n=bi[1];return e.elevationProvider.on("elevation-change",e=>{Object(bt["k"])(e.extent,a,n)&&i()})}function fi(e){return Object(s["k"])(e.geometry)&&"point"===e.geometry.type}const bi=Object(U["e"])(),mi=Object(W["h"])();function vi(e){switch(Object(s["t"])(e.graphic.geometry).type){case"point":return li(e);case"polygon":case"polyline":return ei(e);default:return null}}const yi=[1,.5,0],Oi=128,_i=70,ji=80,wi=.02,xi=54,Mi=100,Si=Math.ceil(_i/3*2),Ri=160,Ei=.5,Pi=24,Ti=9,Di=Ri+30,Ci=Ri+53,Ai=60,Ii=23,ki=5*Math.PI/12,Gi=1*Math.PI/3,zi=10,Li=.2,Vi=30,Hi=53,Fi=.2,Ui=.3,Ni=200,Bi=3,qi=1e6;function Wi(e,t,i){const r=e.graphic,a=(e,i)=>t({action:e,graphic:r,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i((e,t,i)=>{const n=t.next(e=>("start"===e.action&&a("start",e),e)).next(Object(it["g"])(r)).next(e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e});return i.next(Object(it["i"])(r)).next(()=>{a("end",{screenDeltaX:0,screenDeltaY:0})}),n})}function Zi(e){if(Object(s["j"])(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],r=t[1];return Math.atan2(r[1]-i[1],r[0]-i[0])}class Yi{constructor(){this._available=!0}set location(e){this.forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this.forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this.forEachManipulator3D(t=>t.elevationInfo=e)}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D(t=>t.available=e)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(i=>{!t&&e(i)&&(t=!0)}),t}forEachManipulator3D(e){this.forEachManipulator((t,i)=>{t instanceof St&&e(t,i)})}}i("a978"),i("9250");function Xi(e,t){const i=Object(U["e"])(),r=Object(U["e"])();let a=!1;return n=>{if("start"===n.action){const r=Object(gt["j"])(n.screenStart,Object(gt["c"])(st["c"].get())),o=jt["g"].fromScreen(e.state.camera,r,sr);Object(s["k"])(o)&&(a=jt["f"].intersectRay(t,o,i))}if(!a)return null;const o=Object(gt["j"])(n.screenEnd,Object(gt["c"])(st["c"].get())),c=jt["g"].fromScreen(e.state.camera,o,sr);return Object(s["j"])(c)?null:jt["f"].intersectRay(t,c,r)?{...n,renderStart:i,renderEnd:r,plane:t,ray:c}:null}}function Qi(e,t,i,r=null,a=null){let n=null;return o=>{if("start"===o.action&&(n=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(gt["g"])(o.screenStart.x,o.screenStart.y),t,i,a),Object(s["k"])(n)&&Object(s["k"])(r)&&!Object(B["s"])(n,n,r)))return null;if(Object(s["j"])(n))return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(gt["g"])(o.screenEnd.x,o.screenEnd.y),t,i,a);return Object(s["k"])(c)?Object(s["k"])(r)&&!Object(B["s"])(c,c,r)?null:{...o,mapStart:n,mapEnd:c}:null}}function Ji(e,t,i,r=null,a=null){return Qi(e,i,Object(b["f"])(t,e,i),r,a)}function Ki(e,t,i,r=null,a=null){return Ji(e,i,Object(b["d"])(t),r,a)}function $i(e,t,i,r){const a=t.toMap(e.screenStart,{include:[i]});return Object(s["k"])(a)?Ki(t,i,a,r):null}function er(e,t){const i=ar,r=nr,a=jt["f"].create();e.renderCoordsHelper.worldUpAtPosition(t,i);const n=Object(N["h"])(a,i,Object(N["k"])(r,t,e.state.camera.eye));return Object(N["h"])(n,n,i),jt["f"].fromPositionAndNormal(t,n,a)}function tr(e,t,i){let r=null;const a=new it["a"];return a.next(Xi(e,er(e,t))).next(ir(e,t)).next(rr(e,i)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e}),e=>(r=null,a.execute(e),r)}function ir(e,t){const i=Object(U["e"])(),r=Object(N["q"])(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const a=Object(U["e"])(),n=Object(U["e"])(),s=a=>(Object(N["k"])(a,a,t),jt["j"].projectPoint(i,a,a),"global"===e.viewingMode&&Object(N["q"])(a)*Object(pt["s"])(Object(N["i"])(i,a))<.001-r&&Object(N["k"])(a,Object(N["f"])(a,i,.001),t),Object(N["g"])(a,a,t),a);return e=>(e.renderStart=s(Object(N["l"])(a,e.renderStart)),e.renderEnd=s(Object(N["l"])(n,e.renderEnd)),e)}function rr(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,t),a=i.fromRenderCoords(e.renderEnd,t);return Object(s["k"])(r)&&Object(s["k"])(a)?{...e,mapStart:r,mapEnd:a}:null}}const ar=Object(U["e"])(),nr=Object(U["e"])(),sr=jt["g"].create();class or extends Yi{constructor(e){super(),this._handles=new Ke["a"],this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=_i,this._updateAfterDrag=!1,this.events=new d["a"],this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map(({manipulator:t})=>e(t,1))}createGraphicDragPipeline(e,t,i){const r=t.graphic,a=Object(b["d"])(r),n=Object(s["t"])(r.geometry).spatialReference;return Wi(t,i,t=>this.createDragPipeline((i,r,a,n,s)=>t(i,e(i,r,a,n,s),a),a,n,r))}createDragPipeline(e,t,i,r){return Object(Qe["b"])(this._arrowManipulatorInfos.map(({manipulator:a},n)=>Object(it["e"])(a,(a,s,o,c,l)=>{const h=s.next(e=>({...e,manipulatorType:1})).next(Object(it["f"])(this._view,a.elevationAlignedLocation)).next(Ji(this._view,a.elevationAlignedLocation,t,i,r)).next(Object(it["d"])(a.location,this.angle+(n+1)*Math.PI*.5)).next(Object(it["c"])());e(a,h,o,c,l)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const r=this._radius/_i,a=xi*r,n=Math.sqrt(a*a*3/4),s=he["a"].createExtrudedTriangle(n,a/2,a/2,wi);he["a"].transformInPlace(s,Object(nt["u"])(st["a"].get(),Object(N["x"])(st["d"].get(),0,-n/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],e.radius=n/3*2*1.2;const o=Object(nt["i"])(st["a"].get());Object(nt["v"])(o,i*Math.PI/2);const c=Object(nt["i"])(st["a"].get());Object(nt["u"])(c,Object(N["x"])(st["d"].get(),0,Mi*r,0)),Object(nt["m"])(t,o,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(nt["i"])(st["a"].get());Object(nt["r"])(t,t,e,Object(U["g"])(0,0,1));const i=Object(nt["p"])(st["a"].get(),Object(N["x"])(st["d"].get(),this.displayScale,this.displayScale,this.displayScale)),r=Object(nt["i"])(st["a"].get());Object(nt["m"])(r,i,t);for(const a of this._arrowManipulatorInfos){const e=Object(nt["m"])(st["a"].get(),r,a.transform);a.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new St({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(U["g"])(0,0,1)}}),i={manipulator:t,transform:Object(vt["b"])()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),i}createMaterial(e=1){const t=O["a"].toUnitRGBA(x.main);return t[3]*=e,new lt["a"]({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}}class cr{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new it["a"],this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(s["k"])(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(Object(s["k"])(i)){const r={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(r)}}this._enabled=e}snap(e){const t=Object(s["k"])(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(s["k"])(t)&&Object(s["k"])(this.view)&&(t.z=Object(b["f"])(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return Object(s["k"])(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class lr extends Yi{constructor(e){super(),this._handles=new Ke["a"],this._snapToScene=new cr,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=_i,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const r=t.graphic,a=Object(b["d"])(r),n=Object(s["t"])(r.geometry).spatialReference;return Wi(t,i,t=>this.createDragPipeline((i,r,a,n,s)=>t(i,e(i,r,a,n,s),a),a,n,r))}createDragPipeline(e,t,i,r){const a=this._view;return Object(it["e"])(this._manipulator,(n,s,o,c,l)=>{const h=s.next(Object(it["f"])(a,n.elevationAlignedLocation)).next(Ji(a,n.elevationAlignedLocation,t,i,r)).next(this._snapToScene.createDragEventPipelineStep(a,t),this._snapToScene.next).next(e=>({...e,manipulatorType:1})).next(Object(it["c"])());e(n,h,o,c,l)})}_updateManipulatorTransform(){const e=Object(nt["p"])(st["a"].get(),Object(N["x"])(st["d"].get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new St({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(U["g"])(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=he["a"].createCylinderGeometry(wi,1,Oi,Object(U["g"])(0,0,1),Object(U["g"])(0,0,0)),t=Object(nt["p"])(Object(vt["b"])(),Object(U["g"])(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=ji*(this._radius/_i)}_createMaterial(e=1){const t=O["a"].toUnitRGBA(x.main);return t[3]*=e,new lt["a"]({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class hr extends Yi{constructor(e){super(),this._handles=new Ke["a"],this._radius=_i,this.events=new d["a"],this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){const r=Object(s["t"])(t.graphic.geometry).spatialReference;return Wi(t,i,t=>this.createDragPipeline((i,r,a,n,s)=>t(i,e(i,r,a,n,s),a),r))}createDragPipeline(e,t){const i=this._view;return Object(it["e"])(this._manipulator,(r,a,n,s,o)=>{const c=a.next(e=>({...e,manipulatorType:0})).next(tr(i,r.renderLocation,t)).next(Object(it["c"])());e(r,c,n,s,o)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/_i,t=F.zManipulator.height*e,i=F.zManipulator.coneHeight*e,r=F.zManipulator.coneWidth*e,a=F.zManipulator.width*e,n=[Object(U["g"])(0,0,0),Object(U["g"])(0,0,t)],s=he["a"].createTubeGeometry(n,a/2,16,!1),o=he["a"].createConeGeometry(i,r/2,16,!1),c=[Object(U["g"])(0,0,0),Object(U["g"])(0,0,t+i)],l=(e=>{const i=Object(vt["b"])();if(Object(nt["t"])(i,i,[0,0,t]),Object(nt["e"])(i,i,Math.PI/2),e){const t=1+2*e/r;Object(nt["s"])(i,i,[t,t,t])}return i})(0),h=(e,t)=>{const i=Object(_["a"])(F.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,F.zManipulator.color.a*e]},d=Nt(h(1,.25),1),u=Nt(h(1,0),1),p=Nt(h(.7,0),F.zManipulator.renderOccluded),g=Nt(h(.85,0),F.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:l,material:d,stateMask:1},{geometry:s,material:d,stateMask:1},{geometry:o,transform:l,material:u,stateMask:2},{geometry:s,material:u,stateMask:2},{geometry:o,transform:l,material:p,stateMask:1},{geometry:s,material:p,stateMask:1},{geometry:o,transform:l,material:g,stateMask:2},{geometry:s,material:g,stateMask:2}],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}createManipulator(){const e=new St({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=dr;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const r=Object(N["B"])(t.eye,i),a=t.computeRenderPixelSizeAtDist(r),n=Object(N["k"])(ur,i,t.eye);Object(N["s"])(n,n);const s=pr;this._view.renderCoordsHelper.worldUpAtPosition(dr,s);const o=Math.abs(Object(N["i"])(n,s)),c=Object(N["h"])(ur,n,s),l=Object(N["h"])(ur,c,s),h=Object(pt["d"])(o,.01,1),d=1-Math.sqrt(1-h*h)/h/t.fullWidth,u=this._radius/_i,p=F.zManipulator.width*u;Object(N["f"])(l,Object(N["s"])(l,l),(1/d-1)*r+a*p),e[12]-=ur[0],e[13]-=ur[1],e[14]-=ur[2]},this._manipulator=e,this.updateManipulator()}}const dr=Object(U["e"])(),ur=Object(U["e"])(),pr=Object(U["e"])();class gr extends Yi{constructor(e){super(),this._handles=new Ke["a"],this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:r,radius:a}=e;this._view=i,this.xyManipulation=new lr({tool:t,view:i,snapToScene:r,radius:a}),this.xyAxisManipulation=new or({tool:t,view:i,radius:a}),this.zManipulation=new hr({tool:t,view:i,radius:a}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator(e=>{this._handles.add(e.events.on("grab-changed",()=>this.updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(Qe["b"])([this.xyManipulation.createGraphicDragPipeline((t,i,r,a,n)=>e(0,t,i,r,a,n),t,i),this.xyAxisManipulation.createGraphicDragPipeline((t,i,r,a,n)=>e(1,t,i,r,a,n),t,i),this.zManipulation.createGraphicDragPipeline((t,i,r,a,n)=>e(2,t,i,r,a,n),t,i)])}createDragPipeline(e,t,i,r){return Object(Qe["b"])([this.xyManipulation.createDragPipeline((t,i,r,a,n)=>e(0,t,i,r,a,n),t,i,r),this.xyAxisManipulation.createDragPipeline((t,i,r,a,n)=>e(1,t,i,r,a,n),t,i,r),this.zManipulation.createDragPipeline((t,i,r,a,n)=>e(2,t,i,r,a,n),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,1)),this.xyAxisManipulation.forEachManipulator(t=>e(t,1)),this.zManipulation.forEachManipulator(t=>e(t,0))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator(e=>e.focused)||this.xyAxisManipulation.someManipulator(e=>e.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(n["a"])("esri-mobile"))return;const i=[];t.forEachManipulator(e=>i.push(e)),e.forEachManipulator(e=>i.push(e));const r=()=>{const t=[];this.xyAxisVisible?Object(s["k"])(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator(e=>t.push(e.disableDisplay())),this._handles.remove(fr),this._handles.add(t,fr)};for(const a of i)this._handles.add(a.events.on("focus-changed",r));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",r)),r()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=Object(s["k"])(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some(e=>"icon"===e.type)?Si:_i}}const fr="disable-xy-axis-display";var br=i("3cde");class mr extends Yi{constructor(e){super(),this._handles=new Ke["a"],this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return Wi(this._graphicState,e,e=>this.createDragPipeline(e))}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,r=Object(s["k"])(i.geometry)?i.geometry.spatialReference:null;return Object(it["e"])(this._manipulator,(a,n,s,o,c)=>{const l=n.next($i(c,t,i,r)).next(Object(it["b"])()).next(Object(it["c"])());e(a,l,s,o,c)})}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new br["a"]({graphic:t,view:e,selectable:!0,cursor:"move"})}}class vr{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class yr{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class Or{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let _r=class extends(d["a"].EventedMixin(v["a"])){constructor(e){super(e),this.graphics=new Je["a"],this.enableZ=!0,this.type="move-3d",this._toolHandles=new Ke["a"],this._handles=new Ke["a"],this.snappingPipeline=new rt["a"]}initialize(){this._toolHandles.add([this.graphics.on("change",()=>this._refreshManipulators())]),this._refreshManipulators()}destroy(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}reset(){}_refreshManipulators(){this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(e=>0===Object(Qt["a"])(e)).map(e=>new jr(e));e.length&&(this.createManipulators(e),this.createVisualElements(e),this._handles.add(e.map(e=>this.view.trackGraphicState(e.state))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new mr({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator(e=>this._handles.add(e.events.on("immediate-click",e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))),this._handles.add(t.manipulationXY.createDragPipeline((t,i,r,a)=>this.buildDragEventPipeline(e,0,t,i,r,a)))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new gr({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?gr.radiusForSymbol(e[0].graphic.symbol):_i});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(e=>{this._handles.add(e.events.on("immediate-click",i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()}))});const i=()=>this.updateMoveManipulation(e);for(const a of e)this._handles.add([a.state.on("changed",i),a.state.watch("displaying",i)]);const r=e[e.length-1];this._handles.add(r.state.on("changed",()=>this.updateMoveManipulationAngle(r))),this._handles.add(t.createDragPipeline((t,i,r,a,n)=>this.buildDragEventPipeline(e,t,i,r,a,n),Object(b["d"])(r.graphic),Object(s["t"])(r.graphic.geometry).spatialReference,r.graphic)),this.updateMoveManipulationAngle(r)}createVisualElements(e){for(const t of e){const i=t.graphic,r=vi({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(Qe["c"])()});t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof se&&this._handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this.updateMoveManipulation(e)}),t.state.watch("isDraped",()=>this.updateMoveManipulation(e))]),this._handles.add(r)}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>Zi(e.graphic.geometry)}updateMoveManipulation(e){const t=Object(Y["k"])(0,0,0,this.view.spatialReference);let i=0,r=!1;const a=this._moveManipulation;for(const n of e){if(!n.state.displaying)continue;const e=n.state.graphic;this.enableZ&&Jt(e)&&(r=!0);const a=n.geometryRepresentation instanceof se&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:Zt(this.view,e);Object(s["k"])(a)&&(t.x+=a.x,t.y+=a.y,t.z+=a.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,a.location=t,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=r):a.available=!1}buildDragEventPipeline(e,t,i,r,a,n){const s=[],o=[];let c=null,l=null;const h=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){const t=e[0].graphic;r=this.buildSnappingPipelineSteps(t,Object(b["d"])(t),r,a,n)}const d=r.next(t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(it["h"])(o),l=Object(it["j"])(o),this.emit("graphic-move-start",new vr(o)),this.destroyed))return null}return 0!==o.length?t:null}).next(e=>c(e)).next(e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),r=i.x-t.x,a=i.y-t.y;if(this.emit("graphic-move",new yr(r,a,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Or(o)),this.destroyed)return null;h()}});return a.next(e=>l(e)).next(()=>{if(this.emit("graphic-move-stop",new Or(o)),this.destroyed)return null;h()}),d}buildSnappingPipelineSteps(e,t,i,r,a){const n=e.geometry;if(Object(s["j"])(n)||"point"!==n.type)return i;const o=new tt["a"]({elevationInfo:t,pointer:a,geometry:new et["a"]($e["c"].fromGeometry(n,this.view.viewingMode),"point"),visualizer:new at["a"],excludeFeature:e}),c=this.snappingManager;return i.next(t=>{const i=n.clone();return i.z=Object(b["a"])(this.view,i,Object(b["d"])(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:o.coordinateHelper.fromPoint(i)}}).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:o,snappingManager:c,cancel:r}),this.snappingPipeline.next)}};Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],_r.prototype,"view",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],_r.prototype,"graphics",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],_r.prototype,"enableZ",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],_r.prototype,"snappingManager",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],_r.prototype,"type",void 0),_r=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],_r);class jr{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Be({graphic:e})}get graphic(){return this.state.graphic}}var wr=i("240c");let xr=class extends d["a"].EventedAccessor{constructor(e){super(e),this._vertexManipulatorMaterial=Nt(F.colorToVec4(F.reshapeManipulators.vertex.color),F.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Bt(F.colorToVec4(F.reshapeManipulators.vertex.outlineColor),F.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Bt(F.colorToVec4(F.reshapeManipulators.vertex.hoverOutlineColor),F.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Nt(F.colorToVec4(F.reshapeManipulators.edge.color),F.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Bt(F.colorToVec4(F.reshapeManipulators.edge.outlineColor),F.reshapeManipulators.edge.renderOccluded),this._selectedManipulatorMaterial=Nt(F.colorToVec4(F.reshapeManipulators.selected.color),F.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Bt(F.colorToVec4(F.reshapeManipulators.selected.outlineColor),F.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Bt(F.colorToVec4(F.reshapeManipulators.selected.hoverOutlineColor),F.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._handles=new Ke["a"],this._manipulatorHandles=new Ke["a"],this._manipulatorInfos=[],this._reshapeHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new rt["a"],this._snappingPipelineHandle=new rt["a"],this._vertexLaserLineVisualElement=null}initialize(){const e=new Be({graphic:this.graphic});this._graphicState=e,this._handles.add([e.watch("displaying",e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e}),this.view.trackGraphicState(e)])}destroy(){this._clear(),this._handles.destroy()}get inputGeometry(){return Object(s["k"])(this._reshapeHelper)?this._reshapeHelper.geometry:null}set inputGeometry(e){this._recreateManipulators(e)}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZ(){return this.tool.enableZ}get enableMoveGraphic(){return this.tool.enableMoveGraphic}removeSelectedVertices(){const e=this._manipulatorInfos.filter(e=>e.manipulator.selected&&"vertex"===e.handle.type);this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._moveManipulation=Object(s["e"])(this._moveManipulation),this._graphicMoveManipulation=Object(s["e"])(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=Object(s["e"])(this._reshapeHelper),this._numGrabbing=0,this._numDragging=0}_recreateManipulators(e=this.inputGeometry){if(this._clear(),Object(s["j"])(e))return;Object(s["e"])(this._reshapeHelper),this._reshapeHelper=new Dr($e["c"].fromGeometry(e,this.view.viewingMode),e.type);const t=Object(b["d"])(this.graphic);for(const i of this._reshapeHelper.editGeometry.components){for(const e of i.vertices)this._createPerVertexManipulator(e,t);for(const e of i.edges)this._createPerVertexManipulator(e,t)}this._createGraphicMoveManipulators(t)}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;const i=[],r=this._manipulatorInfos.some(e=>"vertex"===e.handle.type&&e.manipulator.selected),a=1===e&&r,n=Object(s["t"])(this._reshapeHelper);for(const c of this._manipulatorInfos)"vertex"===c.handle.type&&(c.manipulator.grabbing||a&&!c.manipulator.selected||(Object(s["t"])(n).moveVertices([c.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(c.handle.pos),this._updateManipulatorPosition(c)));if(0===i.length)return;let o=0;for(const s of this._manipulatorInfos)"vertex"===s.handle.type&&o++;if(this.outputGeometry=n.geometry,i.length===o){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)Sr(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const t=e.mapDeltaX,i=e.mapDeltaY,r=e.mapDeltaZ;if(!t&&!i&&!r)return;const a=[];for(const s of this._manipulatorInfos)Sr(s)&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&a.push(s);const n=Object(s["t"])(this._reshapeHelper);for(const s of a)n.moveVertices([s.handle],t,i,r);this.outputGeometry=n.geometry;for(const s of a)this._updateManipulatorPosition(s);this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){this._graphicMoveManipulation=new mr({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((e,t,i)=>{t.next(e=>this._trackNumDragging(e)).next(e=>{this._perGraphicManipulatorDragAction(0,e)}),i.next(this._cancelDragOperation())})):this._graphicMoveManipulation.forEachManipulator(e=>{e.grabbable=!1,e.cursor=null}),this._graphicMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})])),this._moveManipulation=new gr({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Jt(this.graphic),snapToScene:!1,radius:gr.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator(e=>{this._handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})])}),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=Object(s["t"])(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((t,i,r,a,n)=>{const o=r.next(e=>this._trackNumDragging(e)).next(e=>{const t=this._manipulatorInfos.filter(e=>Sr(e)&&e.manipulator.selected);return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}}).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new tt["a"]({geometry:Object(s["t"])(this._reshapeHelper),elevationInfo:e,pointer:n,excludeFeature:this.graphic,visualizer:new at["a"]})}),this._snappingPipelineHandle.next).next(Object(it["b"])()).next(e=>(this._perGraphicManipulatorDragAction(1,e),e));return a.next(this._cancelDragOperation()),o},e,t,this.graphic),Object(p["a"])(this._graphicState,"displaying",()=>{this._updateMoveManipulationPosition()}),this._graphicState.on("changed",()=>this._updateMoveManipulationPosition()),Object(p["a"])(this._graphicState,"isDraped",()=>{const e="align-move-manipulation";this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),e):this._handles.remove(e)})]),this._updateMoveManipulationPosition();const i=vi({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){Object(s["k"])(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});this._outlineVisualElement=i.visualElement instanceof se?i.visualElement:null,Object(s["k"])(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}),this._graphicState.watch("isDraped",()=>this._updateMoveManipulationPosition())]),this._manipulatorHandles.add(i)}_createPerVertexManipulator(e,t=Object(b["d"])(this.graphic)){if(Object(s["j"])(this._vertexManipulatorGeometry)||Object(s["j"])(this._vertexManipulatorOutlineGeometry)){const e=F.reshapeManipulators.vertex,t=e.size/2,i=t+e.collisionPadding,r=t/i;this._vertexManipulatorGeometry=he["a"].createSphereGeometry(r,16,16);const a=(t+e.outlineSize)/i;this._vertexManipulatorOutlineGeometry=he["a"].createSphereGeometry(a,16,16)}if(Object(s["j"])(this._edgeManipulatorGeometry)||Object(s["j"])(this._edgeManipulatorOutlineGeometry)){const e=F.reshapeManipulators.edge,t=e.size/2,i=t+e.collisionPadding,r=t/i;this._edgeManipulatorGeometry=he["a"].createSphereGeometry(r,16,16);const a=(t+e.outlineSize)/i;this._edgeManipulatorOutlineGeometry=he["a"].createSphereGeometry(a,16,16)}const i=new St({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Tr.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Tr.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Tr.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Tr.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Tr.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Tr.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Tr.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(i,e,t);const r="edge"===e.type?{manipulator:i,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:i,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(r),this.manipulators.add(i),this._updateManipulatorPosition(r),"edge"===r.type){const e=this._getManipulatorInfoFromHandle(r.handle.left).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(r)),t=this._getManipulatorInfoFromHandle(r.handle.right).manipulator.events.on("location-update",()=>this._updateManipulatorPosition(r));r.locationUpdateHandle=Object(Qe["b"])([e,t]),this._manipulatorHandles.add(r.locationUpdateHandle,i)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(i,!0),i);const a=Object(it["e"])(i,(e,i,a,n)=>{i.next(e=>this._trackNumDragging(e)).next(e=>{if(Rr(r)){const t=this._splitEdgeManipulator(r);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:r,snapOrigin:r.handle.pos}}).next(Object(it["f"])(this.view,e.elevationAlignedLocation)).next(Ki(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this.isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new tt["a"]({geometry:Object(s["t"])(this._reshapeHelper),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new at["a"]})}),this._snappingPipeline.next).next(Object(it["b"])()).next(e=>{this._perVertexManipulatorDragAction(e)}),a.next(this._cancelDragOperation())});return this._manipulatorHandles.add(a,i),this._manipulatorHandles.add([i.events.on("immediate-click",e=>this._manipulatorClickCallback(e,r)),i.events.on("select-changed",()=>{r.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})]),this.emit("manipulators-changed"),i}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(){const e=Object(s["k"])(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{switch(this._numDragging--,this.inputGeometry=e,this.outputGeometry=e,Object(s["k"])(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Tr.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=F.reshapeManipulators.vertex.size/2+F.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=Tr.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=F.reshapeManipulators.edge.size/2+F.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing})}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(s["t"])(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,Er),e.manipulator.grabbing&&Object(s["k"])(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,r=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(s["k"])(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const a=i.location,n=r.location,s=.5,o=a.x+s*(n.x-a.x),c=a.y+s*(n.y-a.y),l=a.hasZ&&n.hasZ?0:void 0;e.manipulator.location=Object(Y["k"])(o,c,l,t.geometry.spatialReference)}else Object(N["j"])(Pr,i.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=Pr}}_splitEdgeManipulator(e){const t=Object(s["t"])(this._reshapeHelper),i=Object(s["t"])(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const r=e;r.handle=i,r.type="vertex";const a=Object(b["d"])(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(r),this._updateSelection(e.manipulator);const n=this._updateEventState(2),o=t.editGeometry.coordinateHelper.toArray(r.handle.pos),c=t.editGeometry.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:c,vertexIndex:Object(s["t"])(i.index)}],added:o}),n&&this._updateEventState(0),r}_updateMoveManipulationPosition(){const e=st["d"].get();Object(N["x"])(e,0,0,0);let t=0,i=!1,r=null,a=null;for(const n of this._manipulatorInfos)Sr(n)&&(n.manipulator.selected?(t++,Object(N["g"])(e,e,n.manipulator.renderLocation),Object(s["j"])(r)||n.selectedIndex>r.selectedIndex?(a=r,r=n):(Object(s["j"])(a)||n.selectedIndex>a.selectedIndex)&&(a=n)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Jt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZ&&Jt(this.graphic)}if(0!==t){let e=0;if(Object(s["k"])(r)){const t=r.handle.pos,i=Object(s["k"])(a)?a.handle.pos:r.handle.left&&r.handle.left.left?r.handle.left.left.pos:null,n=!Object(s["k"])(a)&&r.handle.right&&r.handle.right.right?r.handle.right.right.pos:null;i&&n?this._moveManipulation.xyAxisManipulation.available=!1:i?e=Mr(i,t):n&&(e=Mr(t,n))}this._moveManipulation.angle=e,this._moveManipulation.radius=Si}else this._moveManipulation.angleDeferred=()=>Zi(Object(s["t"])(this.graphic.geometry)),this._moveManipulation.radius=gr.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(N["f"])(e,e,1/t),Er.spatialReference=Object(s["t"])(this._reshapeHelper).geometry.spatialReference,Er.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Er),this._moveManipulation.elevationAlignedLocation=Er):Object(s["k"])(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(s["k"])(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Yt(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(s["t"])(this._reshapeHelper);for(const r of e)if("vertex"===r.handle.type&&i.canRemoveVertex()){t.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.right));const e=Object(s["t"])(i.removeVertices([r.handle]).removedVertices[0].createdEdge);e&&this._createPerVertexManipulator(e)}if(t.length>0){const e=t.map(e=>{const t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(s["t"])(e.index)}});this.outputGeometry=i.geometry;const r=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map(e=>e.coordinates),vertices:e}),this.destroyed)return;if(r&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Rr(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function Mr(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Sr(e){return"vertex"===e.handle.type}function Rr(e){return"edge"===e.handle.type}Object(a["a"])([Object(l["b"])({constructOnly:!0})],xr.prototype,"tool",void 0),Object(a["a"])([Object(l["b"])()],xr.prototype,"inputGeometry",null),Object(a["a"])([Object(l["b"])()],xr.prototype,"outputGeometry",void 0),xr=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],xr);const Er=Object(Y["k"])(0,0,null,null),Pr=Object(U["e"])();var Tr;!function(e){e.Vertex=16,e.Edge=32}(Tr||(Tr={}));class Dr extends et["a"]{constructor(e,t){super(e,t),this.type=t,this._geometry=null}get geometry(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}let Cr=class extends(d["a"].EventedMixin(v["a"])){constructor(e){super(e),this._handles=new Ke["a"],this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingManager=null}destroy(){this._handles.removeAll(),this._reshapeOperation=Object(s["e"])(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=this.graphic.geometry;0!==Object(wr["a"])(this.graphic)||!Object(s["k"])(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==Object(wr["a"])(this.graphic))return;const e=this.watch("graphic.geometry",()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){Object(s["j"])(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new xr({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)}),this._reshapeOperation.on("move",e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)}),this._reshapeOperation.on("vertex-add",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)}),this._reshapeOperation.on("vertex-remove",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)}),this._reshapeOperation.on("immediate-click",e=>this.emit("immediate-click",e)),Object(p["a"])(this,"graphic",()=>{this._updateGraphic()},!0)])}beforeUndo(){Object(s["k"])(this.snappingManager)&&this.snappingManager.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],Cr.prototype,"view",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],Cr.prototype,"graphic",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],Cr.prototype,"enableZ",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],Cr.prototype,"enableMoveGraphic",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],Cr.prototype,"type",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0})],Cr.prototype,"snappingManager",void 0),Cr=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Cr);var Ar,Ir=i("4212"),kr=i("5815"),Gr=i("680b");!function(e){e.ScaleIn=32,e.ScaleOut=64,e.RotateLeft=128,e.RotateRight=256,e.Unlocked=1024,e.DelayedFocused=2048,e.TouchInput=32768}(Ar||(Ar={}));class zr{constructor(e){this.mode=null,this._handles=new Ke["a"],this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new d["a"],this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(s["k"])(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._scaleRotateDragData.scale:1,this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}destroy(){Object(s["k"])(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object(kr["a"])({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(s["k"])(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(it["e"])(e,(e,i,r)=>{this._scaleRotateDragData=null;const a=Vr(this.tool.view,t);if(Object(s["j"])(a))return this.updateDragState(),null;const n={mode:"none",origin:Object(U["d"])(e.renderLocation),angle:0,startAngle:this.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:a};this._scaleRotateDragData=n,this.updateDragState();const o=st["d"].get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next(Xi(this.tool.view,jt["f"].fromPositionAndNormal(e.renderLocation,o))).next(e=>{const i=jt["f"].normal(e.plane),r=qt(e.renderStart,e.renderEnd,n.origin,i),a=Gr["g"].shortestSignedDiff(n.angle,r);n.angleDir=Object(pt["d"])(n.angleDir+a,-Ui,Ui),n.angle=r;const o=Lr(n,e),c=o-n.scale;if(n.scaleDir=Object(pt["d"])(n.scaleDir+c,-Fi,Fi),n.scale=o,this.onScaleChanged(),"none"===n.mode){const i=this.mode||Hr(e,e.plane,n.origin,this.tool.view.state.camera);if(Object(s["k"])(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:Object(pt["q"])(n.angle)});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:n.scale,yScale:n.scale})}n.mode=i}}if(this.updateDragState(),Object(s["k"])(t.symbol)){const e=t.symbol.clone();let i=0,r=1;switch(n.mode){default:case"none":break;case"scale":r=n.scale;break;case"rotate":i=n.angle}this.applySymbolData(e,n.startSymbolData,i,r),t.symbol=e,this.updateManipulatorTransform()}switch(e.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(pt["q"])(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:n.scale,yScale:n.scale})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(pt["q"])(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:n.scale,yScale:n.scale});break;default:case"none":}}"end"===e.action&&(this.startAnimation(Ur(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null,this.updateDragState())}),r.next(Object(it["k"])(t)).next(()=>{if(Object(s["k"])(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(pt["q"])(this._scaleRotateDragData.startAngle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Ur(this,()=>this.onScaleChanged())),this._scaleRotateDragData=null}})});this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",e=>{"focus"===e.action?this.startAnimation(Nr(this,()=>this.updateDelayedFocusedState())):this.updateDelayedFocusedState()}),this.ringManipulator.events.on("immediate-click",e=>{e.stopPropagation()}),Object(p["a"])(this.tool.graphicState,"displaying",e=>this.ringManipulator.available=e),this.tool.graphicState.on("changed",()=>Yt(this.tool.view,this.ringManipulator,t))]),Yt(this.tool.view,this.ringManipulator,t)}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Ar.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Ar.Unlocked,!(Object(s["k"])(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(s["k"])(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Ar.ScaleIn|Ar.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Ar.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Ar.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Ar.RotateLeft|Ar.RotateRight,!1),this.ringManipulator.updateStateEnabled(Ar.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Ar.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Ar.ScaleIn|Ar.ScaleOut|Ar.RotateLeft|Ar.RotateRight,!1)}updateManipulatorTransform(){const e=Object(nt["i"])(st["a"].get()),t=this.tool.symbolRotationAngle;Object(nt["r"])(e,e,t,Object(U["g"])(0,0,1));const i=this.getScale(),r=Object(nt["p"])(st["a"].get(),Object(N["x"])(st["d"].get(),i,i,i)),a=Object(nt["i"])(st["a"].get());Object(nt["m"])(a,r,e),this.ringManipulator.modelTransform=a}createRingManipulator(){const e=(e,t,i)=>{const r=[],a=Math.ceil(Oi*(t-e)/(2*Math.PI));for(let n=0;n<a+1;n++){const s=e+n*(t-e)/a;r.push(Object(U["g"])(i*Math.cos(s),i*Math.sin(s),0))}return r},t=t=>e(0,2*Math.PI,t),i=e=>[[-e/2,0],[e/2,0],[e/2,Ei/2],[-e/2,Ei/2]],r=(e,t)=>he["a"].createPathExtrusionGeometry(i(t),e,[],[],!1),a=t(Ri),n=r(a,Pi),s={left:[],right:[]},o=[];for(let b=0;b<2;b++){const t=b*Math.PI-Math.PI/4,i=Math.PI/2-ki,a=t+i,n=t+Math.PI/2-i,c=e(a,n,Di),l=r(c,Ti);o.push(c),o.push(e(a,n,Ci-Pi/2)),s.left.push(l),s.right.push(l);for(let e=0;e<2;e++){const t=0===e,i=Object(vt["b"])();if(t){Object(nt["s"])(i,i,[1,-1,1]),Object(nt["r"])(i,i,-a,[0,0,1]);const e=Math.round(Li*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{Object(nt["r"])(i,i,n,[0,0,1]);const e=Math.round((1-Li)*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const r=he["a"].createExtrudedTriangle(Ai,0,Ii,Ei);he["a"].transformInPlace(r,i),(t?s.left:s.right).push(r)}}const c=[];for(let b=0;b<2;b++){const t=b*Math.PI-Math.PI/4,i=Math.PI/2-Gi,a=t+i,n=t+Math.PI/2-i,s=e(a,n,Ci);c.push(r(s,Ti))}const l=t(Ri+Vi),h=t(Ri+Hi),d=r(l,Ti),u=r(h,Ti),p=t(Ri-Vi),g=t(Ri-Hi),f=r(p,Ti),m=r(g,Ti),v=this.createMaterial(),y=this.createMaterial(.66),O=this.createMaterial(.5),_=this.createMaterial(.33);let j=[{geometry:n,material:v,stateMask:Ar.DelayedFocused},{geometry:n,material:O,stateMask:0}];this.mode&&"scale"!==this.mode||(j=j.concat([{geometry:c,material:v,stateMask:Ar.DelayedFocused|Ar.Unlocked},{geometry:d,material:y,stateMask:Ar.DelayedFocused|Ar.ScaleIn},{geometry:u,material:_,stateMask:Ar.DelayedFocused|Ar.ScaleIn},{geometry:f,material:y,stateMask:Ar.DelayedFocused|Ar.ScaleOut},{geometry:m,material:_,stateMask:Ar.DelayedFocused|Ar.ScaleOut}])),this.mode&&"rotate"!==this.mode||(j=j.concat([{geometry:s.right,material:v,stateMask:Ar.DelayedFocused|Ar.Unlocked},{geometry:s.left,material:v,stateMask:Ar.DelayedFocused|Ar.RotateLeft},{geometry:s.right,material:v,stateMask:Ar.DelayedFocused|Ar.RotateRight}]));const w=[a,...o];return new St({view:this.tool.view,renderObjects:j,autoScaleRenderObjects:!1,worldOriented:!0,radius:Pi,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(b["d"])(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:w,direction:Object(U["g"])(0,0,1)}})}createMaterial(e=1){const t=[...yi,e];return new lt["a"]({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}applySymbolData(e,t,i,r){e.symbolLayers.forEach((e,a)=>{const{heading:n,size:o}=t.symbolLayers[a];"object"===e.type&&(e.heading=(Object(s["k"])(n)?n:0)-Object(Ir["c"])(i),Object(s["k"])(o)&&"width"in o&&(o.width=this.enforceNonZeroSize(o.width),o.height=this.enforceNonZeroSize(o.height),o.depth=this.enforceNonZeroSize(o.depth),e.width=o.width*r,e.depth=o.depth*r,e.height=o.height*r))})}enforceNonZeroSize(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}get test(){return{ringManipulator:this.ringManipulator}}}function Lr(e,t){const i=Object(N["k"])(st["d"].get(),t.renderStart,e.origin),r=Object(N["k"])(st["d"].get(),t.renderEnd,e.origin),a=Object(N["q"])(i),n=Object(N["q"])(r);return 0===a?0:n/a}function Vr(e,t){const i=e.allLayerViews.find(e=>e.layer===t.layer);if(Object(s["j"])(t.symbol))return null;const r=t.symbol;return{symbolLayers:r.symbolLayers.map(e=>{let t=null,a=null;return"object"===e.type&&(t=e.heading),a=i.getSymbolLayerSize(r,e),{heading:t,size:a}}).toArray()}}function Hr(e,t,i,r){const{renderStart:a,renderEnd:n}=e,s=Fr(a,r,st["d"].get()),o=Fr(n,r,st["d"].get());if(Object(N["m"])(s,o)<zi*zi)return null;const c=Object(N["k"])(st["d"].get(),a,i),l=Object(N["h"])(st["d"].get(),c,t),h=a,d=Object(N["g"])(st["d"].get(),h,l),u=Fr(i,r,st["d"].get()),p=s,g=Fr(d,r,st["d"].get()),f=Object(N["k"])(st["d"].get(),g,p),b=Object(N["k"])(st["d"].get(),s,u),m=jt["g"].wrap(p,f),v=jt["g"].wrap(u,b);return jt["g"].distance2(m,o)<jt["g"].distance2(v,o)?"rotate":"scale"}function Fr(e,t,i){const r=t.projectToRenderScreen(e,Object(gt["a"])(Br)),a=t.renderToScreen(r,qr);return Object(N["x"])(i,a[0],a[1],0)}function Ur(e,t){let i=null,r=1;const a=()=>r;return{start:()=>{r=e.getScale(),i=e.getScale,e.getScale=a,t()},update:e=>(r+=((r+1)/2-r)*Math.min(e*Bi,1),t(),Math.abs(r-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}function Nr(e,t){let i=0,r=null;const a=()=>!1;return{start:()=>{r=e.getFocused,e.getFocused=a,i=0,t()},update:e=>(i+=e,!r()||i>Ni?1:0),destroy:()=>{e.getFocused=r,t()}}}const Br=Object(U["e"])(),qr=Object(gt["g"])();let Wr=class extends(d["a"].EventedMixin(v["a"])){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.handles=new Ke["a"],this.scaleRotate=null,this.snappingPipeline=new rt["a"]}initialize(){this.graphicState=new Be({graphic:this.graphic}),this.moveManipulation=new gr({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Jt(this.graphic),radius:gr.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator(e=>this.handles.add(e.events.on("immediate-click",e=>e.stopPropagation()))),this.moveManipulation.elevationInfo=Object(b["d"])(this.graphic);const e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((t,i,r,a,n)=>(Object(s["k"])(e)&&"point"===e.type&&0===t&&(r=r.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new tt["a"]({elevationInfo:Object(b["d"])(this.graphic),pointer:n,geometry:new et["a"]($e["c"].fromGeometry(e,this.view.viewingMode),"point"),visualizer:new at["a"],excludeFeature:this.graphic}),snappingManager:this.snappingManager,cancel:a}),this.snappingPipeline.next)),r),this.graphicState,e=>{const{action:t,graphic:i,dxScreen:r,dyScreen:a}=e,n={graphic:i,dxScreen:r,dyScreen:a};switch(t){case"start":this.emit("graphic-translate-start",n);break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n)}}),this.moveManipulation.angle=this.symbolRotationAngle,this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new zr({tool:this,mode:e}),this.handles.add(this.scaleRotate.events.on("scale-changed",()=>this.onScaleChanged()))}this.handles.add([vi({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Qe["c"])()}),this.graphic.watch("symbol",()=>this.updateMoveAngle()),this.graphicState.on("changed",()=>this.onGeometryChanged()),this.hideManipulatorsForGraphicState(),this.view.watch("scale",()=>this.updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(s["k"])(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",e=>{this.forEachManipulator(t=>t.available=e),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Jt(this.graphic)})}destroy(){this.handles.destroy(),this.moveManipulation.destroy(),this.scaleRotate=Object(s["e"])(this.scaleRotate),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get symbolRotationAngle(){const e=this.graphic.symbol;if(e){const t=e.symbolLayers.find(e=>"object"===e.type),i=t&&t.heading||0;return Object(Ir["d"])(-i)}return 0}reset(){}onDetach(){Object(s["k"])(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){Object(s["k"])(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(Object(s["j"])(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){"local"===this.view.viewingMode||this.view.scale<qi?this.moveManipulation.angle=this.symbolRotationAngle:this.moveManipulation.angle=0}onGeometryChanged(){Yt(this.view,this.moveManipulation,this.graphic)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:Object(s["k"])(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],Wr.prototype,"view",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],Wr.prototype,"graphic",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],Wr.prototype,"enableZ",void 0),Object(a["a"])([Object(l["b"])()],Wr.prototype,"enableRotation",void 0),Object(a["a"])([Object(l["b"])()],Wr.prototype,"enableScaling",void 0),Object(a["a"])([Object(l["b"])({value:!1})],Wr.prototype,"snapToScene",null),Object(a["a"])([Object(l["b"])({constructOnly:!0})],Wr.prototype,"snappingManager",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],Wr.prototype,"type",void 0),Wr=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Wr);var Zr=i("8048"),Yr=i("02f1"),Xr=i("1e2c"),Qr=i("04f0"),Jr=i("2047"),Kr=i("0278"),$r=i("3748");i("94e6");Object(n["a"])("mac");const ea=2,ta=1.15,ia=1.15,ra=1.1,aa=(Math.cos(Object(pt["f"])(45)),Math.cos(Object(pt["f"])(5)),.7),na=[1,.5,0],sa=[...na,1],oa=[1,1,1,1],ca=[1,.8,.6,1],la=[1,.93,.86,1],ha=[...na,1],da=[...na,1],ua=3,pa=11,ga=22.5,fa=40,ba=48,ma=2.25,va=4,ya=1,Oa=.3,_a=6,ja=4,wa=12,xa=40,Ma=27;var Sa=i("70a2"),Ra=(i("8675"),i("fa1e")),Ea=i("b04d");class Pa extends _e["a"]{initializeProgram(e){const t=Pa.shader.get().build();return new we["a"](e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),Ra["a"])}bindPass(e,t,i){Me["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}bindDraw(e){Me["a"].bindView(this.program,e)}initializePipeline(){return Object(xe["e"])({blending:Object(xe["f"])(1,1,771,771),depthTest:{func:513},colorWrite:xe["c"]})}}Pa.shader=new Oe["a"](Ea["a"],()=>i.e("chunk-2d0a47c1").then(i.bind(null,"0748")));ve["a"];class Ta extends be["a"]{constructor(e){super(e),this.technique=new Pa(this.techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(e){return 8===e}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t)}}Object(a["a"])([Object(Sa["c"])()],Ta.prototype,"technique",void 0);ve["b"];ue["a"];var Da,Ca=i("ad96"),Aa=i("7ffa"),Ia=i("1a3e"),ka=i("c6f7"),Ga=i("6a0e");let za=Da=class extends Ga["a"]{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new Da({position:Object(Aa["a"])(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(s["k"])(this.position)&&Object(s["k"])(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};Object(a["a"])([Object(l["b"])({readOnly:!0,json:{read:!1,write:!0}})],za.prototype,"type",void 0),Object(a["a"])([Object(l["b"])({type:ut["a"]}),Object(ka["a"])()],za.prototype,"position",void 0),Object(a["a"])([Object(l["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ka["a"])(),Object(Ia["a"])(e=>Gr["f"].normalize(Object(c["i"])(e),0,!0))],za.prototype,"heading",void 0),Object(a["a"])([Object(l["b"])({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ka["a"])(),Object(Ia["a"])(e=>Gr["f"].normalize(Object(c["i"])(e),0,!0))],za.prototype,"tilt",void 0),Object(a["a"])([Object(l["b"])({type:Number,nonNullable:!0}),Object(ka["a"])()],za.prototype,"width",void 0),Object(a["a"])([Object(l["b"])({type:Number,nonNullable:!0}),Object(ka["a"])()],za.prototype,"height",void 0),za=Da=Object(a["a"])([Object(h["a"])("esri.widgets.Slice.SlicePlane")],za);o["a"].getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function La(e,t){return Wt(e.basis1,e.basis2,e.origin,t)}function Va(e,t,i,r){const a=t.worldUpAtPosition(e.origin,st["d"].get()),n=st["d"].get();switch(i){case 1:Object(N["l"])(n,a);break;case 2:Object(N["l"])(n,e.basis1)}return jt["f"].fromPositionAndNormal(e.origin,n,r)}function Ha(e,t,i,r){const a=Object(N["q"])(r.basis1),n=Object(N["q"])(r.basis2),s=Na(r),o=Ba(r),c=Object(N["x"])(st["d"].get(),0,0,0);Object(N["g"])(c,Object(N["f"])(st["d"].get(),r.basis1,t.direction[0]),Object(N["f"])(st["d"].get(),r.basis2,t.direction[1])),Object(N["g"])(c,r.origin,c);let l=0,h=1;if(qa(t))1===t.direction[0]&&-1===t.direction[1]?l=tn:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;l=1===e?tn:0,h=(1===e?n:a)-s}const d=Object(nt["i"])(st["a"].get());Object(nt["g"])(d,d,l),Object(nt["s"])(d,d,Object(N["x"])(st["d"].get(),h,h,h)),Object(nt["m"])(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}function Fa(e,t,i,r){const a=r.worldUpAtPosition(i.origin,st["d"].get()),n=Ua(i,0),s=Object(nt["i"])(st["a"].get());Object(nt["g"])(s,s,n.edge*Math.PI/2),Object(nt["e"])(s,s,-Ka(i,a)),Object(nt["m"])(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position}function Ua(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(N["g"])(st["d"].get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(N["g"])(st["d"].get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(N["k"])(st["d"].get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(N["k"])(st["d"].get(),e.origin,e.basis2),edge:t}}}function Na(e){const t=Object(N["q"])(e.basis1),i=Object(N["q"])(e.basis2);return Oa*Math.min(t,i)}function Ba(e){return Na(e)}function qa(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Wa(e,t=1){const i=0===t?fa:0,r=[Object(U["g"])(i,0,-ba/2),Object(U["g"])(i,0,ba/2)],a=Ja(r,!0),n=(e,t)=>Xa(r,r,{tubeRadius:ua,tipRadius:pa,tipLength:ga,tubeFocusMultiplier:ta,tipFocusMultiplier:ia,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),s=n(0,!1),o=n(ma,!0),c=new lt["a"]({color:oa,cullFace:2,renderOccluded:16}),l=new lt["a"]({color:ca,cullFace:2,renderOccluded:16}),h=new lt["a"]({color:la,cullFace:2,renderOccluded:16}),d=new lt["a"]({color:da,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),u=he["a"].createPolylineGeometry([[i,0,0],[i-fa,0,0]]),p=he["a"].createPolylineGeometry([[i,0,0],[i-fa,0,0]]),g=new $r["a"]({color:ha,renderOccluded:4});return new St({view:e,renderObjects:[...s.normal.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:h,transform:i,stateMask:1|$a})),...o.normal.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:1|$a})),{geometry:u,material:g,stateMask:1|$a|en},...s.focused.map(({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:h,transform:i,stateMask:2|$a})),...o.focused.map(({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:2|$a})),{geometry:p,material:g,stateMask:2|$a|en}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[a]},collisionPriority:1,radius:pa,state:$a})}function Za(e,t){const i=new Ca["a"]({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),r=xa,a=Ma,n=a*ra,s=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new Kr["a"]([["position",{size:3,data:[r-e,-e,0,r+e,-e,0,r+e,e,0,r-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=he["a"].createPolylineGeometry([[0,0,0],[r-a,0,0]]),c=he["a"].createPolylineGeometry([[0,0,0],[r-n,0,0]]),l=new $r["a"]({color:sa,renderOccluded:4}),h=[{geometry:s(a),material:i,stateMask:1|$a},{geometry:o,material:l,stateMask:1|$a},{geometry:s(n),material:i,stateMask:2|$a},{geometry:c,material:l,stateMask:2|$a}];return new St({view:e,renderObjects:h,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},collisionPriority:1,radius:a/2,state:$a})}function Ya(e,t){const i=qa(t),r=i?[Object(U["g"])(1,0,0),Object(U["g"])(0,0,0),Object(U["g"])(0,1,0)]:[Object(U["g"])(1,0,0),Object(U["g"])(-1,0,0)],a=he["a"].createPolylineGeometry(r),n=[...na,1],s=e=>new J["a"]({color:n,width:e,renderOccluded:4}),o=()=>new $r["a"]({color:n,renderOccluded:4}),c=i?va:ya,l=c*ea,h=ya,d=e=>e>1?s(e):o(),u=[{geometry:a,material:d(c),stateMask:1|rn},{geometry:a,material:d(l),stateMask:2|rn},{geometry:a,material:d(h),stateMask:an}],p=new St({view:e,renderObjects:u,collisionType:{type:"line",paths:[r]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?_a:ja,idHint:i?1:2});return p.state=rn,p}function Xa(e,t,i){const r=r=>{const a=(r?t:e).slice(0),n=Object(N["k"])(st["d"].get(),a[0],a[1]);Object(N["s"])(n,n);const o=Object(N["k"])(st["d"].get(),a[a.length-1],a[a.length-2]);if(Object(N["s"])(o,o),i.padding>0){const e=Object(N["f"])(Object(U["e"])(),o,-i.padding);if(a[a.length-1]=Object(N["g"])(e,e,a[a.length-1]),i.bothEnds){const e=Object(N["f"])(Object(U["e"])(),n,-i.padding);a[0]=Object(N["g"])(e,e,a[0])}}const c=r?i.tipFocusMultiplier:1,l=i.tipLength*(i.focusTipLength?c:1),h=i.tipRadius*c,d=Object(nt["i"])(st["a"].get());if(i.padding>0){const e=l/4,t=Object(N["x"])(st["d"].get(),0,e,0),r=1+i.padding/e;Object(nt["t"])(d,d,t),Object(nt["s"])(d,d,Object(N["x"])(st["d"].get(),r,r,r)),Object(nt["t"])(d,d,Object(N["f"])(t,t,-1/r))}const u=Object(nt["i"])(Object(vt["b"])()),p=Object(U["g"])(0,1,0),g=Object(nt["q"])(Object(vt["b"])(),Object(Qr["f"])(st["b"].get(),p,o));g[12]=a[a.length-1][0],g[13]=a[a.length-1][1],g[14]=a[a.length-1][2],Object(nt["m"])(g,g,d);const f=[{part:"tube",geometry:Qa(i.tubeRadius*(r?i.tubeFocusMultiplier:1)+i.padding,i.flat,a),transform:u}];let b,m;if(Object(s["k"])(i.flat)?b=he["a"].createExtrudedTriangle(l,h,h,i.flat.thickness):(b=he["a"].createConeGeometry(l,h,24,!1,!1,!0),m=he["a"].createConeGeometry(l,h,24,!1,!0,!1)),f.push({part:"tip",geometry:b,transform:g}),m&&f.push({part:"cap",geometry:m,transform:g}),i.bothEnds){const e=Object(nt["q"])(Object(vt["b"])(),Object(Qr["f"])(st["b"].get(),p,n));e[12]=a[0][0],e[13]=a[0][1],e[14]=a[0][2],Object(nt["m"])(e,e,d),f.push({part:"tip",geometry:b,transform:e}),m&&f.push({part:"cap",geometry:m,transform:e})}return f};return{normal:r(!1),focused:r(!0)}}function Qa(e,t,i){const r=[];if(Object(s["k"])(t))r.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const a=i/t*2*Math.PI;r.push([Math.cos(a)*e,Math.sin(a)*e])}}return he["a"].createPathExtrusionGeometry(r,i,[],[],!1)}function Ja(e,t){const i=Object(N["k"])(Object(U["e"])(),e[e.length-1],e[e.length-2]);if(Object(N["s"])(i,i),Object(N["f"])(i,i,wa),Object(N["g"])(i,i,e[e.length-1]),t){const t=Object(N["k"])(Object(U["e"])(),e[0],e[1]);return Object(N["s"])(t,t),Object(N["f"])(t,t,wa),Object(N["g"])(t,t,e[0]),[t,...e,i]}return[...e,i]}function Ka(e,t){return Object(Jr["b"])(t,e.basis2,e.basis1)+tn}const $a=16,en=32,tn=(jt["g"].create(),Math.PI/2),rn=16,an=32;var nn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAK4UExURUdwTP9+AP9tAP9+AP99AP9VAP99AP99AP9+AP9+AP99AP99AP98AP8AAP99AP/9/P+ABf9/Af/Jlf////9/AP9/AP99AP9xAP9/AP94AP9+AP9+AP/16//38f9/AP97AP99AP99AP99AP9zAP9+AP9/AP/o0v/w4v+IE//PoP/59f+DCf99AP98AP+EC/+eQP/kyf/27//at/+VLf/59f+WL//8+/+LHP9+AP9/AP99AP/38P/nz//48/+dPv/7+P/NnP+HEf/8+v/9/f/8+//ewf+SKv/WsP+MHv98AP/27//17P/hxf++f//27v9+AP99AP+1bP98AP9+AP/o0/9+AP+BB/97AP/QpP98AP+uYP9/AP+AA/+QJP+rWP/q1v/Fjf+fQf/hx//Onv/fwP/9/P99AP/ev/+kTP+KGP+vYv/s2v9/AP+oU/+1b/98AP98AP96AP97AP9+AP9/AP9/AP96AP9/AP99AP/Ztf+rW/+mUP98AP+1b//48v/38f98AP+cO//38P99AP/nz//Pov99AP/HkP+fQ/+tX/99AP/69//v4P+6eP/DiP/z6P+TK/+JFv+EDf/s2//lzP+8ev96AP+8ff+YNP9/AP/Tqv+iSf96AP+tXv9/AP/Lm/98AP/lzP/Uq/+tXf/9/P/06f/Hk/+9fv/u3f/Klv/Spf+oVv+za/+jSv/Lmf/q1f/Gjv+1bf/69//Sp/+bOv/PoP+3c//z5/9/AP/Ikv/r1/+hRv/FjP/Mmv+ZN//06v/59P/69f/q1v/x5P9/AP+PI/+3cf/9+//8+v+gRP/16//o0//Ztf+nUv/17P/Hkf/ixv/s2v/59P/48//Di/+lT//ky//hxf/Wrv+oVf/u3f/w4//Wrf+5dv/gxP/7+f/z6P/dvP+6d//u3v+aOP/r2f/r2f///9a+uZsAAADndFJOUwB9B29qA1OAd38/RykBeP6BgLX+KhJ2CQgRdWHt8zpGOUVmC2sK2uaFu/aCQS+DktPwyIz3jfyHZz5o8tf1kvq4hPz+/c6LxIhi8e/RqvBjfKJaedtbgki8K54GgYqb3bGT0rnN/XDNloae30CZpFJUG0BlGhgZUjPHnJgto/PyUJHxUdi8dLKTnU/55aev64yGg+DWqDipjizAlTCdArgx1cCc/Ou0quG1vZqilrfcsaP4vpC6peoos96UsLeP7PX33OcyiaT8+5Tu2saY7rPR4Pb0sJfV0MKZ4ufBptD66sun4pDf3qyDniQAAAO+SURBVFjDpVf1WxRBGF7gYO64A+5OJKU7lFRaSlLARlBpsEVFwu7u7u7u7u7ubt1/w7vZPXZmd/bYffx+geed731vZme+oigR83NsGBNvpbSwUFrF29g6+lGybKxaoQKYqRTqRqlsS09/QDR/T0sJdOdwJRA15Ujntvgd3YBZU661M0dv3wO0aXntxfkaeyDB+mwQodv1BxJNTTyGtQ2QbDbWBH4/02qMBIXeQoVZrYt/h0vZA/8U3PmHtvs0SIKCF84v5Vbe0XQl/GfTgejAoKDFgY/nDSUpTMbun7u/zl1o+lUc6BrdneasQ06EQMDeFRFA3s97I2FIpAONm0OBQMKd49/m0OCXRvfd92iB1W3U8hQ2t8aPEwfq2T3TBFu1Hhdwc2EFwjlMt4d1vsH8meYR245TyO+KK9iy8Y/E70+TrwdN/wp5km6AVpSXBJnQpCo8NJn84IlAI1p/7UU5Au+6yaJP4zAFbyig4IBR3HZjyzDXwlgG3oHnKJj/EOA58sl+4OeNiGLgSgxtNgioAfaIuJt/gyucZhQ8gvkPGjlBVU30249R3ViFEbxrP8TIz0GxREP+V/FfmG75hy/6z18rvtfzFkKgQEoxmu0DKEfpaaQTEx53UUxDjZQuAPZCgQL8LY2RIZCbAT8jCrVQvjIEQF+4hWwEGUcNliOwEwpMQRArSilHoBAKXEYQJ8pCjsAJKKBHkJ7yBIZDgRpMQNYR1kCBC9gRZH3EK1DgLPYRZV1jNRQ4gl2jjIoIdFON/NSVCDSaasB9hr3+s0VUoBfcQCAKJWDBpK2v/kbTyaICFVDgKB5MaDj/rjM6ZA4wu4GMGDyc0YQCIqHLtXQif1gRXK1FsXg8pYFRTBFYrSXww5hIynyAgj4GgUYUqGWyWVaxMJswu6MnYGgTL62DuJmM28U7PH72frbmBQvSOlZYwGE2paYcR7sMrT6Uge8vIBQWSywclppq4cOQqyw042CRKdWvI5U2tLgaLI2rpvnJQ3KyZidxpeIZsbhSznh7uy+VJtuiJTh/rqm8U9vxhUnniPxbl3gftiPXouTxrjztpIAeqteKtzhok8VY2Rm8R1m2Lddsk0WoT7oBp44xd3f9UclEnfBlavBGUU0uZp3nx4SRI8uH3+pOB7JM0OoizbYUIzTb1NaF0vmjrYkTh5dEuspHbOQ5L6lI9CkVH5pc3dvmu7v+39g3vq3B0cXWzDmcbF0kzK4DvRVkusJ7oNTxudkrkT98J/o0yRvgAzQJNr7M+O/bkqAJEPP7B6FvZpCHDcaFAAAAAElFTkSuQmCC",sn=nn;class on{constructor(){this.lastDragEvent=null,this.next=new it["a"],this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(s["k"])(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const t=qa(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}var cn=i("34f2"),ln=i("157c"),hn=i("e1e0"),dn=i("fbd0");function un(e,t){return gn(e,t,!1)}function pn(e,t){return gn(e,t,!0)}function gn(e,t,i){if(e instanceof cn["b"]){if(e.operation instanceof ln["a"])return fn(e.operation,t,i),!0;if(e.operation instanceof hn["a"])return bn(e.operation,t,i),!0;if(e.operation instanceof dn["a"])return mn(e.operation,t,i),!0}return!1}function fn(e,t,i=!1){const r=i?-1:1,a=Object(U["g"])(r*e.dx,r*e.dy,r*e.dz);Object(N["g"])(t.origin,t.origin,a)}function bn(e,t,i=!1){const r=i?-e.angle:e.angle;Object(N["e"])(t.basis1,t.basis1,U["b"],r),Object(N["e"])(t.basis2,t.basis2,U["b"],r)}function mn(e,t,i=!1){const r=i?1/e.factor1:e.factor1,a=i?1/e.factor2:e.factor2;Object(N["f"])(t.basis1,t.basis1,r),Object(N["f"])(t.basis2,t.basis2,a),vn(t.origin,e.origin,e.axis1,r),vn(t.origin,e.origin,e.axis2,a)}function vn(e,t,i,r){const a=st["c"].get(),n=Object(Ot["d"])(a,e,t),s=Object(Ot["a"])(a,i,Object(Ot["g"])(i,n));Object(Ot["p"])(e,e,s,r-1)}function yn(e,t,i,r){r||(r=jt["b"].create());const a=Object(Ot["s"])(st["c"].get(),e[1],-e[0]),n=Object(Ot["s"])(st["c"].get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(Ot["s"])(st["c"].get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=st["c"].get();t.components.forEach(t=>t.vertices.forEach(t=>{const i=t.pos;Object(Ot["s"])(o,Object(Ot["g"])(e,i),Object(Ot["g"])(a,i)),Object(Ot["u"])(n,n,o),Object(Ot["v"])(s,s,o)}));const c=1e-6,l=Object(Ot["s"])(st["c"].get(),s[0]-n[0]<c?i/2:0,s[1]-n[1]<c?i/2:0);return Object(Ot["d"])(n,n,l),Object(Ot["h"])(s,s,l),Object(Ot["a"])(r.basis1,e,(s[0]-n[0])/2),Object(Ot["a"])(r.basis2,a,(s[1]-n[1])/2),Object(Ot["s"])(r.origin,n[0]*e[0]+n[1]*a[0],n[0]*e[1]+n[1]*a[1]),Object(Ot["h"])(r.origin,r.origin,r.basis1),Object(Ot["h"])(r.origin,r.origin,r.basis2),r}function On(e,t,i,r=0,a){a||(a=jt["b"].create()),t.toRenderCoords(e.origin,i,a.origin);const n=st["d"].get();Object(N["g"])(n,e.origin,e.basis1),Object(N["g"])(n,n,e.basis2),t.toRenderCoords(n,i,n);const s=st["d"].get();Object(N["g"])(s,e.origin,e.basis1),Object(N["k"])(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=st["d"].get();Object(N["k"])(o,e.origin,e.basis1),Object(N["k"])(o,o,e.basis2),t.toRenderCoords(o,i,o);const c=st["d"].get();Object(N["k"])(c,e.origin,e.basis1),Object(N["g"])(c,c,e.basis2),t.toRenderCoords(c,i,c);const l=Object(N["j"])(st["d"].get(),n,s,.5);Object(N["k"])(l,l,a.origin);const h=Object(N["j"])(st["d"].get(),o,c,.5);Object(N["k"])(h,a.origin,h),Object(N["j"])(a.basis1,l,h,.5);const d=Object(N["j"])(st["d"].get(),c,n,.5);Object(N["k"])(d,d,a.origin);const u=Object(N["j"])(st["d"].get(),s,o,.5);Object(N["k"])(u,a.origin,u),Object(N["j"])(a.basis2,d,u,.5);const p=Object(N["h"])(st["d"].get(),a.basis1,a.basis2),g=Object(N["h"])(p,p,a.basis1);return Object(N["s"])(g,g),Object(N["f"])(a.basis2,g,Object(N["i"])(a.basis2,g)),Object(N["f"])(a.basis1,a.basis1,1+r/Object(N["q"])(a.basis1)),Object(N["f"])(a.basis2,a.basis2,1+r/Object(N["q"])(a.basis2)),jt["b"].updateUnboundedPlane(a),a}let _n=class extends(d["a"].EventedMixin(v["a"])){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new on,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new Ke["a"],this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=jt["b"].create(),this.mapBoundsStart=jt["b"].create(),this.displayBounds=jt["b"].create(),this.displayBoundsStart=jt["b"].create(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new Be({graphic:this.graphic});const e=this.graphic.geometry;this.reshapeHelper=new Dr($e["c"].fromGeometry(e,this.view.viewingMode),e.type),this.graphicMoveManipulation=new mr({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=Wa(this.view,0),this.moveZManipulator.state|=en,this.handles.add(this.watch("enableZ",()=>this.updateManipulatorAvailability(this.moveZManipulator,0))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map(e=>{const t=Ya(this.view,e);return this.handles.add(this.watch("enableScaling",()=>this.updateManipulatorAvailability(t,2))),t.events.on("grab-changed",e=>this._onResizeGrab(e)),this.handles.add(this._createResizeDragPipeline(t,e)),t}),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new Xr["a"](sn,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=Za(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",()=>this.updateManipulatorAvailability(this.rotateManipulator,3))),this.rotateManipulator.events.on("grab-changed",e=>{this._onRotateGrab(e)}),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);const t=vi({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Qe["c"])()});this.outlineVisualElement=t.visualElement instanceof se?t.visualElement:null,Object(s["k"])(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",()=>this.updateDisplayBounds(this.mapBounds))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",()=>this.onGeometryChanged()),this.graphicState.watch("displaying",()=>this.updateAllManipulatorAvailability()),Object(p["a"])(this.graphicState,"isDraped",()=>this.graphicDrapedChanged()),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",()=>this.updateDisplayBounds(this.mapBounds)));const r=e=>{this.handles.add(e.events.on("grab-changed",()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()}))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r);const a=(e,t)=>{this.handles.add(e.events.on("immediate-click",e=>{1===t&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))};this.forEachManipulator(a),this.graphicMoveManipulation.forEachManipulator(a),this.onGeometryChanged(),this.updateAllManipulatorAvailability()}graphicDrapedChanged(){this.handles.remove(jn),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",e=>{Object(s["k"])(this.attachmentOrigin)&&Object(bt["k"])(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds(this.mapBounds)}),jn)}updateAllManipulatorAvailability(){this.forEachManipulator((e,t)=>this.updateManipulatorAvailability(e,t))}updateManipulatorAvailability(e,t){const i=this.graphicState.displaying,r=this.grabbing&&!e.grabbing;e.interactive=!r;const a=this.enableZ&&Jt(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||a),e.interactive=!r&&this.enableScaling,e.state=this.enableScaling?rn:an;break;case 0:e.available=i&&a;break;default:e.available=i}}forEachManipulator(e){this.resizeManipulators.forEach(t=>e(t,2)),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.reshapeHelper.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds(this.mapBounds)}calculateMapBounds(){const e=this.graphic.geometry,t=this.reshapeHelper.editGeometry,i=t.components[0].edges[0],r=Object(Ot["d"])(st["c"].get(),i.left.pos,i.right.pos);Object(Ot["e"])(r,r);const a=Object(s["u"])(Zt(this.view,this.graphic),e.extent.center);let n=xn*this.view.pixelSizeAt(a);const o=this.view.spatialReference;o!==e.spatialReference&&(n*=Object(Zr["e"])(o)/Object(Zr["e"])(e.spatialReference)),yn(r,t,n,this.mapBounds)}updateDisplayBounds(e){const t=this.graphic.geometry,i=Object(s["k"])(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(s["k"])(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Zt(this.view,this.graphic);this.attachmentOrigin=Object(s["u"])(i,t.extent.center);const r=Object(s["k"])(i)?i.z:Object(oi["e"])(e.origin,this.view.elevationProvider,Q["a"].fromElevationInfo(Object(b["d"])(this.graphic)),this.view.renderCoordsHelper),a=jt["b"].copy(e);Object(N["x"])(a.origin,e.origin[0],e.origin[1],r),On(a,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.focus.location:this.reshapeHelper.geometry.extent.center;return wn*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline((e,t,i)=>this.applyGraphicMoveSteps(t,i))}_createMoveZDragPipeline(){const e=this.view,t=this.reshapeHelper.geometry.spatialReference;return Object(it["e"])(this.moveZManipulator,(i,r,a)=>{const n=Object(U["d"])(i.renderLocation),s=r.next(tr(e,n,t)).next(Object(it["c"])());this.applyGraphicMoveSteps(s,a)})}applyGraphicMoveSteps(e,t){const i=e.next(e=>("start"===e.action&&(this.inputState={type:"move"},jt["b"].copy(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e)).next(Object(it["b"])()).next(this._moveDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e});return t.next(()=>{Object(s["k"])(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()}),i}_moveDragUpdateGeometry(){return e=>{if(Object(s["j"])(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const a of this.reshapeHelper.editGeometry.components)t.push(...a.vertices);const i="start"===e.action?0:1,r=this.reshapeHelper.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i);return un(r,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);jt["f"].intersectRay(this.displayBounds.plane,t,st["d"].get())&&(jt["b"].copy(this.displayBounds,this.displayBoundsStart),jt["b"].copy(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return Object(it["e"])(e,(e,i,r)=>{Object(s["j"])(this.inputState)||(i.next(e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e)).next(Xi(this.view,this.displayBoundsStart.plane)).next(e=>({...e,handle:t})).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e}),r.next(()=>{Object(s["k"])(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()}))})}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,r=this.displayBoundsMargin(),a=this.displayBoundsMarginStart,n=Object(N["l"])(st["d"].get(),t.origin);Object(N["d"])(n,n,t.basis1,-i[0]),Object(N["d"])(n,n,t.basis2,-i[1]);const s=Object(N["k"])(st["d"].get(),e.renderEnd,n),o=Object(N["k"])(st["d"].get(),e.renderStart,n),c=qa(e.handle),l=Ba(t),h=Ba(this.displayBounds)/l,d=(e,t)=>{if(0===e)return 1;let i=Object(N["q"])(t),n=.5*e*Object(N["i"])(t,s)/i;const l=n<0?-1:1;c&&(n+=(i-.5*e*Object(N["i"])(t,o)/i)*l*h);const d=i<1.5*a?1:Mn;return i=Math.max(i-a,Mn),l>0&&(n-=r),l*Math.max(l*(n/i),d)};return{...e,factor1:d(i[0],t.basis1),factor2:d(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=Object(N["l"])(Object(U["e"])(),this.mapBoundsStart.origin);Object(N["d"])(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(N["d"])(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(Ot["s"])(Object(Yr["b"])(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(Ot["e"])(i,i);const r=[];for(const s of this.reshapeHelper.editGeometry.components)r.push(...s.vertices);const a="start"===e.action?0:1,n=this.reshapeHelper.scaleVertices(r,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(t),i,e.factor1,e.factor2,a,1);return jt["b"].copy(this.mapBoundsStart,this.mapBounds),un(n,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=Va(this.displayBounds,this.view.renderCoordsHelper,1,jt["f"].create()),i=this._calculatePickRay(e.screenPoint);jt["f"].intersectRay(t,i,st["d"].get())&&(jt["b"].copy(this.displayBounds,this.displayBoundsStart),jt["b"].copy(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return Object(it["e"])(e,(e,t,i)=>{const r=this.inputState;Object(s["j"])(r)||(t.next(e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e)).next(Xi(this.view,r.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(r)).next(this._rotateDragUpdateGeometry()).next(e=>{const t={graphic:this.graphic,angle:Object(pt["q"])(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e}),i.next(()=>{Object(s["k"])(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()}))})}_rotateDragRenderPlaneToRotate(e){return t=>{const i=jt["f"].normal(e.rotatePlane),r=qt(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:r}}}_rotateDragUpdateGeometry(){return e=>{const t=Object(N["l"])(Object(U["e"])(),this.mapBoundsStart.origin),i=[];for(const n of this.reshapeHelper.editGeometry.components)i.push(...n.vertices);const r="start"===e.action?0:1,a=this.reshapeHelper.rotateVertices(i,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(t),e.rotateAngle,r,1);return jt["b"].copy(this.mapBoundsStart,this.mapBounds),un(a,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_calculatePickRay(e){const t=jt["g"].create(),i=Object(gt["j"])(e);return jt["g"].fromScreen(this.view.state.camera,i,t),Object(N["s"])(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;const e=La(this.displayBounds,st["a"].get());Fa(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach((t,i)=>{Ha(t,this.resizeHandles[i],e,this.displayBounds)})}updateZMoveHandle(e,t){const i=this.displayBounds,r={basis:i.basis1,direction:-1,position:Object(N["k"])(st["d"].get(),i.origin,i.basis1),edge:2},a=st["a"].get();Object(nt["g"])(a,t,r.edge*Math.PI/2),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=r.position}cancel(){const e=this.reshapeHelper.editGeometry.lastOperation;Object(s["j"])(e)||(this.reshapeHelper.undo(),this.graphic.geometry=this.reshapeHelper.geometry,pn(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}canUndo(){return this.reshapeHelper.canUndo}undo(){if(Object(s["k"])(this.inputState))this.view.activeTool=null;else if(this.canUndo()){const e=this.reshapeHelper.undo();this.graphic.geometry=this.reshapeHelper.geometry,pn(Object(s["t"])(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}canRedo(){return this.reshapeHelper.canRedo}redo(){if(this.canRedo()){const e=this.reshapeHelper.redo();this.graphic.geometry=this.reshapeHelper.geometry,un(Object(s["t"])(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}};Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],_n.prototype,"view",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],_n.prototype,"graphic",void 0),Object(a["a"])([Object(l["b"])({constructOnly:!0,nonNullable:!0})],_n.prototype,"enableZ",void 0),Object(a["a"])([Object(l["b"])()],_n.prototype,"enableRotation",void 0),Object(a["a"])([Object(l["b"])()],_n.prototype,"enableScaling",void 0),Object(a["a"])([Object(l["b"])()],_n.prototype,"preserveAspectRatio",null),Object(a["a"])([Object(l["b"])()],_n.prototype,"grabbing",void 0),Object(a["a"])([Object(l["b"])()],_n.prototype,"inputState",void 0),Object(a["a"])([Object(l["b"])({readOnly:!0})],_n.prototype,"type",void 0),_n=Object(a["a"])([Object(h["a"])("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],_n);const jn="draped-elevation-changes",wn=10,xn=80,Mn=1e-6},5241:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return b}));var r=i("b2b2"),a=i("32ed"),n=i("0b2d"),s=i("8188"),o=i("afe1"),c=i("4261"),l=i("1a54"),h=i("5a22"),d=i("ba58"),u=i("2e0f");const p=Object(n["e"])();function g(e,t,i,a,n,l,d,g,f,b){const m=i?i.length:0,v=e.clippingExtent;if(Object(s["t"])(t,p,e.elevationProvider.spatialReference),Object(r["k"])(v)&&!Object(c["g"])(v,p))return null;const y=e.renderCoordsHelper.spatialReference;Object(s["t"])(t,p,y);const O=e.localOriginFactory.getOrigin(p),_=new h["a"]({castShadow:!1,metadata:{layerUid:g,graphicUid:f,usesVerticalDistanceToGround:!0}});for(let r=0;r<m;r++){const e=n?n[r]:o["a"];_.addGeometry(i[r],a[r],e,l,O,b)}return{object:_,sampledElevation:Object(u["b"])(_,t,e.elevationProvider,e.renderCoordsHelper,d)}}function f(e,t,i){const r=e.elevationContext,a=i.spatialReference;Object(s["t"])(t,p,a),r.centerPointInElevationSR=Object(l["k"])(p[0],p[1],t.hasZ?p[2]:0,a)}function b(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(d["a"])(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(a["f"])(t,Object(a["e"])(t)/2);return Object(l["k"])(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.extent.center}return null}function m(e,t,i,r,a){const n=new Float64Array(3*e.length),s=new Float64Array(n.length);e.forEach((e,t)=>{n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e.length>2?e[2]:0});const o=Object(u["c"])(n,t,0,s,0,n,0,n.length/3,i,r,a),c=null!=o;return{numVertices:e.length,position:n,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},"536f":function(e,t,i){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e){let t=0,i=0;for(let r=0;r<e.length;r++){const a=e[r].size;"number"==typeof a&&(t+=a,i++)}return t/i}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?a(e.stops):t}function s(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:r}=t;return(n(i,e)+n(r,e))/2});let r=0;const a=i.length;if(0===a)return e;for(let n=0;n<a;n++)r+=i[n];const s=Math.floor(r/a);return Math.max(s,e)}function o(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const a="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return r(a,t.symbol);if("unique-value"===t.type){let e=a;return t.uniqueValueInfos.forEach(t=>{e=r(e,t.symbol)}),e}if("class-breaks"===t.type){let e=a;return t.classBreakInfos.forEach(t=>{e=r(e,t.symbol)}),e}return t.type,a}i.d(t,"a",(function(){return o}))},"5d5f":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("3886"),a=i("c51b");function n(e){const t=e.fragment.code;t.add(r["a"]`
    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
    {
      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
    }
    `),t.add(r["a"]`
    float integratedRadiance(float cosTheta2, float roughness)
    {
      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
    }
    `),t.add(r["a"]`
    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
    {
      float cosTheta2 = 1.0 - RdotNG * RdotNG;
      float intRadTheta = integratedRadiance(cosTheta2, roughness);

      // Calculate the integrated directional radiance of the ground and the sky
      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
      float sky = 2.0 - ground;
      return (ground * ambientGround + sky * ambientSky) * 0.5;
    }
    `)}function s(e,t){const i=e.fragment.code;e.include(a["a"]),3===t.pbrMode||4===t.pbrMode?(i.add(r["a"]`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r["a"]`
    vec3 fresnelReflection(float angle, vec3 f0, float f90) {
      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
    }
    `),i.add(r["a"]`
    float normalDistributionWater(float NdotH, float roughness)
    {
      float r2 = roughness * roughness;
      float NdotH2 = NdotH * NdotH;
      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
      return r2 / denom;
    }
    `),i.add(r["a"]`
    float geometricOcclusionKelemen(float LoH)
    {
        return 0.25 / (LoH * LoH);
    }
    `),i.add(r["a"]`
    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
    {
      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
      float dSun = normalDistributionWater(props.NdotH, roughness);
      float V = geometricOcclusionKelemen(props.LdotH);

      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
      float strengthSunHaze  = 1.2;
      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;

      return ((dSun + dSunHaze) * V) * F;
    }

    vec3 tonemapACES(const vec3 x) {
      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
    }
    `)):1!==t.pbrMode&&2!==t.pbrMode||(e.include(n),i.add(r["a"]`
    struct PBRShadingInfo
    {
        float NdotL;                  // cos angle between normal and light direction
        float NdotV;                  // cos angle between normal and view direction
        float NdotH;                  // cos angle between normal and half vector
        float VdotH;                  // cos angle between view direction and half vector
        float LdotH;                  // cos angle between view light direction and half vector
        float NdotNG;                 // cos angle between normal and normal of the ground
        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground
        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination
        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination
        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)
        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)
        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)
        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)

        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping
        float ssao;                   // ssao coefficient
        vec3 albedoLinear;            // linear color of the albedo
        vec3 f0;                      // fresnel value at normal incident light
        vec3 f90;                     // fresnel value at 90o of incident light

        vec3 diffuseColor;            // diffuse color of the material used in environment illumination
        float metalness;              // metalness of the material
        float roughness;              // roughness of the material
    };
    `),i.add(r["a"]`
    float normalDistribution(float NdotH, float roughness)
    {
        float a = NdotH * roughness;
        float b = roughness / (1.0 - NdotH * NdotH + a * a);
        return b * b * INV_PI;
    }
    `),i.add(r["a"]`
    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
    const vec2 c2 = vec2(-1.04, 1.04);

    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
        vec4 r = roughness * c0 + c1;
        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
        return c2 * a004 + r.zw;
    }
    `),i.add(r["a"]`
    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);

      // From diffuse illumination calculate reflected color
      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;

      // From specular illumination calculate reflected color
      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
      vec3 specularComponent = specularColor * indirectSpecular;

      return (diffuseComponent + specularComponent);
    }
    `),i.add(r["a"]`
    float gamutMapChanel(float x, vec2 p){
      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
    }`),i.add(r["a"]`
    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
      vec3 outColor;
      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
      outColor.x = gamutMapChanel(inColor.x, p) ;
      outColor.y = gamutMapChanel(inColor.y, p) ;
      outColor.z = gamutMapChanel(inColor.z, p) ;
      return outColor;
    }
    `))}},6061:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("b2b2"),a=i("e431"),n=i("680b"),s=i("d791"),o=i("afe1"),c=i("0fc4"),l=i("1038"),h=i("bea9"),d=i("b623");class u{constructor(e,t,i=null,r=null,a,n,s,o,l){this.data=e,this.material=t,this.layerUid=i,this.graphicUid=r,this.boundingSphere=Object(c["c"])(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=a,this.material=t,this.origin=null,this.transformation=null,this.calculateShaderTransformation=s,n&&this.updateTransformation(n,o),this.castShadow=l}updateTransformation(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}shaderTransformationChanged(){this.shaderTransformationDirty=!0}computeBoundingSphere(e,t,i){Object(r["j"])(this.boundingInfo)||(t=t||Object(n["j"])(e),Object(a["n"])(i,this.boundingInfo.getCenter(),e),i[3]=this.boundingInfo.getBSRadius()*t)}get hasShaderTransformation(){return Object(r["k"])(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(r["j"])(this.calculateShaderTransformation)?Object(r["u"])(this.transformation,o["a"]):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=Object(o["b"])()),Object(s["c"])(this.shaderTransformation,this.calculateShaderTransformation(Object(r["u"])(this.transformation,o["a"]))),this.shaderTransformationDirty=!1),this.shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(r["k"])(this.transformation)&&Object(a["n"])(e,e,this.transformation),!0);const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!Object(l["c"])(i,t,e)&&(Object(r["k"])(this.transformation)&&Object(a["n"])(e,e,this.transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new h["a"](0),t=this.instanceParameters;return t.highlights=Object(d["b"])(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(d["g"])(t.highlights,e)}}},6611:function(e,t,i){"use strict";var r=i("a4ee"),a=(i("c120"),i("e92d"),i("cea0"),i("59b2")),n=i("d386"),s=(i("e041"),i("8eed"),i("f402"),i("fc29"));let o=class extends s["a"]{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,this.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,this.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.ENABLE_PROFILE_DEPTH_RANGE=!1,this.DISABLE_FAST_UPDATES=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(r["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"SHOW_POI",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"DISABLE_FAST_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(r["a"])([Object(a["b"])()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o=Object(r["a"])([Object(n["a"])("esri.views.3d.support.DebugFlags")],o);const c=new o;t["a"]=c},"692f":function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));var r=i("3886"),a=i("4db9"),n=i("690a"),s=i("4377"),o=i("d272"),c=i("d047"),l=i("ebd5"),h=i("c6d7"),d=i("2252");function u(e){const t=new n["a"];return t.include(a["a"],{linearDepth:!1}),t.include(d["a"].builder,{}),t.include(o["a"],e),t.fragment.include(s["a"]),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(r["a"]`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(r["a"]`
      vec3 worldNormal = normal;
      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;
    `),t.vertex.code.add(r["a"]`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(h["b"],e)),t.fragment.code.add(r["a"]`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(r["a"]`
      vec3 viewNormalNorm = normalize(vViewNormal);
      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
      vec4 finalColor = mix(color, shadedColor, shadingFactor);
    `):t.fragment.code.add(r["a"]`
      vec4 finalColor = color;
    `),t.fragment.code.add(r["a"]`
      if (finalColor.a < ${r["a"].float(l["c"])}) {
        discard;
      }
      ${7===e.output?r["a"]`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?r["a"]`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}var p=Object.freeze({__proto__:null,build:u})},"713b":function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d}));var r=i("3886"),a=i("4db9"),n=i("690a"),s=i("d272"),o=i("6a07"),c=i("ebd5"),l=i("6750"),h=i("6d5b");function d(e){const t=new n["a"];return t.include(a["a"],{linearDepth:!1}),t.include(h["a"],e),t.include(l["a"],e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(r["a"]`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = transformPosition(proj, view, vpos);
  `),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(r["a"]`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `)),t.vertex.code.add(r["a"]`
  }
  `),4===e.output&&t.include(o["a"]),t.include(s["a"],e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(r["a"]`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${r["a"].float(c["c"])}) {
      discard;
    }

    ${0===e.output?r["a"]`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?r["a"]`outputHighlight();`:""}
  }
  `),t}var u=Object.freeze({__proto__:null,build:d})},7585:function(e,t,i){"use strict";i.d(t,"a",(function(){return K})),i.d(t,"b",(function(){return W})),i.d(t,"c",(function(){return $}));var r=i("a4ee"),a=(i("c120"),i("b2b2")),n=i("e92d"),s=(i("cea0"),i("59b2")),o=i("d386"),c=(i("e041"),i("8eed"),i("f402"),i("8a44")),l=i("fc29"),h=i("f2e0"),d=i("0b2d"),u=i("af40"),p=i("3795"),g=i("d791"),f=i("9305"),b=i("28eb"),m=i("02f1"),v=i("a1ff"),y=i("8539"),O=i("d5f7"),_=i("2bc9"),j=i("a978"),w=i("171c"),x=i("6611"),M=i("70a2"),S=(i("38a4"),i("9f8b"),i("1956"),i("d267"));class R{constructor(e,t){this.id=Object(h["b"])(),this._renderTarget=null,this._renderTarget=new S["a"](e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._renderTarget=Object(a["f"])(this._renderTarget)}getTexture(){return this._renderTarget?this._renderTarget.colorTexture:null}isValid(){return null!==this._renderTarget}resize(e,t){this._renderTarget.resize(e,t)}bind(e){e.bindFramebuffer(this._renderTarget)}generateMipMap(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()}disposeRenderTargetMemory(){this._renderTarget&&this._renderTarget.resize(0,0)}getGpuMemoryUsage(){let e=0;return this._renderTarget&&(e+=Object(y["c"])(this._renderTarget)),e}}var E=i("9180"),P=i("7abc");class T{constructor(e){this.extent=Object(E["l"])(),this.resolution=0,this.renderLocalOrigin=Object(P["a"])(0,0,0,"O"),this.pixelRatio=1,this.renderTargets={color:{fbo:new R(e,!0),valid:!1,lastUsed:1/0},colorWithoutRasterImage:{fbo:new R(e,!0),valid:!1,lastUsed:1/0},highlight:{fbo:new R(e,!1),valid:!1,lastUsed:1/0},water:{fbo:new R(e,!0),valid:!1,lastUsed:1/0},occluded:{fbo:new R(e,!0),valid:!1,lastUsed:1/0}}}dispose(){this.renderTargets.color.fbo.dispose(),this.renderTargets.colorWithoutRasterImage.fbo.dispose(),this.renderTargets.highlight.fbo.dispose(),this.renderTargets.water.fbo.dispose(),this.renderTargets.occluded.fbo.dispose()}drawRenderTargets(e,t,i){const r=this.renderTargets;r.color.valid=e.drawPass(0,r.color.fbo,t),r.highlight.valid=e.drawPass(5,r.highlight.fbo,t),r.water.valid=e.drawPass(3,r.water.fbo,t),r.occluded.valid=e.drawPass(0,r.occluded.fbo,t,1),r.colorWithoutRasterImage.valid=i&&e.drawPass(0,r.colorWithoutRasterImage.fbo,t,2)}computeRenderTargetValidityBitfield(){const e=this.renderTargets;return+e.color.valid|+e.colorWithoutRasterImage.valid<<1|+e.highlight.valid<<2|+e.water.valid<<3|+e.occluded.valid<<4}validateUsage(e,t){if(e.valid)e.lastUsed=t;else if(t-e.lastUsed>D)e.fbo.disposeRenderTargetMemory(),e.lastUsed=1/0;else if(e.lastUsed<1/0)return!0;return!1}collectUnusedMemory(e){let t=!1;return t=this.validateUsage(this.renderTargets.color,e)||t,t=this.validateUsage(this.renderTargets.colorWithoutRasterImage,e)||t,t=this.validateUsage(this.renderTargets.highlight,e)||t,t=this.validateUsage(this.renderTargets.occluded,e)||t,t=this.validateUsage(this.renderTargets.water,e)||t,t}getGpuMemoryUsage(){return this.renderTargets.color.fbo.getGpuMemoryUsage()+this.renderTargets.colorWithoutRasterImage.fbo.getGpuMemoryUsage()+this.renderTargets.highlight.fbo.getGpuMemoryUsage()+this.renderTargets.water.fbo.getGpuMemoryUsage()+this.renderTargets.occluded.fbo.getGpuMemoryUsage()}}const D=1e3;var C=i("eaa4"),A=i("0e88"),I=i("caca"),k=i("adf1"),G=i("d6e5"),z=i("35b3"),L=i("fdc9"),V=i("9def"),H=i("191a");let F=class extends l["a"]{constructor(){super(...arguments),this._pendingAddsRemoves=new Map,this._changes=new L["a"],this._materialRenderers=new Map,this._sortedMaterialRenderers=new c["a"],this._hasHighlights=!1,this._hasWater=!1}dispose(){this._changes.prune(),this._materialRenderers&&(this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())}get updating(){return this._pendingAddsRemoves.size>0||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(b["b"])(this._materialRenderers,e=>e.rendersOccluded)}stopAnimationsAtTime(e){this._sortedMaterialRenderers.forAll(t=>Object(a["c"])(t.material.animation,t=>t.stopAtTime(e)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){let e=!1;if(!this.updating)return!1;this.updateAddsRemoves();const t=Object(V["a"])(this._changes);let i=!1,r=!1;return t.forEach((t,a)=>{let n=this._materialRenderers.get(a);if(!n&&t.adds.length>0&&(n=new H["a"](this.rctx,this.materialRepository,a),this._materialRenderers.set(a,n),e=!0,i=!0,r=!0),!n)return;const s=i||n.hasHighlights,o=r||n.hasWater;n.modify(t),i=i||s!==n.hasHighlights,r=r||o!==n.hasWater,n.isEmpty&&(this._materialRenderers.delete(a),n.dispose(),e=!0)}),this._changes.clear(),this._pendingAddsRemoves.clear(),e&&this.updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(b["b"])(this._materialRenderers,e=>e.hasHighlights)),r&&(this._hasWater=Object(b["b"])(this._materialRenderers,e=>e.hasWater)),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=0===this._pendingAddsRemoves.size;for(const i of e)this._pendingAddsRemoves.set(i,0);t&&this.notifyChange("updating")}remove(e){const t=0===this._pendingAddsRemoves.size;for(const i of e){const e=this._pendingAddsRemoves.get(i);0===e?this._pendingAddsRemoves.set(i,2):2!==e&&this._pendingAddsRemoves.set(i,1)}t&&this._pendingAddsRemoves.size>0&&this.notifyChange("updating")}modify(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=r,e.updateType=t}i&&this._changes.updates.length>0&&this.notifyChange("updating")}updateLogic(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>{i.updateLogic&&i.updateLogic(e)&&(t=!0)}),t}draw(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];Object(z["c"])(r.material,e)&&r.materialRenderer.render(null,e,t,null)}}updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder})}updateAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._pendingAddsRemoves.forEach((e,t)=>{switch(e){case 0:this._changes.adds.push(t);break;case 1:this._changes.removes.push(t)}});let e=0;for(;e<this._changes.updates.length;){const t=this._changes.updates.data[e].renderGeometry;this._pendingAddsRemoves.has(t)?this._changes.updates.removeUnorderedIndex(e):e++}}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(r["a"])([Object(s["b"])()],F.prototype,"rctx",void 0),Object(r["a"])([Object(s["b"])()],F.prototype,"materialRepository",void 0),Object(r["a"])([Object(s["b"])()],F.prototype,"updating",null),F=Object(r["a"])([Object(o["a"])("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],F);var U=i("7aed"),N=i("2245"),B=i("3544");const q=n["a"].getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let W=class extends(Object(M["b"])(l["a"])){constructor(e){super(e),this._overlays=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new N["a"],this._localOrigins=new k["a"],this._handles=new u["a"],this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new c["a"],this._geometries=new Map,this.globalUnitScale=1,this.longitudeCyclical=null}initialize(){this._rctx=this.renderView.renderingContext,this._renderContext=new G["a"](this._rctx,null,null,null,null,null),this._stippleTextureRepository=new B["a"],this.waterTextureRepository=this.renderView.waterTextureRepository,this._shaderTechniqueRepository=new A["a"]({rctx:this._rctx,viewingMode:2,commonUniformStore:new C["a"],stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),Object(p["a"])(this.waterTextureRepository,"loadingState",()=>this.emitContentChanged()),this._materialRepository=new I["a"](this.renderView.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=e=>{(e.renderOccluded&$)>0!==this._rendersOccluded&&this.updateRendersOccluded(),this.emitContentChanged(),this.notifyChange("updating")},this._compositingHelper=this.renderView.compositingHelper,this._lighting.set({lights:[new _["a"](Object(d["g"])(1,1,1))],groundLightingFactor:1,globalFactor:0}),this._bindParameters={slot:null,highlightDepthTexture:Object(O["b"])(this._rctx),camera:X,inverseViewport:Object(m["b"])(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureUnit:0,lastFrameColorTexture:null,lastFrameColorTextureUnit:0,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!0,multipassGeometryEnabled:!1},this._handles.add(this.scheduler.registerTask(f["b"].STAGE,()=>this.commitChanges(),()=>this.updating))}dispose(){this._handles.destroy(),this._layerRenderers.forEach(e=>e.dispose()),this._layerRenderers.clear(),this._bindParameters.highlightDepthTexture=Object(a["f"])(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(a["f"])(this._shaderTechniqueRepository),this._temporaryRenderTarget=Object(a["f"])(this._temporaryRenderTarget),this._debugPatternTexture=Object(a["f"])(this._debugPatternTexture),this._quadVAO=Object(a["f"])(this._quadVAO)}get updating(){return this._sortedLayerRenderersDirty||Object(b["b"])(this._layerRenderers,e=>e.updating)||this.waterTextureRepository.updating}get hasOverlays(){return Object(a["k"])(this._overlays)}get gpuMemoryUsage(){return Object(a["k"])(this._overlays)?this._overlays[0].getGpuMemoryUsage()+this._overlays[1].getGpuMemoryUsage():0}get overlays(){return this._overlays}forEachOverlay(e){Object(a["k"])(this._overlays)&&(e(this._overlays[0],0),e(this._overlays[1],1))}ensureOverlays(){if(Object(a["j"])(this._overlays)){const e=this.renderView.renderingContext;this._overlays=[new T(e),new T(e)]}}disposeOverlays(){Object(a["k"])(this._overlays)&&(this._overlays.forEach(e=>e.dispose()),this._overlays=null)}commitChanges(){let e=!1;this._layerRenderers.forEach((t,i)=>{t.commitChanges()&&(e=!0),t.isEmpty&&(this._layerRenderers.delete(i),this._sortedLayerRenderersDirty=!0,this._handles.remove(i))}),this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),e=!0),e&&(this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}addGeometries(e,t,i){for(const r of e)null==r.origin&&(r.origin=this._localOrigins.getOrigin(r.boundingSphere)),Object(a["j"])(r.id)&&(r.id=Object(h["b"])()),this._geometries.set(r.id,r);this.ensureLayerRenderer(t).add(e),2===i&&this.notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,i){for(const n of e)this._geometries.delete(Object(a["t"])(n.id));const r=this._layerRenderers.get(t);r&&(r.remove(e),2===i&&this.notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,i){const r=this._layerRenderers.get(t);if(r)switch(r.modify(e,i),i){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else q.warn("Attempted to update geometry for nonexistent layer")}notifyGraphicGeometryChanged(e,t){if(Object(a["j"])(t.notifyGraphicGeometryChanged))return;let i;for(const r of e){const e=r.graphicUid;e!==i&&(t.notifyGraphicGeometryChanged(e),i=e)}}notifyGraphicVisibilityChanged(e,t){if(Object(a["j"])(t.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const e=r.graphicUid;e!==i&&(t.notifyGraphicVisibilityChanged(e),i=e)}}updateHighlights(e,t){const i=this._layerRenderers.get(t);i?i.modify(e,8):q.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!x["a"].OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateLogic(e){let t=!1;return this._layerRenderers.forEach(i=>{i.updateLogic(e)&&(t=!0)}),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawPass(e,t,i,r=0){if(0===i.numViews)return!1;if(this._screenToWorldRatio=i.pixelRatio*Math.abs(i.views[0].extent[2]-i.views[0].extent[0])/Math.abs(i.views[0].viewport[2]-i.views[0].viewport[0]),this.isEmpty()||5===e&&!this.hasHighlights||3===e&&!this.hasWater)return!1;if(!this.hasNonZeroSizedView(i))return!1;const n=i.width,s=i.height;if(!t.isValid())return!1;t.resize(n,s);const o=this._rctx;if(X.pixelRatio=i.pixelRatio||1,this._renderContext.pass=e,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale,t.bind(o),o.setClearColor(0,0,0,0),o.clearSafe(16384),1===r&&(this._renderContext.renderOccludedMask=$),x["a"].OVERLAY_DRAW_DEBUG_TEXTURE&&1!==r)for(let a=0;a<i.numViews;a++)this.setViewParameters(i.views[a],X),this.drawDebugTexture(n,s,Y[i.index%Y.length]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll(({layerView:c,renderer:l})=>{if(2===r&&Object(a["k"])(c)&&0===c.drapeSourceType)return;const h=Object(a["k"])(c)&&Object(a["k"])(c.fullOpacity)&&c.fullOpacity<1&&0===e;h&&(this.bindTemporaryFramebuffer(this._rctx,n,s),o.clearSafe(16384));for(let e=0;e<i.numViews;e++)this.setViewParameters(i.views[e],X),l.draw(this._renderContext,this._bindParameters);h&&Object(a["k"])(this._temporaryRenderTarget)&&(t.bind(o),this._compositingHelper.composite(this._temporaryRenderTarget.getTexture(),2,Object(a["t"])(Object(a["t"])(c).fullOpacity)))}),o.bindFramebuffer(null),t.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){Object(a["j"])(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=new R(e,!1)),this._temporaryRenderTarget.resize(t,i),this._temporaryRenderTarget.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.hotReload()}intersect(e,t,i){let r=0;this._geometries.forEach(a=>{if(i&&!i(a))return;this.intersectRenderGeometry(a,t,0,e,r);const n=this.longitudeCyclical;n&&(a.boundingSphere[0]-a.boundingSphere[3]<n.min&&this.intersectRenderGeometry(a,t,n.range,e,r),a.boundingSphere[0]+a.boundingSphere[3]>n.max&&this.intersectRenderGeometry(a,t,-n.range,e,r)),r++})}intersectRenderGeometry(e,t,i,r,n){if(!e.instanceParameters.visible)return;let s=0;Object(a["k"])(e.transformation)&&(i+=e.transformation[12],s=e.transformation[13]),Q[0]=t[0]-i,Q[1]=t[1]-s,Q[2]=1,J[0]=t[0]-i,J[1]=t[1]-s,J[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),r,Q,J,(t,i,a)=>{this.addIntersectionResult(a,e.material.renderPriority,n,r,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,!0)}addIntersectionResult(e,t,i,r,a,n){const s={type:"external",metadata:{layerUid:a,graphicUid:n}},o=a=>{a.set(s,null,r.results.ground.dist,r.results.ground.normal,r.results.ground.transformation,t,null,null,e,i),a.intersector="OverlayRenderer"};if((null==r.results.min.drapedLayerOrder||t>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&o(r.results.min),0!==r.options.store&&(null==r.results.max.drapedLayerOrder||t<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&o(r.results.max),2===r.options.store){const e=new j["b"](r.ray);o(e),r.results.all.push(e)}}stopAnimationsAtTime(e){this._sortedLayerRenderers.forAll(t=>t.renderer.stopAnimationsAtTime(e))}ensureLayerRenderer(e){let t=this._layerRenderers.get(e);return t||(t=new F({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,t),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",()=>this.emitContentChanged()),e),this._handles.add(Object(p["a"])(t,"updating",()=>this.notifyChange("updating")),e)),t}updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const[{view:{allLayerViews:e}}]=this._layerRenderers.keys(),t=new Set(this._layerRenderers.values());e.forEach(e=>{const i=e,r=this._layerRenderers.get(i);r&&(this._sortedLayerRenderers.push(new Z(i,r)),t.delete(r))}),t.forEach(e=>{this._sortedLayerRenderers.push(new Z(null,e))})}setViewParameters(e,t){t.viewport=e.viewport;const i=e.extent;Object(g["o"])(t.projectionMatrix,0,i[2]-i[0],0,i[3]-i[1],t.near,t.far),Object(g["i"])(t.viewMatrix),Object(g["t"])(t.viewMatrix,t.viewMatrix,[-e.extent[0],-e.extent[1],0]),t.setGLViewport(this._rctx),this._renderContext.camera=t,this._bindParameters.camera=t,this._bindParameters.inverseViewport[0]=1/t.fullViewport[2],this._bindParameters.inverseViewport[1]=1/t.fullViewport[3]}hasNonZeroSizedView(e){for(let t=0;t<e.numViews;t++){const i=e.views[t];if(i.extent[0]!==i.extent[2]&&i.extent[1]!==i.extent[3])return!0}return!1}emitContentChanged(){this.onContentChanged&&this.onContentChanged()}updateHasWater(){const e=Object(b["b"])(this._layerRenderers,e=>e.hasWater);e!==this._hasWater&&(this._hasWater=e)}updateHasHighlights(){const e=Object(b["b"])(this._layerRenderers,e=>e.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.onHasHighlightsChanged&&this.onHasHighlightsChanged(this._hasHighlights))}updateRendersOccluded(){const e=Object(b["b"])(this._layerRenderers,e=>e.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.onRendersOccludedChanged&&this.onRendersOccludedChanged(this.rendersOccluded))}drawDebugTexture(e,t,i){const r=this._rctx;this.ensureDebugPatternResources(e,t);const a=this._debugTextureTechnique.program;r.bindProgram(a),r.setPipelineState(this._debugTextureTechnique.pipeline),a.setUniform4f("color",i[0],i[1],i[2],1),a.setUniform1i("tex",0),r.bindTexture(this._debugPatternTexture,0),r.bindVAO(this._quadVAO),r.drawArrays(5,0,Object(y["f"])(this._quadVAO,"geometry"))}ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let a=0;a<e;a++){const s=Math.floor(a/10),o=Math.floor(n/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&a^1&n?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new v["a"](this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},i);const a=new U["b"];a.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(U["a"],a,this._debugTextureTechnique),this._quadVAO=Object(O["d"])(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};Object(r["a"])([Object(M["c"])()],W.prototype,"_shaderTechniqueRepository",void 0),Object(r["a"])([Object(M["c"])()],W.prototype,"_stippleTextureRepository",void 0),Object(r["a"])([Object(s["b"])(),Object(M["c"])()],W.prototype,"waterTextureRepository",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],W.prototype,"renderView",void 0),Object(r["a"])([Object(s["b"])({constructOnly:!0})],W.prototype,"scheduler",void 0),Object(r["a"])([Object(s["b"])()],W.prototype,"globalUnitScale",void 0),Object(r["a"])([Object(s["b"])({type:Boolean,readOnly:!0})],W.prototype,"updating",null),W=Object(r["a"])([Object(o["a"])("esri.views.3d.terrain.OverlayRenderer")],W);class Z{constructor(e,t){this.layerView=e,this.renderer=t}}const Y=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],X=new w["a"];X.near=1,X.far=1e4,X.relativeElevation=null;const Q=Object(d["e"])(),J=Object(d["e"])(),K=-2,$=4},7590:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var r=i("4ae5"),a=i("3af1"),n=i("57dc"),s=i("1219"),o=i("521c");const c={convertToGEGeometry:l,exportPoint:h,exportPolygon:d,exportPolyline:u,exportMultipoint:p,exportExtent:g};function l(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i}function h(e,t,i){const a=e.hasZ(t),n=e.hasM(t),s=new r["a"]({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return a&&(s.z=e.getPointZ(t)),n&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s}function d(e,t,i){const r=new s["a"]({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r}function u(e,t,i){const r=new o["a"]({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r}function p(e,t,i){const r=new n["a"]({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r}function g(e,t,i){const r=e.hasZ(t),n=e.hasM(t),s=new a["a"]({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(r){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(n){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s.cache._geVersion=t,s}},"7abc":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("0b2d");class a{constructor(e,t){this.vec3=e,this.id=t}}function n(e,t,i,n){return new a(Object(r["g"])(e,t,i),n)}},"7aed":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var r=i("a4ee"),a=i("c3a4"),n=i("ca98"),s=i("da35"),o=i("fa1e"),c=i("8e37"),l=i("189c"),h=i("3e44");class d extends n["a"]{initializeProgram(e){const t=d.shader.get().build();return new c["a"](e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),o["a"])}initializePipeline(){return this.configuration.hasAlpha?Object(l["e"])({blending:Object(l["f"])(770,1,771,771),colorWrite:l["c"]}):Object(l["e"])({colorWrite:l["c"]})}}d.shader=new a["a"](h["a"],()=>i.e("chunk-2d0b3143").then(i.bind(null,"279a")));class u extends s["a"]{constructor(){super(...arguments),this.hasAlpha=!1}}Object(r["a"])([Object(s["b"])()],u.prototype,"hasAlpha",void 0)},"8c4b":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("38a4");function a(e,t,i){var a;const l=e.byteLength/(4*t),h=new Uint32Array(e,0,l*t);let d=new Uint32Array(l);const u=null!=(a=null==i?void 0:i.minReduction)?a:0,p=(null==i?void 0:i.originalIndices)||null,g=p?p.length:0,f=(null==i?void 0:i.componentOffsets)||null;let b=0;if(f)for(let r=0;r<f.length-1;r++){const e=f[r+1]-f[r];e>b&&(b=e)}else b=l;const m=Math.floor(1.1*b)+1;(null==c||c.length<2*m)&&(c=new Uint32Array(Object(r["o"])(2*m)));for(let r=0;r<2*m;r++)c[r]=0;let v=0;const y=!!f&&!!p,O=y?g:l,_=y?new Uint32Array(g):null,j=1.96;let w=0!==u?Math.ceil(4*j*j/(u*u)*u*(1-u)):O,x=1,M=f?f[1]:O;for(let r=0;r<O;r++){if(r===w){const e=1-v/r;if(e+j*Math.sqrt(e*(1-e)/r)<u)return null;w*=2}if(r===M){for(let e=0;e<2*m;e++)c[e]=0;if(p)for(let e=f[x-1];e<f[x];e++)_[e]=d[p[e]];M=f[++x]}const e=y?p[r]:r,i=e*t,a=o(h,i,t);let s=a%m,l=v;for(;0!==c[2*s+1];){if(c[2*s]===a){const e=c[2*s+1]-1;if(n(h,i,e*t,t)){l=d[e];break}}s++,s>=m&&(s-=m)}l===v&&(c[2*s]=a,c[2*s+1]=e+1,v++),d[e]=l}if(0!==u&&1-v/l<u)return null;if(y){for(let e=f[x-1];e<_.length;e++)_[e]=d[p[e]];d=_}const S=new Uint32Array(t*v);v=0;for(let r=0;r<O;r++)d[r]===v&&(s(h,(y?p[r]:r)*t,S,v*t,t),v++);if(p&&!y){const e=new Uint32Array(g);for(let t=0;t<e.length;t++)e[t]=d[p[t]];d=e}return{buffer:S.buffer,indices:d,uniqueCount:v}}function n(e,t,i,r){for(let a=0;a<r;a++)if(e[t+a]!==e[i+a])return!1;return!0}function s(e,t,i,r,a){for(let n=0;n<a;n++)i[r+n]=e[t+n]}function o(e,t,i){let r=0;for(let a=0;a<i;a++)r=e[t+a]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},9250:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));i("c120");var r=i("b2b2"),a=i("0b2d"),n=i("e431"),s=i("afe1"),o=i("d0ac"),c=i("b623"),l=i("a978");const h=1e-5;class d{constructor(e){this.options=new l["a"],this.results=new l["c"],this.transform=new l["d"],this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=h,this.verticalOffset=null,this._ray={origin:Object(a["e"])(),direction:Object(a["e"])()},this._rayEndPoint=Object(a["e"])(),this._rayStartPointTransformed=Object(a["e"])(),this._rayEndPointTransformed=Object(a["e"])(),this.viewingMode=null==e?1:e}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(e,t){this.resetWithRay(o["g"].fromPoints(e,t,this._ray))}resetWithRay(e){e!==this._ray&&o["g"].copy(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(n["g"])(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(e,t,i,a,n,s){this.point=t,this.camera=i,this.filterPredicate=n,this.tolerance=null==a?h:a;const o=Object(l["g"])(this.verticalOffset),c=s?e=>{s(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};if(e&&e.length>0)for(const l of e){const e=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();Object(r["k"])(e)?(Object(r["k"])(o)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,c,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,c),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(c)):l.getObjects().forAll(e=>c(e))}this.sortResults()}intersectObject(e){this._numObjectsTested++;const t=e.geometryRecords;if(!t)return;const i=e.id,a=e.transformation;let o;const h=Object(l["g"])(this.verticalOffset);for(const d of t){const{geometry:t,material:u,instanceParameters:p}=d;if(Object(c["e"])(p))continue;o=t.id,this.transform.setAndInvalidateLazyTransforms(a,d.getShaderTransformation()),Object(n["n"])(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),Object(n["n"])(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const g=this.transform.transform;Object(r["k"])(h)&&(h.objectTransform=this.transform),u.intersect(t,p,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,(t,a,n,c,h,d)=>{if(t>=0){if(Object(r["k"])(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,t))return;const u="Object3D "+i;if(h)return void((null==this.results.hud.dist||t<this.results.hud.dist)&&this.results.hud.set(e,u,t,a,s["a"],c,d,o,n));const p=i=>i.set(e,u,t,a,g,c,null,o,n);if((null==this.results.min.drapedLayerOrder||c>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||t<this.results.min.dist)&&p(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||c<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||t>this.results.max.dist)&&p(this.results.max),2===this.options.store){const e=new l["b"](this._ray);p(e),this.results.all.push(e)}}},d.shaderTransformation)}}sortResults(){this.results.all.sort((e,t)=>e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE))}}d.DEFAULT_TOLERANCE=h},"94e6":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i("b2b2"),a=i("0b2d"),n=i("e431"),s=i("d791"),o=i("afe1"),c=i("7577"),l=i("5ef2"),h=i("86ba"),d=i("d408"),u=i("5fae");class p extends u["a"]{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=Object(l["c"])(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromExtent(e){const t=this.view.spatialReference,i=Object(a["e"])(),r=Object(a["e"])(),s=100,o=[];Object(n["x"])(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),Object(n["x"])(i,e[2],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),Object(n["x"])(i,e[2],e[3],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),Object(n["x"])(i,e[0],e[3],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),Object(n["x"])(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),Object(n["x"])(i,e[0],e[1],s),this.view.renderCoordsHelper.toRenderCoords(i,t,r),o.push([r[0],r[1],r[2]]),this.geometry=[o]}setGeometryFromFrustum(e){const t=[];e.lines.forEach(e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])}),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;Object(s["i"])(g),Object(s["t"])(g,g,t),this.transform=g;const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=a["b"]){Object(s["i"])(g),Object(s["t"])(g,g,t),this.transform=g,this.geometry=e.map(e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(c["g"])(e,this._color)||(Object(c["c"])(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(r["k"])(e)?!Object(r["j"])(this._innerColor)&&Object(c["g"])(e,this._innerColor)||(this._innerColor=Object(c["c"])(Object(l["b"])(),e),this._updateMaterial()):Object(r["k"])(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(r["k"])(e)!==Object(r["k"])(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(r["j"])(e)||Object(r["j"])(this._stippleOffColor)||!Object(c["g"])(e,this._stippleOffColor))&&(this._stippleOffColor=Object(r["k"])(e)?Object(l["a"])(e):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new h["a"](this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const r=Object(d["a"])(t[i]);e.addGeometry(r,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameterValues(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if(Object(r["j"])(e)||0===e.length)return[];const t=[];return e.forEach(e=>{const i=e.length,r=new Float64Array(3*i);e.forEach((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]});const a={attributeData:{position:r},removeDuplicateStartEnd:0};t.push(a)}),t}}const g=Object(o["b"])()},"9def":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("fdc9");function a(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new r["b"],t.set(e,i)),i};return e.adds.forAll(e=>{n(e)&&i(e.material).adds.push(e)}),e.removes.forAll(e=>{n(e)&&i(e.material).removes.push(e)}),e.updates.forAll(e=>{n(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)}),t}function n(e){return e.data.indexCount>=1}},a326:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b2b2");function a(e){const t=e.capabilities.disjointTimerQuery;return Object(r["j"])(t)?null:t.timestampBits()>0?new n(t):o?null:new s(t)}class n{constructor(e){this.timer=e,this.start=e.createQuery(),e.createTimestamp(this.start)}stop(e,t=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this.checkQueryResult(e,t)}checkQueryResult(e,t){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this.checkQueryResult(e,t),t);if(this.timer.disjoint())return void e(null);const i=this.timer.getResult(this.start),r=this.timer.getResult(this.end);e((r-i)/1e6)}}class s{constructor(e){this.timer=e,this.query=e.createQuery(),o=!0,this.timer.beginTimeElapsed(this.query)}stop(e,t=50){this.timer.endTimeElapsed(),o=!1,this.checkQueryResult(e,t)}checkQueryResult(e,t){const i=this.timer.resultAvailable(this.query),r=this.timer.disjoint();if(!i||r)r?e(null):setTimeout(()=>this.checkQueryResult(e,t),t);else{const t=this.timer.getResult(this.query);e(t/1e6)}}}let o=!1},a445:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("d7f7"),a=i("f498");class n extends r["a"]{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(a["a"],this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(2===this.output)return 22===e;if(5===this.output)return null==e;if(4===this.output)return 3===e;let t=3;return this.material.params.transparent&&(t=this.material.params.writeDepth?5:8),e===t}setElapsedTimeUniform(e){const t=.001*this.material.animation.time;e.setUniform1f("timeElapsed",t*this.material.params.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this.material.params.receiveShadows&&this.material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this.material.params.ssrEnabled&&this.material.setParameterValues({ssrEnabled:e.ssrEnabled})}ensureResources(e){return this.technique.ensureResource(e)}ensureParameters(e){0===this.output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t),2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)}}},a978:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return V})),i.d(t,"f",(function(){return G})),i.d(t,"g",(function(){return I})),i.d(t,"h",(function(){return L})),i.d(t,"i",(function(){return y}));var r=i("b2b2"),a=i("0b2d"),n=i("e431"),s=i("d791"),o=i("dae5"),c=i("afe1"),l=i("b139"),h=i("0fc4"),d=i("1c92"),u=i("7577"),p=i("04f0"),g=i("47f8"),f=i("f895"),b=i("0d9f"),m=i("d0ac"),v=i("5a22");function y(e){return(t,i,r)=>(Object(n["j"])(H,t,i,r),!Object(b["c"])(e,H))}class O{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}class _{constructor(){this._transform=Object(c["b"])(),this._transformInverse=new j({value:this._transform},s["a"],c["b"]),this._transformInverseTranspose=new j(this._transformInverse,s["b"],c["b"]),this._transformTranspose=new j({value:this._transform},s["b"],c["b"]),this._transformInverseRotation=new j({value:this._transform},d["b"],o["a"])}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s["c"])(this._transform,e)}multiplyTransform(e){Object(s["m"])(this._transform,this._transform,e)}set(e){Object(s["c"])(this._transform,e),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}class j{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class w{constructor(){this.min=new x,this.max=new x,this.hud=new x,this.ground=new x}init(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}class x{constructor(e){this.normal=Object(a["e"])(),this.transformation=Object(c["b"])(),this._ray=m["g"].create(),this.init(e)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return Object(n["f"])(F,this.ray.direction,this.dist),Object(n["q"])(F)}getIntersectionPoint(e){return!!this.hasIntersectionPoint&&(Object(n["f"])(F,this.ray.direction,this.dist),Object(n["g"])(e,this.ray.origin,F),!0)}getTransformedNormal(e){return Object(n["l"])(U,this.normal),U[3]=0,Object(u["m"])(U,U,this.transformation),Object(n["l"])(e,U),Object(n["s"])(e,e),e}init(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?m["g"].copy(e,this._ray):this._ray=m["g"].create()}set(e,t,i,r,o,c,l,h,d,u){e instanceof v["a"]&&(e={type:"stage",obj:e}),this.dist=i,Object(n["l"])(this.normal,r),Object(s["c"])(this.transformation,o),this.target=e,this.name=t,this.drapedLayerOrder=c,this.center=l?Object(a["d"])(l):null,this.geometryId=h,this.triangleNr=d,this.drapedLayerGraphicOrder=u}copyFrom(e){m["g"].copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(a["d"])(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(n["l"])(this.normal,e.normal),Object(s["c"])(this.transformation,e.transformation)}toOwner(e){if(!this.target)return null;switch(this.target.type){case"stage":return M(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return E(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return M(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null}toGraphic(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return P(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e)}}return null}}function M(e,t){return Object(r["j"])(e)||null==e.layerUid?null:Object(r["k"])(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function S(e,t){if(Object(r["j"])(e))return null;const i=M(e,t);if(Object(r["j"])(i))return null;if(i===t.graphics)return Object(r["k"])(t.graphicsView)?Object(r["t"])(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;const a=t.allLayerViews.find(e=>e.layer===i);return a?R(a,e):null}function R(e,t){return!e||e.suspended?null:"getGraphicFromIntersectorMetadata"in e&&t?e.getGraphicFromIntersectorMetadata(t):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}function E(e,t){const i=e.metadata.layerUid;return null!=i?t.map.findLayerByUid(i):null}function P(e){return e.metadata.createGraphic()}class T{constructor(e=0){this.offset=e,this.tmpVertex=Object(a["e"])()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],a=t+this.localOrigin[1],n=i+this.localOrigin[2],s=this.offset/Math.sqrt(r*r+a*a+n*n);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+a*s,this.tmpVertex[2]=i+n*s,this.tmpVertex}applyToAabb(e){const t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],a=e[3]+this.localOrigin[0],n=e[4]+this.localOrigin[1],s=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(a*a+n*n+s*s);return e[3]+=a*c,e[4]+=n*c,e[5]+=s*c,e}}class D{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(a["e"])(),this.mbs=Object(h["c"])(),this.obb={center:Object(a["e"])(),halfSize:Object(g["c"])(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,a=t,n=i+this.componentLocalOriginLength,s=this.offset/Math.sqrt(r*r+a*a+n*n);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+a*s,this.tmpVertex[2]=i+n*s,this.tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,a=e[3],n=e[4],s=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(a*a+n*n+s*s);return e[3]+=a*c,e[4]+=n*c,e[5]+=s*c,e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){const t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(n["v"])(this.obb.halfSize,e.halfSize,e.quaternion),Object(n["g"])(this.obb.halfSize,this.obb.halfSize,e.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(n["k"])(this.obb.halfSize,this.obb.halfSize,e.center),Object(p["b"])(N,e.quaternion),Object(n["v"])(this.obb.halfSize,this.obb.halfSize,N),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}class C{constructor(e=0){this.offset=e,this.sphere=Object(f["b"])(),this.tmpVertex=Object(a["e"])()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let a=r[0]*e+r[4]*t+r[8]*i+r[12],n=r[1]*e+r[5]*t+r[9]*i+r[13],s=r[2]*e+r[6]*t+r[10]*i+r[14];const o=this.offset/Math.sqrt(a*a+n*n+s*s);a+=a*o,n+=n*o,s+=s*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*a+c[4]*n+c[8]*s+c[12],this.tmpVertex[1]=c[1]*a+c[5]*n+c[9]*s+c[13],this.tmpVertex[2]=c[2]*a+c[6]*n+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const A=new C;function I(e){return Object(r["k"])(e)?(A.offset=e,A):null}const k=new D;function G(e){return Object(r["k"])(e)?(k.offset=e,k):null}const z=new T;function L(e){return Object(r["k"])(e)?(z.offset=e,z):null}const V="terrain",H=Object(a["e"])(),F=Object(a["e"])(),U=Object(h["c"])(),N=Object(l["a"])()},ad96:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i("68af"),a=i("7c51"),n=i("35b3"),s=i("7438"),o=i("8675"),c=i("a4ee"),l=i("c3a4"),h=i("ca98"),d=i("da35"),u=i("fa1e"),p=i("8e37"),g=i("189c"),f=i("8e97"),b=i("d272"),m=i("c6d7"),v=i("87b7"),y=i("f3d9");class O extends h["a"]{initializeProgram(e){const t=O.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new p["a"](e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),u["a"])}bindPass(e,t,i){f["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(m["a"])(this.program,e,i))}bindDraw(e){f["a"].bindView(this.program,e),b["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,r=3===e,a=2===e,n=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return Object(g["e"])({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?_:Object(s["a"])(e),culling:n(i.cullFace),depthTest:{func:Object(s["b"])(e)},depthWrite:r?i.writeDepth&&g["d"]:Object(s["c"])(e),colorWrite:g["c"],stencilWrite:i.sceneHasOcludees?v["j"]:null,stencilTest:i.sceneHasOcludees?t?v["f"]:v["e"]:null,polygonOffset:r||a?null:Object(s["g"])(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}O.shader=new l["a"](y["a"],()=>i.e("chunk-2d215c84").then(i.bind(null,"c056")));const _=Object(g["g"])(1,771);class j extends d["a"]{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(c["a"])([Object(d["b"])({count:8})],j.prototype,"output",void 0),Object(c["a"])([Object(d["b"])({count:3})],j.prototype,"cullFace",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"slicePlaneEnabled",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"transparent",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"enableOffset",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"writeDepth",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"sceneHasOcludees",void 0),Object(c["a"])([Object(d["b"])({count:4})],j.prototype,"transparencyPassType",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"multipassTerrainEnabled",void 0),Object(c["a"])([Object(d["b"])()],j.prototype,"cullAboveGround",void 0);class w extends n["a"]{constructor(e){super(e,M),this.supportsEdges=!0,this.techniqueConfig=new j}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s["e"],this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,s,o){Object(a["i"])(e,t,r,n,s,void 0,o)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new x(e):void 0}createBufferWriter(){return new o["a"](o["d"])}}class x extends r["a"]{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(O,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}const M={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...n["b"]}},adf1:function(e,t,i){"use strict";var r=i("b2b2"),a=i("5996"),n=i("0b2d"),s=i("e431"),o=i("8188"),c=i("afe1"),l=i("0278"),h=i("5a22"),d=i("7abc"),u=i("748f"),p=i("86ba");let g=0;const f="rg_";class b{constructor(){this.ROOT_ORIGIN_ID=f+"root_"+g++,this._origins=new Map,this._gridSize=42e5}getOrigin(e){const t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){if(Object(r["k"])(b.testOrigin)){const t=b.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,Object(d["a"])(t[0],t[1],t[2],this.ROOT_ORIGIN_ID)),this.getOrigin(e)}const t=Object(d["a"])(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,t),t}Object(s["k"])(m,e,t.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]);const i=this._gridSize;if(m[0]<i&&m[1]<i&&m[2]<i)return t;const a=Math.round(e[0]/i),n=Math.round(e[1]/i),o=Math.round(e[2]/i),c=`${f}${a}/${n}/${o}`;let l=this._origins.get(c);return l||(l=Object(d["a"])(a*i,n*i,o*i,c),this._origins.set(c,l)),l}_drawOriginBox(e){const t=window.view,i=t._stage;if(null==this._object){this._material=new p["a"]({width:2,color:[0,1,0,1]}),i.add(this._material);const e=new u["a"]({isPickable:!1});this._object=new h["a"]({castShadow:!1}),i.add(this._object),e.add(this._object),i.add(e)}const r=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],n=r.length,s=new Array(3*n),d=new Uint16Array(2*(n-1)),g=.5*this._gridSize;for(let a=0;a<n;a++)s[3*a+0]=e[0]+(1&r[a]?g:-g),s[3*a+1]=e[1]+(2&r[a]?g:-g),s[3*a+2]=e[2]+(4&r[a]?g:-g),a>0&&(d[2*a+0]=a-1,d[2*a+1]=a);Object(o["q"])(s,a["a"].WebMercator,0,s,t.spatialReference,0,n);const f=new l["a"]([["position",{size:3,data:s,exclusive:!0}]],[["position",d]],2);i.add(f),this._object.addGeometry(f,this._material,c["a"]),console.log(this._origins.size,e)}}const m=Object(n["e"])();!function(e){e.testOrigin=null}(b||(b={}));var v=b;t["a"]=v},b04d:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));var r=i("3886"),a=i("690a");function n(){const e=new a["a"];return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(r["a"]`
    void main(void) {
      vUV = uv0;
      gl_Position = proj * view * vec4(position, 1.0);
    }
  `),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(r["a"]`
    void main() {
      const float LINE_WIDTH = 1.0;

      vec2 uvScaled = vUV * gridWidth;
      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);

      // mask aliasing along edges
      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);

      float gridFade = max(grid.x, grid.y);

      float gridAlpha = gridColor.a * gridFade;

      // premultiply alpha in output
      gl_FragColor =
        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
        vec4(gridColor.rgb, 1.0) * gridAlpha;
    }
  `),e}var s=Object.freeze({__proto__:null,build:n})},b852:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return l}));var r=i("b2b2"),a=i("4c37"),n=i("2ff3"),s=i("a326");const o=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class c{constructor(){this.triangles=0,this.drawCalls=0}reset(){this.triangles=0,this.drawCalls=0}}function l(e,t,i){Object(r["k"])(i)&&(i.drawCalls+=e,i.triangles+=t)}class h extends n["a"]{constructor(){super("total"),this.total=0,this.frameCount=0}}class d{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new h,this.gpuTime=new n["a"]("gpu",9),this.renderPassTimings=o.map(e=>new n["a"](e)),this.stats=new c}enableGPUTimer(){return++this._enableGPUTimer,{remove:Object(a["d"])(()=>--this._enableGPUTimer)}}prerender(e){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=Object(s["a"])(e))}advance(e){const t=performance.now();this.renderPassTimings[e].record(t-this._lastSample),this._lastSample=t}postrender(){Object(r["k"])(this._gpuTimer)&&(this._gpuTimer.stop(e=>Object(r["k"])(e)&&this.gpuTime.record(e),16),this._gpuTimer=null);const e=performance.now()-this._startTime;this.totalTime.record(e),this.totalTime.total+=e,this.totalTime.frameCount++}}},bd75:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("3886");function a(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r["a"]`
      void forwardLinearDepth() { linearDepth = gl_Position.w; }
    `)):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(r["a"]`
      void forwardLinearDepth() {
        linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
      }
    `)):e.vertex.code.add(r["a"]`
      void forwardLinearDepth() {}
    `)}},c6f7:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("b2b2"),a=i("7af8"),n=i("59b2"),s=i("2698"),o=i("e041"),c=i("8eed"),l=i("92ef"),h=i("f402"),d=i("fcf2");function u(e){const t=Object(r["k"])(e)&&e.origins?e.origins:[void 0];return(i,r)=>{const a=p(e,i,r);for(const e of t){const t=Object(n["c"])(i,e,r);for(const e in a)t[e]=a[e]}}}function p(e,t,i){if(Object(r["k"])(e)&&"resource"===e.type)return g(e,t,i);switch(Object(r["k"])(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=d["c"];return{read:e,write:t}}}}function g(e,t,i){const n=Object(a["b"])(t,i);return{type:String,read:(e,t,i)=>{const r=Object(d["d"])(e,t,i);return n.type===String?r:"function"==typeof n.type?new n.type({url:r}):void 0},write:{writer(t,a,c,h){if(!h||!h.resources)return"string"==typeof t?void(a[c]=Object(d["e"])(t,h)):void(a[c]=t.write({},h));const u=_(t),p=u?Object(d["e"])(u,{...h,verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,g=n.type!==String&&(!Object(s["a"])(this)||h&&h.origin&&this.originIdOf(i)>Object(l["d"])(h.origin));h&&h.portalItem&&Object(r["k"])(p)&&!Object(o["s"])(p)?g?b(this,i,t,p,a,c,h,e):m(p,a,c,h):h&&h.portalItem&&(Object(r["j"])(p)||Object(r["k"])(Object(d["b"])(p))||Object(o["t"])(p)||g)?f(this,i,t,p,a,c,h,e):a[c]=p}}}}function f(e,t,i,a,n,s,l,d){const u=Object(c["a"])(),p=y(i,a,l),g=Object(o["y"])(Object(r["i"])(d,"prefix"),u),f=`${g}.${Object(h["a"])(p)}`,b=l.portalItem.resourceFromPath(f);Object(o["t"])(a)&&l.resources.pendingOperations.push(O(a).then(e=>{b.path=`${g}.${Object(h["a"])(e)}`,n[s]=b.itemRelativeUrl}).catch(()=>{})),v(e,t,b,p,l.resources.toAdd),n[s]=b.itemRelativeUrl}function b(e,t,i,r,a,n,s,c){const l=s.portalItem.resourceFromPath(r),d=y(i,r,s);Object(h["a"])(d)===Object(o["n"])(l.path)?(v(e,t,l,d,s.resources.toUpdate),a[n]=r):f(e,t,i,r,a,n,s,c)}function m(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}function v(e,t,i,r,a){a.push({resource:i,content:r,finish:i=>{j(e,t,i)}})}function y(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function O(e){const t=(await Promise.resolve().then(i.bind(null,"2eab"))).default,{data:r}=await t(e,{responseType:"blob"});return r}function _(e){return Object(r["j"])(e)?null:"string"==typeof e?e:e.url}function j(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}},caca:function(e,t,i){"use strict";var r=i("b2b2"),a=i("e92d"),n=i("1153");const s=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function o(e,t){return e+"_"+s.find(e=>e.output===t).name}const c=a["a"].getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");class l{constructor(e){this.refCnt=0,this.glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(n["a"])(this.refCnt>=0)}getRefCnt(){return this.refCnt}getGLMaterial(){return this.glMaterial}}class h{constructor(e,t,i){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=i,this._id2glMaterialRef=new Map}dispose(){this._textureRep.dispose()}acquire(e,t){this.ownMaterial(e);const i=o(e.id,t);let r=this._id2glMaterialRef.get(i);if(null==r){const a=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return r=new l(a),r.incRefCnt(),this._id2glMaterialRef.set(i,r),a}return r.incRefCnt(),r.getGLMaterial()}release(e,t){const i=o(e.id,t),r=this._id2glMaterialRef.get(i);if(r.decRefCnt(),0===r.getRefCnt()){const e=r.getGLMaterial();e&&e.dispose(),this._id2glMaterialRef.delete(i)}}materialChanged(e){for(const t of s)if(5!==t.output&&6!==t.output){const i=this._id2glMaterialRef.get(o(e.id,t.output));if(i&&i.getGLMaterial()){const e=i.getGLMaterial();e.updateParameters&&e.updateParameters()}}this.onMaterialChanged&&this.onMaterialChanged(e)}ownMaterial(e){Object(r["k"])(e.materialRepository)&&e.materialRepository!==this&&c.error("Material is already owned by a different material repository"),e.materialRepository=this}}t["a"]=h},d017:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("3886"),a=i("501b");function n(e){e.fragment.include(a["a"]),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(r["a"]`
    int chooseCascade(float _linearDepth, out mat4 mat) {
      vec4 distance = uShadowMapDistance;
      float depth = _linearDepth;

      //choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
      float texSize = 0.5 / halfPixelSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= uShadowMapNum) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
    }
  `)}!function(e){function t(e,t,i){t.shadowMappingEnabled&&(t.shadowMap.bind(e,i),t.shadowMap.bindView(e,t.origin))}function i(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)}function r(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}e.bindUniforms=t,e.bindViewCustomOrigin=i,e.bindView=r}(n||(n={}))},d329:function(e,t,i){"use strict";function r(e){return"r"in e&&"g"in e&&"b"in e}function a(e){return"h"in e&&"s"in e&&"v"in e}function n(e){return"l"in e&&"a"in e&&"b"in e}function s(e){return"l"in e&&"c"in e&&"h"in e}function o(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return R})),i.d(t,"b",(function(){return x})),i.d(t,"c",(function(){return M})),i.d(t,"d",(function(){return S})),i.d(t,"e",(function(){return w}));const c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const i=[];let r,a;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,s=e[0].length;let o=0;for(r=0;r<n;r++){for(o=0,a=0;a<s;a++)o+=e[r][a]*t[a];i.push(o)}return i}function d(e){const t=[e.r/255,e.g/255,e.b/255].map(e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4),i=h(c,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function u(e){const t=h(l,[e.x/100,e.y/100,e.z/100]).map(e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function p(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function f(e){const t=e.l,i=e.a,r=e.b,a=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:a,h:n}}function b(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function m(e){return p(d(e))}function v(e){return u(g(e))}function y(e){return f(p(d(e)))}function O(e){return u(g(b(e)))}function _(e){const t=e.r,i=e.g,r=e.b,a=Math.max(t,i,r),n=a-Math.min(t,i,r);let s=a,o=0===n?0:a===t?(i-r)/n%6:a===i?(r-t)/n+2:(t-i)/n+4,c=0===n?0:n/s;return o<0&&(o+=6),o*=60,c*=100,s*=100/255,{h:o,s:c,v:s}}function j(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,a=r*i,n=a*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:a,g:n,b:0};break;case 1:s={r:n,g:a,b:0};break;case 2:s={r:0,g:a,b:n};break;case 3:s={r:0,g:n,b:a};break;case 4:s={r:n,g:0,b:a};break;case 5:case 6:s={r:a,g:0,b:n};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+r-a),s.g=Math.round(s.g+r-a),s.b=Math.round(s.b+r-a),s}function w(e){return r(e)?e:s(e)?O(e):n(e)?v(e):o(e)?u(e):a(e)?j(e):e}function x(e){return a(e)?e:_(w(e))}function M(e){return n(e)?e:m(w(e))}function S(e){return s(e)?e:y(w(e))}function R(e,t){const i=m(e);return i.l*=1-t,v(i)}},d408:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return m}));var r=i("a21b"),a=i("b2b2"),n=i("38a4"),s=i("0b2d"),o=i("e431"),c=i("8188"),l=i("1666"),h=i("0278"),d=i("2e0f"),u=i("7585"),p=i("ed70");function g(e){const t=[],i=[];v(e,i,t);const r=i[0][1].data,a=t[0][1].length,n=new Uint16Array(a);return y(e,i,t),O(e,i,t,n),j(e,i,t,n),_(e,i,t,n),w(e,i,t,n),x(e,i,t,n),M(e,i,t,r),new h["a"](i,t,2)}function f(e,t,i,r){const a="polygon"===e.type?1:0,n="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(l["a"])(n,e.hasZ,a),c=new Float64Array(s.length),h=Object(d["c"])(s,e.spatialReference,0,c,0,s,0,s.length/3,t,i,r),u=null!=h;return{lines:u?b(o,s,c):[],projectionSuccess:u,sampledElevation:h}}function b(e,t,i){const r=new Array;for(const{index:a,count:n}of e){if(n<=1)continue;const e=3*a,s=e+3*n;r.push({position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function m(e,t){const i="polygon"===e.type?1:0,r="polygon"===e.type?e.rings:e.paths,{position:a,outlines:n}=Object(l["a"])(r,!1,i),s=Object(c["q"])(a,e.spatialReference,0,a,t,0,a.length/3);for(let o=2;o<a.length;o+=3)a[o]=u["a"];return{lines:s?b(n,a):[],projectionSuccess:s}}function v(e,t,i){const{attributeData:{position:a},removeDuplicateStartEnd:n}=e,s=R(a)&&1===n,o=a.length/3-(s?1:0),c=new Uint32Array(2*(o-1)),l=s?Object(r["m"])(a,0,a.length-3):a;let h=0;for(let r=0;r<o-1;r++)c[h++]=r,c[h++]=r+1;t.push(["position",{size:3,data:l,exclusive:s}]),i.push(["position",c])}function y(e,t,i){const r=e.attributeData.mapPosition;Object(a["j"])(r)||(i.push(["mapPos",i[0][1]]),t.push(["mapPos",{size:3,data:r}]))}function O(e,t,i,r){if(Object(a["k"])(e.attributeData.colorFeature))return;const n=e.attributeData.color;t.push(["color",{size:4,data:Object(a["u"])(n,p["c"])}]),i.push(["color",r])}function _(e,t,i,r){const n=e.attributeData.colorFeature;Object(a["j"])(n)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([n])}]),i.push(["color",r]))}function j(e,t,i,r){if(Object(a["k"])(e.attributeData.sizeFeature))return;const n=e.attributeData.size;t.push(["size",{size:1,data:[Object(a["u"])(n,1)]}]),i.push(["size",r])}function w(e,t,i,r){const n=e.attributeData.sizeFeature;Object(a["j"])(n)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([n])}]),i.push(["sizeFeatureAttribute",r]))}function x(e,t,i,r){const n=e.attributeData.opacityFeature;Object(a["j"])(n)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([n])}]),i.push(["opacityFeatureAttribute",r]))}function M(e,t,i,r){if("round"!==e.join)return;const s=r.length/3,c=new Float32Array(s),l=E,h=P;Object(o["x"])(l,0,0,0);const d=Object(a["u"])(e.uniformSize,1);for(let a=-1;a<s;++a){const e=a<0?s+a:a,t=(a+1)%s;if(Object(o["x"])(h,r[3*t+0]-r[3*e+0],r[3*t+1]-r[3*e+1],r[3*t+2]-r[3*e+2]),Object(o["s"])(h,h),a>=0){const e=(Math.PI-Object(n["b"])(Object(o["i"])(l,h)))*T*1*S(d);c[a]=Math.max(Math.floor(e),0)}Object(o["f"])(l,h,-1)}t.push(["subdivisions",{size:1,data:c}]),i.push(["subdivisions",i[0][1]])}function S(e){return 1.863798+-2.0062872/(1+e/18.2313)**.8856294}function R(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const E=Object(s["e"])(),P=Object(s["e"])(),T=4/Math.PI},d6e5:function(e,t,i){"use strict";var r=i("171c");class a{constructor(e,t,i,a,s,o){this.rctx=e,this.offscreenRenderingHelper=t,this.scenelightingData=i,this.shadowMap=a,this.ssaoHelper=s,this.sliceHelper=o,this.camera=null,this.lastFrameCamera=new r["a"],this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=n,this.hasOccludees=!1}resetRenderOccludedMask(){this.renderOccludedMask=n}get isHighlightPass(){return 5===this.pass}}const n=13;t["a"]=a},d981:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i("3886");function a(e){e.fragment.code.add(r["a"]`
    float normals2FoamIntensity(vec3 n, float waveStrength){
      float normalizationFactor =  max(0.015, waveStrength);
      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
    }
  `)}function n(e){e.fragment.code.add(r["a"]`
    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
    }
  `)}},df77:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("3886"),a=i("d047");function n(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(r["a"]`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy*0.5 + 0.5;
  }
  `)}function s(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(a["a"]),e.include(n),e.fragment.code.add(r["a"]`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}!function(e){function t(e,t,i){e.setUniform1i("lastFrameColorMap",i.lastFrameColorTextureUnit),t.bindTexture(i.lastFrameColorTexture,i.lastFrameColorTextureUnit),e.setUniformMatrix4fv("reprojectionMat",i.reprojectionMat),e.setUniformMatrix4fv("rpProjectionMat",i.camera.projectionMatrix)}e.bindUniforms=t}(n||(n={})),function(e){function t(e,t,i){i.ssrEnabled&&(e.setUniform1i("depthMapView",i.linearDepthTextureUnit),t.bindTexture(i.linearDepthTexture,i.linearDepthTextureUnit),e.setUniform2fv("nearFar",i.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",i.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/i.camera.height),n.bindUniforms(e,t,i))}e.bindUniforms=t}(s||(s={}))},dfd4:function(e,t,i){"use strict";i.r(t),i.d(t,"createCircle",(function(){return w})),i.d(t,"createEllipse",(function(){return x})),i.d(t,"createMultipoint",(function(){return v})),i.d(t,"createPoint",(function(){return m})),i.d(t,"createPolygon",(function(){return O})),i.d(t,"createPolyline",(function(){return y})),i.d(t,"createRectangle",(function(){return j})),i.d(t,"createSquare",(function(){return _})),i.d(t,"makeMapPoint",(function(){return b}));var r=i("7ffa"),a=i("b2b2"),n=i("b50f"),s=i("7f83"),o=i("4ae5"),c=i("57dc"),l=i("32ed"),h=i("1219"),d=i("521c"),u=(i("e06a"),i("8048")),p=i("b48e"),g=i("ea51"),f=i("a545");function b(e,t,i=null){return Object(a["k"])(i)?[e,t,i]:[e,t]}function m(e,t){const i=new o["a"]({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function v(e,t){return new c["a"]({points:e,spatialReference:t})}function y(e,t,i){const r=new d["a"]({paths:e,spatialReference:t});return i&&Object(l["i"])(r),r}function O(e,t,i,a=!0){const o=Object(r["a"])(e);o.forEach(e=>{const t=e[0],i=e[e.length-1];Object(n["e"])(t,i)&&1!==e.length||e.push(e[0])});let c=new h["a"]({rings:o,spatialReference:t});return c.rings.forEach(e=>{Object(l["g"])(e,!1,!1)||e.reverse()}),i&&Object(l["i"])(c),a&&c.isSelfIntersecting&&Object(s["j"])(t)&&(c=Object(g["simplify"])(c)),c}function _(e,t,i){const r=t.mapToLocalMultiple(e),n=[],s={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y},c=Math.round(o.x-s.x),l=Math.round(o.y-s.y),h=Math.max(Math.abs(c),Math.abs(l));if(i){const e={x:s.x+h,y:s.y+h},t={x:s.x-h,y:s.y-h};n.push(Object(f["b"])(e.x,t.y),Object(f["b"])(t.x,t.y),Object(f["b"])(t.x,e.y),Object(f["b"])(e.x,e.y))}else{const e={x:c>0?s.x+h:s.x-h,y:l>0?s.y+h:s.y-h};n.push(Object(f["b"])(s.x,s.y),Object(f["b"])(e.x,s.y),Object(f["b"])(e.x,e.y),Object(f["b"])(s.x,e.y))}return O([Object(a["g"])(n.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function j(e,t,i){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[Object(f["b"])(t.x-e,t.y+e),Object(f["b"])(t.x+e,t.y-e),Object(f["b"])(t.x+e,t.y-e),Object(f["b"])(t.x-e,t.y+e)]}const n=[],s={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y};if(i){const e=Math.round(o.x-s.x),t=Math.round(o.y-s.y);n.push(Object(f["b"])(s.x-e,s.y-t),Object(f["b"])(o.x,s.y-t),Object(f["b"])(o.x,o.y),Object(f["b"])(s.x-e,o.y))}else n.push(Object(f["b"])(s.x,s.y),Object(f["b"])(o.x,s.y),Object(f["b"])(o.x,o.y),Object(f["b"])(s.x,o.y));return O([Object(a["g"])(n.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!0)}function w(e,t,i,r){const n=t.mapToLocalMultiple(e);let o=null,c=null;if(i)o=n[0],c=n[1];else{const e=n[0],t=n[1],i=Math.round(t.x-e.x),r=Math.round(t.y-e.y),a=Math.max(Math.abs(i),Math.abs(r));o=Object(f["b"])(i>0?e.x+a/2:e.x-a/2,r>0?e.y+a/2:e.y-a/2),c=Object(f["b"])(Math.abs(i)>Math.abs(r)?o.x-a/2:o.x,Math.abs(i)>Math.abs(r)?o.y:o.y-a/2)}const h=t.localToMap(o),d=t.localToMap(c);if(Object(a["j"])(h)||Object(a["j"])(d))return null;t.doUnnormalization&&Object(l["j"])([[h,d]],t.spatialReference);const b=m(h,t.spatialReference),v=m(d,t.spatialReference),y=Object(u["e"])(t.spatialReference);let _=0;if(Object(s["j"])(t.spatialReference))_=y*Object(g["distance"])(b,v,null);else{const e=o.x-c.x,t=o.y-c.y;_=y*Math.sqrt(e*e+t*t)*(r||1)}const j=new p["a"]({center:b,radius:_,radiusUnit:"meters",spatialReference:t.spatialReference});return O(j.rings,j.spatialReference,!1)}function x(e,t,i){const r=t.mapToLocalMultiple(e),n=r[0],s=r[1],o=Math.round(s.x-n.x),c=Math.round(s.y-n.y),l=Object(f["b"])(i?n.x:n.x+o/2,i?n.y:n.y+c/2),h=i?o:o/2,d=i?c:c/2,u=60,p=[],g=2*Math.PI/u;for(let a=0;a<u;a++){const e=Math.cos(a*g),t=Math.sin(a*g),i=Object(f["b"])(h*e+l.x,d*t+l.y);p.push(i)}return p.push(p[0]),O([Object(a["g"])(p.map(e=>t.localToMap(e)))],t.spatialReference,t.doUnnormalization,!1)}},e550:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("3886"),a=i("df77"),n=i("d981");function s(e){e.fragment.code.add(r["a"]`
    const float GAMMA = 2.2;
    const float INV_GAMMA = 0.4545454545;

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)}var o=i("5d5f");function c(e,t){e.include(o["a"],t),e.include(s),e.include(n["a"]),t.ssrEnabled&&e.include(a["a"],t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(r["a"]`
    PBRShadingWater shadingInfo;

    /*
    *   This function is an approximation for the sky gradient reflected
    *   the water surface and describes a combination of two fresnel terms.
    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)
    *   @parameter: horizon = the dominant color of the sky horizon
    *   @parameter: cosTheta = the dominant color of the sky zenit
    */
    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
      return mix(zenit, horizon, exponent);
    }

    /*
    *   This function determines the water color per pixel.
    *   @parameter: n = normal facing away from the surface
    *   @parameter: v = view direction facing away from the surface.
    *   @parameter: l = light direction facing away from the surface
    *   @parameter: lightIntensity = light intensity, currently between 0...PI
    *   @parameter: localUp = a normal for the general direction of the surface
    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)
    */
    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {

      float reflectionHit = 0.;
      vec3 seaWaterColor = linearizeGamma(color);
      // using half vector to determine the specular light
      vec3 h = normalize(l + v);
      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);

      // angle between vertex normal and view direction
      float upDotV = max(dot(localUp,v), 0.0);
      // reflected sky color: the reflected sky color consists of two main colors, the
      // reflected color at the horizon and the reflected color of the zenit.
      // the reflected sky color is then an approximation based on the fresnel term.
      vec3 skyHorizon = linearizeGamma(skyColor);
      vec3 skyZenit = linearizeGamma(skyZenitColor);
      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );

      // we use the upDotL to smoothen out the
      // reflected color of the water
      float upDotL = max(dot(localUp,l),0.0);

      // The approximated sky color is adjusted according to the sun position.
      // This is done as approximation for e.g. night views.
      float daytimeMod = 0.1 + upDotL * 0.9;
      skyColor *= daytimeMod;

      // If a water surface is in shadow we just use a slight darkening of the
      // water surface expressed with this shadowModifier.
      float shadowModifier = clamp(shadow, 0.8, 1.0);

      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.
      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long
      // as reflection are absent there is a need to have a slight shadow for depth perception.
      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;

      // The reflected sea color is the input water color combined with the reflected sky color.
      // The reflected sky color is modified by the incoming light.
      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;

      vec3 specular = vec3(0.0);
      // This prevents the specular light to be rendered when:
      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)
      // - viewer is under water (for this localUp is better than n)
      if(upDotV > 0.0 && upDotL > 0.0) {
        // calculate the cook torrance BRDF but with simplified occlusion
        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);

        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here
        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;

        specular = shadingInfo.NdotL * incidentLight * specularSun;
      }

      vec3 foam = vec3(0.0);
      if(upDotV > 0.0) {
        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
      }
      `),t.ssrEnabled?e.fragment.code.add(r["a"]`
      // Convert the world position to view position
      vec4 viewPosition = vec4(positionView.xyz, 1.0);
      vec3 viewDir = normalize(viewPosition.xyz);
      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);

      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal
      // this removes some artifacts of normal mapping
      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);

      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));

      // perform screen space reflection to detect hit
      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
      vec3 reflectedColor = vec3(0.0);

      // if there is a hit with ssr find reflected color from the reprojeted frame
      if (hitCoordinate.z > 0.0)
      {
        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);

        // fade out if there if the hit is near end of Y axis
        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;

        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
      }
      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
      // combining reflected sky, reflected sea, specular highlight and SSR reflections.
      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
    }
  `):e.fragment.code.add(r["a"]`
      // combining reflected sky, reflected sea, specular highlight and SSR reflections.
      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
    }
  `)}},e94b:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i("b2b2"),a=i("3af1"),n=(i("e06a"),i("8048")),s=i("536f");function o(e,t,i,s=new a["a"]){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const a=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;o=Object(r["k"])(s)&&!s.equals(i.spatialReference)?Object(n["e"])(s)/Object(n["e"])(i.spatialReference):t*a}const c=e.x-o,l=e.y-o,h=e.x+o,d=e.y+o,{spatialReference:u}=i;return s.xmin=Math.min(c,h),s.ymin=Math.min(l,d),s.xmax=Math.max(c,h),s.ymax=Math.max(l,d),s.spatialReference=u,s}function c(e,t,i){const a=i.toMap(e);return!Object(r["j"])(a)&&o(a,Object(s["a"])(),i,l).intersects(t)}const l=new a["a"]},ea44:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return m}));var r=i("3886"),a=i("4db9"),n=i("690a"),s=i("4377"),o=i("d272"),c=i("d047"),l=i("6a07"),h=i("ebd5"),d=i("c6d7"),u=i("d017"),p=i("33e2"),g=i("bd75"),f=i("040b"),b=i("e550");function m(e){const t=new n["a"];return t.include(a["a"],{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(f["a"],e),t.include(g["a"],e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(r["a"]`
      void main(void) {
        if (waterColor.a < ${r["a"].float(h["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===e.output?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(d["b"],e)),7===e.output&&(t.include(o["a"],e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(r["a"]`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),0===e.output&&(t.include(p["a"],e),t.include(o["a"],e),e.receiveShadows&&t.include(u["a"],e),t.include(b["a"],e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(s["a"]),t.fragment.code.add(r["a"]`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        vec3 l = normalize(-lightingMainDirection);
        float shadow = ${e.receiveShadows?r["a"]`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),2===e.output&&(t.include(f["a"],e),t.include(p["a"],e),t.include(o["a"],e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(r["a"]`
        void main(void) {
          if (waterColor.a < ${r["a"].float(h["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(r["a"]`
        void main() {
          discardBySlice(vpos);

          // the created normal is in tangent space and foam
          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);

          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
        }
    `)),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(r["a"]`
        void main(void) {
          if (waterColor.a < ${r["a"].float(h["c"])}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(r["a"]`
        void main() {
          gl_FragColor = waterColor;
        }
    `)),4===e.output&&(t.include(l["a"]),t.varyings.add("vpos","vec3"),t.vertex.code.add(r["a"]`
      void main(void) {
        if (waterColor.a < ${r["a"].float(h["c"])}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(o["a"],e),t.fragment.code.add(r["a"]`
      void main() {
        discardBySlice(vpos);
        outputHighlight();
      }
    `)),t}var v=Object.freeze({__proto__:null,build:m})},ea51:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return R})),i.d(t,"clip",(function(){return o})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return _})),i.d(t,"crosses",(function(){return h})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return z})),i.d(t,"difference",(function(){return j})),i.d(t,"disjoint",(function(){return b})),i.d(t,"distance",(function(){return d})),i.d(t,"equals",(function(){return u})),i.d(t,"extendedSpatialReferenceInfo",(function(){return s})),i.d(t,"flipHorizontal",(function(){return I})),i.d(t,"flipVertical",(function(){return k})),i.d(t,"generalize",(function(){return G})),i.d(t,"geodesicArea",(function(){return F})),i.d(t,"geodesicBuffer",(function(){return E})),i.d(t,"geodesicDensify",(function(){return L})),i.d(t,"geodesicLength",(function(){return U})),i.d(t,"intersect",(function(){return x})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return y})),i.d(t,"nearestCoordinate",(function(){return P})),i.d(t,"nearestVertex",(function(){return T})),i.d(t,"nearestVertices",(function(){return D})),i.d(t,"offset",(function(){return S})),i.d(t,"overlaps",(function(){return m})),i.d(t,"planarArea",(function(){return V})),i.d(t,"planarLength",(function(){return H})),i.d(t,"relate",(function(){return v})),i.d(t,"rotate",(function(){return A})),i.d(t,"simplify",(function(){return O})),i.d(t,"symmetricDifference",(function(){return w})),i.d(t,"touches",(function(){return g})),i.d(t,"union",(function(){return M})),i.d(t,"within",(function(){return f}));var r=i("f606"),a=i("7590");function n(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return r["a"].extendedSpatialReferenceInfo(e)}function o(e,t){return r["a"].clip(a["hydratedAdapter"],n(e),e,t)}function c(e,t){return r["a"].cut(a["hydratedAdapter"],n(e),e,t)}function l(e,t){return r["a"].contains(a["hydratedAdapter"],n(e),e,t)}function h(e,t){return r["a"].crosses(a["hydratedAdapter"],n(e),e,t)}function d(e,t,i){return r["a"].distance(a["hydratedAdapter"],n(e),e,t,i)}function u(e,t){return r["a"].equals(a["hydratedAdapter"],n(e),e,t)}function p(e,t){return r["a"].intersects(a["hydratedAdapter"],n(e),e,t)}function g(e,t){return r["a"].touches(a["hydratedAdapter"],n(e),e,t)}function f(e,t){return r["a"].within(a["hydratedAdapter"],n(e),e,t)}function b(e,t){return r["a"].disjoint(a["hydratedAdapter"],n(e),e,t)}function m(e,t){return r["a"].overlaps(a["hydratedAdapter"],n(e),e,t)}function v(e,t,i){return r["a"].relate(a["hydratedAdapter"],n(e),e,t,i)}function y(e){return r["a"].isSimple(a["hydratedAdapter"],n(e),e)}function O(e){return r["a"].simplify(a["hydratedAdapter"],n(e),e)}function _(e,t=!1){return r["a"].convexHull(a["hydratedAdapter"],n(e),e,t)}function j(e,t){return r["a"].difference(a["hydratedAdapter"],n(e),e,t)}function w(e,t){return r["a"].symmetricDifference(a["hydratedAdapter"],n(e),e,t)}function x(e,t){return r["a"].intersect(a["hydratedAdapter"],n(e),e,t)}function M(e,t=null){return r["a"].union(a["hydratedAdapter"],n(e),e,t)}function S(e,t,i,s,o,c){return r["a"].offset(a["hydratedAdapter"],n(e),e,t,i,s,o,c)}function R(e,t,i,s=!1){return r["a"].buffer(a["hydratedAdapter"],n(e),e,t,i,s)}function E(e,t,i,s,o,c){return r["a"].geodesicBuffer(a["hydratedAdapter"],n(e),e,t,i,s,o,c)}function P(e,t,i=!0){return r["a"].nearestCoordinate(a["hydratedAdapter"],n(e),e,t,i)}function T(e,t){return r["a"].nearestVertex(a["hydratedAdapter"],n(e),e,t)}function D(e,t,i,s){return r["a"].nearestVertices(a["hydratedAdapter"],n(e),e,t,i,s)}function C(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function A(e,t,i){var a;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(i=null!=(a=i)?a:C(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(r["a"].rotate(e,t,i));return s.spatialReference=n,s}function I(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;if(null==(t=null!=(i=t)?i:C(e)))throw new Error("Illegal Argument Exception");const n=e.constructor.fromJSON(r["a"].flipHorizontal(e,t));return n.spatialReference=a,n}function k(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;if(null==(t=null!=(i=t)?i:C(e)))throw new Error("Illegal Argument Exception");const n=e.constructor.fromJSON(r["a"].flipVertical(e,t));return n.spatialReference=a,n}function G(e,t,i,s){return r["a"].generalize(a["hydratedAdapter"],n(e),e,t,i,s)}function z(e,t,i){return r["a"].densify(a["hydratedAdapter"],n(e),e,t,i)}function L(e,t,i,s=0){return r["a"].geodesicDensify(a["hydratedAdapter"],n(e),e,t,i,s)}function V(e,t){return r["a"].planarArea(a["hydratedAdapter"],n(e),e,t)}function H(e,t){return r["a"].planarLength(a["hydratedAdapter"],n(e),e,t)}function F(e,t,i){return r["a"].geodesicArea(a["hydratedAdapter"],n(e),e,t,i)}function U(e,t,i){return r["a"].geodesicLength(a["hydratedAdapter"],n(e),e,t,i)}},eaa4:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i("b50f");class a{constructor(){this._uniforms={proj:[],uShadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}dispose(){this._uniforms=null}getPrograms(e){return this._uniforms[e]||[]}subscribeProgram(e){for(const t in this._uniforms)e.hasUniform(t)&&this._uniforms[t].push(e)}unsubscribeProgram(e){for(const t in this._uniforms)Object(r["l"])(this._uniforms[t],e)}}},ed70:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s}));var r=i("0fc4");const a=1.2,n=r["b"],s=r["a"]},f3d9:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d}));var r=i("3886"),a=i("4db9"),n=i("690a"),s=i("4377"),o=i("d272"),c=i("d047"),l=i("ebd5"),h=i("c6d7");function d(e){const t=new n["a"];return t.include(a["a"],{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(r["a"]`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(o["a"],e),e.multipassTerrainEnabled&&(t.fragment.include(c["a"]),t.include(h["b"],e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(r["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${r["a"].float(l["b"])}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(s["a"]),t.fragment.code.add(r["a"]`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${r["a"].float(l["b"])}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}var u=Object.freeze({__proto__:null,build:d})},f498:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return _}));var r=i("a4ee"),a=i("c3a4"),n=i("ca98"),s=i("da35"),o=i("fa1e"),c=i("8e37"),l=i("189c"),h=i("8e97"),d=i("8dd3"),u=i("d272"),p=i("6a07"),g=i("7438"),f=i("c6d7"),b=i("d017"),m=i("df77"),v=i("33e2"),y=i("ea44");class O extends n["a"]{constructor(e,t){super(e,t),this.waterTextureRepository=e.waterTextureRepository}initializeProgram(e){const t=O.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:i.useSSR,highStepCount:!0,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new c["a"](e.rctx,r.generateSource("vertex"),r.generateSource("fragment"),o["a"])}ensureResource(e){return this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(e),this.waterTextureRepository.ready?2:1}bindPass(e,t,i){h["a"].bindProjectionMatrix(this.program,i.camera.projectionMatrix),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(f["a"])(this.program,e,i)),0===this.configuration.output&&(i.lighting.setUniforms(this.program,!1),m["a"].bindUniforms(this.program,e,i)),0!==this.configuration.output&&2!==this.configuration.output||(v["a"].bindUniforms(this.program,t),this.waterTextureRepository.bindRepo(e)),this.program.setUniform4fv("waterColor",t.color),4===this.configuration.output&&p["a"].bindOutputHighlight(e,this.program,i)}bindDraw(e){h["a"].bindView(this.program,e),0!==this.configuration.output&&7!==this.configuration.output||h["a"].bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&b["a"].bindUniforms(this.program,e,d["a"].SHADOW_MAP),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||u["a"].bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e;return Object(l["e"])({blending:2!==t.output&&4!==t.output&&t.transparent?i?g["f"]:Object(g["a"])(e):null,depthTest:{func:Object(g["b"])(e)},depthWrite:i?t.writeDepth&&l["d"]:Object(g["c"])(e),colorWrite:l["c"],polygonOffset:i||r?null:Object(g["g"])(t.enableOffset)})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}O.shader=new a["a"](y["a"],()=>i.e("chunk-2d0a5169").then(i.bind(null,"08e0")));class _ extends s["a"]{constructor(){super(...arguments),this.output=0,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(r["a"])([Object(s["b"])({count:8})],_.prototype,"output",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"receiveShadows",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"slicePlaneEnabled",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"transparent",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"enableOffset",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"writeDepth",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"useSSR",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"isDraped",void 0),Object(r["a"])([Object(s["b"])({count:4})],_.prototype,"transparencyPassType",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"multipassTerrainEnabled",void 0),Object(r["a"])([Object(s["b"])()],_.prototype,"cullAboveGround",void 0)},fb2c:function(e,t,i){"use strict";function r(e,t,i){const r=t&&t.length,n=r?t[0]*i:e.length;let o=a(e,0,n,i,!0);const c=new Array;if(!o||o.next===o.prev)return c;let l,h,d,p,g;if(r&&(o=u(e,t,o,i)),e.length>80*i){l=d=e[0],h=p=e[1];for(let t=i;t<n;t+=i){const i=e[t],r=e[t+1];l=Math.min(l,i),h=Math.min(h,r),d=Math.max(d,i),p=Math.max(p,r)}g=Math.max(d-l,p-h),g=0!==g?1/g:0}return s(o,c,i,l,h,g),c}function a(e,t,i,r,a){let n;if(a===_(e,t,i,r)>0)for(let s=t;s<i;s+=r)n=l(s,e[s],e[s+1],n);else for(let s=i-r;s>=t;s-=r)n=l(s,e[s],e[s+1],n);return n&&M(n,n.next)&&(h(n),n=n.next),n}function n(e,t=e){if(!e)return e;let i,r=e;do{if(i=!1,r.steiner||!M(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(h(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function s(e,t,i,r,a,l,d=0){if(!e)return;!d&&l&&(e=f(e,r,a,l));let u=e;for(;e.prev!==e.next;){const p=e.prev,g=e.next;if(l?c(e,r,a,l):o(e))t.push(p.index/i),t.push(e.index/i),t.push(g.index/i),h(e),e=g.next,u=g.next;else if((e=g)===u){d?1===d?s(e=R(e,t,i),t,i,r,a,l,2):2===d&&E(e,t,i,r,a,l):s(n(e),t,i,r,a,l,1);break}}}function o(e){const t=e.prev,i=e,r=e.next;if(v(t,i,r)>=0)return!1;let a=e.next.next;const n=a;let s=0;for(;a!==e.prev&&(0===s||a!==n);){if(s++,j(t.x,t.y,i.x,i.y,r.x,r.y,a.x,a.y)&&v(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function c(e,t,i,r){const a=e.prev,n=e,s=e.next;if(v(a,n,s)>=0)return!1;const o=a.x<n.x?a.x<s.x?a.x:s.x:n.x<s.x?n.x:s.x,c=a.y<n.y?a.y<s.y?a.y:s.y:n.y<s.y?n.y:s.y,l=a.x>n.x?a.x>s.x?a.x:s.x:n.x>s.x?n.x:s.x,h=a.y>n.y?a.y>s.y?a.y:s.y:n.y>s.y?n.y:s.y,d=x(o,c,t,i,r),u=x(l,h,t,i,r);let p=e.prevZ,g=e.nextZ;for(;p&&p.z>=d&&g&&g.z<=u;){if(p!==e.prev&&p!==e.next&&j(a.x,a.y,n.x,n.y,s.x,s.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&j(a.x,a.y,n.x,n.y,s.x,s.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&j(a.x,a.y,n.x,n.y,s.x,s.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=u;){if(g!==e.prev&&g!==e.next&&j(a.x,a.y,n.x,n.y,s.x,s.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function l(e,t,i,r){const a=new C(e,t,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function h(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function d(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function u(e,t,i,r){const s=new Array;for(let n=0,o=t.length;n<o;n++){const i=a(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1);i===i.next&&(i.steiner=!0),s.push(d(i))}s.sort(S);for(const a of s)p(a,i),i=n(i,i.next);return i}function p(e,t){if(t=g(e,t)){const i=D(t,e);n(i,i.next)}}function g(e,t){let i=t;const r=e.x,a=e.y;let n,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const e=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>s){if(s=e,e===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===s)return n.prev;const o=n,c=n.x,l=n.y;let h,d=1/0;for(i=n.next;i!==o;)r>=i.x&&i.x>=c&&r!==i.x&&j(a<l?r:s,a,c,l,a<l?s:r,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(r-i.x),(h<d||h===d&&i.x>n.x)&&w(i,e)&&(n=i,d=h)),i=i.next;return n}function f(e,t,i,r){for(let a;a!==e;a=a.next){if(a=a||e,null===a.z&&(a.z=x(a.x,a.y,t,i,r)),a.prev.next!==a||a.next.prev!==a)return a.prev.next=a,a.next.prev=a,f(e,t,i,r);a.prevZ=a.prev,a.nextZ=a.next}return e.prevZ.nextZ=null,e.prevZ=null,b(e)}function b(e){let t,i=1;for(;;){let r,a=e;e=null,t=null;let n=0;for(;a;){n++,r=a;let s=0;for(;s<i&&r;s++)r=r.nextZ;let o=i;for(;s>0||o>0&&r;){let i;0===s?(i=r,r=r.nextZ,o--):0!==o&&r?a.z<=r.z?(i=a,a=a.nextZ,s--):(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,s--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}a=r}if(t.nextZ=null,i*=2,n<2)return e}}function m(e,t,i,r){const a=t&&t.length,n=a?t[0]*i:e.length;let s=Math.abs(_(e,0,n,i));if(a)for(let c=0,l=t.length;c<l;c++){const r=t[c]*i,a=c<l-1?t[c+1]*i:e.length;s-=Math.abs(_(e,r,a,i))}let o=0;for(let c=0;c<r.length;c+=3){const t=r[c]*i,a=r[c+1]*i,n=r[c+2]*i;o+=Math.abs((e[t]-e[n])*(e[a+1]-e[t+1])-(e[t]-e[a])*(e[n+1]-e[t+1]))}return 0===s&&0===o?0:Math.abs((o-s)/s)}function v(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t,i,r){return!!(M(e,t)&&M(i,r)||M(e,r)&&M(i,t))||v(e,t,i)>0!=v(e,t,r)>0&&v(i,r,e)>0!=v(i,r,t)>0}function O(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&y(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function _(e,t,i,r){let a=0;for(let n=t,s=i-r;n<i;n+=r)a+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return a}function j(e,t,i,r,a,n,s,o){return(a-s)*(t-o)-(e-s)*(n-o)>=0&&(e-s)*(r-o)-(i-s)*(t-o)>=0&&(i-s)*(n-o)-(a-s)*(r-o)>=0}function w(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function x(e,t,i,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function M(e,t){return e.x===t.x&&e.y===t.y}function S(e,t){return e.x-t.x}function R(e,t,i){let r=e;do{const a=r.prev,n=r.next.next;!M(a,n)&&y(a,r,r.next,n)&&w(a,n)&&w(n,a)&&(t.push(a.index/i),t.push(r.index/i),t.push(n.index/i),h(r),h(r.next),r=e=n),r=r.next}while(r!==e);return r}function E(e,t,i,r,a,o){let c=e;do{let e=c.next.next;for(;e!==c.prev;){if(c.index!==e.index&&P(c,e)){let l=D(c,e);return c=n(c,c.next),l=n(l,l.next),s(c,t,i,r,a,o),void s(l,t,i,r,a,o)}e=e.next}c=c.next}while(c!==e)}function P(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!O(e,t)&&w(e,t)&&w(t,e)&&T(e,t)}function T(e,t){let i=e,r=!1;const a=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&a<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function D(e,t){const i=new C(e.index,e.x,e.y),r=new C(t.index,t.x,t.y),a=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=a,a.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return r}));class C{constructor(e,t,i){this.index=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},fdc9:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i("8a44");class a{constructor(){this.adds=new r["a"],this.removes=new r["a"],this.updates=new r["a"]({allocator:e=>e||new n,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class n{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}}}]);
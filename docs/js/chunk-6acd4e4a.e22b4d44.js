(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6acd4e4a"],{"0e0b":function(e,t,r){"use strict";var i=r("a4ee"),s=(r("c120"),r("e92d"),r("cea0"),r("59b2")),a=r("d386"),n=(r("e041"),r("8eed"),r("f402"),r("fc29")),o=r("ce6d"),l=r("9180"),c=r("8188"),u=r("0fc4"),d=r("4261");let p=class extends n["a"]{constructor(e){super(e),this.events=new o["a"]}destroy(){}forEach(e){this.forAllFeatures(t=>(e(t),1))}forEachBounds(e,t,r){const i=this.getFeatureExtent;for(const s of e)t(i(s,r))}forEachInBounds(e,t){this.forAllFeatures(r=>{const i=this.getFeatureExtent(r,y);return Object(l["w"])(e,Object(d["G"])(i,h))&&t(r),1},t=>{if(Object(c["p"])(t.node.mbs,this.sourceSpatialReference,b,this.viewSpatialReference),b[0]>=e[0]&&b[2]<=e[2]&&b[1]>=e[1]&&b[3]<=e[3])return 1;const r=Math.max(e[0],Math.min(b[0],e[2])),i=Math.max(e[1],Math.min(b[1],e[3])),s=b[0]-r,a=b[1]-i;return s*s+a*a<=b[3]*b[3]?1:2})}};Object(i["a"])([Object(s["b"])({constructOnly:!0})],p.prototype,"featureAdapter",void 0),Object(i["a"])([Object(s["b"])({constructOnly:!0})],p.prototype,"forAllFeatures",void 0),Object(i["a"])([Object(s["b"])({constructOnly:!0})],p.prototype,"getFeatureExtent",void 0),Object(i["a"])([Object(s["b"])({constructOnly:!0})],p.prototype,"sourceSpatialReference",void 0),Object(i["a"])([Object(s["b"])({constructOnly:!0})],p.prototype,"viewSpatialReference",void 0),p=Object(i["a"])([Object(a["a"])("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],p);const b=Object(u["c"])(),y=Object(d["h"])(),h=Object(l["l"])();var O=p;t["a"]=O},"16d0":function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r("a4ee"),s=(r("c120"),r("e92d")),a=(r("cea0"),r("59b2")),n=r("d386"),o=(r("e041"),r("8eed"),r("f402"),r("66a2")),l=r("ee9c");const c=s["a"].getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),u=e=>{let t=class extends e{constructor(){super(...arguments),this._definitionExpressionErrors=0,this._maxDefinitionExpressionErrors=20,this.logError=e=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&c.error("Error while evaluating definitionExpression: "+e),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&c.error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const e=o["WhereClause"].create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return c.error("definitionExpression is using non standard function"),null;const t=[],r=e.fieldNames;return Object(l["l"])(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(c.error("definitionExpression references unknown fields: "+t.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return c.error("Failed to parse definitionExpression: "+e),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}_evaluateClause(e,t){try{return e.testFeature(t)}catch(r){return this.logError(r),!1}}_addDefinitionExpressionToQuery(e){if(!this.parsedDefinitionExpression)return e;const t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where=`(${t}) AND (${r.where})`:r.where=t,r}};return Object(i["a"])([Object(a["b"])()],t.prototype,"i3slayer",void 0),Object(i["a"])([Object(a["b"])({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),Object(i["a"])([Object(a["b"])({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=Object(i["a"])([Object(n["a"])("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},"18cc":function(e,t,r){"use strict";var i=r("a4ee"),s=(r("c120"),r("b2b2")),a=(r("e92d"),r("cea0"),r("59b2")),n=r("d386"),o=r("ce50"),l=(r("e041"),r("8eed"),r("f402"),r("fc29")),c=r("3af1"),u=r("af40"),d=r("f29a"),p=r("c64f"),b=r("6411");const y=b["a"];let h=class extends l["a"]{constructor(e){super(e),this._dataQueryEngineInstance=null,this._handles=new u["a"]}get defaultQueryJSON(){return new p["a"]({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}initialize(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null),this._handles&&(this._handles.destroy(),this._handles=null),this._set("layerView",null)}async executeQueryForCount(e,t){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)}async executeQueryForExtent(e,t){const{count:r,extent:i}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t);return{count:r,extent:c["a"].fromJSON(i)}}async executeQueryForIds(e,t){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)}async executeQuery(e,t){const r=this._ensureQueryJSON(e);if(r.returnGeometry)throw new o["a"]("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(r.returnCentroid)throw new o["a"]("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");const i=await this.dataQueryEngine.executeQuery(r,t),s=d["default"].fromJSON(i);return s.features.forEach(e=>{e.geometry=null}),s}_ensureQueryJSON(e){if(Object(s["j"])(e))return this.defaultQueryJSON;const t=e.toJSON();return t.outSpatialReference||(e.outSpatialReference=this.spatialReference),t}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=this.layer.objectIdField||"OBJECTID",t="esriGeometryPolygon",r=this.layer.fields.map(e=>e.toJSON()),i=this.layerView.view.resourceController.scheduler,s=this.spatialReference.toJSON(),a=this.task,n=this.spatialIndex;return this._dataQueryEngineInstance=new y({hasZ:!0,hasM:!1,geometryType:t,fields:r,timeInfo:null,spatialReference:s,objectIdField:e,featureStore:n,scheduler:i,task:a}),this._dataQueryEngineInstance}};Object(i["a"])([Object(a["b"])({constructOnly:!0})],h.prototype,"layerView",void 0),Object(i["a"])([Object(a["b"])({constructOnly:!0})],h.prototype,"task",void 0),Object(i["a"])([Object(a["b"])({constructOnly:!0})],h.prototype,"spatialIndex",void 0),Object(i["a"])([Object(a["b"])({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],h.prototype,"spatialReference",void 0),Object(i["a"])([Object(a["b"])({readOnly:!0,aliasOf:"layerView.i3slayer"})],h.prototype,"layer",void 0),Object(i["a"])([Object(a["b"])({readOnly:!0})],h.prototype,"defaultQueryJSON",null),h=Object(i["a"])([Object(n["a"])("esri.views.3d.layers.i3s.I3SQueryEngine")],h);var O=h;t["a"]=O},"246f":function(e,t,r){"use strict";r.r(t);var i=r("a4ee"),s=(r("c120"),r("b2b2")),a=r("e92d"),n=(r("cea0"),r("c649")),o=r("59b2"),l=r("d386"),c=(r("e041"),r("8eed"),r("f402"),r("f4cc")),u=r("fc29"),d=r("2c4f"),p=r("8d60"),b=r("3795"),y=(r("433f"),r("66af")),h=r("9ee2"),O=(r("0b86"),r("365a"));class j extends O["a"]{constructor(){super(...arguments),this.layer=null,this.sublayerViews=null}highlight(e){throw new Error("Not implemented")}}Object(i["a"])([Object(o["b"])()],j.prototype,"layer",void 0),Object(i["a"])([Object(o["b"])()],j.prototype,"sublayerViews",void 0);var f=j,g=r("ee9c"),m=r("ce6d"),v=r("a5d8"),w=r("fab3"),x=r("9096");const F=(e,t)=>{let r=class extends(Object(w["b"])(Object(x["b"])(Object(v["a"])(m["a"].EventedMixin(e))))){constructor(e){super(e),this.sublayer=null,this.parent=null,this.view=null}initialize(){}get suspended(){return!this.canResume()}get updating(){return!this.suspended&&this.isUpdating()}get visible(){return!0===this.get("sublayer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}get fullOpacity(){const e=e=>null!=e?e:1;return e(this.get("sublayer.opacity"))*e(this.get("parent.fullOpacity"))}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.visible||!1}isUpdating(){return!1}};return Object(i["a"])([Object(o["b"])()],r.prototype,"sublayer",void 0),Object(i["a"])([Object(o["b"])()],r.prototype,"parent",void 0),Object(i["a"])([Object(o["b"])({readOnly:!0})],r.prototype,"suspended",null),Object(i["a"])([Object(o["b"])({type:Boolean,readOnly:!0})],r.prototype,"updating",null),Object(i["a"])([Object(o["b"])()],r.prototype,"view",void 0),Object(i["a"])([Object(o["b"])()],r.prototype,"visible",null),Object(i["a"])([Object(o["b"])()],r.prototype,"fullOpacity",null),r=Object(i["a"])([Object(l["a"])("esri.views.3d.layers.BuildingSublayerView3D")],r),r};var E=r("0fc4"),S=r("ec13");const I=.15,_=.5*I;function R(e){switch(e.filterMode.type){case"solid":return{mode:0};case"wire-frame":return{mode:1,edgeMaterial:Object(S["b"])(e.filterMode.edges,{})};case"x-ray":return{mode:2}}}function M(e,t){if(Object(s["j"])(t))return e.color[3]=0,e.edgeMaterial=null,void(e.pickable=!1);switch(t.mode){case 0:return;case 1:return e.color[3]=0,e.edgeMaterial=t.edgeMaterial,void(e.pickable=!1);case 2:return e.color[0]=1,e.color[1]=1,e.color[2]=1,e.color[3]*=I,e.colorMixMode=3,e.castShadows=!1,e.pickable=!1,void(e.edgeMaterial=Q(e.edgeMaterial))}}function Q(e){return Object(s["j"])(e)?null:(C.lastMaterial!==e&&(C.cachedMaterial=k(e),C.lastMaterial=e),C.cachedMaterial)}function k(e){const t=Object(E["f"])(e.color);return t[3]*=_,{...e,color:t}}const C={cachedMaterial:null,lastMaterial:null};var L=r("ce50"),T=r("c1da"),P=r("9305"),q=r("66a2"),N=r("c64f");r("e814");class V extends u["a"]{constructor(){super(...arguments),this.sublayer=null}get updating(){return!1}get suspended(){return!1}get availableFields(){return[]}get filter(){return null}set filter(e){throw new Error("Not implemented")}queryFeatures(e,t){throw new Error("Not implemented")}queryObjectIds(e,t){throw new Error("Not implemented")}queryFeatureCount(e,t){throw new Error("Not implemented")}createQuery(){throw new Error("Not implemented")}queryExtent(e,t){throw new Error("Not implemented")}highlight(e){throw new Error("Not implemented")}}Object(i["a"])([Object(o["b"])()],V.prototype,"sublayer",void 0),Object(i["a"])([Object(o["b"])()],V.prototype,"availableFields",null),Object(i["a"])([Object(o["b"])()],V.prototype,"filter",null);var D=V,A=r("33c9"),U=r("ad73"),B=r("9a0d"),G=r("4c7e"),W=r("4bb0"),J=r("18cc"),z=r("8ea5"),Z=r("0e0b"),H=r("16d0");const $=a["a"].getLogger("esri.views.3d.layers.BuildingComponentSublayerView3D");let K=class extends(Object(H["a"])(Object(G["a"])(F(D)))){constructor(){super(...arguments),this.layerView=null,this._elevationContext="scene",this._isIntegratedMesh=!1,this._supportsLabeling=!1,this.lodFactor=1,this.progressiveLoadFactor=1,this._queryEngine=null}get layerUid(){return this.sublayer.layer.uid}get sublayerUid(){return this.sublayer.uid}initialize(){this.updatingHandles.add(this,"sublayer.renderer,definitionExpressionFields,filterExpressionFields",()=>this._updateRequiredFields()),this.updatingHandles.add(this.sublayer,"renderer",e=>this._rendererChange(e),2);for(const e of["parsedDefinitionExpression","filter","viewFilter.parsedWhereClause","viewFilter.parsedGeometry","viewFilter.sortedObjectIds"])this.updatingHandles.add(this,e,()=>this._filterChange());this.updatingHandles.add(this,"parsedFilterExpressions",()=>this._updateSymbologyOverride(),2),this.addResolvingPromise(this._updateRequiredFields())}get parsedFilterExpressions(){return"Overview"===this.sublayer.modelName?[]:this.layerView.filterExpressions.map(([e,t])=>{let r;try{r=q["WhereClause"].create(e,this.sublayer.fieldsIndex)}catch(a){return $.error("Failed to parse filterExpression: "+a),null}if(!r.isStandardized)return $.error("filterExpression is using non standard function"),null;const i=[],s=r.fieldNames;return Object(g["l"])(s,this.sublayer.fields,{missingFields:i}),i.length>0?($.error("filterExpression references unknown fields: "+i.join(", ")),null):[r,t]}).filter(e=>null!=e)}get filter(){return Object(s["k"])(this.viewFilter)?this.viewFilter.filter:null}set filter(e){!Object(s["j"])(e)&&W["a"].checkSupport(e)?Object(s["k"])(this.viewFilter)?this.viewFilter.filter=e:this.viewFilter=new W["a"]({filter:e,layerFieldsIndex:this.sublayer.fieldsIndex,loadAsyncModule:e=>this._loadAsyncModule(e),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(e,t)=>this.addSqlFilter(e,t,this.logError)}):this.viewFilter=null}_updateSymbologyOverride(){const e=this.parsedFilterExpressions;e.length>0?this._setSymbologyOverride((t,r)=>{for(const[s,a]of e)try{if(s.testFeature(t))return M(r,a)}catch(i){this.logError(i)}return M(r,null)},this.filterExpressionFields):this._setSymbologyOverride(null,null)}get filterExpressionFields(){return Object(T["i"])(this.sublayer.fields,this.parsedFilterExpressions.reduce((e,[t])=>e.concat(t.fieldNames),[]))}get availableFields(){const e=this.sublayer,t=e.fields;let r=this.requiredFields;if(e.outFields||e.layer.outFields){const i=[...e.outFields||[],...e.layer.outFields||[]];r=[...Object(T["v"])(t,i),...r]}return Object(T["i"])(t,r)}_createLayerGraphic(e){const t=new p["a"](null,null,e);return t.layer=this.sublayer.layer,t.sourceLayer=this.sublayer,t}canResume(){return super.canResume()&&(!this._controller||this._controller.rootNodeVisible)}async fetchPopupFeatures(e,t){const r=this._validateFetchPopupFeatures(t);if(r)return Promise.reject(r);if(!Object(s["k"])(t)||!t.clientGraphics||0===t.clientGraphics.length)return[];const i=[],a=[],n=Object(s["k"])(this.sublayer.associatedLayer)?await this.sublayer.associatedLayer.load():this.sublayer,o=Object(T["v"])(this.sublayer.fields,await Object(U["b"])(n,Object(U["a"])(this.sublayer,t))),l=new Set;for(const s of t.clientGraphics)Object(T["t"])(o,s,l)?a.push(s):i.push(s);return 0===a.length?Promise.resolve(i):(Object(s["k"])(this.sublayer.associatedLayer)&&await this.sublayer.associatedLayer.load().catch(()=>$.warn("Failed to load associated feature layer. Displaying popup attributes from cached attributes.")),this.whenGraphicAttributes(a,Array.from(l)).catch(()=>a).then(e=>i.concat(e)))}async _updateRequiredFields(){const e=Object(T["i"])(this.sublayer.fields,[...this.sublayer.renderer?await this.sublayer.renderer.getRequiredFields(this.sublayer.fields):[],...this.definitionExpressionFields||[],...this.filterExpressionFields||[]]);this._set("requiredFields",e)}_validateFetchPopupFeatures(e){const{sublayer:t}=this,{popupEnabled:r}=t;return r?Object(U["a"])(t,e)?void 0:new L["a"]("buildingscenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{sublayer:t}):new L["a"]("buildingscenelayerview3d:fetchPopupFeatures","Popups are disabled",{sublayer:t})}getFilters(){const e=super.getFilters();return this.addSqlFilter(e,this.parsedDefinitionExpression,this.logError),Object(s["k"])(this.viewFilter)&&this.viewFilter.addFilters(e,this.view,this._controller.crsIndex,this._collection),e}createQuery(){const e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return Object(s["k"])(this.filter)?this.filter.createQuery(e):new N["a"](e)}queryExtent(e,t){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatureCount(e,t){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null==t?void 0:t.signal)}queryFeatures(e,t){return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null==t?void 0:t.signal).then(e=>{if(null==e||!e.features)return e;const t=this.sublayer,r=t.layer;for(const i of e.features)i.layer=r,i.sourceLayer=t;return e})}queryObjectIds(e,t){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null==t?void 0:t.signal)}_ensureQueryEngine(){return Object(s["j"])(this._queryEngine)&&(this._queryEngine=this._createQueryEngine()),this._queryEngine}_createQueryEngine(){const e=Object(B["c"])(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new J["a"]({layerView:this,task:P["b"].FEATURE_QUERY_ENGINE,spatialIndex:new Z["a"]({featureAdapter:new z["a"]({objectIdField:this.sublayer.objectIdField,attributeStorageInfo:this.sublayer.attributeStorageInfo,getFeatureExtent:e}),forAllFeatures:(e,t)=>this._forAllFeatures((t,r,i)=>e({id:t,index:r,meta:i}),t,2),getFeatureExtent:e,sourceSpatialReference:Object(g["q"])(this.sublayer),viewSpatialReference:this.view.spatialReference})})}_ensureQuery(e){return this._addDefinitionExpressionToQuery(Object(s["j"])(e)?this.createQuery():N["a"].from(e))}};Object(i["a"])([Object(o["b"])({aliasOf:"sublayer"})],K.prototype,"i3slayer",void 0),Object(i["a"])([Object(o["b"])()],K.prototype,"layerView",void 0),Object(i["a"])([Object(o["b"])()],K.prototype,"suspended",void 0),Object(i["a"])([Object(o["b"])({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],K.prototype,"lodFactor",void 0),Object(i["a"])([Object(o["b"])({readOnly:!0})],K.prototype,"parsedFilterExpressions",null),Object(i["a"])([Object(o["b"])({type:A["a"]})],K.prototype,"filter",null),Object(i["a"])([Object(o["b"])()],K.prototype,"viewFilter",void 0),Object(i["a"])([Object(o["b"])({type:[String],readOnly:!0})],K.prototype,"filterExpressionFields",null),Object(i["a"])([Object(o["b"])({type:[String],readOnly:!0})],K.prototype,"requiredFields",void 0),Object(i["a"])([Object(o["b"])({type:[String],readOnly:!0})],K.prototype,"availableFields",null),K=Object(i["a"])([Object(l["a"])("esri.views.3d.layers.BuildingComponentSublayerView3D")],K);var Y=K,X=Y;const ee=a["a"].getLogger("esri.views.3d.layers.BuildingSceneLayerView3D"),te=F(u["a"]);let re=class extends(Object(y["a"])(f)){constructor(){super(...arguments),this.sublayerViews=new d["a"],this._abortController=Object(c["e"])(),this._loadingComponents=0}get filterExpression(){const e=this.layer.activeFilterId,t=null!=e?this.layer.filters.find(t=>t.id===e):null,r=null!=t?t.filterBlocks.find(e=>"solid"===e.filterMode.type):null;return r?r.filterExpression:null}get filterExpressions(){const e=this.layer.activeFilterId,t=null!=e?this.layer.filters.find(t=>t.id===e):null;return t&&t.filterBlocks?t.filterBlocks.toArray().map(e=>[e.filterExpression,R(e)]):[]}get updatingProgressValue(){const e=this.sublayerViews,t=this._loadingComponents+(e?e.length:0);return e.reduce((e,t)=>e+t.updatingProgress,0)/t}isUpdating(){return this._loadingComponents>0||this.sublayerViews&&this.sublayerViews.some(e=>e.updating)}initialize(){Object(g["f"])(this.layer.spatialReference,this.view.spatialReference,this.view.viewingMode),this.initializeSubLayerViews(this.layer.sublayers,this)}destroy(){this.sublayerViews&&(this.sublayerViews.forEach(e=>e.destroy()),this.sublayerViews=null),this._abortController.abort(),this._abortController=null}initializeSubLayerViews(e,t){const r=this,i=this.view;e.forEach(e=>{if(!e.isEmpty)if("building-group"===e.type){const r=new te({sublayer:e,view:i,parent:t});this.initializeSubLayerViews(e.sublayers,r)}else"mesh"===e.geometryType&&(this._loadingComponents++,e.load({signal:this._abortController.signal}).then(()=>{const s=new X({sublayer:e,layerView:r,view:i,parent:t});this.sublayerViews.push(s),this.handles.add([Object(b["a"])(s,"updating",()=>this.notifyChange("updating"),!0),Object(b["a"])(s,"updatingProgress",()=>this.notifyChange("updatingProgressValue"),!0)])}).catch(t=>{Object(c["n"])(t)||ee.error(`Error while creating view for sublayer ${e.id}\nLayer: ${this.layer.url}\n`,t)}).then(()=>{this._loadingComponents--,this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}))})}getGraphicFromIntersectorMetadata(e){for(const t of this.sublayerViews.items)if(t.sublayer.uid===e.sublayerUid)return t.getGraphicFromIntersectorMetadata(e);return null}async fetchPopupFeatures(e,t){if(!Object(s["k"])(t)||!t.clientGraphics||0===t.clientGraphics.length)return;const r=this._findComponent(t.clientGraphics[0].sourceLayer);return Object(s["j"])(r)?void 0:r.fetchPopupFeatures(e,t)}whenGraphicBounds(e){const t=this._findComponent(e.sourceLayer);return Object(s["j"])(t)?Promise.reject():t.whenGraphicBounds(e)}_findComponent(e){return this.sublayerViews.find(t=>e===t.sublayer)}highlight(e){e instanceof p["a"]?e=[e]:e instanceof d["a"]&&(e=e.toArray());const t=[];if(Array.isArray(e)&&e.length>0&&e[0]instanceof p["a"]){const r=e,i=new Map;for(const e of r){let t=i.get(e.sourceLayer);null==t&&(t=[],i.set(e.sourceLayer,t)),t.push(e)}this.sublayerViews.forEach(e=>{const r=i.get(e.sublayer);r&&t.push(e.highlight(r))})}return Object(n["b"])(t)}getUsedMemory(){return this.sublayerViews.reduce((e,t)=>e+t.getUsedMemory(),0)}getUnloadedMemory(){return this.sublayerViews.reduce((e,t)=>e+t.getUnloadedMemory(),0)}ignoresMemoryFactor(){return!1}};Object(i["a"])([Object(o["b"])()],re.prototype,"sublayerViews",void 0),Object(i["a"])([Object(o["b"])({readOnly:!0})],re.prototype,"filterExpression",null),Object(i["a"])([Object(o["b"])({readOnly:!0})],re.prototype,"filterExpressions",null),Object(i["a"])([Object(o["b"])(h["a"])],re.prototype,"updatingProgress",void 0),Object(i["a"])([Object(o["b"])({readOnly:!0,dependsOn:[]})],re.prototype,"updatingProgressValue",null),re=Object(i["a"])([Object(l["a"])("esri.views.3d.layers.BuildingSceneLayerView3D")],re);var ie=re;t["default"]=ie},"2e4d":function(e,t,r){"use strict";var i=r("a4ee"),s=(r("c120"),r("e92d"),r("cea0")),a=r("59b2"),n=r("afcf"),o=r("d386"),l=(r("e041"),r("8eed"),r("f402"),r("a5d8")),c=r("e694"),u=r("22f4");let d=class extends(Object(l["a"])(c["b"])){constructor(e){super(e),this.title="",this.id=-1,this.modelName=null,this.isEmpty=null,this.visible=!0,this.opacity=1}readTitle(e,t){return"string"==typeof t.alias?t.alias:"string"==typeof t.name?t.name:""}readIdOnlyOnce(e){return-1!==this.id?this.id:"number"==typeof e?e:void 0}};Object(i["a"])([Object(a["b"])({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],d.prototype,"title",void 0),Object(i["a"])([Object(n["a"])("service","title",["alias","name"])],d.prototype,"readTitle",null),Object(i["a"])([Object(a["b"])()],d.prototype,"layer",void 0),Object(i["a"])([Object(a["b"])({type:s["a"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"id",void 0),Object(i["a"])([Object(n["a"])("service","id")],d.prototype,"readIdOnlyOnce",null),Object(i["a"])([Object(a["b"])(Object(u["k"])(String))],d.prototype,"modelName",void 0),Object(i["a"])([Object(a["b"])(Object(u["k"])(Boolean))],d.prototype,"isEmpty",void 0),Object(i["a"])([Object(a["b"])({type:Boolean,json:{name:"visibility",write:!0}})],d.prototype,"visible",void 0),Object(i["a"])([Object(a["b"])({type:Number,json:{write:!0}})],d.prototype,"opacity",void 0),d=Object(i["a"])([Object(o["a"])("esri.layers.buildingSublayers.BuildingSublayer")],d);var p=d;t["a"]=p},"33c9":function(e,t,r){"use strict";var i,s=r("a4ee"),a=(r("c120"),r("7ffa")),n=(r("e92d"),r("cea0"),r("59b2")),o=r("fa8a"),l=r("d386"),c=r("09db"),u=(r("e041"),r("8eed"),r("f402"),r("6a0e")),d=r("a9ab"),p=r("e06a"),b=r("658b"),y=r("c64f");const h=new o["a"]({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),O=new o["a"]({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let j=i=class extends u["a"]{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||"1=1"}enable(){this._set("enabled",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:l}=this;return new y["a"]({geometry:Object(a["a"])(r),objectIds:Object(a["a"])(n),spatialRelationship:i,timeExtent:Object(a["a"])(s),where:t,units:o,distance:l,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:s,timeExtent:n,objectIds:o,units:l,distance:c}=this,u=new Set;return s.forEach(e=>u.add(e)),new i({geometry:Object(a["a"])(t),hiddenIds:u,objectIds:Object(a["a"])(o),spatialRelationship:r,timeExtent:Object(a["a"])(n),where:e,units:l,distance:c})}};Object(s["a"])([Object(n["b"])({type:String})],j.prototype,"where",void 0),Object(s["a"])([Object(c["a"])("where")],j.prototype,"writeWhere",null),Object(s["a"])([Object(n["b"])({types:p["a"],json:{read:d["a"],write:!0}})],j.prototype,"geometry",void 0),Object(s["a"])([Object(n["b"])({type:String,json:{read:{source:"spatialRel",reader:h.read},write:{target:"spatialRel",writer:h.write}}})],j.prototype,"spatialRelationship",void 0),Object(s["a"])([Object(n["b"])({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],j.prototype,"hiddenIds",void 0),Object(s["a"])([Object(n["b"])({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],j.prototype,"distance",void 0),Object(s["a"])([Object(n["b"])({type:[Number],json:{write:!0}})],j.prototype,"objectIds",void 0),Object(s["a"])([Object(n["b"])({type:String,json:{read:O.read,write:{writer:O.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],j.prototype,"units",void 0),Object(s["a"])([Object(n["b"])({type:b["a"],json:{write:!0}})],j.prototype,"timeExtent",void 0),Object(s["a"])([Object(n["b"])({readOnly:!0})],j.prototype,"enabled",void 0),j=i=Object(s["a"])([Object(l["a"])("esri.views.layers.support.FeatureFilter")],j);var f=j;t["a"]=f},"433f":function(e,t,r){"use strict";var i,s=r("a4ee"),a=(r("c120"),r("e92d"),r("cea0"),r("59b2")),n=r("0028"),o=r("d386"),l=(r("e041"),r("8eed"),r("f402"),r("2c4f")),c=r("1853"),u=r("2e4d"),d=r("e814");const p={type:l["a"],readOnly:!0,json:{origins:{service:{read:{source:"sublayers",reader:b}}},read:!1}};function b(e,t,r){if(e&&Array.isArray(e))return new l["a"](e.map(e=>{const t=h(e);if(t){const i=new t;return i.read(e,r),i}r&&r.messages&&e&&r.messages.push(new n["a"]("building-scene-layer:unsupported-sublayer-type","Building scene sublayer of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:r}))}))}let y=i=class extends u["a"]{constructor(e){super(e),this.type="building-group",this.listMode="show",this.sublayers=null}loadAll(){return Object(c["b"])(this,e=>i.forEachSublayer(this.sublayers,t=>{"building-group"!==t.type&&e(t)}))}};function h(e){return"group"===e.layerType?y:d["a"]}Object(s["a"])([Object(a["b"])({type:["hide","show","hide-children"],json:{write:!0}})],y.prototype,"listMode",void 0),Object(s["a"])([Object(a["b"])(p)],y.prototype,"sublayers",void 0),y=i=Object(s["a"])([Object(o["a"])("esri.layers.buildingSublayers.BuildingGroupSublayer")],y),function(e){function t(e,r){e.forEach(e=>{r(e),"building-group"===e.type&&t(e.sublayers,r)})}e.sublayersProperty=p,e.readSublayers=b,e.forEachSublayer=t}(y||(y={}));var O=y;t["a"]=O},"4bb0":function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var i=r("a4ee"),s=(r("c120"),r("b2b2")),a=r("e92d"),n=(r("cea0"),r("59b2")),o=r("d386"),l=(r("e041"),r("8eed"),r("f402"),r("b50f")),c=r("fc29"),u=r("5996"),d=r("9786"),p=(r("e06a"),r("e431")),b=r("3795"),y=r("8048"),h=r("9180"),O=r("8188"),j=r("66a2"),f=r("4261"),g=r("33c9"),m=r("ee9c");const v=a["a"].getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");let w,x=class extends c["a"]{constructor(e){super(e),this._projectionEngineLoaded=!1}initialize(){Object(b["k"])(this,"filter.geometry").then(()=>this.loadAsyncModule(E().then(e=>{this.destroyed||(this._geometryEngine=e,this.applyFilters())})))}get sortedObjectIds(){if(Object(s["j"])(this.filter.objectIds))return null;const e=new Float64Array(this.filter.objectIds);return e.sort(),e}get parsedWhereClause(){const e=Object(s["k"])(this.filter)?this.filter.where:null;if(Object(s["j"])(e)||!e)return null;try{return j["WhereClause"].create(e,this.layerFieldsIndex)}catch(t){v.error("Failed to parse filter where clause: "+t)}return null}addFilters(e,t,r,i){const a=this.sortedObjectIds;Object(s["k"])(a)&&e.push(e=>Object(m["v"])(a,!0,e)),this.addSqlFilter(e,this.parsedWhereClause);const n=this.parsedGeometry;if(Object(s["k"])(n)){const s=this.spatialRelationship;e.push((e,a)=>M(e,a,i,t,r,n,s))}}isMBSGeoemtryVisible(e,t,r){const i=this.parsedGeometry;if(Object(s["k"])(i)){const s=this.spatialRelationship,a=i[0].spatialReference||t;return Object(O["p"])(e,r,Q,a)?R(Q,i,a,s):(v.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}get parsedGeometry(){if(Object(s["j"])(this.filter))return null;if(!this._geometryEngine)return null;const{geometry:e}=this.filter;if(Object(s["j"])(e))return null;const{distance:t,units:r}=this.filter,i=this.spatialRelationship,a="mesh"===e.type?e.extent:e;if(Object(s["j"])(t)||0===t)return _(a,i);const n=r||Object(y["g"])(a.spatialReference);if(a.spatialReference.isWGS84)return _(this._geometryEngine.geodesicBuffer(a,t,n),i);if(Object(d["a"])(a,u["a"].WGS84))return _(Object(d["d"])(this._geometryEngine.geodesicBuffer(Object(d["d"])(a,u["a"].WGS84),t,n),a.spatialReference),i);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(Object(O["j"])().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let o=null;try{o=Object(O["n"])(a,u["a"].WGS84)}catch(l){}if(o)try{o=Object(O["n"])(this._geometryEngine.geodesicBuffer(o,t,n),a.spatialReference)}catch(l){o=null}return o||v.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${a.spatialReference.wkid}) to WGS84.`),_(o,i)}get spatialRelationship(){return Object(s["k"])(this.filter)?this.filter.spatialRelationship:"intersects"}static checkSupport(e){return e.timeExtent?(v.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1):!!I(e.spatialRelationship)||(v.warn(`Filters with spatialRelationship other than ${S.join(", ")} are not supported for mesh scene layers`),!1)}};function F(){return!!w}async function E(){return F()||(w=await Promise.all([r.e("chunk-2d22cf8c"),r.e("chunk-1900908c")]).then(r.bind(null,"ea51"))),w}Object(i["a"])([Object(n["b"])({type:g["a"]})],x.prototype,"filter",void 0),Object(i["a"])([Object(n["b"])()],x.prototype,"layerFieldsIndex",void 0),Object(i["a"])([Object(n["b"])()],x.prototype,"loadAsyncModule",void 0),Object(i["a"])([Object(n["b"])()],x.prototype,"applyFilters",void 0),Object(i["a"])([Object(n["b"])()],x.prototype,"addSqlFilter",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0})],x.prototype,"sortedObjectIds",null),Object(i["a"])([Object(n["b"])({readOnly:!0})],x.prototype,"parsedWhereClause",null),Object(i["a"])([Object(n["b"])({readOnly:!0})],x.prototype,"parsedGeometry",null),Object(i["a"])([Object(n["b"])({readOnly:!0})],x.prototype,"spatialRelationship",null),Object(i["a"])([Object(n["b"])()],x.prototype,"_projectionEngineLoaded",void 0),Object(i["a"])([Object(n["b"])()],x.prototype,"_geometryEngine",void 0),x=Object(i["a"])([Object(o["a"])("esri.views.3d.layers.i3s.I3SMeshViewFilter")],x);const S=(e=>e)(["contains","intersects","disjoint"]);function I(e){return null!=e&&S.indexOf(e)>=0}function _(e,t){if(!e)return null;if("disjoint"===t&&"polygon"===e.type){const t=new Array(e.rings.length);for(let s=0;s<e.rings.length;++s){const r=Object(h["t"])(1/0,1/0,-1/0,-1/0);Object(h["r"])(r,e.rings[s]),t[s]={type:"polygon",rings:[e.rings[s]],spatialReference:e.spatialReference,aabr:r}}t.sort((e,t)=>e.aabr[0]-t.aabr[0]);const r=new Set,i=new l["a"];for(let e=0;e<t.length;++e){const s=t[e];for(let i=e+1;i<t.length;++i){const e=t[i];if(e.aabr[0]>=s.aabr[2])break;r.add(e)}r.forEach(e=>{if(s!==e)if(e.aabr[2]<=s.aabr[0])r.delete(e);else if(w.intersects(s,e)){s.rings=s.rings.concat(e.rings),Object(h["p"])(s.aabr,e.aabr),delete s._geVersion,r.delete(e);const a=Object(l["g"])(t,e,t.length,i);t.splice(a,1)}}),r.add(s)}for(const e of t)delete e.aabr;return t}return[e]}function R(e,t,r,i){const s=C(e,r);return t.every(e=>1!==L(e,s,i))}function M(e,t,r,i,s,a,n){const o=a[0].spatialReference||i.spatialReference;if(!Object(O["p"])(t.node.mbs,s,Q,o))return void v.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter");const l=C(Q,o),c=k(n,i,o,r,t.objectHandle);for(const u of a){if(0===e.length)return;switch(L(u,l,n)){case 1:return void(e.length=0);case 0:continue}Object(m["k"])(e,t.featureIds,e=>N(u,e,c))}}const Q=[0,0,0,0];function k(e,t,r,i,s){const a=t.renderSpatialReference,n=new Map,o={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:r};o.rings[0][3]=o.rings[0][0];const l={indices:null,data:null,stride:0,startIndex:0,endIndex:0};let c,u;switch(e){case"intersects":c=(e,t)=>w.intersects(e,t)?0:2,u=T;break;case"contains":c=(e,t)=>w.contains(e,t)?2:1,u=T;break;case"disjoint":default:c=(e,t)=>w.disjoint(e,t)?2:1,u=P}return{collection:i,object:s,type:e,maskSR:r,renderSR:a,aabbCache:n,triangle:o,positions:l,triangleTest:c,geometryTest:u}}function C(e,t){const r={x:e[0],y:e[1],hasZ:!1,hasM:!1,type:"point",spatialReference:t},i=t.isWGS84||t.isWebMercator?w.geodesicBuffer(r,e[3],1):w.buffer(r,e[3],1);return i.type="polygon",i}function L(e,t,r){switch(r){case"intersects":case"contains":return T(e,t);case"disjoint":return P(e,t)}}function T(e,t){return w.intersects(e,t)?w.contains(e,t)?0:2:1}function P(e,t){return w.intersects(e,t)?w.contains(e,t)?1:2:0}const q=2**-32;function N(e,t,r){const{collection:i,object:s,renderSR:a,maskSR:n,geometryTest:o,aabbCache:l}=r;let c=l.get(t);if(!c){const e=i.getObjectTransform(s);i.getComponentAabb(s,t,V);const r=[[V[0],V[1],0],[V[0],V[4],0],[V[3],V[4],0],[V[3],V[1],0]];for(let t=0;t<4;++t)Object(p["y"])(r[t],r[t],e.rotationScale),Object(p["g"])(r[t],r[t],e.position),Object(O["y"])(r[t],a,r[t],n);c={rings:[r],hasZ:!1,hasM:!1,type:"polygon",spatialReference:n},c.rings[0][4]=c.rings[0][0],l.set(t,c)}switch(o(e,c)){case 1:return!1;case 0:return!0}const{triangle:u,triangleTest:d,positions:b}=r,y=u.rings[0][0],h=u.rings[0][1],j=u.rings[0][2],f=i.getObjectTransform(s);i.getComponentPositions(s,t,b);const{indices:g,data:m,stride:v,startIndex:w,endIndex:x}=b;for(let F=w;F<x;F+=3){const t=v*g[F+0],r=v*g[F+1],i=v*g[F+2];Object(p["x"])(y,m[t+0],m[t+1],m[t+2]),Object(p["x"])(h,m[r+0],m[r+1],m[r+2]),Object(p["x"])(j,m[i+0],m[i+1],m[i+2]),Object(p["y"])(y,y,f.rotationScale),Object(p["y"])(h,h,f.rotationScale),Object(p["y"])(j,j,f.rotationScale),Object(p["g"])(y,y,f.position),Object(p["g"])(h,h,f.position),Object(p["g"])(j,j,f.position),Object(O["y"])(y,a,y,n),Object(O["y"])(h,a,h,n),Object(O["y"])(j,a,j,n);const s=h[0]-y[0],o=h[1]-y[1],l=j[0]-y[0],c=j[1]-y[1];if(!(Math.abs(s*c-o*l)<q))switch(delete u._geVersion,d(e,u)){case 1:return!1;case 0:return!0}}switch(r.type){case"intersects":return!1;case"contains":case"disjoint":default:return!0}}const V=Object(f["h"])()},"5d34":function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return b}));var i=r("a4ee"),s=(r("c120"),r("e92d"),r("cea0"),r("59b2")),a=r("448d"),n=r("d386"),o=(r("e041"),r("8eed"),r("f402"),r("6a0e"));let l=class extends o["a"]{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};Object(i["a"])([Object(s["b"])({type:Number})],l.prototype,"nodesPerPage",void 0),Object(i["a"])([Object(s["b"])({type:Number})],l.prototype,"rootIndex",void 0),Object(i["a"])([Object(s["b"])({type:String})],l.prototype,"lodSelectionMetricType",void 0),l=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SNodePageDefinition")],l);let c=class extends o["a"]{constructor(){super(...arguments),this.factor=1}};Object(i["a"])([Object(s["b"])({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0),Object(i["a"])([Object(s["b"])({type:Number})],c.prototype,"factor",void 0),c=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SMaterialTexture")],c);let u=class extends o["a"]{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};Object(i["a"])([Object(s["b"])({type:[Number]})],u.prototype,"baseColorFactor",void 0),Object(i["a"])([Object(s["b"])({type:c})],u.prototype,"baseColorTexture",void 0),Object(i["a"])([Object(s["b"])({type:c})],u.prototype,"metallicRoughnessTexture",void 0),Object(i["a"])([Object(s["b"])({type:Number})],u.prototype,"metallicFactor",void 0),Object(i["a"])([Object(s["b"])({type:Number})],u.prototype,"roughnessFactor",void 0),u=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SMaterialPBRMetallicRoughness")],u);let d=class extends o["a"]{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};Object(i["a"])([Object(a["a"])({opaque:"opaque",mask:"mask",blend:"blend"})],d.prototype,"alphaMode",void 0),Object(i["a"])([Object(s["b"])({type:Number})],d.prototype,"alphaCutoff",void 0),Object(i["a"])([Object(s["b"])({type:Boolean})],d.prototype,"doubleSided",void 0),Object(i["a"])([Object(a["a"])({none:"none",back:"back",front:"front"})],d.prototype,"cullFace",void 0),Object(i["a"])([Object(s["b"])({type:c})],d.prototype,"normalTexture",void 0),Object(i["a"])([Object(s["b"])({type:c})],d.prototype,"occlusionTexture",void 0),Object(i["a"])([Object(s["b"])({type:c})],d.prototype,"emissiveTexture",void 0),Object(i["a"])([Object(s["b"])({type:[Number]})],d.prototype,"emissiveFactor",void 0),Object(i["a"])([Object(s["b"])({type:u})],d.prototype,"pbrMetallicRoughness",void 0),d=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SMaterialDefinition")],d);let p=class extends o["a"]{};Object(i["a"])([Object(s["b"])({type:String,json:{read:{source:["name","index"],reader:(e,t)=>null!=e?e:""+t.index}}})],p.prototype,"name",void 0),Object(i["a"])([Object(a["a"])({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",basis:"basis"})],p.prototype,"format",void 0),p=Object(i["a"])([Object(n["a"])("esri.layer.support.I3STextureFormat")],p);let b=class extends o["a"]{constructor(){super(...arguments),this.atlas=!1}};Object(i["a"])([Object(s["b"])({type:[p]})],b.prototype,"formats",void 0),Object(i["a"])([Object(s["b"])({type:Boolean})],b.prototype,"atlas",void 0),b=Object(i["a"])([Object(n["a"])("esri.layer.support.I3STextureSetDefinition")],b);let y=class extends o["a"]{};Object(i["a"])([Object(a["a"])({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],y.prototype,"type",void 0),Object(i["a"])([Object(s["b"])({type:Number})],y.prototype,"component",void 0),y=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SGeometryAttribute")],y);let h=class extends o["a"]{};Object(i["a"])([Object(a["a"])({draco:"draco"})],h.prototype,"encoding",void 0),Object(i["a"])([Object(s["b"])({type:[String]})],h.prototype,"attributes",void 0),h=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SGeometryCompressedAttributes")],h);let O=class extends o["a"]{constructor(){super(...arguments),this.offset=0}};Object(i["a"])([Object(s["b"])({type:Number})],O.prototype,"offset",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"position",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"normal",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"uv0",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"color",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"uvRegion",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"featureId",void 0),Object(i["a"])([Object(s["b"])({type:y})],O.prototype,"faceRange",void 0),Object(i["a"])([Object(s["b"])({type:h})],O.prototype,"compressedAttributes",void 0),O=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SGeometryBuffer")],O);let j=class extends o["a"]{};Object(i["a"])([Object(a["a"])({triangle:"triangle"})],j.prototype,"topology",void 0),Object(i["a"])([Object(s["b"])()],j.prototype,"geometryBuffers",void 0),j=Object(i["a"])([Object(n["a"])("esri.layer.support.I3SGeometryDefinition")],j)},"6e36":function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r("b2b2"),s=r("ce50"),a=r("2eab");async function n(e,t,r,n,o){let l=null;if(Object(i["k"])(r)){const t=e+"/nodepages/",s=t+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await Object(a["default"])(s,{query:{f:"json"},responseType:"json",signal:o})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:t}}catch(d){Object(i["k"])(n)&&n.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",s,d),l=d}}if(!t)return null;const c=e+"/nodes/",u=c+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await Object(a["default"])(u,{query:{f:"json"},responseType:"json",signal:o})).data,urlPrefix:c}}catch(d){throw new s["a"]("sceneservice:root-node-missing","Root node missing.",{pageError:l,nodeError:d,url:u})}}},"7eab":function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));const i={attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsStatistics:!1,tileMaxRecordCount:0}}},"8ea5":function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r("b2b2"),s=r("8152"),a=r("d97e"),n=r("4261"),o=r("ee9c");class l{constructor(e){this.objectIdField=e.objectIdField,this.getFeatureExtent=e.getFeatureExtent}getObjectId(e){return e.id}getAttributes(e){const{meta:t,index:r}=e,s={};this.objectIdField&&(s[this.objectIdField]=e.id);const a=Object(i["k"])(t.attributeInfo)&&t.attributeInfo.attributeData;if(Object(i["k"])(a))for(const i of Object.keys(a))s[i]=Object(o["o"])(a[i],r);return s}getAttribute(e,t){if(t===this.objectIdField)return e.id;const{meta:r,index:s}=e,a=Object(i["k"])(r.attributeInfo)&&r.attributeInfo.attributeData;return Object(i["k"])(a)?Object(o["o"])(a[t],s):null}getGeometry(e){if(e.geometry)return e.geometry;const[t,r,i,a,n]=this.getFeatureExtent(e,c);return new s["a"]([5],[t,r,i,a,r,i,a,n,i,t,n,i,t,r,i])}getCentroid(e,t){if(e.geometry)return Object(a["a"])(new s["a"],e.geometry,t.hasZ,t.hasM);const[r,i,n,o,l,u]=this.getFeatureExtent(e,c);return new s["a"]([0],[(r+o)/2,(i+l)/2,(n+u)/2])}cloneWithGeometry(e,t){const{id:r,index:i,meta:s}=e;return{id:r,index:i,meta:s,geometry:t}}}const c=Object(n["h"])()},ad73:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r("b2b2"),s=r("c1da");async function a(e,t=e.popupTemplate){if(!Object(i["k"])(t))return[];const r=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:a}=t,{objectIdField:n,typeIdField:o,globalIdField:l,relationships:c}=e;if(r.includes("*"))return["*"];const u=a?await Object(s["m"])(e):[],d=Object(s["i"])(e.fields,[...r,...u]);return o&&d.push(o),d&&n&&Object(s["p"])(e.fields,n)&&-1===d.indexOf(n)&&d.push(n),d&&l&&Object(s["p"])(e.fields,l)&&-1===d.indexOf(l)&&d.push(l),c&&c.forEach(t=>{const{keyField:r}=t;d&&r&&Object(s["p"])(e.fields,r)&&-1===d.indexOf(r)&&d.push(r)}),d}function n(e,t){return e.popupTemplate?e.popupTemplate:Object(i["k"])(t)&&t.defaultPopupTemplateEnabled&&Object(i["k"])(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},e814:function(e,t,r){"use strict";var i=r("a4ee"),s=(r("c120"),r("b2b2")),a=r("e92d"),n=(r("cea0"),r("59b2")),o=r("fa8a"),l=r("448d"),c=r("afcf"),u=r("d386"),d=r("ce50"),p=(r("e041"),r("8eed"),r("f402"),r("5996")),b=r("3af1"),y=r("4856"),h=r("2eab"),O=r("fab3"),j=r("6d5f"),f=r("fd14"),g=r("22f4"),m=(r("667b"),r("b423"),r("da00"),r("261a"),r("b48d"),r("478c"),r("ff57"),r("5cdb")),v=(r("f976"),r("80b7")),w=r("2feb"),x=r("f51b"),F=r("c64f"),E=r("5bd5"),S=r("2e4d"),I=r("7eab"),_=r("6e36"),R=r("5d34");const M=a["a"].getLogger("esri.layers.buildingSublayers.BuildingComponentSublayer"),Q=Object(w["a"])();let k=class extends(j["a"].LoadableMixin(Object(O["b"])(S["a"]))){constructor(e){super(e),this.type="building-component",this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.fields=null,this.associatedLayer=null,this.outFields=null,this.listMode="show",this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType="3d-object"}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl.path}/sublayers/${this.id}`,query:this.layer.parsedUrl.query}:null}get fieldsIndex(){return new v["a"](this.fields)}readAssociatedLayer(e,t){const r=this.layer.associatedFeatureServiceItem,i=t.associatedLayerID;return Object(s["k"])(r)&&"number"==typeof i?new E["default"]({portalItem:r,layerId:i}):null}get objectIdField(){if(null!=this.fields)for(const e of this.fields)if("oid"===e.type)return e.name;return null}get displayField(){return Object(s["k"])(this.associatedLayer)?this.associatedLayer.displayField:null}get defaultPopupTemplate(){return this.createPopupTemplate()}load(e){const t=Object(s["k"])(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t).then(()=>{this.indexInfo=Object(_["a"])(this.parsedUrl.path,this.rootNode,this.nodePages,M,t)})),Promise.resolve(this)}createPopupTemplate(e){return Object(x["a"])(this,e)}async _fetchService(e){const t=(await Object(h["default"])(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:e})).data;this.read(t,{origin:"service",url:this.parsedUrl})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e){const t=this.getField(e);return t&&t.domain?t.domain:null}get geometryType(){return"3d-object"===this.layerType?"mesh":"point"}get profile(){return"3d-object"===this.layerType?"mesh-pyramids":"points"}get capabilities(){const e=Object(s["k"])(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:I["a"],{query:t,data:{supportsZ:r,supportsM:i,isVersioned:a}}=e;return{query:t,data:{supportsZ:r,supportsM:i,isVersioned:a}}}createQuery(){const e=new F["a"];return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e&&e.features)for(const t of e.features)t.layer=this.layer,t.sourceLayer=this;return e})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}getFieldUsageInfo(e){return this.fieldsIndex.has(e)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:Object(s["k"])(this.associatedLayer)}}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return Object(s["k"])(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),Object(s["j"])(this.associatedLayer))throw new d["a"]("buildingscenelayer:query-not-available","BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new d["a"]("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}};Object(i["a"])([Object(n["b"])({readOnly:!0})],k.prototype,"parsedUrl",null),Object(i["a"])([Object(n["b"])({type:R["c"],readOnly:!0})],k.prototype,"nodePages",void 0),Object(i["a"])([Object(n["b"])({type:[R["b"]],readOnly:!0})],k.prototype,"materialDefinitions",void 0),Object(i["a"])([Object(n["b"])({type:[R["d"]],readOnly:!0})],k.prototype,"textureSetDefinitions",void 0),Object(i["a"])([Object(n["b"])({type:[R["a"]],readOnly:!0})],k.prototype,"geometryDefinitions",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0})],k.prototype,"serviceUpdateTimeStamp",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0})],k.prototype,"store",void 0),Object(i["a"])([Object(n["b"])({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],k.prototype,"rootNode",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0})],k.prototype,"attributeStorageInfo",void 0),Object(i["a"])([Object(n["b"])(Q.fields)],k.prototype,"fields",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0})],k.prototype,"fieldsIndex",null),Object(i["a"])([Object(n["b"])({readOnly:!0,type:E["default"]})],k.prototype,"associatedLayer",void 0),Object(i["a"])([Object(c["a"])("service","associatedLayer",["associatedLayerID"])],k.prototype,"readAssociatedLayer",null),Object(i["a"])([Object(n["b"])(Q.outFields)],k.prototype,"outFields",void 0),Object(i["a"])([Object(n["b"])({type:String,readOnly:!0})],k.prototype,"objectIdField",null),Object(i["a"])([Object(n["b"])({readOnly:!0,type:String,json:{read:!1}})],k.prototype,"displayField",null),Object(i["a"])([Object(n["b"])({readOnly:!0,type:b["a"],aliasOf:"layer.fullExtent"})],k.prototype,"fullExtent",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,type:p["a"],aliasOf:"layer.spatialReference"})],k.prototype,"spatialReference",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,aliasOf:"layer.version"})],k.prototype,"version",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,type:f["a"],aliasOf:"layer.elevationInfo"})],k.prototype,"elevationInfo",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,type:Number,aliasOf:"layer.minScale"})],k.prototype,"minScale",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,type:Number,aliasOf:"layer.maxScale"})],k.prototype,"maxScale",void 0),Object(i["a"])([Object(n["b"])({type:["hide","show"],json:{write:!0}})],k.prototype,"listMode",void 0),Object(i["a"])([Object(n["b"])({types:m["b"],json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],k.prototype,"renderer",void 0),Object(i["a"])([Object(n["b"])({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],k.prototype,"definitionExpression",void 0),Object(i["a"])([Object(n["b"])(g["j"])],k.prototype,"popupEnabled",void 0),Object(i["a"])([Object(n["b"])({type:y["a"],json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],k.prototype,"popupTemplate",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],k.prototype,"normalReferenceFrame",void 0),Object(i["a"])([Object(n["b"])({readOnly:!0,json:{read:!1}})],k.prototype,"defaultPopupTemplate",null),Object(i["a"])([Object(n["b"])({json:{write:!1}}),Object(l["a"])(new o["a"]({"3DObject":"3d-object",Point:"point"}))],k.prototype,"layerType",void 0),Object(i["a"])([Object(n["b"])()],k.prototype,"geometryType",null),Object(i["a"])([Object(n["b"])()],k.prototype,"profile",null),Object(i["a"])([Object(n["b"])({readOnly:!0,json:{read:!1}})],k.prototype,"capabilities",null),k=Object(i["a"])([Object(u["a"])("esri.layers.buildingSublayers.BuildingComponentSublayer")],k);var C=k;t["a"]=C}}]);
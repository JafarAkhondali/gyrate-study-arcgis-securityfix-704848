{"version":3,"sources":["webpack:///./node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js","webpack:///./node_modules/@arcgis/core/layers/graphics/sources/support/clientSideDefaults.js"],"names":["async","b","e","t","data","Promise","r","a","FileReader","readAsDataURL","onload","result","onerror","F","Set","R","super","arguments","this","type","signal","addResolvingPromise","_fetchService","resolve","capabilities","query","supportsFormatPBF","parsedUrl","dynamicDataSource","gdbVersion","s","spatialReference","o","fieldsIndex","i","layer","u","url","path","format","sourceSpatialReference","load","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","body","_createFeatureEditResult","addAttachmentResult","_createAttachmentErrorResult","attachmentId","updateAttachmentResult","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","globalIdUsed","deleteAttachments","c","addAttachments","push","_serializeAttachment","updateAttachments","n","length","adds","updates","deletes","l","method","JSON","stringify","join","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","attachments","d","_createEditsResult","attachmentIds","deleteAttachmentResults","then","returnUpdates","layerId","id","extent","fullExtent","timeExtent","fromJSON","start","end","get","objectIds","all","parentObjectId","attachmentInfos","queryTask","executeAttachmentQuery","execute","customParameters","executeJSON","executeForIds","executeForCount","executeForExtent","executeRelationshipQuery","executeRelationshipQueryForCount","sourceJSON","returnAdvancedSymbols","_patchServiceJSON","has","geometryType","drawingInfo","renderer","defaultSymbol","geometry","toJSON","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","mediaType","File","_canUseGlobalIds","_getGlobalIdsFromFeatureIdentifier","_getObjectIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","addFeatureResults","addResults","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","f","responseType","prototype","constructOnly","readOnly","q","symbol","indexOf","Function"],"mappings":"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","file":"js/chunk-9ca80934.566f16ac.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/has.js\";import{fixJson as r}from\"../../../core/lang.js\";import{setDeepValue as a}from\"../../../core/object.js\";import{isSome as s,isNone as o}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../core/Error.js\";import{dataComponents as l}from\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import d from\"../../../geometry/Extent.js\";import c from\"../../../request.js\";import h from\"../../../core/Loadable.js\";import y from\"../../../TimeExtent.js\";import{unapplyEditsZUnitScaling as p}from\"../../../rest/query/operations/zscale.js\";import{processAttachmentQueryResult as m}from\"../../../rest/query/operations/queryAttachments.js\";import f from\"../../../tasks/QueryTask.js\";import{createDrawingInfo as g}from\"./support/clientSideDefaults.js\";async function b(e){if(\"string\"==typeof e){const t=l(e);return t||{data:e}}return new Promise(((t,r)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(l(a.result)),a.onerror=e=>r(e)}))}const F=new Set([\"Feature Layer\",\"Table\"]);let R=class extends h{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=s(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:a,gdbVersion:s,spatialReference:o,fieldsIndex:i}=this.layer,u=t(\"featurelayer-pbf\")&&e?\"pbf\":\"json\";return new f({url:r.path,format:u,fieldsIndex:i,dynamicDataSource:a,gdbVersion:s,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/addAttachment\",s=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,s.query);try{const e=await c(a,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(i){throw this._createAttachmentErrorResult(r,i)}}async updateAttachment(e,t,r){await this.load();const a=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+a+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),i=this._getFormDataForAttachment(r,o.query);try{const e=await c(s,{body:i});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(a,u)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),s=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);p(r,a,this.layer.spatialReference);const o=[],i=[],u=[...e.deleteAttachments];for(const c of e.addAttachments)o.push(await this._serializeAttachment(c));for(const c of e.updateAttachments)i.push(await this._serializeAttachment(c));const n=o.length||i.length||u.length?{adds:o,updates:i,deletes:u}:null,l=this._getLayerRequestOptions({method:\"post\",query:{adds:r.length?JSON.stringify(r):null,updates:a.length?JSON.stringify(a):null,deletes:s.length?null!=t&&t.globalIdUsed?JSON.stringify(s):s.join(\",\"):null,gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:n&&JSON.stringify(n)}}),d=await c(this.layer.parsedUrl.path+\"/applyEdits\",l);return this._createEditsResult(d)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+r+\"/deleteAttachments\";try{return(await c(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(s){throw this._createAttachmentErrorResult(r,s)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:a}=this.layer,{data:s}=await c(`${a}/${r}`,t),{id:o,extent:i,fullExtent:u,timeExtent:n}=s,l=i||u;return{id:o,fullExtent:l&&d.fromJSON(l),timeExtent:n&&y.fromJSON({start:n[0],end:n[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,a=r.path;await this.load();const s=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,r=[];for(const e of t){const t=a+\"/\"+e+\"/attachments\";r.push(c(t,s))}return Promise.all(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>m(e,a)))}return this.queryTask.executeAttachmentQuery(e,s)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})}async _fetchService(e){let r=this.layer.sourceJSON;if(!r){const{data:a}=await c(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:t(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));r=a}this.sourceJSON=this._patchServiceJSON(r);const a=r.type;if(!F.has(a))throw new n(\"feature-layer-source:unsupported-type\",`Source type \"${a}\" is not supported`)}_patchServiceJSON(e){var t;if(\"Table\"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=g(e.geometryType).renderer;a(\"drawingInfo.renderer\",t,e)}return e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return o(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:a,name:s,contentType:o,data:i,uploadId:u}=r,n={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(n.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),u)n.uploadId=u;else if(i){const e=await b(i);n.contentType=e.mediaType,n.data=e.data,i instanceof File&&(n.name=i.name)}return s&&(n.name=s),o&&(n.contentType=o),n}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):\"objectId\"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&\"globalId\"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new n(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,a=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new n(\"feature-layer-source:attachment-failure\",r,{code:a})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const a in t){const e=t[a];null!=e&&(r.set?r.set(a,e):r.append(a,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:a,dynamicDataSource:s}=this.layer;return{...e,query:r({gdbVersion:a,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:\"json\",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:\"json\"}}};e([i()],R.prototype,\"type\",void 0),e([i({constructOnly:!0})],R.prototype,\"layer\",void 0),e([i({readOnly:!0})],R.prototype,\"queryTask\",null),R=e([u(\"esri.layers.graphics.sources.FeatureLayerSource\")],R);var q=R;export default q;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/has.js\";import{clone as r}from\"../../../../core/lang.js\";import{defaultPointSymbolJSON as e,defaultPolylineSymbolJSON as n,defaultPolygonSymbolJSON as o}from\"../../../../symbols/support/defaultsJSON.js\";function i(t){return{renderer:{type:\"simple\",symbol:\"esriGeometryPoint\"===t||\"esriGeometryMultipoint\"===t?e:\"esriGeometryPolyline\"===t?n:o}}}function s(r,e){if(t(\"csp-restrictions\"))return()=>({[e]:null,...r});try{let t=`this.${e} = null;`;for(const e in r){t+=`this${e.indexOf(\".\")?`[\"${e}\"]`:`.${e}`} = ${JSON.stringify(r[e])};`}const n=new Function(t);return()=>new n}catch(n){return()=>({[e]:null,...r})}}function u(t={}){return[{name:\"New Feature\",description:\"\",prototype:{attributes:r(t)}}]}export{s as createDefaultAttributesFunction,u as createDefaultTemplate,i as createDrawingInfo};\n"],"sourceRoot":""}